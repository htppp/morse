<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>モールス練習アプリ v6</title>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const Y="modulepreload",_=function(u,t){return new URL(u,t).href},G={},B=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){let r=function(l){return Promise.all(l.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");n=r(e.map(l=>{if(l=_(l,s),l in G)return;G[l]=!0;const h=l.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(s)for(let m=a.length-1;m>=0;m--){const b=a[m];if(b.href===l&&(!h||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${g}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":Y,h||(v.as="script"),v.crossOrigin="",v.href=l,c&&v.setAttribute("nonce",c),document.head.appendChild(v),h)return new Promise((m,b)=>{v.addEventListener("load",m),v.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})};class J{constructor(){this.currentMode="menu",this.currentController=null,this.routes=new Map,window.addEventListener("hashchange",()=>this.handleHashChange())}register(t,e){this.routes.set(t,e)}async start(){await this.handleHashChange()}async handleHashChange(){const t=window.location.hash.slice(1)||"menu";if(!this.routes.has(t)){window.location.hash="#menu";return}await this.switchMode(t)}async switchMode(t){this.currentController&&(this.currentController.destroy(),this.currentController=null);const e=document.getElementById("app");e&&(e.innerHTML=""),this.currentMode=t;const s=this.routes.get(t);if(s)try{this.currentController=await s()}catch(n){console.error(`Failed to load mode: ${t}`,n),this.showError(`モード「${t}」の読み込みに失敗しました`)}}showError(t){const e=document.getElementById("app");e&&(e.innerHTML=`
			<div class="error-container">
				<h2>エラー</h2>
				<p>${t}</p>
				<a href="#menu" class="btn">メニューに戻る</a>
			</div>
		`)}getCurrentMode(){return this.currentMode}}class X{constructor(){this.router=new J,this.registerRoutes(),this.router.start()}registerRoutes(){this.router.register("menu",async()=>{const{MenuPage:t}=await B(async()=>{const{MenuPage:e}=await Promise.resolve().then(()=>et);return{MenuPage:e}},void 0,import.meta.url);return new t}),this.router.register("vertical",async()=>{const{VerticalKeyTrainer:t}=await B(async()=>{const{VerticalKeyTrainer:e}=await Promise.resolve().then(()=>it);return{VerticalKeyTrainer:e}},void 0,import.meta.url);return new t}),this.router.register("horizontal",async()=>{const{HorizontalKeyTrainer:t}=await B(async()=>{const{HorizontalKeyTrainer:e}=await Promise.resolve().then(()=>ot);return{HorizontalKeyTrainer:e}},void 0,import.meta.url);return new t}),this.router.register("flashcard",async()=>{const{FlashcardTrainer:t}=await B(async()=>{const{FlashcardTrainer:e}=await Promise.resolve().then(()=>ct);return{FlashcardTrainer:e}},void 0,import.meta.url);return new t}),this.router.register("koch",async()=>{const{KochTrainer:t}=await B(async()=>{const{KochTrainer:e}=await Promise.resolve().then(()=>dt);return{KochTrainer:e}},void 0,import.meta.url);return new t}),this.router.register("listening",async()=>{const{ListeningTrainer:t}=await B(async()=>{const{ListeningTrainer:e}=await Promise.resolve().then(()=>bt);return{ListeningTrainer:e}},void 0,import.meta.url);return new t})}}document.addEventListener("DOMContentLoaded",()=>{new X});const Z=[{id:"vertical",title:"縦振り電鍵練習",description:"縦振り電鍵の操作を練習",icon:"⬇️",hash:"#vertical"},{id:"horizontal",title:"横振り電鍵練習",description:"横振り電鍵の操作を練習",icon:"↔️",hash:"#horizontal"},{id:"flashcard",title:"CW略語・Q符号学習",description:"フラッシュカード・試験モード",icon:"📚",hash:"#flashcard"},{id:"koch",title:"コッホ法トレーニング",description:"40文字を段階的に習得",icon:"🎓",hash:"#koch"},{id:"listening",title:"モールス信号聞き取り練習",description:"ラバースタンプQSO・英文の聞き取り",icon:"👂",hash:"#listening"}];class tt{constructor(){this.render()}render(){const t=document.getElementById("app");t&&(t.innerHTML=`
			<div class="container">
				<header class="header">
					<h1>モールス練習アプリ v7</h1>
					<p class="subtitle">練習メニューを選択してください</p>
				</header>

				<div class="menu-grid">
					${Z.map(e=>`
						<a href="${e.hash}" class="menu-card" data-id="${e.id}">
							<div class="menu-icon">${e.icon}</div>
							<h2 class="menu-title">${e.title}</h2>
							<p class="menu-description">${e.description}</p>
						</a>
					`).join("")}
				</div>

				<footer class="footer">
					<p>モールス練習アプリ v7 - モールス信号聞き取り練習版</p>
				</footer>
			</div>
		`)}destroy(){}}const et=Object.freeze(Object.defineProperty({__proto__:null,MenuPage:tt},Symbol.toStringTag,{value:"Module"}));class P{constructor(t={frequency:750,volume:.7,wpm:20}){this.audioContext=null,this.currentOscillator=null,this.currentGain=null,this.isPlaying=!1,this.settings=t,this.loadSettings(),this.init()}ensureAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume()}init(){}updateSettings(t){this.settings={...this.settings,...t}}scheduleTone(t,e){if(this.ensureAudioContext(),!!this.audioContext)try{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.audioContext.destination),s.frequency.value=this.settings.frequency,s.type="sine";const i=this.audioContext.currentTime,a=Math.max(i,t);n.gain.setValueAtTime(0,a),n.gain.linearRampToValueAtTime(this.settings.volume,a+.001),n.gain.setValueAtTime(this.settings.volume,a+(e-1)/1e3),n.gain.linearRampToValueAtTime(0,a+e/1e3),s.start(a),s.stop(a+e/1e3)}catch(s){console.error("音声エラー:",s)}}startContinuousTone(){if(this.ensureAudioContext(),!!this.audioContext)try{this.stopContinuousTone();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.value=this.settings.frequency,t.type="sine";const s=this.audioContext.currentTime;e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(this.settings.volume,s+.001),t.start(s),this.currentOscillator=t,this.currentGain=e}catch(t){console.error("連続音開始エラー:",t)}}stopContinuousTone(){if(this.audioContext)try{if(this.currentOscillator&&this.currentGain){const t=this.audioContext.currentTime;this.currentGain.gain.cancelScheduledValues(t),this.currentGain.gain.setValueAtTime(this.currentGain.gain.value,t),this.currentGain.gain.linearRampToValueAtTime(0,t+.001),this.currentOscillator.stop(t+.002),this.currentOscillator=null,this.currentGain=null}}catch(t){console.error("連続音停止エラー:",t)}}async playMorseString(t){if(this.isPlaying||!t||(this.ensureAudioContext(),!this.audioContext))return!1;this.isPlaying=!0;const e=this.settings.wpm||20,s=Math.min(this.settings.effectiveWpm||e,e),n=1200/e,i=n,a=3*n,o=n,c=3*n,l=7*(1200/s);let h=this.audioContext.currentTime+.02;for(let m=0;m<t.length&&this.isPlaying;m++){const b=t[m];b==="."?(this.scheduleTone(h,i),h+=(i+o)/1e3):b==="-"?(this.scheduleTone(h,a),h+=(a+o)/1e3):b===" "?h+=(c-o)/1e3:b==="/"&&(h+=(l-o)/1e3)}const g=(h-this.audioContext.currentTime)*1e3;await new Promise(m=>setTimeout(m,g));const v=this.isPlaying;return this.isPlaying=!1,v}stopPlaying(){this.isPlaying=!1}getAudioContext(){return this.audioContext}getVolume(){return this.settings.volume}setVolume(t){this.settings.volume=Math.max(0,Math.min(1,t))}getFrequency(){return this.settings.frequency}setFrequency(t){this.settings.frequency=Math.max(400,Math.min(1200,t))}getWPM(){return this.settings.wpm||20}setWPM(t){this.settings.wpm=Math.max(5,Math.min(40,t))}saveSettings(){try{localStorage.setItem("v4.audio.settings",JSON.stringify(this.settings))}catch(t){console.error("設定保存エラー:",t)}}loadSettings(){try{const t=localStorage.getItem("v4.audio.settings");t&&(this.settings={...this.settings,...JSON.parse(t)})}catch(t){console.error("設定読み込みエラー:",t)}}}const A={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."," ":"/",".":".-.-.-",",":"--..--",":":"---...","?":"..--..",_:"..--.-","+":".-.-.","-":"-....-","×":"-..-","^":"......","/":"-..-.","@":".--.-.","(":"-.--.",")":"-.--.-",'"':".-..-.","'":".----.","=":"-...-"},st=Object.fromEntries(Object.entries(A).map(([u,t])=>[t,u]));class T{static textToMorse(t){const e=t.toUpperCase(),s=/\[([A-Z]+)\]/g,n=[];let i=0,a;for(;(a=s.exec(e))!==null;){if(a.index>i){const r=e.substring(i,a.index),l=Array.from(r).map(h=>A[h]||h);n.push(l.join(" "))}const c=Array.from(a[1]).map(r=>A[r]||r);n.push(c.join("")),i=s.lastIndex}if(i<e.length){const o=e.substring(i),c=Array.from(o).map(r=>A[r]||r);n.push(c.join(" "))}return n.filter(o=>o).join(" ")}static morseSequencesToText(t){let e="";for(const s of t)s==="/"?e+=" ":s&&s!==""&&(e+=st[s]||"?");return e}static getMorseMap(){return A}static charToMorse(t){return A[t.toUpperCase()]}}const q=class q{static get(t){return this.settings[t]}static set(t,e){this.settings[t]=e,this.save()}static load(){try{const t=localStorage.getItem("v4.settings");t&&(this.settings={...this.defaultSettings,...JSON.parse(t)})}catch(t){console.error("Failed to load settings:",t)}}static save(){try{localStorage.setItem("v4.settings",JSON.stringify(this.settings))}catch(t){console.error("Failed to save settings:",t)}}static getAll(){return{...this.settings}}};q.defaultSettings={volume:.7,frequency:750,wpm:20,iambicMode:"B",paddleLayout:"normal"},q.settings={...q.defaultSettings};let d=q;class nt{constructor(){this.keyDown=!1,this.keyDownTime=0,this.buffer="",this.sequence="",this.charTimer=null,this.wordTimer=null,d.load();const t=d.getAll();this.audioSystem=new P({frequency:t.frequency,volume:t.volume,wpm:t.wpm}),this.render(),this.setupEventListeners(),this.setupSettingsModal()}getTimings(){const t=1200/d.get("wpm");return{dot:t,dash:t*3,charGap:t*4*.9,wordGap:t*7*.9}}clearTimers(){this.charTimer!==null&&(clearTimeout(this.charTimer),this.charTimer=null),this.wordTimer!==null&&(clearTimeout(this.wordTimer),this.wordTimer=null)}setTimers(){this.clearTimers();const t=this.getTimings();this.charTimer=window.setTimeout(()=>{this.sequence&&(this.buffer+=this.sequence+" ",this.sequence="",this.updateDisplay())},t.charGap),this.wordTimer=window.setTimeout(()=>{this.sequence&&(this.buffer+=this.sequence+" ",this.sequence=""),this.buffer.endsWith("/ ")||(this.buffer+="/ "),this.updateDisplay()},t.wordGap)}onKeyDown(){if(this.keyDown)return;this.keyDown=!0,this.keyDownTime=Date.now(),this.clearTimers(),this.audioSystem.startContinuousTone();const t=document.getElementById("morseKey");t&&t.classList.add("pressed")}onKeyUp(){if(!this.keyDown)return;this.keyDown=!1;const t=Date.now()-this.keyDownTime;this.audioSystem.stopContinuousTone();const e=this.getTimings(),s=t<e.dash?".":"-";this.sequence+=s,this.updateDisplay(),this.setTimers();const n=document.getElementById("morseKey");n&&n.classList.remove("pressed")}updateDisplay(){let t="";this.buffer&&(t=this.buffer.trim()),this.sequence&&(t&&(t+=" "),t+=`[${this.sequence}]`);const e=document.getElementById("morseDisplay");e&&(e.textContent=t||"入力されたモールス信号"),this.updateDecoded()}updateDecoded(){const t=this.buffer.trim().split(/\s+/),e=T.morseSequencesToText(t),s=document.getElementById("decodedOutput");s&&(s.textContent=e||"解読された文字")}clear(){this.buffer="",this.sequence="",this.clearTimers(),this.updateDisplay()}setupEventListeners(){const t=document.getElementById("morseKey");t&&(t.addEventListener("mousedown",()=>this.onKeyDown()),t.addEventListener("mouseup",()=>this.onKeyUp()),t.addEventListener("mouseleave",()=>{this.keyDown&&this.onKeyUp()}),t.addEventListener("touchstart",n=>{n.preventDefault(),this.onKeyDown()}),t.addEventListener("touchend",n=>{n.preventDefault(),this.onKeyUp()}));const e=document.getElementById("clearBtn");e&&e.addEventListener("click",()=>this.clear());const s=document.getElementById("backBtn");s&&s.addEventListener("click",()=>{window.location.hash="#menu"}),document.addEventListener("keydown",n=>{n.target.tagName==="INPUT"||n.target.tagName==="TEXTAREA"||n.repeat||n.code==="Space"&&(n.preventDefault(),this.onKeyDown())}),document.addEventListener("keyup",n=>{n.target.tagName==="INPUT"||n.target.tagName==="TEXTAREA"||n.code==="Space"&&(n.preventDefault(),this.onKeyUp())})}setupSettingsModal(){const t=document.getElementById("settingsIcon"),e=document.getElementById("settingsModal"),s=document.getElementById("settingsCancel"),n=document.getElementById("settingsOK");t&&e&&t.addEventListener("click",()=>{this.openSettingsModal()}),s&&e&&s.addEventListener("click",()=>{e.classList.remove("active")}),n&&e&&n.addEventListener("click",()=>{this.applySettings(),e.classList.remove("active")}),e&&e.addEventListener("click",i=>{i.target===e&&e.classList.remove("active")})}openSettingsModal(){const t=d.getAll(),e=document.getElementById("volumeRange"),s=document.getElementById("volumeInput"),n=document.getElementById("frequencyInput"),i=document.getElementById("wpmInput");e&&(e.value=String(t.volume*100)),s&&(s.value=String(Math.round(t.volume*100))),n&&(n.value=String(t.frequency)),i&&(i.value=String(t.wpm));const a=document.getElementById("settingsModal");a&&a.classList.add("active"),e&&s&&(e.oninput=o=>{const c=o.target.value;s.value=c},s.oninput=o=>{const c=o.target.value;e.value=c})}applySettings(){const t=document.getElementById("volumeInput"),e=document.getElementById("frequencyInput"),s=document.getElementById("wpmInput");t&&d.set("volume",parseInt(t.value)/100),e&&d.set("frequency",parseInt(e.value)),s&&d.set("wpm",parseInt(s.value));const n=d.getAll();this.audioSystem.updateSettings({volume:n.volume,frequency:n.frequency,wpm:n.wpm})}render(){const t=document.getElementById("app");if(!t)return;const e=d.getAll();t.innerHTML=`
      <div class="settings-icon" id="settingsIcon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </div>

      <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
          <div class="settings-header">
            <h2>設定</h2>
          </div>
          <div class="settings-grid">
            <div class="setting-item">
              <label>音量</label>
              <div class="setting-row">
                <input type="range" id="volumeRange" min="0" max="100" value="${e.volume*100}">
                <input type="number" id="volumeInput" min="0" max="100" value="${Math.round(e.volume*100)}">
                <span>%</span>
              </div>
            </div>
            <div class="setting-item">
              <label>周波数 (Hz)</label>
              <div class="setting-row">
                <input type="number" id="frequencyInput" min="100" max="2000" value="${e.frequency}" step="50">
              </div>
            </div>
            <div class="setting-item">
              <label>WPM (速度)</label>
              <div class="setting-row">
                <input type="number" id="wpmInput" min="1" max="999" value="${e.wpm}">
              </div>
            </div>
          </div>
          <div class="settings-buttons">
            <button id="settingsCancel" class="btn btn-secondary">キャンセル</button>
            <button id="settingsOK" class="btn">OK</button>
          </div>
        </div>
      </div>

      <div class="container">
        <header class="header">
          <button id="backBtn" class="back-btn">← 戻る</button>
          <h1>縦振り電鍵練習</h1>
        </header>

        <div class="key-container">
          <div id="morseKey" class="morse-key">
            <div class="key-label">押す</div>
          </div>
        </div>

        <div class="output-container">
          <div class="output-section">
            <h2>モールス信号</h2>
            <div id="morseDisplay" class="output-display">入力されたモールス信号</div>
          </div>

          <div class="output-section">
            <h2>解読された文字</h2>
            <div id="decodedOutput" class="output-display">解読された文字</div>
          </div>
        </div>

        <div class="controls">
          <button id="clearBtn" class="btn">クリア</button>
        </div>

        <div class="instructions">
          <h3>使い方</h3>
          <ul>
            <li>電鍵ボタンをクリック/タッチ、またはスペースキーを押して信号を送信</li>
            <li>短く押すと「・」（短点）、長く押すと「−」（長点）</li>
            <li>文字間は自動的に判定されます</li>
            <li>画面右上の設定アイコンから音量・周波数・速度を調整できます</li>
          </ul>
        </div>
      </div>
    `}destroy(){this.clearTimers(),this.audioSystem.stopContinuousTone()}}const it=Object.freeze(Object.defineProperty({__proto__:null,VerticalKeyTrainer:nt},Symbol.toStringTag,{value:"Module"}));class at{constructor(){this.leftDown=!1,this.rightDown=!1,this.buffer="",this.sequence="",this.charTimer=null,this.wordTimer=null,this.sending=!1,this.lastSent=null,this.lastInputTime=0,this.dotReqCount=0,this.dashReqCount=0,this.forceNextElement=null,this.isSqueezing=!1,this.squeezeOccurred=!1,this.squeezeDetected=!1,this.savedSettings=null,d.load();const t=d.getAll();this.audioSystem=new P({frequency:t.frequency,volume:t.volume,wpm:t.wpm}),this.render(),this.setupEventListeners(),this.setupSettingsModal(),this.updatePaddleLayout()}getTimings(){const t=1200/d.get("wpm");return{dot:t,dash:t*3,charGap:t*4,wordGap:t*7}}clearTimers(){this.charTimer!==null&&(clearTimeout(this.charTimer),this.charTimer=null),this.wordTimer!==null&&(clearTimeout(this.wordTimer),this.wordTimer=null)}setTimers(){this.clearTimers();const t=this.getTimings();this.charTimer=window.setTimeout(()=>{this.sequence&&(this.buffer+=this.sequence+" ",this.sequence="",this.updateDisplay())},t.charGap),this.wordTimer=window.setTimeout(()=>{this.sequence&&(this.buffer+=this.sequence+" ",this.sequence=""),this.buffer.endsWith("/ ")||(this.buffer+="/ "),this.updateDisplay()},t.wordGap)}sendPaddleElement(t){if(this.sending)return;this.sending=!0,this.clearTimers(),this.leftDown&&this.rightDown||(this.squeezeDetected=!1);const e=1200/d.get("wpm"),s=t==="."?e:e*3;this.audioSystem.scheduleTone(0,s),this.sequence+=t,this.lastInputTime=Date.now(),this.updateDisplay(),this.lastSent=t,setTimeout(()=>{const n=d.get("iambicMode"),i=this.leftDown&&this.rightDown;n==="B"&&this.squeezeDetected&&!this.forceNextElement&&(t==="."?this.forceNextElement="-":t==="-"&&(this.forceNextElement=".")),i&&!this.forceNextElement&&(t==="."?this.forceNextElement="-":t==="-"&&(this.forceNextElement="."))},s-5),setTimeout(()=>{if(this.sending=!1,!this.leftDown){const n=document.getElementById("paddleLeft");n&&n.classList.remove("active")}if(!this.rightDown){const n=document.getElementById("paddleRight");n&&n.classList.remove("active")}this.updateSqueezeIndicator(),this.forceNextElement?this.scheduleNext():this.leftDown||this.rightDown?this.scheduleNext():this.setTimers()},s+e)}scheduleNext(){const e=d.get("paddleLayout")==="reversed";if(this.forceNextElement){const s=this.forceNextElement;this.forceNextElement=null,this.sendPaddleElement(s)}else if(this.leftDown&&this.rightDown){const s=this.lastSent==="."?"-":".";this.sendPaddleElement(s)}else if(this.leftDown){const s=e?"-":".";this.sendPaddleElement(s)}else if(this.rightDown){const s=e?".":"-";this.sendPaddleElement(s)}}updateSqueezeIndicator(){const t=this.leftDown&&this.rightDown;this.isSqueezing=t;const e=document.getElementById("squeezeIndicator");e&&(t?(e.classList.add("active"),this.squeezeOccurred=!0):e.classList.remove("active"))}onLeftDown(){const t=d.get("iambicMode");this.leftDown=!0;const e=document.getElementById("paddleLeft");if(e&&e.classList.add("active"),this.updateSqueezeIndicator(),t==="B"&&this.sending&&this.rightDown){const s=d.get("paddleLayout");this.forceNextElement=s==="reversed"?"-":".",this.squeezeDetected=!0}if(!this.sending){const n=d.get("paddleLayout")==="reversed"?"-":".";this.sendPaddleElement(n)}}onRightDown(){const t=d.get("iambicMode");this.rightDown=!0;const e=document.getElementById("paddleRight");if(e&&e.classList.add("active"),this.updateSqueezeIndicator(),t==="B"&&this.sending&&this.leftDown){const s=d.get("paddleLayout");this.forceNextElement=s==="reversed"?".":"-",this.squeezeDetected=!0}if(!this.sending){const n=d.get("paddleLayout")==="reversed"?".":"-";this.sendPaddleElement(n)}}onLeftUp(){this.leftDown=!1,this.dashReqCount=0;const t=document.getElementById("paddleLeft");t&&t.classList.remove("active"),this.updateSqueezeIndicator(),d.get("iambicMode")==="B"&&this.isSqueezing&&this.rightDown&&!this.sending&&setTimeout(()=>{if(this.rightDown&&!this.sending){const n=d.get("paddleLayout")==="reversed"?".":"-";this.sendPaddleElement(n)}},10)}onRightUp(){this.rightDown=!1,this.dotReqCount=0;const t=document.getElementById("paddleRight");t&&t.classList.remove("active"),this.updateSqueezeIndicator();const e=d.get("iambicMode");if(e==="B"&&this.isSqueezing&&this.leftDown&&!this.sending&&setTimeout(()=>{if(this.leftDown&&!this.sending){const n=d.get("paddleLayout")==="reversed"?"-":".";this.sendPaddleElement(n)}},10),!this.leftDown&&!this.rightDown&&this.squeezeOccurred){if(e==="B"&&this.lastSent==="-")if(this.sending)this.dotReqCount++;else{const n=d.get("paddleLayout")==="reversed"?"-":".";this.sendPaddleElement(n)}this.squeezeOccurred=!1}}updateDisplay(){let t="";this.buffer&&(t=this.buffer.trim()),this.sequence&&(t&&(t+=" "),t+=`[${this.sequence}]`);const e=document.getElementById("paddleMorseDisplay");e&&(e.textContent=t||"入力されたモールス信号"),this.updateDecoded()}updateDecoded(){const t=this.buffer.trim().split(/\s+/),e=T.morseSequencesToText(t),s=document.getElementById("paddleDecoded");s&&(s.textContent=e||"解読された文字")}clear(){this.buffer="",this.sequence="",this.clearTimers(),this.updateDisplay()}updatePaddleLayout(){const t=d.get("paddleLayout"),e=document.getElementById("paddleLeft"),s=document.getElementById("paddleRight");!e||!s||(t==="reversed"?(e.innerHTML='<div class="paddle-label">左<br>（長点）</div>',s.innerHTML='<div class="paddle-label">右<br>（短点）</div>'):(e.innerHTML='<div class="paddle-label">左<br>（短点）</div>',s.innerHTML='<div class="paddle-label">右<br>（長点）</div>'))}setupEventListeners(){let t=!1,e=!1,s=!1,n=!1;const i=document.getElementById("paddleLeft");i&&(i.addEventListener("mousedown",r=>{r.preventDefault(),t||(t=!0,this.onLeftDown())}),i.addEventListener("mouseup",r=>{r.preventDefault(),t&&(t=!1,this.onLeftUp())}),i.addEventListener("touchstart",r=>{r.preventDefault(),s||(s=!0,this.onLeftDown())},{passive:!1}),i.addEventListener("touchend",r=>{r.preventDefault(),s&&(s=!1,this.onLeftUp())},{passive:!1}));const a=document.getElementById("paddleRight");a&&(a.addEventListener("mousedown",r=>{r.preventDefault(),e||(e=!0,this.onRightDown())}),a.addEventListener("mouseup",r=>{r.preventDefault(),e&&(e=!1,this.onRightUp())}),a.addEventListener("touchstart",r=>{r.preventDefault(),n||(n=!0,this.onRightDown())},{passive:!1}),a.addEventListener("touchend",r=>{r.preventDefault(),n&&(n=!1,this.onRightUp())},{passive:!1})),document.addEventListener("mouseup",()=>{t&&(t=!1,this.onLeftUp()),e&&(e=!1,this.onRightUp())}),document.addEventListener("touchend",()=>{s&&(s=!1,this.onLeftUp()),n&&(n=!1,this.onRightUp())},{passive:!1});const o=document.getElementById("paddleClear");o&&o.addEventListener("click",()=>this.clear());const c=document.getElementById("backBtn");c&&c.addEventListener("click",()=>{window.location.hash="#menu"}),document.addEventListener("keydown",r=>{r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||r.repeat||(r.key==="j"||r.key==="J"?(r.preventDefault(),this.onLeftDown()):(r.key==="k"||r.key==="K")&&(r.preventDefault(),this.onRightDown()))}),document.addEventListener("keyup",r=>{r.target.tagName==="INPUT"||r.target.tagName==="TEXTAREA"||(r.key==="j"||r.key==="J"?(r.preventDefault(),this.onLeftUp()):(r.key==="k"||r.key==="K")&&(r.preventDefault(),this.onRightUp()))})}setupSettingsModal(){const t=document.getElementById("settingsIcon"),e=document.getElementById("settingsModal"),s=document.getElementById("settingsCancel"),n=document.getElementById("settingsOK"),i=document.getElementById("closeSettings");t&&e&&t.addEventListener("click",()=>{this.openSettingsModal()}),s&&e&&s.addEventListener("click",()=>{this.restoreSettings(),e.classList.remove("active")}),n&&e&&n.addEventListener("click",()=>{this.applySettings(),e.classList.remove("active")}),i&&e&&i.addEventListener("click",()=>{this.restoreSettings(),e.classList.remove("active")}),e&&e.addEventListener("click",a=>{a.target===e&&(this.restoreSettings(),e.classList.remove("active"))})}openSettingsModal(){this.savedSettings=d.getAll();const t=d.getAll(),e=document.getElementById("volumeRange"),s=document.getElementById("volumeInput"),n=document.getElementById("frequencyInput"),i=document.getElementById("wpmInput"),a=document.getElementById("iambicMode"),o=document.getElementById("paddleLayout");e&&(e.value=String(t.volume*100)),s&&(s.value=String(Math.round(t.volume*100))),n&&(n.value=String(t.frequency)),i&&(i.value=String(t.wpm)),a&&(a.checked=t.iambicMode==="B"),o&&(o.checked=t.paddleLayout==="reversed");const c=document.getElementById("settingsModal");c&&c.classList.add("active"),e&&s&&(e.oninput=r=>{const l=r.target.value;s.value=l},s.oninput=r=>{const l=r.target.value;e.value=l}),a&&(a.onchange=()=>{this.updateIambicModeStatus()}),o&&(o.onchange=()=>{this.updatePaddleLayoutStatus()}),this.updateIambicModeStatus(),this.updatePaddleLayoutStatus()}restoreSettings(){this.savedSettings&&(d.set("volume",this.savedSettings.volume),d.set("frequency",this.savedSettings.frequency),d.set("wpm",this.savedSettings.wpm),d.set("iambicMode",this.savedSettings.iambicMode),d.set("paddleLayout",this.savedSettings.paddleLayout),this.audioSystem.updateSettings({volume:this.savedSettings.volume,frequency:this.savedSettings.frequency,wpm:this.savedSettings.wpm}),this.updatePaddleLayout(),this.savedSettings=null)}applySettings(){const t=document.getElementById("volumeInput"),e=document.getElementById("frequencyInput"),s=document.getElementById("wpmInput"),n=document.getElementById("iambicMode"),i=document.getElementById("paddleLayout");t&&d.set("volume",parseInt(t.value)/100),e&&d.set("frequency",parseInt(e.value)),s&&d.set("wpm",parseInt(s.value)),n&&d.set("iambicMode",n.checked?"B":"A"),i&&d.set("paddleLayout",i.checked?"reversed":"normal");const a=d.getAll();this.audioSystem.updateSettings({volume:a.volume,frequency:a.frequency,wpm:a.wpm}),this.updatePaddleLayout(),this.savedSettings=null}updateIambicModeStatus(){const t=document.getElementById("iambicMode"),e=document.getElementById("iambicModeStatus");e&&t&&(e.textContent=t.checked?"(現在: Iambic B)":"(現在: Iambic A)")}updatePaddleLayoutStatus(){const t=document.getElementById("paddleLayout"),e=document.getElementById("paddleLayoutStatus");e&&t&&(e.textContent=t.checked?"(現在: 左:長点 / 右:短点)":"(現在: 左:短点 / 右:長点)")}render(){const t=document.getElementById("app");if(!t)return;const e=d.getAll();t.innerHTML=`
      <div class="settings-icon" id="settingsIcon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </div>

      <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
          <div class="settings-header">
            <h2>設定</h2>
            <button class="close-btn" id="closeSettings">×</button>
          </div>
          <div class="settings-grid">
            <div class="setting-item">
              <label>音量</label>
              <div class="setting-row">
                <input type="range" id="volumeRange" min="0" max="100" value="${e.volume*100}">
                <input type="number" id="volumeInput" min="0" max="100" value="${Math.round(e.volume*100)}">
                <span>%</span>
              </div>
            </div>
            <div class="setting-item">
              <label>周波数 (Hz)</label>
              <div class="setting-row">
                <input type="number" id="frequencyInput" min="100" max="2000" value="${e.frequency}" step="50">
              </div>
            </div>
            <div class="setting-item">
              <label>WPM (速度)</label>
              <div class="setting-row">
                <input type="number" id="wpmInput" min="1" max="999" value="${e.wpm}">
              </div>
            </div>
            <div class="setting-item">
              <label>Iambic A/B モード <span id="iambicModeStatus">(現在: Iambic ${e.iambicMode})</span></label>
              <div class="setting-row">
                <div class="toggle-switch">
                  <input type="checkbox" id="iambicMode" class="toggle-input" ${e.iambicMode==="B"?"checked":""}>
                  <label for="iambicMode" class="toggle-label">
                    <span class="toggle-switch-handle"></span>
                  </label>
                </div>
              </div>
            </div>
            <div class="setting-item">
              <label>横振りパドル配置 <span id="paddleLayoutStatus">(現在: ${e.paddleLayout==="reversed"?"左:長点 / 右:短点":"左:短点 / 右:長点"})</span></label>
              <div class="setting-row">
                <div class="toggle-switch">
                  <input type="checkbox" id="paddleLayout" class="toggle-input" ${e.paddleLayout==="reversed"?"checked":""}>
                  <label for="paddleLayout" class="toggle-label">
                    <span class="toggle-switch-handle"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="settings-buttons">
            <button id="settingsCancel" class="btn btn-secondary">キャンセル</button>
            <button id="settingsOK" class="btn">OK</button>
          </div>
        </div>
      </div>

      <div class="container">
        <header class="header">
          <button id="backBtn" class="back-btn">← 戻る</button>
          <h1>横振り電鍵練習</h1>
        </header>

        <div class="paddle-container">
          <button class="paddle-key paddle-left" id="paddleLeft">
            <div class="paddle-label">左<br>（短点）</div>
          </button>
          <button class="paddle-key paddle-right" id="paddleRight">
            <div class="paddle-label">右<br>（長点）</div>
          </button>
        </div>

        <div class="keyboard-hint">
          キーボード: J / K
        </div>

        <div class="squeeze-indicator" id="squeezeIndicator">
          ⚡squeeze⚡
        </div>

        <div class="morse-display" id="paddleMorseDisplay">入力されたモールス信号</div>
        <div class="decoded-output" id="paddleDecoded">解読された文字</div>

        <div style="text-align: center; margin-top: 20px;">
          <button id="paddleClear" class="btn">クリア</button>
        </div>
      </div>
    `}destroy(){this.clearTimers(),this.sending&&this.audioSystem.stopContinuousTone()}}const ot=Object.freeze(Object.defineProperty({__proto__:null,HorizontalKeyTrainer:at},Symbol.toStringTag,{value:"Module"}));class rt{constructor(){this.entries=[],this.filteredEntries=[],this.selectedTags=new Set,this.selectedFrequencies=new Set([5]),this.displayMode="card",this.viewMode="browse",this.sortColumn="abbreviation",this.sortDirection="asc",this.searchQuery="",this.currentCards=[],this.currentIndex=0,this.isFlipped=!1,this.progress={known:new Set,unknown:new Set},this.reviewMode=!1,this.hideAbbreviation=!1,this.isLearning=!1,this.learnQuestionType="abbr-to-meaning",this.currentlyPlaying=null,this.examQuestions=[],this.currentQuestionIndex=0,this.examResults=[],this.questionCount=10,this.questionType="abbr-to-meaning",this.settingsModalOpen=!1,this.tempSettings=null,this.isTestPlaying=!1,this.audioSystem=new P,this.loadProgress(),this.loadFilters(),this.loadData()}async loadData(){try{const t=await fetch("./flashcard.tsv");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.text();this.entries=e.trim().split(`
`).slice(1).map(s=>{const[n,i,a,o,c,r,l]=s.split("	");return{tags:n,frequency:parseInt(i),abbreviation:a,english:o,japanese:c,description:r||"",example:l||""}}),this.applyFilters(),this.render()}catch(t){console.error("データ読み込みエラー:",t),this.renderError()}}getAllTags(){const t=new Set;return this.entries.forEach(e=>{e.tags.split(",").forEach(s=>t.add(s.trim()))}),Array.from(t).sort()}applyFilters(){let t=this.entries;if(this.selectedTags.size>0&&(t=t.filter(e=>{const s=e.tags.split(",").map(n=>n.trim());return Array.from(this.selectedTags).some(n=>s.includes(n))})),this.selectedFrequencies.size>0&&(t=t.filter(e=>this.selectedFrequencies.has(e.frequency))),this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();t=t.filter(s=>s.abbreviation.toLowerCase().includes(e)||s.english.toLowerCase().includes(e)||s.japanese.includes(this.searchQuery)||s.tags.toLowerCase().includes(e))}this.filteredEntries=this.sortEntries(t)}sortEntries(t){const e=[...t];return e.sort((s,n)=>{let i=0;switch(this.sortColumn){case"abbreviation":i=s.abbreviation.localeCompare(n.abbreviation);break;case"english":i=s.english.localeCompare(n.english);break;case"japanese":i=s.japanese.localeCompare(n.japanese);break;case"frequency":i=s.frequency-n.frequency;break;case"tags":i=s.tags.localeCompare(n.tags);break}return this.sortDirection==="asc"?i:-i}),e}toggleSort(t){this.sortColumn===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.applyFilters(),this.render()}toggleTag(t){this.selectedTags.has(t)?this.selectedTags.delete(t):this.selectedTags.add(t),this.applyFilters(),this.saveFilters(),this.render()}toggleFrequency(t){this.selectedFrequencies.has(t)?this.selectedFrequencies.delete(t):this.selectedFrequencies.add(t),this.applyFilters(),this.saveFilters(),this.render()}toggleAllFrequencies(){const t=[1,2,3,4,5];t.every(e=>this.selectedFrequencies.has(e))?this.selectedFrequencies.clear():t.forEach(e=>this.selectedFrequencies.add(e)),this.applyFilters(),this.saveFilters(),this.render()}toggleDisplayMode(){this.displayMode=this.displayMode==="card"?"list":"card",this.render()}getFrequencyStars(t){return"★".repeat(t)+"☆".repeat(5-t)}formatAbbreviation(t){const e=t.match(/^\[([A-Z]+)\]$/);return e?`<span class="prosign">${e[1]}</span>`:t}getCardCountText(){const t=this.filteredEntries.length,e=this.filteredEntries.filter(n=>this.progress.unknown.has(n.abbreviation)).length,s=this.filteredEntries.filter(n=>this.progress.known.has(n.abbreviation)).length;return`全${t}件 / わかる:${s}件 / わからない:${e}件`}shuffleCards(t){const e=[...t];for(let s=e.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[e[s],e[n]]=[e[n],e[s]]}return e}startLearning(){this.reviewMode?this.currentCards=this.filteredEntries.filter(t=>this.progress.unknown.has(t.abbreviation)):this.currentCards=this.shuffleCards(this.filteredEntries),this.currentIndex=0,this.isFlipped=!1,this.isLearning=!0,this.render()}flipCard(){this.isFlipped=!this.isFlipped,this.render()}nextCard(){this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1,this.render())}previousCard(){this.currentIndex>0&&(this.currentIndex--,this.isFlipped=!1,this.render())}markAsKnown(){const t=this.currentCards[this.currentIndex];this.progress.known.add(t.abbreviation),this.progress.unknown.delete(t.abbreviation),this.saveProgress(),this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1),this.render()}markAsUnknown(){const t=this.currentCards[this.currentIndex];this.progress.unknown.add(t.abbreviation),this.progress.known.delete(t.abbreviation),this.saveProgress(),this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1),this.render()}backToLearnSetup(){this.isLearning=!1,this.currentCards=[],this.currentIndex=0,this.isFlipped=!1,this.render()}async playMorse(t){try{if(this.currentlyPlaying===t){this.audioSystem.stopPlaying(),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render();return}this.currentlyPlaying&&this.audioSystem.stopPlaying(),this.currentlyPlaying=t,this.viewMode!=="exam"&&this.render();const e=T.textToMorse(t);e&&await this.audioSystem.playMorseString(e),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render()}catch(e){console.error("モールス再生エラー:",e),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render()}}render(){this.viewMode==="browse"?this.renderBrowseMode():this.viewMode==="learn"?this.renderLearnMode():this.viewMode==="exam"&&this.renderExamMode(),this.settingsModalOpen&&this.renderSettingsModal()}renderBrowseMode(){const t=document.getElementById("app");if(!t)return;const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button active" data-tab="browse">一覧</button>
					<button class="tab-button" data-tab="learn">学習モード</button>
					<button class="tab-button" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<div class="filter-group">
						<h2>タグでフィルター</h2>
						<div class="tags-list">
							${e.map(a=>`
								<button class="tag-btn ${this.selectedTags.has(a)?"active":""}" data-tag="${a}">
									${a}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>使用頻度 <button id="toggle-freq-btn" class="toggle-freq-btn" title="チェックを反転">⇆</button></h2>
						<div class="frequency-list">
							${[5,4,3,2,1].map(a=>`
								<button class="freq-btn ${this.selectedFrequencies.has(a)?"active":""}" data-freq="${a}">
									${this.getFrequencyStars(a)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>検索</h2>
						<input type="text" id="search-input" class="search-input" placeholder="略語、英文、和訳、タグで検索..." value="${this.searchQuery}">
					</div>

					<div class="result-count">
						全 ${this.filteredEntries.length} 件
					</div>
				</div>

				<div class="entries-container" id="entriesContainer"></div>
			</div>
		`;const s=document.getElementById("backBtn");s&&s.addEventListener("click",()=>{window.location.hash="#menu"});const n=document.getElementById("settingsBtn");n&&n.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(a=>{a.addEventListener("click",()=>{const o=a.getAttribute("data-tab");o==="learn"?(this.viewMode="learn",this.render()):o==="exam"&&(this.viewMode="exam",this.render())})}),this.renderEntries(),this.attachBrowseModeListeners()}renderEntries(){const t=document.getElementById("entriesContainer");if(!t)return;this.displayMode==="card"?this.renderCardView(t):this.renderListView(t);const e=document.getElementById("toggleModeBtn");e&&e.addEventListener("click",()=>this.toggleDisplayMode())}updateResultCount(){const t=document.querySelector(".result-count");t&&(t.textContent=`全 ${this.filteredEntries.length} 件`)}renderCardView(t){t.innerHTML=`
			<div class="entries-header">
				<h2>略語一覧 (${this.filteredEntries.length}件 / ${this.entries.length}件中)</h2>
				<button id="toggleModeBtn" class="toggle-mode-btn" title="表示モード切り替え">
					📋 リスト表示
				</button>
			</div>
			<div class="entries-list">
				${this.filteredEntries.map(e=>`
					<div class="entry-card ${this.currentlyPlaying===e.abbreviation?"playing":""}" data-abbr="${e.abbreviation}">
						<div class="entry-header">
							<div class="entry-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
							<div class="entry-frequency" title="使用頻度: ${e.frequency}/5">${this.getFrequencyStars(e.frequency)}</div>
						</div>
						<div class="entry-english">${e.english}</div>
						<div class="entry-japanese">${e.japanese}</div>
						${e.description?`<div class="entry-description">${e.description}</div>`:""}
						${e.example?`<div class="entry-example">例: ${e.example}</div>`:""}
						<div class="entry-tags">${e.tags}</div>
					</div>
				`).join("")}
			</div>
		`,t.querySelectorAll(".entry-card").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-abbr");s&&this.playMorse(s)})})}getSortIndicator(t){return this.sortColumn!==t?"":this.sortDirection==="asc"?" ▲":" ▼"}renderListView(t){t.innerHTML=`
			<div class="entries-header">
				<h2>略語一覧 (${this.filteredEntries.length}件 / ${this.entries.length}件中)</h2>
				<button id="toggleModeBtn" class="toggle-mode-btn" title="表示モード切り替え">
					🃏 カード表示
				</button>
			</div>
			<div class="list-table-container">
				<table class="list-table">
					<thead>
						<tr>
							<th class="sortable" data-column="abbreviation">略語${this.getSortIndicator("abbreviation")}</th>
							<th class="sortable" data-column="english">英文${this.getSortIndicator("english")}</th>
							<th class="sortable" data-column="japanese">和訳${this.getSortIndicator("japanese")}</th>
							<th class="sortable" data-column="frequency">頻度${this.getSortIndicator("frequency")}</th>
							<th class="sortable" data-column="tags">タグ${this.getSortIndicator("tags")}</th>
							<th>説明</th>
							<th>具体例</th>
						</tr>
					</thead>
					<tbody>
						${this.filteredEntries.map(n=>`
							<tr>
								<td class="list-abbr">
									<button class="abbr-play-btn ${this.currentlyPlaying===n.abbreviation?"playing":""}" data-abbr="${n.abbreviation}">
										${this.formatAbbreviation(n.abbreviation)}
									</button>
								</td>
								<td class="list-english">${n.english}</td>
								<td class="list-japanese">${n.japanese}</td>
								<td class="list-frequency" title="使用頻度: ${n.frequency}/5">${this.getFrequencyStars(n.frequency)}</td>
								<td class="list-tags">${n.tags}</td>
								<td class="list-description">${n.description}</td>
								<td class="list-example">${n.example}</td>
							</tr>
						`).join("")}
					</tbody>
				</table>
			</div>
		`,t.querySelectorAll("th.sortable").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-column");i&&this.toggleSort(i)})}),t.querySelectorAll(".abbr-play-btn").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-abbr");i&&this.playMorse(i)})})}renderLearnMode(){const t=document.getElementById("app");if(!t)return;if(!this.isLearning){this.renderLearnSetupView(t);return}if(this.currentCards.length===0){t.innerHTML=`
				<div class="container">
					<div class="no-cards">
						${this.reviewMode?"復習するカードがありません":"学習するカードがありません"}
					</div>
					<button id="back-to-setup-btn" class="secondary-button">設定に戻る</button>
				</div>
			`;const o=document.getElementById("back-to-setup-btn");o&&o.addEventListener("click",()=>this.backToLearnSetup());return}const e=this.currentCards[this.currentIndex],s=this.currentIndex+1,n=this.currentCards.length;let i="",a="";switch(this.learnQuestionType){case"abbr-to-meaning":i=`
					<div class="card-label">略語</div>
					<div class="card-content">${this.formatAbbreviation(e.abbreviation)}</div>
					<button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">🔊 モールス再生</button>
				`,a=`
					<div class="card-label">意味</div>
					<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
					<div class="card-content-text">${e.english}</div>
					<div class="card-content-text">${e.japanese}</div>
				`;break;case"meaning-to-abbr":i=`
					<div class="card-label">意味</div>
					<div class="card-content-text">${e.english}</div>
					<div class="card-content-text">${e.japanese}</div>
				`,a=`
					<div class="card-label">略語</div>
					<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
					<button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">🔊 モールス再生</button>
				`;break;case"morse-to-abbr":i=`
					<div class="card-label">モールス音を聞いて略語を答えてください</div>
					<button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">🔊 モールス再生</button>
				`,a=`
					<div class="card-label">略語</div>
					<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
				`;break;case"morse-to-meaning":i=`
					<div class="card-label">モールス音を聞いて意味を答えてください</div>
					<button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">🔊 モールス再生</button>
				`,a=`
					<div class="card-label">意味</div>
					<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
					<div class="card-content-text">${e.english}</div>
					<div class="card-content-text">${e.japanese}</div>
				`;break}t.innerHTML=`
			<div class="container learning-view">
				<div class="learning-header">
					<button id="back-to-setup-btn" class="back-btn">← 設定に戻る</button>
					<div class="progress-indicator">${s} / ${n}</div>
				</div>

				<div class="card-container">
					<div class="flashcard ${this.isFlipped?"flipped":""}" id="flashcard">
						<div class="card-front">
							${i}
						</div>
						<div class="card-back">
							${a}
							${e.description?`<div class="card-description">${e.description}</div>`:""}
							${e.example?`<div class="card-example">例: ${e.example}</div>`:""}
							<div class="card-tags">${e.tags} / ${this.getFrequencyStars(e.frequency)}</div>
						</div>
					</div>
				</div>

				<div class="card-controls">
					<button id="flip-card-btn" class="control-button">
						${this.isFlipped?"問題に戻る":"正解を確認する"} (Space)
					</button>
				</div>

				${this.isFlipped?this.renderJudgmentButtons(e):""}

				<div class="navigation-controls">
					<button id="prev-card-btn" class="nav-button" ${this.currentIndex===0?"disabled":""}>
						← 前のカード
					</button>
					<button id="next-card-btn" class="nav-button" ${this.currentIndex>=this.currentCards.length-1?"disabled":""}>
						次のカード →
					</button>
				</div>
			</div>
		`,this.attachLearnModeListeners()}renderLearnSetupView(t){const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button" data-tab="browse">一覧</button>
					<button class="tab-button active" data-tab="learn">学習モード</button>
					<button class="tab-button" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<div class="filter-group">
						<h2>タグでフィルター</h2>
						<div class="tags-list">
							${e.map(a=>`
								<button class="tag-btn ${this.selectedTags.has(a)?"active":""}" data-tag="${a}">
									${a}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>使用頻度 <button id="toggle-freq-btn" class="toggle-freq-btn" title="チェックを反転">⇆</button></h2>
						<div class="frequency-list">
							${[5,4,3,2,1].map(a=>`
								<button class="freq-btn ${this.selectedFrequencies.has(a)?"active":""}" data-freq="${a}">
									${this.getFrequencyStars(a)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>モード</h2>
						<div class="mode-buttons">
							<button class="mode-btn ${this.reviewMode?"selected":""}" id="review-mode-btn">復習モード（わからないカードのみ）</button>
							<button class="mode-btn ${this.hideAbbreviation?"selected":""}" id="hide-abbreviation-btn">略語を非表示（モールス再生のみ）</button>
						</div>
					</div>

					<div class="filter-group">
						<h2>出題形式</h2>
						<div class="question-type-buttons">
							<button class="question-type-btn ${this.learnQuestionType==="abbr-to-meaning"?"selected":""}" data-type="abbr-to-meaning">略語→意味（基本）</button>
							<button class="question-type-btn ${this.learnQuestionType==="meaning-to-abbr"?"selected":""}" data-type="meaning-to-abbr">意味→略語（応用）</button>
							<button class="question-type-btn ${this.learnQuestionType==="morse-to-abbr"?"selected":""}" data-type="morse-to-abbr">モールス音→略語（実践）</button>
							<button class="question-type-btn ${this.learnQuestionType==="morse-to-meaning"?"selected":""}" data-type="morse-to-meaning">モールス音→意味（実践）</button>
						</div>
					</div>

					<div class="result-count">
						${this.getCardCountText()}
					</div>

					<div class="action-buttons">
						<button id="start-learning-btn" class="primary-button">学習開始</button>
						<button id="clear-progress-btn" class="secondary-button">進捗をリセット</button>
					</div>
				</div>
			</div>
		`;const s=document.getElementById("backBtn");s&&s.addEventListener("click",()=>{window.location.hash="#menu"});const n=document.getElementById("settingsBtn");n&&n.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(a=>{a.addEventListener("click",()=>{const o=a.getAttribute("data-tab");o==="browse"?(this.viewMode="browse",this.render()):o==="exam"&&(this.viewMode="exam",this.render())})}),this.attachLearnSetupListeners()}renderJudgmentButtons(t){const e=this.progress.known.has(t.abbreviation);return`
			<div class="judgment-controls">
				<button id="mark-unknown-btn" class="judgment-button unknown ${this.progress.unknown.has(t.abbreviation)?"active":""}">
					× わからない
				</button>
				<button id="mark-known-btn" class="judgment-button known ${e?"active":""}">
					○ わかる
				</button>
			</div>
		`}attachBrowseModeListeners(){document.querySelectorAll(".tag-btn").forEach(i=>{i.addEventListener("click",()=>{const a=i.getAttribute("data-tag");a&&this.toggleTag(a)})}),document.querySelectorAll(".freq-btn").forEach(i=>{i.addEventListener("click",()=>{const a=parseInt(i.getAttribute("data-freq")||"0",10);this.toggleFrequency(a)})});const s=document.getElementById("toggle-freq-btn");s&&s.addEventListener("click",()=>this.toggleAllFrequencies());const n=document.getElementById("search-input");n&&n.addEventListener("input",()=>{this.searchQuery=n.value,this.applyFilters(),this.renderEntries(),this.updateResultCount()})}attachLearnSetupListeners(){document.querySelectorAll(".tag-btn").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-tag");l&&this.toggleTag(l)})}),document.querySelectorAll(".freq-btn").forEach(r=>{r.addEventListener("click",()=>{const l=parseInt(r.getAttribute("data-freq")||"0",10);this.toggleFrequency(l)})});const s=document.getElementById("toggle-freq-btn");s&&s.addEventListener("click",()=>this.toggleAllFrequencies());const n=document.getElementById("review-mode-btn");n&&n.addEventListener("click",()=>{this.reviewMode=!this.reviewMode,this.render()});const i=document.getElementById("hide-abbreviation-btn");i&&i.addEventListener("click",()=>{this.hideAbbreviation=!this.hideAbbreviation,this.render()}),document.querySelectorAll(".question-type-btn").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-type");l&&(this.learnQuestionType=l,this.render())})});const o=document.getElementById("start-learning-btn");o&&o.addEventListener("click",()=>this.startLearning());const c=document.getElementById("clear-progress-btn");c&&c.addEventListener("click",()=>{confirm("学習進捗をすべてリセットしますか？")&&(this.progress={known:new Set,unknown:new Set},this.saveProgress(),this.render())})}attachLearnModeListeners(){const t=document.getElementById("back-to-setup-btn");t&&t.addEventListener("click",()=>this.backToLearnSetup());const e=document.getElementById("flip-card-btn");e&&e.addEventListener("click",()=>this.flipCard());const s=document.getElementById("play-morse-btn");s&&s.addEventListener("click",()=>{const a=this.currentCards[this.currentIndex];this.playMorse(a.abbreviation)});const n=document.getElementById("prev-card-btn"),i=document.getElementById("next-card-btn");if(n&&n.addEventListener("click",()=>this.previousCard()),i&&i.addEventListener("click",()=>this.nextCard()),this.isFlipped){const a=document.getElementById("mark-known-btn"),o=document.getElementById("mark-unknown-btn");a&&a.addEventListener("click",()=>this.markAsKnown()),o&&o.addEventListener("click",()=>this.markAsUnknown())}this.attachKeyboardListeners()}attachKeyboardListeners(){const t=e=>{this.viewMode==="learn"&&(e.key===" "||e.key==="Spacebar"?(e.preventDefault(),this.flipCard()):e.key==="ArrowRight"?(e.preventDefault(),this.nextCard()):e.key==="ArrowLeft"&&(e.preventDefault(),this.previousCard()))};document.removeEventListener("keydown",t),document.addEventListener("keydown",t)}saveFilters(){try{const t={tags:Array.from(this.selectedTags),frequencies:Array.from(this.selectedFrequencies)};localStorage.setItem("v4.flashcard.filters",JSON.stringify(t))}catch(t){console.error("フィルタ保存エラー:",t)}}loadFilters(){try{const t=localStorage.getItem("v4.flashcard.filters");if(t){const e=JSON.parse(t);this.selectedTags=new Set(Array.isArray(e.tags)?e.tags:[]),this.selectedFrequencies=new Set(Array.isArray(e.frequencies)?e.frequencies:[5])}}catch(t){console.error("フィルタ読み込みエラー:",t)}}saveProgress(){try{const t={known:Array.from(this.progress.known),unknown:Array.from(this.progress.unknown)};localStorage.setItem("v4.flashcard.progress",JSON.stringify(t))}catch(t){console.error("進捗保存エラー:",t)}}loadProgress(){try{const t=localStorage.getItem("v4.flashcard.progress");if(t){const e=JSON.parse(t);this.progress={known:new Set(e.known||[]),unknown:new Set(e.unknown||[])}}}catch(t){console.error("進捗読み込みエラー:",t)}}renderError(){const t=document.getElementById("app");t&&(t.innerHTML=`
			<div class="container">
				<header class="header">
					<button onclick="window.location.href='./index.html'" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
				</header>
				<div class="error">
					データの読み込みに失敗しました。flashcard.tsvを確認してください。
				</div>
			</div>
		`)}openSettingsModal(){this.settingsModalOpen=!0,this.tempSettings={volume:this.audioSystem.getVolume(),frequency:this.audioSystem.getFrequency(),wpm:this.audioSystem.getWPM()},this.renderSettingsModal()}closeSettingsModal(t){this.isTestPlaying&&(this.audioSystem.stopPlaying(),this.isTestPlaying=!1),!t&&this.tempSettings?(this.audioSystem.setVolume(this.tempSettings.volume),this.audioSystem.setFrequency(this.tempSettings.frequency),this.audioSystem.setWPM(this.tempSettings.wpm)):t&&this.audioSystem.saveSettings(),this.settingsModalOpen=!1,this.tempSettings=null;const e=document.getElementById("settings-modal");e&&e.remove()}renderSettingsModal(){const t=document.getElementById("settings-modal");t&&t.remove();const e=this.audioSystem.getVolume(),s=this.audioSystem.getFrequency(),n=this.audioSystem.getWPM(),i=`
			<div class="settings-modal active" id="settings-modal">
				<div class="settings-content">
					<h2>設定</h2>
					<div class="settings-grid">
						<div class="setting-item">
							<label for="volumeRange">音量</label>
							<input type="range" id="volumeRange" min="0" max="100" value="${e*100}" aria-label="音量スライダー">
							<input type="number" id="volumeInput" min="0" max="100" value="${Math.round(e*100)}" aria-label="音量数値入力">
							<span>%</span>
						</div>
						<div class="setting-item">
							<label for="frequencyInput">周波数 (Hz)</label>
							<input type="number" id="frequencyInput" min="400" max="1200" value="${s}" step="50">
						</div>
						<div class="setting-item">
							<label for="wpmInput">WPM (速度: 5-40)</label>
							<input type="number" id="wpmInput" min="5" max="40" value="${n}">
						</div>
						<div class="setting-item">
							<span>テスト再生</span>
							<button id="testMorseBtn" class="test-button">再生</button>
						</div>
					</div>
					<div class="settings-buttons">
						<button id="cancelBtn" class="secondary-button">キャンセル</button>
						<button id="okBtn" class="primary-button">OK</button>
					</div>
				</div>
			</div>
		`;document.body.insertAdjacentHTML("beforeend",i);const a=document.getElementById("settings-modal");if(!a)return;a.addEventListener("click",m=>{m.target===a&&this.closeSettingsModal(!1)});const o=document.getElementById("volumeRange"),c=document.getElementById("volumeInput");o&&c&&(o.addEventListener("input",()=>{const m=parseInt(o.value)/100;this.audioSystem.setVolume(m),c.value=o.value}),c.addEventListener("input",()=>{const m=parseInt(c.value)/100;this.audioSystem.setVolume(m),o.value=c.value}));const r=document.getElementById("frequencyInput");r&&r.addEventListener("input",()=>{const m=parseInt(r.value);this.audioSystem.setFrequency(m)});const l=document.getElementById("wpmInput");l&&l.addEventListener("input",()=>{const m=parseInt(l.value);this.audioSystem.setWPM(m)});const h=document.getElementById("testMorseBtn");h&&h.addEventListener("click",async()=>{if(this.isTestPlaying)this.audioSystem.stopPlaying(),this.isTestPlaying=!1,h.textContent="再生";else{this.isTestPlaying=!0,h.textContent="停止";const m=T.textToMorse("CQ");m&&await this.audioSystem.playMorseString(m),this.isTestPlaying=!1,h.textContent="再生"}});const g=document.getElementById("cancelBtn");g&&g.addEventListener("click",()=>{this.closeSettingsModal(!1)});const v=document.getElementById("okBtn");v&&v.addEventListener("click",()=>{this.closeSettingsModal(!0)})}renderExamMode(){const t=document.getElementById("app");t&&(this.examQuestions.length===0?this.renderExamSetup(t):this.currentQuestionIndex<this.examQuestions.length?this.renderExamQuestion(t):this.renderExamResult(t))}renderExamSetup(t){const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button" data-tab="browse">一覧</button>
					<button class="tab-button" data-tab="learn">学習モード</button>
					<button class="tab-button active" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<div class="filter-group">
						<h2>タグでフィルター</h2>
						<div class="tags-list">
							${e.map(s=>`
								<button class="tag-btn ${this.selectedTags.has(s)?"active":""}" data-tag="${s}">
									${s}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>使用頻度</h2>
						<div class="frequency-list">
							${[5,4,3,2,1].map(s=>`
								<button class="freq-btn ${this.selectedFrequencies.has(s)?"active":""}" data-freq="${s}">
									${this.getFrequencyStars(s)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>出題形式</h2>
						<div class="question-type-buttons">
							<button class="question-type-btn ${this.questionType==="abbr-to-meaning"?"selected":""}" data-type="abbr-to-meaning">略語→意味（基礎）</button>
							<button class="question-type-btn ${this.questionType==="meaning-to-abbr"?"selected":""}" data-type="meaning-to-abbr">意味→略語（応用）</button>
							<button class="question-type-btn ${this.questionType==="morse-to-abbr"?"selected":""}" data-type="morse-to-abbr">モールス音→略語（実践）</button>
							<button class="question-type-btn ${this.questionType==="morse-to-meaning"?"selected":""}" data-type="morse-to-meaning">モールス音→意味（実践）</button>
						</div>
					</div>

					<div class="filter-group">
						<h2>問題数</h2>
						<div class="question-count-buttons">
							<button class="question-count-btn ${this.questionCount===5?"selected":""}" data-count="5">5問</button>
							<button class="question-count-btn ${this.questionCount===10?"selected":""}" data-count="10">10問</button>
							<button class="question-count-btn ${this.questionCount===20?"selected":""}" data-count="20">20問</button>
							<button class="question-count-btn ${this.questionCount===50?"selected":""}" data-count="50">50問</button>
							<button class="question-count-btn ${this.questionCount==="all"?"selected":""}" data-count="all">全問</button>
						</div>
					</div>

					<div class="result-count">
						出題可能: ${this.filteredEntries.length}件
					</div>

					<div class="action-buttons">
						<button id="start-exam-btn" class="primary-button">試験開始</button>
					</div>
				</div>
			</div>
		`,this.attachExamSetupListeners()}attachExamSetupListeners(){const t=document.getElementById("backBtn");t&&t.addEventListener("click",()=>{window.location.hash="#menu"});const e=document.getElementById("settingsBtn");e&&e.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-tab");l==="browse"?(this.viewMode="browse",this.render()):l==="learn"&&(this.viewMode="learn",this.currentCards=[],this.render())})}),document.querySelectorAll(".tag-btn").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-tag");l&&(this.selectedTags.has(l)?this.selectedTags.delete(l):this.selectedTags.add(l),this.applyFilters(),this.saveFilters(),this.render())})}),document.querySelectorAll(".freq-btn").forEach(r=>{r.addEventListener("click",()=>{const l=parseInt(r.getAttribute("data-freq")||"0",10);this.toggleFrequency(l)})}),document.querySelectorAll(".question-type-btn").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-type");l&&(this.questionType=l,this.render())})}),document.querySelectorAll(".question-count-btn").forEach(r=>{r.addEventListener("click",()=>{const l=r.getAttribute("data-count")||"10";this.questionCount=l==="all"?"all":parseInt(l,10),this.render()})});const c=document.getElementById("start-exam-btn");c&&c.addEventListener("click",()=>{this.startExam()})}startExam(){this.examQuestions=this.generateExamQuestions(),this.currentQuestionIndex=0,this.examResults=[],this.render()}generateExamQuestions(){const t=this.questionCount==="all"?this.filteredEntries.length:Math.min(this.questionCount,this.filteredEntries.length);return[...this.filteredEntries].sort(()=>Math.random()-.5).slice(0,t).map(n=>this.createExamQuestion(n))}createExamQuestion(t){const e=this.filteredEntries.filter(i=>i.abbreviation!==t.abbreviation).sort(()=>Math.random()-.5).slice(0,3);let s,n;switch(this.questionType){case"abbr-to-meaning":s=`${t.english} / ${t.japanese}`,n=[s,...e.map(i=>`${i.english} / ${i.japanese}`)];break;case"meaning-to-abbr":s=t.abbreviation,n=[s,...e.map(i=>i.abbreviation)];break;case"morse-to-abbr":s=t.abbreviation,n=[s,...e.map(i=>i.abbreviation)];break;case"morse-to-meaning":s=`${t.english} / ${t.japanese}`,n=[s,...e.map(i=>`${i.english} / ${i.japanese}`)];break}return n=n.sort(()=>Math.random()-.5),{type:this.questionType,entry:t,choices:n,correctAnswer:s}}renderExamQuestion(t){const e=this.examQuestions[this.currentQuestionIndex],s=`問題 ${this.currentQuestionIndex+1} / ${this.examQuestions.length}`;t.innerHTML=`
			<div class="container exam-view">
				<div class="exam-header">
					<button id="quit-exam-btn" class="secondary-button">試験を中止</button>
					<div class="progress-indicator">${s}</div>
				</div>

				<div class="question-container">
					${this.renderQuestion(e)}
				</div>

				<div class="choices-container">
					${this.renderChoices(e)}
				</div>

				<div id="feedback-area" class="feedback-area"></div>
			</div>
		`,this.attachExamQuestionListeners(),(e.type==="morse-to-abbr"||e.type==="morse-to-meaning")&&setTimeout(()=>this.playMorse(e.entry.abbreviation),500)}renderQuestion(t){switch(t.type){case"abbr-to-meaning":return`
					<div class="question-text">
						<p>次の略語の意味を選んでください:</p>
						<p class="question-abbr">${this.formatAbbreviation(t.entry.abbreviation)}</p>
					</div>
				`;case"meaning-to-abbr":return`
					<div class="question-text">
						<p>次の意味に対応する略語を選んでください:</p>
						<p class="question-meaning">${t.entry.english}</p>
						<p class="question-meaning">${t.entry.japanese}</p>
					</div>
				`;case"morse-to-abbr":return`
					<div class="question-text">
						<p>モールス音を聞いて、対応する略語を選んでください:</p>
						<button id="replay-morse-btn" class="control-button">🔊 もう一度再生</button>
					</div>
				`;case"morse-to-meaning":return`
					<div class="question-text">
						<p>モールス音を聞いて、対応する意味を選んでください:</p>
						<button id="replay-morse-btn" class="control-button">🔊 もう一度再生</button>
					</div>
				`}}renderChoices(t){return t.choices.map((e,s)=>`
			<button class="choice-button" data-choice="${e}">
				${String.fromCharCode(65+s)}. ${e}
			</button>
		`).join("")}attachExamQuestionListeners(){const t=document.getElementById("quit-exam-btn");t&&t.addEventListener("click",()=>{confirm("試験を中止しますか？")&&(this.examQuestions=[],this.examResults=[],this.currentQuestionIndex=0,this.render())});const e=document.getElementById("replay-morse-btn");e&&e.addEventListener("click",()=>{const n=this.examQuestions[this.currentQuestionIndex];this.playMorse(n.entry.abbreviation)}),document.querySelectorAll(".choice-button").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-choice");i&&this.submitExamAnswer(i)})})}submitExamAnswer(t){const e=this.examQuestions[this.currentQuestionIndex],s=t===e.correctAnswer;this.examResults.push({question:e,userAnswer:t,isCorrect:s}),this.showExamFeedback(s,e.correctAnswer),setTimeout(()=>{this.currentQuestionIndex++,this.render()},1500)}showExamFeedback(t,e){const s=document.getElementById("feedback-area");if(!s)return;s.className=`feedback-area ${t?"correct":"incorrect"}`,s.innerHTML=t?'<div class="feedback-text">✓ 正解！</div>':`<div class="feedback-text">✗ 不正解<br>正解: ${e}</div>`,document.querySelectorAll(".choice-button").forEach(i=>{i.disabled=!0})}renderExamResult(t){const e=this.examResults.filter(a=>a.isCorrect).length,s=this.examResults.length,n=Math.round(e/s*100),i=this.examResults.filter(a=>!a.isCorrect);t.innerHTML=`
			<div class="container exam-result-view">
				<div class="result-header">
					<h2>試験結果</h2>
				</div>

				<div class="score-display">
					<div class="score-large">${e} / ${s}</div>
					<div class="score-percentage">${n}%</div>
				</div>

				<div class="result-details">
					${i.length>0?`
						<h3>間違えた問題 (${i.length}問)</h3>
						<div class="wrong-questions">
							${i.map(a=>this.renderWrongAnswer(a)).join("")}
						</div>
					`:`
						<p class="perfect-score">全問正解です！おめでとうございます！</p>
					`}
				</div>

				<div class="action-buttons">
					<button id="back-to-setup-btn" class="primary-button">設定に戻る</button>
					${i.length>0?`
						<button id="retry-wrong-btn" class="secondary-button">間違えた問題を復習</button>
					`:""}
				</div>
			</div>
		`,this.attachExamResultListeners()}renderWrongAnswer(t){const{question:e,userAnswer:s}=t;return`
			<div class="wrong-question-item">
				<div class="wrong-q-abbr">${this.formatAbbreviation(e.entry.abbreviation)}</div>
				<div class="wrong-q-correct">正解: ${e.correctAnswer}</div>
				<div class="wrong-q-user">あなたの回答: ${s}</div>
				<div class="wrong-q-meaning">${e.entry.english} / ${e.entry.japanese}</div>
			</div>
		`}attachExamResultListeners(){const t=document.getElementById("back-to-setup-btn");t&&t.addEventListener("click",()=>{this.examQuestions=[],this.examResults=[],this.currentQuestionIndex=0,this.render()});const e=document.getElementById("retry-wrong-btn");e&&e.addEventListener("click",()=>{const s=this.examResults.filter(n=>!n.isCorrect).map(n=>n.question.entry);this.filteredEntries=s,this.questionCount=s.length,this.startExam()})}destroy(){this.audioSystem.stopContinuousTone()}}const ct=Object.freeze(Object.defineProperty({__proto__:null,FlashcardTrainer:rt},Symbol.toStringTag,{value:"Module"})),C="K M U R E S N A P T L W I . J Z = F O Y , V G 5 / Q 9 2 H 3 8 B ? 4 7 C 1 D 6 0 X".split(" ");function S(u){return C.slice(0,u+1)}function F(u,t=5,e=60){const s=[],n=Math.floor(e*20/(t*5));for(let i=0;i<n;i++){let a="";for(let o=0;o<t;o++){const c=u[Math.floor(Math.random()*u.length)];a+=c}s.push(a)}return s}const R=class R{static get(t){return this.settings[t]}static set(t,e){this.settings[t]=e,this.save()}static load(){try{const t=localStorage.getItem("v4.koch.settings");t&&(this.settings={...this.defaultSettings,...JSON.parse(t)})}catch(t){console.error("Failed to load Koch settings:",t)}}static save(){try{localStorage.setItem("v4.koch.settings",JSON.stringify(this.settings))}catch(t){console.error("Failed to save Koch settings:",t)}}static getAll(){return{...this.settings}}static reset(){this.settings={...this.defaultSettings},this.save()}};R.defaultSettings={characterSpeed:20,effectiveSpeed:20,frequency:750,volume:.7,groupSize:9,displayMode:"fixed",practiceDuration:60,showInput:!0},R.settings={...R.defaultSettings};let p=R;class lt{constructor(){this.viewMode="learning",this.state={currentLesson:1,isPlaying:!1,userInput:"",correctAnswer:"",groups:[],currentGroupIndex:0},this.testState={selectedLesson:1,isTestRunning:!1,testUserInput:"",testCorrectAnswer:"",testGroups:[],testCurrentGroupIndex:0,testIsPlaying:!1},this.customState={selectedChars:new Set,isCustomRunning:!1,customUserInput:"",customCorrectAnswer:"",customGroups:[],customCurrentGroupIndex:0,customIsPlaying:!1},p.load();const t=p.getAll();this.audioSystem=new P({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed}),this.loadProgress(),this.render()}loadProgress(){try{const t=localStorage.getItem("v4.koch.currentLesson");t&&(this.state.currentLesson=parseInt(t))}catch(t){console.error("Failed to load progress:",t)}}saveProgress(){try{localStorage.setItem("v4.koch.currentLesson",this.state.currentLesson.toString())}catch(t){console.error("Failed to save progress:",t)}}async startLesson(){const t=p.getAll(),e=S(this.state.currentLesson);this.state.groups=F(e,5,t.practiceDuration),this.state.currentGroupIndex=0,this.state.userInput="",this.state.correctAnswer=this.state.groups.join(""),this.state.isPlaying=!1,this.audioSystem.updateSettings({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed,effectiveWpm:t.effectiveSpeed}),this.renderPractice()}async playMorse(){if(!this.state.isPlaying){this.state.isPlaying=!0,this.state.currentGroupIndex=0,this.updateProgress(),this.updatePlaybackButtons();for(let t=0;t<this.state.groups.length&&this.state.isPlaying;t++){const e=this.state.groups[t],s=T.textToMorse(e);await this.audioSystem.playMorseString(s+" /"),this.state.currentGroupIndex=t+1,this.updateProgress()}this.state.isPlaying=!1,this.updatePlaybackButtons(),this.state.currentGroupIndex>=this.state.groups.length&&this.showResult()}}pauseMorse(){this.state.isPlaying=!1,this.audioSystem.stopPlaying(),this.updatePlaybackButtons()}stopLesson(){this.state.isPlaying=!1,this.audioSystem.stopPlaying(),this.render()}showResult(){const t=this.calculateAccuracy(),e=t>=90,s=document.getElementById("resultContainer");s&&(s.innerHTML=`
      <div class="result ${e?"passed":"failed"}">
        <h2>${e?"合格！":"不合格"}</h2>
        <div class="accuracy">正答率: ${t.toFixed(1)}%</div>
        <div class="comparison">
          <div>送信: ${this.state.correctAnswer}</div>
          <div>入力: ${this.state.userInput||"（未入力）"}</div>
        </div>
        <div class="actions">
          ${e?'<button class="btn primary" onclick="window.location.reload()">次のレッスンへ</button>':""}
          <button class="btn" onclick="window.location.reload()">もう一度</button>
        </div>
      </div>
    `,e&&this.state.currentLesson<40&&(this.state.currentLesson++,this.saveProgress()))}calculateAccuracy(){if(!this.state.userInput)return 0;const t=this.state.correctAnswer.replace(/\s/g,""),e=this.state.userInput.replace(/\s/g,""),s=Math.max(t.length,e.length);let n=0;for(let i=0;i<s;i++)t[i]===e[i]&&n++;return n/s*100}updateProgress(){const t=document.getElementById("lessonProgress"),e=document.getElementById("progressBar");if(t&&e){const s=this.state.currentGroupIndex/this.state.groups.length*100;t.textContent=`進行: ${this.state.currentGroupIndex}/${this.state.groups.length} (${s.toFixed(0)}%)`,e.style.width=`${s}%`}this.updatePlaybackButtons()}showSettings(){const t={...p.getAll()},e=p.getAll(),s=document.createElement("div");s.className="modal",s.innerHTML=`
      <div class="modal-content">
        <div class="modal-header">
          <h2>設定</h2>
          <button id="closeSettings" class="close-btn">×</button>
        </div>
        <div class="modal-body">
          <div class="setting-item">
            <label>文字速度 (Character Speed) WPM:</label>
            <input type="number" id="characterSpeed" min="5" max="40" step="1" value="${e.characterSpeed}">
          </div>

          <div class="setting-item">
            <label>実効速度 (Effective Speed) WPM:</label>
            <input type="number" id="effectiveSpeed" min="5" max="40" step="1" value="${e.effectiveSpeed}">
          </div>

          <div class="setting-item">
            <label>周波数 (Hz):</label>
            <input type="number" id="frequency" min="400" max="1000" step="10" value="${e.frequency}">
          </div>

          <div class="setting-item">
            <label>音量 (%):</label>
            <div class="volume-control">
              <input type="range" id="volumeRange" min="0" max="100" step="5" value="${e.volume*100}">
              <input type="number" id="volumeInput" min="0" max="100" step="5" value="${Math.round(e.volume*100)}">
            </div>
          </div>

          <div class="setting-item">
            <label>練習時間 (秒):</label>
            <input type="number" id="practiceDuration" min="30" max="300" step="30" value="${e.practiceDuration}">
          </div>

          <div class="setting-item">
            <label>グループサイズ (文字):</label>
            <input type="number" id="groupSize" min="3" max="10" step="1" value="${e.groupSize}">
          </div>

          <div class="setting-item">
            <label>
              <input type="checkbox" id="showInput" ${e.showInput?"checked":""}>
              入力を表示
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelSettings" class="btn">キャンセル</button>
          <button id="saveSettings" class="btn primary">OK</button>
        </div>
      </div>
    `,document.body.appendChild(s);const n=document.getElementById("volumeRange"),i=document.getElementById("volumeInput");n&&i&&(n.oninput=o=>{const c=o.target.value;i.value=c},i.oninput=o=>{const c=o.target.value;n.value=c});const a=()=>{p.set("characterSpeed",t.characterSpeed),p.set("effectiveSpeed",t.effectiveSpeed),p.set("frequency",t.frequency),p.set("volume",t.volume),p.set("practiceDuration",t.practiceDuration),p.set("groupSize",t.groupSize),p.set("showInput",t.showInput),this.audioSystem.updateSettings({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed})};document.getElementById("saveSettings")?.addEventListener("click",()=>{const o=document.getElementById("characterSpeed"),c=document.getElementById("effectiveSpeed"),r=document.getElementById("frequency"),l=document.getElementById("practiceDuration"),h=document.getElementById("groupSize"),g=document.getElementById("showInput"),v=parseInt(o.value);let m=parseInt(c.value);m>v&&(m=v,c.value=v.toString()),p.set("characterSpeed",v),p.set("effectiveSpeed",m),p.set("frequency",parseInt(r.value)),p.set("volume",parseInt(i.value)/100),p.set("practiceDuration",parseInt(l.value)),p.set("groupSize",parseInt(h.value)),p.set("showInput",g.checked),this.audioSystem.updateSettings({frequency:p.get("frequency"),volume:p.get("volume"),wpm:p.get("characterSpeed"),effectiveWpm:p.get("effectiveSpeed")}),s.remove(),this.state.groups.length>0&&this.renderPractice()}),document.getElementById("cancelSettings")?.addEventListener("click",()=>{a(),s.remove()}),document.getElementById("closeSettings")?.addEventListener("click",()=>{a(),s.remove()}),s.addEventListener("click",o=>{o.target===s&&(a(),s.remove())})}render(){const t=document.getElementById("app");if(!t)return;S(this.state.currentLesson),C.slice(0,40).map((s,n)=>{const i=n+1,a=S(i),o=i===this.state.currentLesson,c=i<this.state.currentLesson;return`
        <div class="lesson-item ${o?"current":""} ${c?"passed":""}" data-lesson="${i}">
          <div class="lesson-num">L${i}</div>
          <div class="lesson-chars">${a.join("")}</div>
        </div>
      `}).join(""),t.innerHTML=`
      <div class="settings-icon" id="settingsIcon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </div>

      <div class="container">
        <header class="header">
          <button id="backBtn" class="back-btn">← 戻る</button>
          <h1>コッホ法トレーニング</h1>
        </header>

        <div class="tabs">
          <button class="tab-button ${this.viewMode==="learning"?"active":""}" data-tab="learning">基本学習</button>
          <button class="tab-button ${this.viewMode==="test"?"active":""}" data-tab="test">試験モード</button>
          <button class="tab-button ${this.viewMode==="custom"?"active":""}" data-tab="custom">任意文字列練習</button>
        </div>

        ${this.renderModeContent()}
      </div>
    `,document.getElementById("backBtn")?.addEventListener("click",()=>{window.location.href="./index.html"}),document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.showSettings()}),document.querySelectorAll(".tab-button").forEach(s=>{s.addEventListener("click",()=>{const n=s.getAttribute("data-tab");n&&(this.viewMode=n,this.render())})}),this.setupModeEventListeners()}renderModeContent(){switch(this.viewMode){case"learning":return this.renderLearningMode();case"test":return this.renderTestMode();case"custom":return this.renderCustomMode();default:return this.renderLearningMode()}}renderLearningMode(){const t=S(this.state.currentLesson),e=C.slice(0,40).map((s,n)=>{const i=n+1,a=S(i),o=i===this.state.currentLesson,c=i<this.state.currentLesson;return`
        <div class="lesson-item ${o?"current":""} ${c?"passed":""}" data-lesson="${i}">
          <div class="lesson-num">L${i}</div>
          <div class="lesson-chars">${a.join("")}</div>
        </div>
      `}).join("");return`
      <div class="lesson-info">
        <h2>レッスン ${this.state.currentLesson} / 40</h2>
        <div class="chars">学習文字: ${t.join("")}</div>
        <button id="startBtn" class="btn primary">練習開始</button>
      </div>

      <div id="practiceContainer"></div>
      <div id="resultContainer"></div>

      <div class="instructions">
        <h3>使い方</h3>
        <ul>
          <li>「練習開始」をクリックしてモールス信号を聞く</li>
          <li>聞こえた文字を入力</li>
          <li>90%以上の正答率で次のレッスンへ</li>
        </ul>
      </div>

      <div class="lesson-list-section">
        <h3>レッスン一覧</h3>
        <div class="lesson-list">
          ${e}
        </div>
      </div>
    `}renderTestMode(){return this.testState.isTestRunning?`
        <div id="testPracticeContainer"></div>
        <div id="testResultContainer"></div>
      `:`
        <div class="lesson-info">
          <h2>試験モード</h2>
          <p>学習済みのレッスンを選択してテストを行います</p>
          <button id="startTestBtn" class="btn primary">試験開始</button>
        </div>

        <div class="lesson-list-section">
          <h3>レッスン選択（学習済みレッスンのみ）</h3>
          <div class="lesson-list">
            ${C.slice(0,Math.min(this.state.currentLesson,40)).map((e,s)=>{const n=s+1,i=S(n);return`
          <div class="lesson-item ${n===this.testState.selectedLesson?"current":""}" data-test-lesson="${n}">
            <div class="lesson-num">L${n}</div>
            <div class="lesson-chars">${i.join("")}</div>
          </div>
        `}).join("")}
          </div>
        </div>
      `}renderCustomMode(){return this.customState.isCustomRunning?`
        <div id="customPracticeContainer"></div>
        <div id="customResultContainer"></div>
      `:`
        <div class="lesson-info">
          <h2>任意文字列練習モード</h2>
          <p>練習したい文字を選択してください（最低2文字）</p>
          <div class="char-selection">
            ${S(this.state.currentLesson).map(s=>`
        <button class="char-select-btn ${this.customState.selectedChars.has(s)?"selected":""}" data-char="${s}">
          ${s}
        </button>
      `).join("")}
          </div>
          <button id="startCustomBtn" class="btn primary" ${this.customState.selectedChars.size<2?"disabled":""}>練習開始</button>
        </div>

        <div class="instructions">
          <h3>使い方</h3>
          <ul>
            <li>練習したい文字をクリックして選択</li>
            <li>2文字以上選択すると練習開始可能</li>
            <li>選択した文字のみでランダムな練習問題が生成されます</li>
          </ul>
        </div>
      `}setupModeEventListeners(){this.viewMode==="learning"?(document.getElementById("startBtn")?.addEventListener("click",()=>{this.startLesson()}),document.querySelectorAll(".lesson-item").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-lesson")||"1");this.state.currentLesson=e,this.saveProgress(),this.render(),window.scrollTo({top:0,behavior:"smooth"})})})):this.viewMode==="test"?this.testState.isTestRunning||(document.getElementById("startTestBtn")?.addEventListener("click",()=>{this.startTest()}),document.querySelectorAll("[data-test-lesson]").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-test-lesson")||"1");this.testState.selectedLesson=e,this.render(),window.scrollTo({top:0,behavior:"smooth"})})})):this.viewMode==="custom"&&(this.customState.isCustomRunning||(document.getElementById("startCustomBtn")?.addEventListener("click",()=>{this.startCustom()}),document.querySelectorAll(".char-select-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-char");e&&(this.customState.selectedChars.has(e)?this.customState.selectedChars.delete(e):this.customState.selectedChars.add(e),this.render())})})))}renderPractice(){const t=document.getElementById("practiceContainer");if(!t)return;const e=p.getAll(),s=S(this.state.currentLesson);t.innerHTML=`
      <div class="practice-area">
        <div class="progress-section">
          <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
          </div>
          <div id="lessonProgress" class="progress-text">準備完了 - 再生ボタンを押してください</div>
        </div>

        <div class="playback-controls">
          <button id="playBtn" class="control-btn" title="再生">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <button id="pauseBtn" class="control-btn" title="一時停止" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          <button id="stopBtn" class="control-btn" title="停止">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <rect x="6" y="6" width="12" height="12"/>
            </svg>
          </button>
        </div>

        <textarea id="userInput" class="input-area" placeholder="聞こえた文字を入力..." ${e.showInput?"":'style="opacity: 0.3; pointer-events: none;"'}></textarea>
        ${this.renderKeyboard(s)}
      </div>
    `;const n=document.getElementById("userInput");n&&n.addEventListener("input",i=>{this.state.userInput=i.target.value.toUpperCase()}),document.getElementById("playBtn")?.addEventListener("click",()=>{this.playMorse()}),document.getElementById("pauseBtn")?.addEventListener("click",()=>{this.pauseMorse()}),document.getElementById("stopBtn")?.addEventListener("click",()=>{this.stopLesson()}),this.setupKeyboardEvents(s),this.updatePlaybackButtons()}updatePlaybackButtons(){const t=document.getElementById("playBtn"),e=document.getElementById("pauseBtn");t&&e&&(this.state.isPlaying?(t.disabled=!0,e.disabled=!1):(t.disabled=!1,e.disabled=!0))}renderKeyboard(t){const e=p.get("groupSize"),s=[];for(let n=0;n<C.length;n+=e)s.push(C.slice(n,n+e));return`
      <div class="keyboard">
        <div class="keyboard-header">
          <small>グループベースキーボード（学習済み文字のみ有効）</small>
        </div>
        <div class="keyboard-controls">
          <button id="spaceBtn" class="key-btn special">スペース</button>
          <button id="backspaceBtn" class="key-btn special">1字削除</button>
        </div>
        <div class="keyboard-groups-wrapper">
          <div class="keyboard-groups">
            ${s.map((n,i)=>`
              <div class="keyboard-group">
                <div class="group-label">G${i+1}</div>
                <div class="group-keys">
                  ${n.map(a=>{const o=t.includes(a);return`
                      <button class="key-btn ${o?"":"disabled"}"
                              data-char="${a}"
                              ${o?"":"disabled"}>
                        ${a}
                      </button>
                    `}).join("")}
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      </div>
    `}setupKeyboardEvents(t){const e=document.getElementById("userInput");e&&(document.querySelectorAll(".key-btn:not(.special)").forEach(s=>{s.addEventListener("click",n=>{n.preventDefault();const i=n.target.getAttribute("data-char");i&&t.includes(i)&&(e.value+=i,this.state.userInput=e.value.toUpperCase())})}),document.getElementById("spaceBtn")?.addEventListener("click",s=>{s.preventDefault(),e.value+=" ",this.state.userInput=e.value.toUpperCase()}),document.getElementById("backspaceBtn")?.addEventListener("click",s=>{s.preventDefault(),e.value=e.value.slice(0,-1),this.state.userInput=e.value.toUpperCase()}),e.addEventListener("keydown",s=>{s.key===""&&(s.preventDefault(),e.value+="",this.state.userInput=e.value.toUpperCase())}))}async startTest(){const t=p.getAll(),e=S(this.testState.selectedLesson);this.testState.testGroups=F(e,5,t.practiceDuration),this.testState.testCurrentGroupIndex=0,this.testState.testUserInput="",this.testState.testCorrectAnswer=this.testState.testGroups.join(""),this.testState.testIsPlaying=!1,this.testState.isTestRunning=!0,this.audioSystem.updateSettings({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed,effectiveWpm:t.effectiveSpeed}),this.render(),this.renderTestPractice()}async startCustom(){const t=p.getAll(),e=Array.from(this.customState.selectedChars);this.customState.customGroups=F(e,5,t.practiceDuration),this.customState.customCurrentGroupIndex=0,this.customState.customUserInput="",this.customState.customCorrectAnswer=this.customState.customGroups.join(""),this.customState.customIsPlaying=!1,this.customState.isCustomRunning=!0,this.audioSystem.updateSettings({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed,effectiveWpm:t.effectiveSpeed}),this.render(),this.renderCustomPractice()}renderTestPractice(){const t=document.getElementById("testPracticeContainer");if(!t)return;const e=p.getAll();S(this.testState.selectedLesson),t.innerHTML=`
      <div class="practice-area">
        <div class="progress-section">
          <div class="progress-bar-container">
            <div id="testProgressBar" class="progress-bar" style="width: 0%"></div>
          </div>
          <div id="testProgress" class="progress-text">準備完了 - 再生ボタンを押してください</div>
        </div>

        <div class="playback-controls">
          <button id="testPlayBtn" class="control-btn" title="再生">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <button id="testPauseBtn" class="control-btn" title="一時停止" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          <button id="testStopBtn" class="control-btn" title="停止">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <rect x="6" y="6" width="12" height="12"/>
            </svg>
          </button>
        </div>

        ${e.showInput?`
          <textarea id="testInputArea" class="input-area" placeholder="聞こえた文字を入力してください..."></textarea>
        `:""}

        <button id="testSubmitBtn" class="btn primary">採点</button>
      </div>
    `,this.setupTestControls()}renderCustomPractice(){const t=document.getElementById("customPracticeContainer");if(!t)return;const e=p.getAll();t.innerHTML=`
      <div class="practice-area">
        <div class="progress-section">
          <div class="progress-bar-container">
            <div id="customProgressBar" class="progress-bar" style="width: 0%"></div>
          </div>
          <div id="customProgress" class="progress-text">準備完了 - 再生ボタンを押してください</div>
        </div>

        <div class="playback-controls">
          <button id="customPlayBtn" class="control-btn" title="再生">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <button id="customPauseBtn" class="control-btn" title="一時停止" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          <button id="customStopBtn" class="control-btn" title="停止">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <rect x="6" y="6" width="12" height="12"/>
            </svg>
          </button>
        </div>

        ${e.showInput?`
          <textarea id="customInputArea" class="input-area" placeholder="聞こえた文字を入力してください..."></textarea>
        `:""}

        <button id="customEndBtn" class="btn primary">結果を見る</button>
      </div>
    `,this.setupCustomControls()}setupTestControls(){const t=document.getElementById("testInputArea");t&&t.addEventListener("input",e=>{this.testState.testUserInput=e.target.value.toUpperCase()}),document.getElementById("testPlayBtn")?.addEventListener("click",()=>{this.playTestMorse()}),document.getElementById("testPauseBtn")?.addEventListener("click",()=>{this.pauseTestMorse()}),document.getElementById("testStopBtn")?.addEventListener("click",()=>{this.stopTest()}),document.getElementById("testSubmitBtn")?.addEventListener("click",()=>{const e=document.getElementById("testInputArea");e&&(this.testState.testUserInput=e.value.toUpperCase()),this.checkTestAnswer()}),this.updateTestPlaybackButtons()}setupCustomControls(){const t=document.getElementById("customInputArea");t&&t.addEventListener("input",e=>{this.customState.customUserInput=e.target.value.toUpperCase()}),document.getElementById("customPlayBtn")?.addEventListener("click",()=>{this.playCustomMorse()}),document.getElementById("customPauseBtn")?.addEventListener("click",()=>{this.pauseCustomMorse()}),document.getElementById("customStopBtn")?.addEventListener("click",()=>{this.stopCustom()}),document.getElementById("customEndBtn")?.addEventListener("click",()=>{this.showCustomResult()}),this.updateCustomPlaybackButtons()}async playCustomMorse(){if(!this.customState.customIsPlaying){this.customState.customIsPlaying=!0,this.customState.customCurrentGroupIndex=0,this.updateCustomProgress(),this.updateCustomPlaybackButtons();for(let t=0;t<this.customState.customGroups.length&&this.customState.customIsPlaying;t++){const e=this.customState.customGroups[t],s=T.textToMorse(e);await this.audioSystem.playMorseString(s+" /"),this.customState.customCurrentGroupIndex=t+1,this.updateCustomProgress()}this.customState.customIsPlaying=!1,this.updateCustomPlaybackButtons()}}pauseCustomMorse(){this.customState.customIsPlaying=!1,this.audioSystem.stopPlaying(),this.updateCustomPlaybackButtons()}stopCustom(){this.customState.customIsPlaying=!1,this.audioSystem.stopPlaying(),this.customState.isCustomRunning=!1,this.render()}updateCustomProgress(){const t=document.getElementById("customProgress"),e=document.getElementById("customProgressBar");if(t&&e){const s=this.customState.customCurrentGroupIndex/this.customState.customGroups.length*100;t.textContent=`進行: ${this.customState.customCurrentGroupIndex}/${this.customState.customGroups.length} (${s.toFixed(0)}%)`,e.style.width=`${s}%`}this.updateCustomPlaybackButtons()}updateCustomPlaybackButtons(){const t=document.getElementById("customPlayBtn"),e=document.getElementById("customPauseBtn");t&&e&&(this.customState.customIsPlaying?(t.disabled=!0,e.disabled=!1):(t.disabled=!1,e.disabled=!0))}showCustomResult(){const t=document.getElementById("customResultContainer");if(!t)return;const e=this.customState.customUserInput.replace(/\s+/g,""),s=this.customState.customCorrectAnswer.replace(/\s+/g,"");let n=0;const i=Math.max(e.length,s.length);for(let o=0;o<i;o++)e[o]===s[o]&&n++;const a=i>0?Math.round(n/i*100):0;t.innerHTML=`
      <div class="result">
        <h2>練習結果</h2>
        <div class="accuracy">正答率: ${a}%</div>
        <div class="comparison">
          <div>送信: ${s}</div>
          <div>あなたの入力: ${e}</div>
        </div>
        <div class="actions">
          <button id="retryCustomBtn" class="btn">もう一度</button>
          <button id="backToCustomMenuBtn" class="btn primary">戻る</button>
        </div>
      </div>
    `,document.getElementById("retryCustomBtn")?.addEventListener("click",()=>{this.customState.isCustomRunning=!1,this.render(),this.startCustom()}),document.getElementById("backToCustomMenuBtn")?.addEventListener("click",()=>{this.customState.isCustomRunning=!1,this.render()})}async playTestMorse(){if(!this.testState.testIsPlaying){this.testState.testIsPlaying=!0,this.testState.testCurrentGroupIndex=0,this.updateTestProgress(),this.updateTestPlaybackButtons();for(let t=0;t<this.testState.testGroups.length&&this.testState.testIsPlaying;t++){const e=this.testState.testGroups[t],s=T.textToMorse(e);await this.audioSystem.playMorseString(s+" /"),this.testState.testCurrentGroupIndex=t+1,this.updateTestProgress()}this.testState.testIsPlaying=!1,this.updateTestPlaybackButtons()}}pauseTestMorse(){this.testState.testIsPlaying=!1,this.audioSystem.stopPlaying(),this.updateTestPlaybackButtons()}stopTest(){this.testState.testIsPlaying=!1,this.audioSystem.stopPlaying(),this.testState.isTestRunning=!1,this.render()}updateTestProgress(){const t=document.getElementById("testProgress"),e=document.getElementById("testProgressBar");if(t&&e){const s=this.testState.testCurrentGroupIndex/this.testState.testGroups.length*100;t.textContent=`進行: ${this.testState.testCurrentGroupIndex}/${this.testState.testGroups.length} (${s.toFixed(0)}%)`,e.style.width=`${s}%`}this.updateTestPlaybackButtons()}updateTestPlaybackButtons(){const t=document.getElementById("testPlayBtn"),e=document.getElementById("testPauseBtn");t&&e&&(this.testState.testIsPlaying?(t.disabled=!0,e.disabled=!1):(t.disabled=!1,e.disabled=!0))}checkTestAnswer(){const t=document.getElementById("testResultContainer");if(!t)return;const e=this.testState.testUserInput.replace(/\s+/g,""),s=this.testState.testCorrectAnswer.replace(/\s+/g,"");let n=0;const i=Math.max(e.length,s.length);for(let c=0;c<i;c++)e[c]===s[c]&&n++;const a=i>0?Math.round(n/i*100):0,o=a>=90;t.innerHTML=`
      <div class="result ${o?"passed":"failed"}">
        <h2>${o?"合格!":"不合格"}</h2>
        <div class="accuracy">正答率: ${a}%</div>
        <div class="comparison">
          <div>正解: ${s}</div>
          <div>あなたの解答: ${e}</div>
        </div>
        <div class="actions">
          <button id="retryTestBtn" class="btn">もう一度</button>
          <button id="backToTestMenuBtn" class="btn primary">戻る</button>
        </div>
      </div>
    `,document.getElementById("retryTestBtn")?.addEventListener("click",()=>{this.testState.isTestRunning=!1,this.render(),this.startTest()}),document.getElementById("backToTestMenuBtn")?.addEventListener("click",()=>{this.testState.isTestRunning=!1,this.render()})}destroy(){this.audioSystem.stopContinuousTone()}}const dt=Object.freeze(Object.defineProperty({__proto__:null,KochTrainer:lt},Symbol.toStringTag,{value:"Module"}));//! 定型文の型定義。
//! ラバースタンプQSOのサンプルデータ。
const z=[{id:"qso-1",category:"qso",title:"QSO例1: CQ呼び出しから終了まで",content:"CQ CQ CQ DE JF2SDR JF2SDR PSE K"},{id:"qso-2",category:"qso",title:"QSO例2: 応答",content:"JF2SDR DE JR2ZWA JR2ZWA K"},{id:"qso-3",category:"qso",title:"QSO例3: 挨拶と信号報告",content:"R JR2ZWA DE JF2SDR GM OM TNX FER UR CALL BT UR RST IS 599 599 BT MI QTH IS NAGOYA NAGOYA CITY ES MI NAME IS SHIN SHIN HW ? AR JF2SDR DE JF2SDR KN"},{id:"qso-4",category:"qso",title:"QSO例4: 返信と自己紹介",content:"R JF2SDR DE JR2ZWA GM DR SHIN OM TKS FER FB RPT 599 FM NAGOYA BT UR RST ALSO 599 599 VY FB MI QTH IS GIFU GIFU CITY BT NAME IS HIRO HIRO HW? JF2SDR DE JR2ZWA KN"},{id:"qso-5",category:"qso",title:"QSO例5: リグとアンテナ情報",content:"R FB DE JF2SDR DR HIRO OM BT MI RIG I TS-850S PWR 100W ES ANT IS 3ELE YAGI 12MH BT PSE UR QSL CRD VIA JARL ? MI CRD SURE HW? AR JR2ZWA DE JF2SDR KN"},{id:"qso-6",category:"qso",title:"QSO例6: QSL確認と終了",content:"R JF2SDR DE JR2ZWA OK SHIN OM BT UR RIG ES ANT VY FB BT MI RIG IS FT-101ES VY OLD RIG ES ANT IS DP 8MH BT QSL VIA JARL OK SURE BT TNX FB 1ST QSO ES 73 AR JF2SDR DE JR2ZWA VA"},{id:"qso-7",category:"qso",title:"QSO例7: 最終挨拶",content:"OK HIRO SOLID CPI BT TKS FB QSO ES BEST 73 AR JR2ZWA DE JF2SDR VA TU E E"}];//! 英文100字程度のサンプルデータ。
const Q=[{id:"text100-1",category:"text100",title:"英文例1: 自己紹介",content:"MY NAME IS JOHN. I LIVE IN TOKYO JAPAN. I AM A STUDENT AT THE UNIVERSITY. I ENJOY LEARNING MORSE CODE IN MY FREE TIME."},{id:"text100-2",category:"text100",title:"英文例2: 天気",content:"THE WEATHER TODAY IS VERY NICE. IT IS SUNNY AND WARM. I WENT FOR A WALK IN THE PARK. MANY PEOPLE WERE ENJOYING THE SUNSHINE."},{id:"text100-3",category:"text100",title:"英文例3: 趣味",content:"I HAVE MANY HOBBIES. I LIKE READING BOOKS AND LISTENING TO MUSIC. ON WEEKENDS I PLAY TENNIS WITH MY FRIENDS. WE HAVE A LOT OF FUN."}];//! 英文200字程度のサンプルデータ。
const j=[{id:"text200-1",category:"text200",title:"英文例1: アマチュア無線の歴史",content:"AMATEUR RADIO HAS A LONG AND RICH HISTORY. IT BEGAN IN THE EARLY TWENTIETH CENTURY WHEN ENTHUSIASTS STARTED EXPERIMENTING WITH RADIO WAVES. MORSE CODE WAS THE PRIMARY MODE OF COMMUNICATION. TODAY AMATEUR RADIO CONTINUES TO BE A POPULAR HOBBY AROUND THE WORLD. OPERATORS USE VARIOUS MODES INCLUDING CW SSB AND DIGITAL MODES. IT IS A GREAT WAY TO MAKE FRIENDS AND LEARN ABOUT TECHNOLOGY."},{id:"text200-2",category:"text200",title:"英文例2: 旅行の思い出",content:"LAST SUMMER I WENT ON A TRIP TO KYOTO. IT WAS MY FIRST TIME VISITING THE ANCIENT CAPITAL OF JAPAN. I VISITED MANY FAMOUS TEMPLES AND SHRINES. THE ARCHITECTURE WAS BEAUTIFUL AND THE GARDENS WERE PEACEFUL. I ALSO ENJOYED TRYING LOCAL FOODS LIKE TOFU AND GREEN TEA. THE PEOPLE WERE VERY FRIENDLY AND HELPFUL. I TOOK MANY PHOTOS TO REMEMBER THIS WONDERFUL EXPERIENCE. I HOPE TO RETURN SOMEDAY."}];//! 英文300字程度のサンプルデータ。
const V=[{id:"text300-1",category:"text300",title:"英文例1: モールス符号の学習",content:"LEARNING MORSE CODE IS A REWARDING EXPERIENCE. AT FIRST IT MAY SEEM DIFFICULT BUT WITH REGULAR PRACTICE IT BECOMES EASIER. THE KOCH METHOD IS ONE OF THE MOST EFFECTIVE WAYS TO LEARN. IT STARTS WITH JUST TWO CHARACTERS AND GRADUALLY ADDS MORE. THIS APPROACH HELPS YOU LEARN AT A STEADY PACE. LISTENING PRACTICE IS ALSO VERY IMPORTANT. YOU SHOULD TRY TO COPY REAL MORSE CODE TRANSMISSIONS. MANY ONLINE RESOURCES ARE AVAILABLE TO HELP YOU PRACTICE. JOINING AN AMATEUR RADIO CLUB CAN ALSO BE BENEFICIAL. YOU CAN MEET OTHER ENTHUSIASTS AND SHARE EXPERIENCES. WITH DEDICATION AND PATIENCE YOU WILL MASTER MORSE CODE AND ENJOY USING IT IN YOUR RADIO COMMUNICATIONS."},{id:"text300-2",category:"text300",title:"英文例2: 無線交信の楽しみ",content:"AMATEUR RADIO OFFERS MANY EXCITING OPPORTUNITIES. ONE OF THE GREATEST JOYS IS MAKING CONTACT WITH STATIONS AROUND THE WORLD. YOU CAN TALK TO PEOPLE FROM DIFFERENT COUNTRIES AND CULTURES. EACH CONTACT IS UNIQUE AND SPECIAL. SOME OPERATORS ENJOY CONTESTS WHERE THEY TRY TO MAKE AS MANY CONTACTS AS POSSIBLE. OTHERS PREFER RELAXED CONVERSATIONS ABOUT HOBBIES AND DAILY LIFE. DX CONTACTS WITH DISTANT STATIONS ARE PARTICULARLY THRILLING. THE THRILL OF HEARING A WEAK SIGNAL FROM FAR AWAY IS UNFORGETTABLE. OPERATING PORTABLE FROM MOUNTAINTOPS OR PARKS IS ALSO FUN. YOU CAN COMBINE YOUR LOVE OF RADIO WITH OUTDOOR ACTIVITIES. AMATEUR RADIO IS MORE THAN A HOBBY IT IS A LIFELONG PASSION."}];//! すべてのビルトイン定型文を取得する関数。
function ut(){return[...z,...Q,...j,...V]}//! カテゴリー別に定型文を取得する関数。
function ht(u){switch(u){case"qso":return z;case"text100":return Q;case"text200":return j;case"text300":return V;case"custom":return O();default:return[]}}//! ユーザー定義定型文をローカルストレージから取得する関数。
function O(){try{const u=localStorage.getItem("v7.listening.customTemplates");if(u)return JSON.parse(u)}catch(u){console.error("Failed to load custom templates:",u)}return[]}//! ユーザー定義定型文をローカルストレージに保存する関数。
function U(u){try{localStorage.setItem("v7.listening.customTemplates",JSON.stringify(u))}catch(t){console.error("Failed to save custom templates:",t)}}//! 新しいユーザー定義定型文を追加する関数。
function mt(u,t){const e=O(),s={id:`custom-${Date.now()}`,category:"custom",title:u,content:t};e.push(s),U(e)}//! ユーザー定義定型文を更新する関数。
function pt(u,t,e){const s=O(),n=s.findIndex(i=>i.id===u);n!==-1&&(s[n].title=t,s[n].content=e,U(s))}//! ユーザー定義定型文を削除する関数。
function gt(u){const e=O().filter(s=>s.id!==u);U(e)}//! IDで定型文を取得する関数。
function W(u){return[...ut(),...O()].find(e=>e.id===u)}const $=class ${static get(t){return this.settings[t]}static set(t,e){this.settings[t]=e,this.save()}static load(){try{const t=localStorage.getItem("v7.listening.settings");t&&(this.settings={...this.defaultSettings,...JSON.parse(t)})}catch(t){console.error("Failed to load Listening settings:",t)}}static save(){try{localStorage.setItem("v7.listening.settings",JSON.stringify(this.settings))}catch(t){console.error("Failed to save Listening settings:",t)}}static getAll(){return{...this.settings}}static reset(){this.settings={...this.defaultSettings},this.save()}};$.defaultSettings={characterSpeed:20,effectiveSpeed:20,frequency:600,volume:.5},$.settings={...$.defaultSettings};let f=$;class vt{constructor(){this.state={currentCategory:"qso",selectedTemplate:null,isPlaying:!1,userInput:"",showResult:!1};//! 設定を読み込み。
f.load();const t=f.getAll();//! AudioSystemを初期化。
this.audioSystem=new P({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed,effectiveWpm:t.effectiveSpeed}),this.render()}render(){const t=document.getElementById("app");t&&(t.innerHTML=`
			<div class="settings-icon" id="settingsIcon">
				<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
					<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
				</svg>
			</div>

			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>モールス信号聞き取り練習</h1>
				</header>

				<div class="category-tabs">
					${this.renderCategoryTabs()}
				</div>

				<div class="content-area">
					${this.state.selectedTemplate?this.renderPracticeArea():this.renderTemplateList()}
				</div>
			</div>
		`,this.attachEventListeners())}renderCategoryTabs(){return[{id:"qso",label:"ラバースタンプQSO"},{id:"text100",label:"英文100字"},{id:"text200",label:"英文200字"},{id:"text300",label:"英文300字"},{id:"custom",label:"ユーザー定義"}].map(e=>`
			<button class="tab-button ${this.state.currentCategory===e.id?"active":""}" data-category="${e.id}">
				${e.label}
			</button>
		`).join("")}renderTemplateList(){const t=ht(this.state.currentCategory);return t.length===0?`
				<div class="empty-state">
					<p>定型文がありません</p>
					${this.state.currentCategory==="custom"?'<button id="addCustomBtn" class="btn primary">新規作成</button>':""}
				</div>
			`:`
			<div class="template-list">
				${this.state.currentCategory==="custom"?'<button id="addCustomBtn" class="btn primary">新規作成</button>':""}
				${t.map(e=>`
					<div class="template-card" data-template-id="${e.id}">
						<h3>${e.title}</h3>
						<p class="template-preview">${e.content.substring(0,100)}${e.content.length>100?"...":""}</p>
						<div class="template-actions">
							<button class="btn select-btn" data-template-id="${e.id}">選択</button>
							${this.state.currentCategory==="custom"?`
								<button class="btn edit-btn" data-template-id="${e.id}">編集</button>
								<button class="btn delete-btn" data-template-id="${e.id}">削除</button>
							`:""}
						</div>
					</div>
				`).join("")}
			</div>
		`}renderPracticeArea(){return this.state.selectedTemplate?`
			<div class="practice-area">
				<div class="practice-header">
					<h2>${this.state.selectedTemplate.title}</h2>
					<button id="backToListBtn" class="btn">一覧に戻る</button>
				</div>

				<div class="playback-controls">
					<button id="playBtn" class="control-btn" title="再生" ${this.state.isPlaying?"disabled":""}>
						<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
							<path d="M8 5v14l11-7z"/>
						</svg>
					</button>
					<button id="pauseBtn" class="control-btn" title="一時停止" ${this.state.isPlaying?"":"disabled"}>
						<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
							<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
						</svg>
					</button>
					<button id="stopBtn" class="control-btn" title="停止">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
							<rect x="6" y="6" width="12" height="12"/>
						</svg>
					</button>
					<button id="downloadBtn" class="control-btn" title="WAVファイルとしてダウンロード">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
							<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
						</svg>
					</button>
				</div>

				<div class="input-section">
					<label for="userInput">聞き取った内容を入力してください:</label>
					<textarea id="userInput" class="input-area" placeholder="聞き取った文字を入力...">${this.state.userInput}</textarea>
				</div>

				<div class="action-buttons">
					<button id="checkBtn" class="btn primary">採点</button>
					<button id="showAnswerBtn" class="btn">正解を表示</button>
				</div>

				${this.state.showResult?this.renderResult():""}
			</div>
		`:""}renderResult(){if(!this.state.selectedTemplate)return"";const t=this.state.selectedTemplate.content.toUpperCase().replace(/\s+/g,""),e=this.state.userInput.toUpperCase().replace(/\s+/g,"");let s=0;const n=Math.max(t.length,e.length);for(let a=0;a<n;a++)t[a]===e[a]&&s++;return`
			<div class="result-area">
				<h3>結果</h3>
				<div class="accuracy">正答率: ${n>0?Math.round(s/n*100):0}%</div>
				<div class="comparison">
					<div class="comparison-row">
						<strong>正解:</strong>
						<div class="comparison-text">${this.state.selectedTemplate.content}</div>
					</div>
					<div class="comparison-row">
						<strong>入力:</strong>
						<div class="comparison-text">${this.state.userInput||"（未入力）"}</div>
					</div>
				</div>
			</div>
		`}attachEventListeners(){//! 戻るボタン。
document.getElementById("backBtn")?.addEventListener("click",()=>{if(this.state.selectedTemplate){//! 練習画面から一覧画面に戻る。
this.state.selectedTemplate=null,this.state.showResult=!1,this.state.userInput="",this.audioSystem.stopPlaying(),this.render()}else{//! 一覧画面からメニュー画面に戻る。
window.location.href="./index.html"}});//! 設定アイコン。
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.showSettings()});//! カテゴリータブ。
document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-category");s&&(this.state.currentCategory=s,this.state.selectedTemplate=null,this.state.showResult=!1,this.state.userInput="",this.render())})});//! 定型文選択ボタン。
document.querySelectorAll(".select-btn").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-template-id");if(s){const n=W(s);n&&(this.state.selectedTemplate=n,this.state.showResult=!1,this.state.userInput="",this.render())}})});//! ユーザー定義定型文の新規作成ボタン。
document.getElementById("addCustomBtn")?.addEventListener("click",()=>{this.showCustomTemplateDialog()});//! ユーザー定義定型文の編集ボタン。
document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-template-id");if(s){const n=W(s);n&&this.showCustomTemplateDialog(n)}})});//! ユーザー定義定型文の削除ボタン。
document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-template-id");s&&confirm("この定型文を削除しますか?")&&(gt(s),this.render())})});//! 一覧に戻るボタン。
document.getElementById("backToListBtn")?.addEventListener("click",()=>{this.state.selectedTemplate=null,this.state.showResult=!1,this.state.userInput="",this.audioSystem.stopPlaying(),this.render()});//! 再生ボタン。
document.getElementById("playBtn")?.addEventListener("click",()=>{this.playMorse()});//! 一時停止ボタン。
document.getElementById("pauseBtn")?.addEventListener("click",()=>{this.pauseMorse()});//! 停止ボタン。
document.getElementById("stopBtn")?.addEventListener("click",()=>{this.stopMorse()});//! ダウンロードボタン。
document.getElementById("downloadBtn")?.addEventListener("click",()=>{this.downloadMorseAudio()});//! 入力欄。
const t=document.getElementById("userInput");t&&t.addEventListener("input",e=>{this.state.userInput=e.target.value});//! 採点ボタン。
document.getElementById("checkBtn")?.addEventListener("click",()=>{this.state.showResult=!0,this.render()});//! 正解表示ボタン。
document.getElementById("showAnswerBtn")?.addEventListener("click",()=>{this.state.selectedTemplate&&alert(`正解:
${this.state.selectedTemplate.content}`)})}async playMorse(){if(!this.state.selectedTemplate||this.state.isPlaying)return;this.state.isPlaying=!0,this.render();const t=T.textToMorse(this.state.selectedTemplate.content);await this.audioSystem.playMorseString(t),this.state.isPlaying=!1,this.render()}pauseMorse(){this.state.isPlaying=!1,this.audioSystem.stopPlaying(),this.render()}stopMorse(){this.state.isPlaying=!1,this.audioSystem.stopPlaying(),this.state.userInput="",this.state.showResult=!1,this.render()}showSettings(){//! 現在の設定を保存（キャンセル時の復元用）。
const t={...f.getAll()},e=f.getAll(),s=document.createElement("div");s.className="modal",s.innerHTML=`
			<div class="modal-content">
				<div class="modal-header">
					<h2>設定</h2>
					<button id="closeSettings" class="close-btn">×</button>
				</div>
				<div class="modal-body">
					<div class="setting-item">
						<label>文字速度 (Character Speed) WPM:</label>
						<input type="number" id="characterSpeed" min="5" max="40" step="1" value="${e.characterSpeed}">
					</div>

					<div class="setting-item">
						<label>実効速度 (Effective Speed) WPM:</label>
						<input type="number" id="effectiveSpeed" min="5" max="40" step="1" value="${e.effectiveSpeed}">
					</div>

					<div class="setting-item">
						<label>周波数 (Hz):</label>
						<input type="number" id="frequency" min="400" max="1000" step="10" value="${e.frequency}">
					</div>

					<div class="setting-item">
						<label>音量 (%):</label>
						<div class="volume-control">
							<input type="range" id="volumeRange" min="0" max="100" step="5" value="${e.volume*100}">
							<input type="number" id="volumeInput" min="0" max="100" step="5" value="${Math.round(e.volume*100)}">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button id="cancelSettings" class="btn">キャンセル</button>
					<button id="saveSettings" class="btn primary">OK</button>
				</div>
			</div>
		`,document.body.appendChild(s);//! 音量のレンジと入力欄を連携。
const n=document.getElementById("volumeRange"),i=document.getElementById("volumeInput");n&&i&&(n.oninput=o=>{const c=o.target.value;i.value=c},i.oninput=o=>{const c=o.target.value;n.value=c});//! 設定を復元する関数。
const a=()=>{f.set("characterSpeed",t.characterSpeed),f.set("effectiveSpeed",t.effectiveSpeed),f.set("frequency",t.frequency),f.set("volume",t.volume);//! AudioSystemを元に戻す。
this.audioSystem.updateSettings({frequency:t.frequency,volume:t.volume,wpm:t.characterSpeed,effectiveWpm:t.effectiveSpeed})};//! OK（保存）ボタン。
document.getElementById("saveSettings")?.addEventListener("click",()=>{const o=document.getElementById("characterSpeed"),c=document.getElementById("effectiveSpeed"),r=document.getElementById("frequency"),l=parseInt(o.value);let h=parseInt(c.value);//! 実効速度は文字速度を上限とする。
h>l&&(h=l,c.value=l.toString()),f.set("characterSpeed",l),f.set("effectiveSpeed",h),f.set("frequency",parseInt(r.value)),f.set("volume",parseInt(i.value)/100);//! AudioSystemを更新。
this.audioSystem.updateSettings({frequency:f.get("frequency"),volume:f.get("volume"),wpm:f.get("characterSpeed"),effectiveWpm:f.get("effectiveSpeed")}),s.remove()});//! キャンセルボタン。
document.getElementById("cancelSettings")?.addEventListener("click",()=>{a(),s.remove()});//! ×ボタンで閉じる（キャンセル扱い）。
document.getElementById("closeSettings")?.addEventListener("click",()=>{a(),s.remove()});//! モーダル外クリックで閉じる（キャンセル扱い）。
s.addEventListener("click",o=>{o.target===s&&(a(),s.remove())})}showCustomTemplateDialog(t){const e=!!t,s=document.createElement("div");s.className="modal",s.innerHTML=`
			<div class="modal-content">
				<div class="modal-header">
					<h2>${e?"定型文を編集":"新しい定型文を作成"}</h2>
					<button id="closeDialog" class="close-btn">×</button>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="templateTitle">タイトル:</label>
						<input type="text" id="templateTitle" class="form-input" value="${t?.title||""}" placeholder="例: 私のQSO">
					</div>
					<div class="form-group">
						<label for="templateContent">内容:</label>
						<textarea id="templateContent" class="form-textarea" placeholder="モールス信号で送信する文章を入力してください">${t?.content||""}</textarea>
					</div>
				</div>
				<div class="modal-footer">
					<button id="cancelDialog" class="btn">キャンセル</button>
					<button id="saveDialog" class="btn primary">${e?"更新":"作成"}</button>
				</div>
			</div>
		`,document.body.appendChild(s);//! 保存ボタン。
document.getElementById("saveDialog")?.addEventListener("click",()=>{const n=document.getElementById("templateTitle"),i=document.getElementById("templateContent");if(n&&i){const a=n.value.trim(),o=i.value.trim();if(!a||!o){alert("タイトルと内容を入力してください");return}e&&t?pt(t.id,a,o):mt(a,o),s.remove(),this.render()}});//! キャンセルボタン。
document.getElementById("cancelDialog")?.addEventListener("click",()=>{s.remove()});//! 閉じるボタン。
document.getElementById("closeDialog")?.addEventListener("click",()=>{s.remove()});//! モーダル外クリックで閉じる。
s.addEventListener("click",n=>{n.target===s&&s.remove()})}async downloadMorseAudio(){if(this.state.selectedTemplate)try{//! 設定を取得。
const t=f.getAll(),e=t.characterSpeed,s=t.effectiveSpeed,n=t.frequency,i=t.volume;//! モールス符号に変換。
const a=T.textToMorse(this.state.selectedTemplate.content);//! タイミングを計算（ミリ秒）。
const o=1200/e,c=o*3,r=o,l=o*3,h=7*(1200/s);//! 総時間を計算。
let g=0;for(let w=0;w<a.length;w++){const I=a[w];I==="."?g+=o+r:I==="-"?g+=c+r:I===" "?g+=l-r:I==="/"&&(g+=h-r)}//! サンプルレート。
const v=44100,m=g/1e3;//! OfflineAudioContextを作成。
const b=new OfflineAudioContext(1,Math.ceil(v*m),v);//! モールス信号を生成。
let y=0;for(let w=0;w<a.length;w++){const I=a[w];let x=0;if(I==="."?x=o:I==="-"&&(x=c),x>0){//! オシレーターとゲインノードを作成。
const k=b.createOscillator(),L=b.createGain();k.connect(L),L.connect(b.destination),k.frequency.value=n,k.type="sine";//! エンベロープ（フェードイン・フェードアウト）。
const D=y/1e3,N=D+x/1e3;L.gain.setValueAtTime(0,D),L.gain.linearRampToValueAtTime(i,D+.001),L.gain.setValueAtTime(i,N-.001),L.gain.linearRampToValueAtTime(0,N),k.start(D),k.stop(N),y+=x+r}else I===" "?y+=l-r:I==="/"&&(y+=h-r)}//! レンダリング。
const E=await b.startRendering();//! WAVファイルに変換。
const K=this.audioBufferToWav(E);//! ダウンロード。
const H=URL.createObjectURL(K),M=document.createElement("a");M.href=H,M.download=`${this.state.selectedTemplate.title.replace(/[^a-zA-Z0-9]/g,"_")}.wav`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(H)}catch(t){console.error("音声ダウンロードエラー:",t),alert("音声ファイルの生成に失敗しました")}}audioBufferToWav(t){const e=t.numberOfChannels,s=t.sampleRate,n=1,i=16,a=i/8,o=e*a,c=new Float32Array(t.length*e);for(let b=0;b<e;b++){const y=t.getChannelData(b);for(let E=0;E<t.length;E++)c[E*e+b]=y[E]}const r=c.length*a,l=44+r,h=new ArrayBuffer(l),g=new DataView(h);//! WAVヘッダーを書き込む。
const v=(b,y)=>{for(let E=0;E<y.length;E++)g.setUint8(b+E,y.charCodeAt(E))};//! RIFFチャンク。
v(0,"RIFF"),g.setUint32(4,l-8,!0),v(8,"WAVE");//! fmtチャンク。
v(12,"fmt "),g.setUint32(16,16,!0),g.setUint16(20,n,!0),g.setUint16(22,e,!0),g.setUint32(24,s,!0),g.setUint32(28,s*o,!0),g.setUint16(32,o,!0),g.setUint16(34,i,!0);//! dataチャンク。
v(36,"data"),g.setUint32(40,r,!0);//! PCMデータを書き込む。
let m=44;for(let b=0;b<c.length;b++){const y=Math.max(-1,Math.min(1,c[b])),E=y<0?y*32768:y*32767;g.setInt16(m,E,!0),m+=2}return new Blob([h],{type:"audio/wav"})}destroy(){this.audioSystem.stopContinuousTone()}}const bt=Object.freeze(Object.defineProperty({__proto__:null,ListeningTrainer:vt},Symbol.toStringTag,{value:"Module"}));</script>
  <style rel="stylesheet" crossorigin>body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{max-width:1200px;width:100%}.header{text-align:center;color:#fff;margin-bottom:40px}.header h1{font-size:2.5rem;margin-bottom:10px}.subtitle{font-size:1.1rem;opacity:.9}.menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:40px}.menu-card{background:#fff;border-radius:12px;padding:30px;text-decoration:none;color:#333;transition:transform .3s,box-shadow .3s;box-shadow:0 4px 6px #0000001a;display:flex;flex-direction:column;align-items:center;text-align:center}.menu-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0003}.menu-icon{font-size:3rem;margin-bottom:15px}.menu-title{font-size:1.3rem;margin-bottom:10px;color:#667eea}.menu-description{font-size:.95rem;color:#666;line-height:1.5}.footer{text-align:center;color:#fff;opacity:.8;font-size:.9rem}@media (max-width: 768px){.header h1{font-size:2rem}.menu-grid{grid-template-columns:1fr}}.key-container{display:flex;justify-content:center;margin-bottom:40px}.morse-key{width:200px;height:200px;background:linear-gradient(145deg,#fff,#e6e6e6);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none;box-shadow:0 10px 30px #0000004d;transition:transform .1s,box-shadow .1s;touch-action:none}.morse-key:active,.morse-key.pressed{transform:scale(.95);box-shadow:0 5px 15px #0000004d;background:linear-gradient(145deg,#e6e6e6,#ccc)}.key-label{font-size:1.5rem;font-weight:700;color:#667eea}.output-container{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.output-section{margin-bottom:20px}.output-section:last-child{margin-bottom:0}.output-section h2{font-size:1.2rem;color:#667eea;margin-bottom:10px}.output-display{background:#f5f5f5;border-radius:8px;padding:15px;min-height:60px;font-family:Courier New,monospace;font-size:1.1rem;color:#333;word-wrap:break-word}.controls{display:flex;justify-content:center;gap:10px;margin-bottom:30px}.btn{background:#fff;border:none;color:#667eea;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:600;transition:background .3s,transform .1s}.instructions{background:#ffffff1a;border-radius:12px;padding:20px;color:#fff}.instructions h3{margin-bottom:15px;font-size:1.2rem}.instructions ul{list-style:none;padding:0}.settings-icon{position:fixed;top:20px;right:20px;width:50px;height:50px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 15px #0003;z-index:100;transition:all .3s ease}.settings-icon:hover{transform:rotate(90deg) scale(1.1)}.settings-icon svg{width:28px;height:28px;fill:#667eea}.settings-content{background:#fff;border-radius:20px;padding:30px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px #0000004d}.settings-header{margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #e0e0e0}.settings-header h2{font-size:1.5rem;color:#333}.setting-item{display:flex;flex-direction:column;gap:10px}.setting-item label{font-weight:600;color:#555;font-size:1rem}.btn-secondary{background:linear-gradient(135deg,#888,#666);color:#fff}@media (max-width: 768px){.header h1{font-size:1.5rem}.morse-key{width:150px;height:150px}.key-label{font-size:1.2rem}}.settings-icon svg{width:28px;height:28px;fill:#fff}.settings-modal{display:none;position:fixed;inset:0;background:#00000080;z-index:200;align-items:center;justify-content:center;padding:20px}.settings-content{background:#fff;border-radius:20px;padding:30px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px #0000004d;scrollbar-width:none;-ms-overflow-style:none}.settings-content::-webkit-scrollbar{display:none}.settings-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #e0e0e0}.settings-header h2{font-size:24px;color:#333}.close-btn{background:none;border:none;font-size:32px;cursor:pointer;color:#999;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s ease}.close-btn:hover{background:#f0f0f0;color:#333}.settings-grid{display:grid;gap:20px}.setting-item{display:flex;flex-direction:column;gap:8px}.setting-item>label:not(.toggle-label){display:block;margin-bottom:8px;font-weight:600;color:#555;font-size:15px}.setting-row{display:flex;align-items:center;gap:10px}.setting-row input[type=range]{flex:1}.setting-row input[type=number]{width:80px;padding:8px;border:2px solid #ddd;border-radius:6px;font-size:1rem;text-align:center}.setting-row input[type=number]:focus{outline:none;border-color:#667eea}.toggle-switch{position:relative;display:inline-block;width:60px;height:30px}.toggle-input{opacity:0;width:0;height:0;position:absolute}.toggle-switch .toggle-label{position:absolute;cursor:pointer;inset:0;background:linear-gradient(135deg,#e0e0e0,#f5f5f5);border:2px solid #ddd;border-radius:30px;transition:all .3s ease;box-shadow:inset 0 2px 4px #0000001a,0 2px 8px #0000001a;box-sizing:border-box}.toggle-switch .toggle-label:hover{border-color:#667eea;box-shadow:inset 0 2px 4px #0000001a,0 2px 12px #667eea33}.toggle-switch-handle{position:absolute;content:"";height:22px;width:22px;left:2px;top:2px;background:linear-gradient(135deg,#fff,#f8f8f8);border-radius:50%;transition:all .3s ease;box-shadow:0 2px 6px #0003,0 1px 3px #0000001a}.toggle-input:checked+.toggle-label{background:linear-gradient(135deg,#667eea,#764ba2);border-color:#667eea;box-shadow:inset 0 2px 4px #0000001a,0 2px 12px #667eea66}.toggle-input:checked+.toggle-label .toggle-switch-handle{transform:translate(30px);background:linear-gradient(135deg,#fff,#f0f8ff);box-shadow:0 2px 8px #0000004d,0 1px 4px #0003}.toggle-input:focus+.toggle-label{outline:2px solid #667eea;outline-offset:2px}.toggle-label:active .toggle-switch-handle{width:26px}.toggle-input:checked+.toggle-label:active .toggle-switch-handle{transform:translate(26px)}.settings-buttons{display:flex;justify-content:center;gap:15px;margin-top:25px}.btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:600;transition:background .3s,transform .1s;box-shadow:0 4px 15px #667eea66;min-width:120px}.btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px #667eea99}.btn:active{transform:scale(.98)}.btn-secondary{background:linear-gradient(135deg,#888,#666);color:#fff;box-shadow:0 4px 15px #8886}.btn-secondary:hover{box-shadow:0 6px 20px #8889}.paddle-container{display:flex;justify-content:center;gap:30px;margin:30px auto}.paddle-key{font-size:22px;font-weight:700;padding:40px 50px;color:#fff;border:none;border-radius:15px;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none;min-width:140px;min-height:170px;box-shadow:0 8px 25px #0000004d;transition:all .2s ease;cursor:pointer}.paddle-left{background:linear-gradient(135deg,#4facfe,#00f2fe)}.paddle-left.active{transform:scale(.95)}.paddle-right{background:linear-gradient(135deg,#fa709a,#fee140)}.paddle-right.active{transform:scale(.95)}.paddle-label{text-align:center;font-size:1.2rem;font-weight:700;color:#fff}.keyboard-hint{text-align:center;font-size:14px;color:#fff;margin-top:15px;font-style:italic;background:#fff3;padding:10px;border-radius:6px;margin-bottom:15px}.squeeze-indicator{text-align:center;margin-top:15px;margin-bottom:15px;font-size:16px;font-weight:700;color:#ff6b00;opacity:0;transition:opacity .2s;background:#fff3cde6;padding:10px;border-radius:6px}.squeeze-indicator.active{opacity:1}.morse-display{font-family:Courier New,monospace;font-size:18px;background:#fff;padding:20px;border-radius:8px;min-height:60px;word-wrap:break-word;letter-spacing:2px;border:2px solid #e0e0e0;margin-bottom:15px}.decoded-output{background:#fff;padding:20px;border-radius:8px;min-height:50px;font-weight:700;font-size:18px;border:2px solid #e0e0e0;color:#333;margin-bottom:15px}@media (max-width: 768px){.header h1{font-size:1.5rem}.paddle-key{min-width:120px;min-height:150px;padding:30px 40px}.paddle-label{font-size:1rem}}.prosign{text-decoration:overline}.container{max-width:1200px;margin:0 auto}.header h1{font-size:2rem;flex:1}.mode-toggle{margin-left:auto}.toggle-mode-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:.9rem;transition:transform .2s,box-shadow .2s;white-space:nowrap}.toggle-mode-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.tags-container{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.tags-container h2{font-size:1.2rem;color:#667eea;margin-bottom:15px}.tags-list{display:flex;flex-wrap:wrap;gap:10px}.tag-btn{background:#f0f0f0;border:2px solid transparent;color:#667eea;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:.9rem;transition:all .3s}.tag-btn:hover{background:#e0e0e0}.tag-btn.active{background:#667eea;color:#fff;border-color:#667eea}.entries-container{background:#fff;border-radius:12px;padding:20px}.entries-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.entries-header h2{font-size:1.2rem;color:#667eea;margin:0}.entries-container h2{font-size:1.2rem;color:#667eea;margin-bottom:15px}.entries-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}.entry-card{background:#f9f9f9;border-radius:8px;padding:15px;transition:transform .2s,box-shadow .2s;cursor:pointer}.entry-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.entry-card.playing{background:linear-gradient(135deg,#ffe0e0,#ffd0d0);box-shadow:0 4px 12px #f443364d;animation:cardPulse 1s infinite}@keyframes cardPulse{0%,to{opacity:1}50%{opacity:.85}}.entry-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.entry-abbr{font-size:1.3rem;font-weight:700;color:#667eea}.entry-frequency{font-size:1rem;color:orange;-webkit-user-select:none;user-select:none}.entry-english{font-size:.95rem;color:#666;margin-bottom:5px}.entry-japanese{font-size:1rem;color:#333;margin-bottom:10px}.entry-description{font-size:.9rem;color:#666;margin-bottom:8px;line-height:1.5}.entry-example{font-size:.85rem;color:#888;margin-bottom:10px;font-style:italic;padding-left:10px;border-left:3px solid #ddd}.entry-tags{font-size:.85rem;color:#999;font-style:italic}.error{background:#fff;border-radius:12px;padding:40px;text-align:center;color:#d32f2f;font-size:1.1rem}.list-table-container{overflow-x:auto}.list-table{width:100%;border-collapse:collapse;background:#fff}.list-table thead{background:#667eea;color:#fff}.list-table th{padding:12px;text-align:left;font-weight:600;white-space:nowrap}.list-table th.sortable{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .2s}.list-table th.sortable:hover{background:#5568d3}.list-table tbody tr{border-bottom:1px solid #e0e0e0;transition:background .2s}.list-table tbody tr:hover{background:#f5f5f5}.list-table td{padding:10px 12px}.list-frequency{color:orange;font-size:.9rem;white-space:nowrap;text-align:center;-webkit-user-select:none;user-select:none}.list-abbr{white-space:nowrap}.abbr-play-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;font-weight:700;transition:transform .2s,box-shadow .2s;white-space:nowrap}.abbr-play-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px #667eea4d}.abbr-play-btn.playing{background:linear-gradient(135deg,#f44336,#e91e63);animation:pulse 1s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.7}}.abbr-play-btn .prosign{text-decoration:overline}.list-english{color:#666;min-width:150px}.list-japanese{color:#333;min-width:150px}.list-tags{color:#999;font-size:.85rem;font-style:italic}.list-description{color:#555;font-size:.9rem;line-height:1.4;min-width:200px}.list-example{color:#777;font-size:.85rem;font-style:italic;line-height:1.4;min-width:200px}.filter-section{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.filter-group{margin-bottom:20px}.filter-group h2{font-size:1.1rem;color:#667eea;margin-bottom:10px;display:flex;align-items:center;gap:10px}.toggle-freq-btn{background:#667eea1a;border:1px solid #667eea;color:#667eea;padding:4px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .2s}.toggle-freq-btn:hover{background:#667eea;color:#fff}.search-input{width:100%;max-width:500px;padding:10px 15px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:border-color .3s}.search-input:focus{outline:none;border-color:#667eea}.frequency-list{display:flex;flex-wrap:wrap;gap:10px}.freq-btn{background:#f0f0f0;border:2px solid transparent;color:#667eea;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:1rem;transition:all .3s;-webkit-user-select:none;user-select:none}.freq-btn:hover{background:#e0e0e0}.freq-btn.active{background:#667eea;color:#fff;border-color:#667eea}.mode-buttons{display:flex;flex-wrap:wrap;gap:10px}.mode-btn{background:#f0f0f0;border:2px solid transparent;color:#667eea;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:.9rem;transition:all .3s;-webkit-user-select:none;user-select:none}.mode-btn:hover{background:#e0e0e0}.mode-btn.selected{background:#667eea;color:#fff;border-color:#667eea}.result-count{font-size:1rem;color:#667eea;margin:15px 0;font-weight:600}.action-buttons{display:flex;gap:10px;margin-top:15px}.primary-button{background:#667eea;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.primary-button:hover{background:#5568d3}.secondary-button{background:#f0f0f0;color:#333;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.secondary-button:hover{background:#e0e0e0}.learning-view{max-width:800px}.learning-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.progress-indicator{font-size:1.2rem;color:#fff;font-weight:600}.no-cards{background:#fff;border-radius:12px;padding:60px;text-align:center;font-size:1.2rem;color:#666;margin-bottom:20px}.card-container{perspective:1000px;margin-bottom:30px}.flashcard{position:relative;width:100%;min-height:400px;transition:transform .6s;transform-style:preserve-3d}.flashcard.flipped{transform:rotateY(180deg)}.card-front,.card-back{position:absolute;width:100%;min-height:400px;backface-visibility:hidden;background:#fff;border-radius:12px;padding:40px;display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 4px 20px #0000001a}.card-back{transform:rotateY(180deg)}.card-label{font-size:1rem;color:#999;margin-bottom:20px;text-transform:uppercase;letter-spacing:1px}.card-content{font-size:3rem;font-weight:700;color:#667eea;margin-bottom:30px;text-align:center}.card-content-abbr{font-size:2rem;font-weight:700;color:#667eea;margin-bottom:15px}.card-content-text{font-size:1.3rem;color:#333;margin-bottom:10px;text-align:center}.card-description{font-size:1rem;color:#666;margin-top:15px;margin-bottom:10px;text-align:center;line-height:1.6;max-width:90%}.card-example{font-size:.95rem;color:#888;margin-top:10px;margin-bottom:10px;text-align:center;font-style:italic;padding:10px;background:#f9f9f9;border-radius:6px;max-width:90%}.card-tags{font-size:.9rem;color:#999;margin-top:20px}.play-morse-btn{background:#764ba2;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.play-morse-btn:hover{background:#5f3d84}.card-controls{text-align:center;margin-bottom:20px}.control-button{background:#667eea;color:#fff;border:none;padding:15px 40px;border-radius:8px;font-size:1.1rem;cursor:pointer;transition:background .3s}.control-button:hover{background:#5568d3}.judgment-controls{display:flex;justify-content:center;gap:20px;margin-bottom:20px}.judgment-button{border:2px solid transparent;padding:15px 40px;border-radius:8px;font-size:1.1rem;cursor:pointer;transition:all .3s}.judgment-button.known{background:#f0f0f0;color:#4caf50}.judgment-button.known:hover{background:#e8f5e9}.judgment-button.known.active{background:#4caf50;color:#fff;border-color:#4caf50}.judgment-button.unknown{background:#f0f0f0;color:#f44336}.judgment-button.unknown:hover{background:#ffebee}.judgment-button.unknown.active{background:#f44336;color:#fff;border-color:#f44336}.navigation-controls{display:flex;justify-content:space-between;gap:20px}.nav-button{background:#fff3;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.nav-button:hover:not(:disabled){background:#ffffff4d}.nav-button:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.header h1{font-size:1.5rem}.entries-list{grid-template-columns:1fr}.toggle-mode-btn{font-size:.9rem;padding:8px 12px}.list-table{font-size:.9rem}.list-table th,.list-table td{padding:8px}.card-content{font-size:2rem}.card-content-abbr{font-size:1.5rem}.card-content-text{font-size:1.1rem}.judgment-controls,.navigation-controls{flex-direction:column}}.settings-icon{width:40px;height:40px;background:#fff3;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.settings-icon:hover{background:#ffffff4d;transform:rotate(90deg) scale(1.1)}.tabs{display:flex;gap:8px;margin-bottom:20px;border-bottom:2px solid rgba(255,255,255,.3)}.tab-button{background:#ffffff1a;border:none;color:#fff;padding:12px 24px;border-radius:8px 8px 0 0;cursor:pointer;font-size:1rem;font-weight:500;transition:all .3s;border-bottom:3px solid transparent}.tab-button:hover{background:#fff3}.tab-button.active{background:#fff;color:#667eea;border-bottom-color:#667eea}.settings-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;align-items:center;justify-content:center;z-index:1000}.settings-modal.active{display:flex}.settings-content{background:#fff;border-radius:12px;padding:30px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.settings-content h2{margin-bottom:20px;color:#333}.settings-grid{display:flex;flex-direction:column;gap:20px;margin-bottom:30px}.setting-item{display:grid;grid-template-columns:150px 1fr auto auto;gap:15px;align-items:center}.setting-item label{font-weight:600;color:#555}.setting-item input[type=range]{width:100%}.setting-item input[type=number]{width:80px;padding:8px;border:2px solid #e0e0e0;border-radius:8px;text-align:center}.test-button{padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s}.test-button:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.settings-buttons{display:flex;justify-content:center;gap:15px}.question-type-buttons,.question-count-buttons{display:flex;flex-wrap:wrap;gap:10px}.question-type-btn,.question-count-btn{padding:12px 20px;background:#ffffffe6;color:#333;border:2px solid transparent;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s;flex:1;min-width:120px}.question-type-btn:hover,.question-count-btn:hover{background:#fff;transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.question-type-btn.selected,.question-count-btn.selected{background:#667eea;color:#fff;border-color:#667eea}.exam-view,.exam-result-view{background:#fff;border-radius:12px;padding:30px}.exam-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.question-container{background:#f9f9f9;padding:40px;border-radius:8px;margin-bottom:30px}.question-text{font-size:1.25rem;color:#333;text-align:center}.question-text p{margin-bottom:12px}.question-abbr{font-size:3rem;font-weight:700;font-family:Courier New,monospace;color:#667eea;margin:20px 0}.question-meaning{font-size:1.125rem;font-weight:500;color:#555;margin:12px 0}.choices-container{display:grid;grid-template-columns:1fr;gap:12px;max-width:800px;margin:0 auto 30px}.choice-button{padding:16px 24px;background:#fff;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;text-align:left;cursor:pointer;transition:all .3s}.choice-button:hover:not(:disabled){border-color:#667eea;background:#f0f8ff}.choice-button:disabled{cursor:not-allowed;opacity:.6}.feedback-area{min-height:60px;display:flex;align-items:center;justify-content:center;margin-top:20px}.feedback-text{font-size:1.5rem;font-weight:600;padding:20px 40px;border-radius:8px}.feedback-area.correct .feedback-text{background:#e8f5e9;color:#2e7d32;border:2px solid #4caf50}.feedback-area.incorrect .feedback-text{background:#ffebee;color:#c62828;border:2px solid #ef5350}.result-header h2{font-size:2rem;color:#333;text-align:center;margin-bottom:30px}.score-display{text-align:center;padding:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;color:#fff;margin-bottom:40px}.score-large{font-size:4rem;font-weight:700;margin-bottom:12px}.score-percentage{font-size:2.25rem;font-weight:500}.result-details{max-width:800px;margin:0 auto 30px}.result-details h3{font-size:1.5rem;color:#333;margin-bottom:20px}.wrong-questions{display:flex;flex-direction:column;gap:16px}.wrong-question-item{background:#fff3e0;border:2px solid #ffa726;border-radius:8px;padding:20px}.wrong-q-abbr{font-size:1.5rem;font-weight:700;font-family:Courier New,monospace;color:#667eea;margin-bottom:12px}.wrong-q-correct{font-size:1rem;font-weight:600;color:#2e7d32;margin-bottom:8px}.wrong-q-user{font-size:1rem;color:#c62828;margin-bottom:12px}.wrong-q-meaning{font-size:.875rem;color:#666;font-style:italic}.perfect-score{text-align:center;font-size:1.5rem;font-weight:600;color:#2e7d32;padding:40px;background:#e8f5e9;border-radius:8px}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}.container{max-width:800px;margin:0 auto}.header{display:flex;align-items:center;gap:20px;margin-bottom:30px;color:#fff}.back-btn{background:#fff3;border:none;color:#fff;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:1rem;transition:background .3s}.back-btn:hover{background:#ffffff4d}.header h1{font-size:2rem}.lesson-info{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;text-align:center}.lesson-info h2{color:#667eea;margin-bottom:10px}.chars{font-family:Courier New,monospace;font-size:1.2rem;color:#333;margin-bottom:20px}.controls{display:flex;justify-content:center;margin-bottom:30px}.btn{background:#fff;border:none;color:#667eea;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .3s}.practice-area{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.progress{font-size:1.1rem;color:#667eea;margin-bottom:15px;text-align:center}.progress-section{margin-bottom:20px}.progress-bar-container{width:100%;height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden;margin-bottom:10px}.progress-bar{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s ease}.progress-text{font-size:1rem;color:#667eea;text-align:center}.playback-controls{display:flex;justify-content:center;gap:15px;margin-bottom:20px}.control-btn{width:50px;height:50px;border-radius:50%;border:2px solid #667eea;background:#fff;color:#667eea;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s}.control-btn:hover:not(:disabled){background:#667eea;color:#fff;transform:scale(1.1)}.control-btn:disabled{opacity:.3;cursor:not-allowed}.input-area{width:100%;min-height:120px;padding:15px;border:2px solid #ddd;border-radius:8px;font-family:Courier New,monospace;font-size:1.1rem;margin-bottom:15px;resize:vertical}.result{background:#fff;border-radius:12px;padding:30px;text-align:center}.result h2{font-size:2rem;margin-bottom:20px}.result.passed h2{color:#4caf50}.result.failed h2{color:#f44336}.accuracy{font-size:1.5rem;color:#667eea;margin-bottom:20px}.comparison{background:#f9f9f9;border-radius:8px;padding:15px;margin-bottom:20px;text-align:left}.comparison div{font-family:Courier New,monospace;margin-bottom:10px}.actions{display:flex;gap:10px;justify-content:center}.instructions{background:#fff;border-radius:12px;padding:20px;color:#000}.instructions h3{margin-bottom:15px;color:#667eea}.instructions li{color:#000}.instructions ul{list-style:none}.instructions li{margin-bottom:10px;padding-left:20px;position:relative}.instructions li:before{content:"•";position:absolute;left:0}.lesson-list-section{background:#fff;border-radius:12px;padding:20px;color:#000;margin-top:20px}.lesson-list-section h3{margin-bottom:15px;color:#667eea}.lesson-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.lesson-item{background:#f9f9f9;border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:5px;transition:all .3s;border:2px solid transparent;cursor:pointer}.lesson-item:hover{background:#f0f0f0;transform:translateY(-2px)}.lesson-item.current{background:#e8ebff;border-color:#667eea;box-shadow:0 0 10px #667eea4d}.lesson-item.passed{opacity:.6}.lesson-num{font-weight:600;font-size:.9rem;color:#667eea}.lesson-chars{font-family:Courier New,monospace;font-size:.85rem;color:#000;word-wrap:break-word}.settings-icon{position:fixed;top:20px;right:20px;width:48px;height:48px;background:#fff3;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;z-index:100}.settings-icon:hover{background:#ffffff4d;transform:rotate(45deg)}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content{background:#fff;border-radius:12px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #ddd}.modal-header h2{color:#667eea;margin:0}.close-btn{background:none;border:none;font-size:2rem;color:#999;cursor:pointer;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;transition:color .3s}.close-btn:hover{color:#333}.modal-body{padding:20px}.modal-footer{padding:20px;border-top:1px solid #ddd;display:flex;gap:10px;justify-content:flex-end}.setting-item label{display:block;margin-bottom:8px;color:#333;font-weight:500}.setting-item input[type=range]{width:100%;height:6px;border-radius:3px;background:#ddd;outline:none;-webkit-appearance:none}.setting-item input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#667eea;cursor:pointer}.setting-item input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#667eea;cursor:pointer;border:none}.setting-item small{display:block;margin-top:5px;color:#999;font-size:.85rem}.setting-item input[type=checkbox]{margin-right:8px}.setting-item input[type=number]{width:100%;padding:8px;border:2px solid #ddd;border-radius:6px;font-size:1rem}.keyboard{margin:20px 0;background:#f9f9f9;border-radius:8px;padding:15px}.keyboard-header{text-align:center;margin-bottom:15px;color:#666}.keyboard-groups-wrapper{overflow-x:auto;margin-bottom:15px}.keyboard-groups{display:flex;flex-direction:row;gap:4px;min-width:min-content}.keyboard-group{background:#fff;border-radius:6px;padding:3px;flex-shrink:0}.group-label{text-align:center;font-size:.75rem;color:#667eea;font-weight:600;margin-bottom:4px}.group-keys{display:flex;flex-direction:column;gap:3px}.key-btn{background:#667eea;color:#fff;border:none;border-radius:4px;padding:9px 16px;font-size:1.7rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:Courier New,monospace;min-width:60px}.key-btn:hover:not(:disabled){background:#5568d3;transform:translateY(-2px)}.key-btn:active:not(:disabled){transform:translateY(0)}.key-btn.disabled{background:#ddd;color:#999;cursor:not-allowed;opacity:.5}.key-btn.special{background:#764ba2}.key-btn.special:hover{background:#663d8f}.keyboard-controls{display:flex;gap:10px;justify-content:center}.keyboard-controls .key-btn{padding:12px 30px}@media (max-width: 768px){.header h1{font-size:1.5rem}.keyboard-controls .key-btn{flex:1}.settings-icon{top:10px;right:10px;width:40px;height:40px}.settings-icon svg{width:20px;height:20px}}.char-selection{display:flex;flex-wrap:wrap;gap:10px;margin:20px 0;justify-content:center}.char-select-btn{background:#fff;border:2px solid #667eea;color:#667eea;padding:15px 20px;border-radius:8px;cursor:pointer;font-size:1.2rem;font-weight:600;font-family:Courier New,monospace;transition:all .3s;min-width:60px}.char-select-btn:hover{background:#f0f0f0;transform:translateY(-2px)}.char-select-btn.selected{background:#667eea;color:#fff}.char-select-btn.selected:hover{background:#5568d3}.settings-icon{position:fixed;top:20px;right:20px;width:40px;height:40px;background:#667eea;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 8px #0003;z-index:999;transition:all .3s}.settings-icon:hover{background:#5568d3;transform:scale(1.1)}.settings-icon svg{width:24px;height:24px;fill:#fff}.container{max-width:1200px;margin:0 auto;padding:20px}.header{display:flex;align-items:center;gap:20px;margin-bottom:30px}.back-btn{padding:10px 20px;background:#667eea;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:1rem;transition:background .3s}.back-btn:hover{background:#5568d3}.category-tabs{display:flex;gap:10px;margin-bottom:30px;border-bottom:2px solid #e0e0e0;flex-wrap:wrap}.tab-button{padding:12px 24px;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:1rem;color:#666;transition:all .3s}.tab-button:hover{color:#667eea}.tab-button.active{color:#667eea;border-bottom-color:#667eea;font-weight:700}.empty-state{text-align:center;padding:60px 20px;color:#666}.empty-state p{font-size:1.2rem;margin-bottom:20px}.template-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;padding:20px 0}.template-card{background:#fff;border:1px solid #e0e0e0;border-radius:12px;padding:20px;transition:transform .3s,box-shadow .3s}.template-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.template-card h3{margin:0 0 10px;color:#333;font-size:1.1rem}.template-preview{color:#666;font-size:.9rem;line-height:1.5;margin-bottom:15px;font-family:monospace}.template-actions{display:flex;gap:10px;flex-wrap:wrap}.btn{padding:10px 20px;border:1px solid #667eea;background:#fff;color:#667eea;border-radius:8px;cursor:pointer;font-size:.9rem;transition:all .3s}.btn:hover{background:#f0f0f0}.btn.primary{background:#667eea;color:#fff}.btn.primary:hover{background:#5568d3}.select-btn{flex:1}.edit-btn,.delete-btn{padding:8px 16px;font-size:.85rem}.delete-btn{border-color:#dc3545;color:#dc3545}.delete-btn:hover{background:#dc3545;color:#fff}.practice-area{background:#fff;border-radius:12px;padding:30px;box-shadow:0 2px 8px #0000001a}.practice-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.practice-header h2{margin:0;color:#333}.playback-controls{display:flex;gap:10px;justify-content:center;margin-bottom:30px}.control-btn{width:60px;height:60px;border:none;background:#667eea;color:#fff;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s}.control-btn:hover:not(:disabled){background:#5568d3;transform:scale(1.1)}.control-btn:disabled{opacity:.4;cursor:not-allowed}.control-btn.hidden{display:none}.input-section{margin-bottom:20px}.input-section label{display:block;margin-bottom:10px;color:#333;font-weight:700}.input-area{width:100%;min-height:150px;padding:15px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;font-family:monospace;resize:vertical;transition:border-color .3s}.input-area:focus{outline:none;border-color:#667eea}.action-buttons{display:flex;gap:10px;margin-bottom:30px}.result-area{background:#f8f9fa;border-radius:12px;padding:20px;margin-top:30px}.result-area h3{margin:0 0 15px;color:#333}.accuracy{font-size:1.5rem;font-weight:700;color:#667eea;margin-bottom:20px}.comparison{display:flex;flex-direction:column;gap:15px}.comparison-row{display:flex;flex-direction:column;gap:5px}.comparison-row strong{color:#333}.comparison-text{background:#fff;padding:15px;border-radius:8px;font-family:monospace;line-height:1.5;word-break:break-all}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content{background:#fff;border-radius:12px;max-width:600px;width:90%;max-height:80vh;display:flex;flex-direction:column}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #e0e0e0}.modal-header h2{margin:0;color:#333}.close-btn{width:30px;height:30px;border:none;background:transparent;font-size:1.5rem;cursor:pointer;color:#666;transition:color .3s}.close-btn:hover{color:#dc3545}.modal-body{padding:20px;overflow-y:auto}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;color:#333;font-weight:700}.form-input{width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;transition:border-color .3s}.form-input:focus{outline:none;border-color:#667eea}.form-textarea{width:100%;min-height:200px;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;font-family:monospace;resize:vertical;transition:border-color .3s}.form-textarea:focus{outline:none;border-color:#667eea}.setting-item{margin-bottom:20px}.setting-item label{display:block;margin-bottom:8px;color:#333;font-weight:700}.setting-item input[type=number]{width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;transition:border-color .3s}.setting-item input[type=number]:focus{outline:none;border-color:#667eea}.volume-control{display:flex;gap:10px;align-items:center}.volume-control input[type=range]{flex:1}.volume-control input[type=number]{width:80px}.modal-footer{display:flex;justify-content:flex-end;gap:10px;padding:20px;border-top:1px solid #e0e0e0}@media (max-width: 768px){.template-list{grid-template-columns:1fr}.practice-header{flex-direction:column;gap:15px;align-items:flex-start}.action-buttons{flex-direction:column}.category-tabs{overflow-x:auto}}</style>
</head>
<body>
  <div id="app"></div>
</body>
</html>
