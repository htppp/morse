<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>コッホ法トレーニング - モールス練習アプリ v4</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class S{constructor(e={frequency:750,volume:.7,wpm:20}){this.audioContext=null,this.currentOscillator=null,this.currentGain=null,this.isPlaying=!1,this.settings=e,this.loadSettings(),this.init()}ensureAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume()}init(){const e=()=>{this.ensureAudioContext()};document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}updateSettings(e){this.settings={...this.settings,...e}}scheduleTone(e,t){if(this.ensureAudioContext(),!!this.audioContext)try{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.audioContext.destination),s.frequency.value=this.settings.frequency,s.type="sine";const i=this.audioContext.currentTime,r=Math.max(i,e);n.gain.setValueAtTime(0,r),n.gain.linearRampToValueAtTime(this.settings.volume,r+.001),n.gain.setValueAtTime(this.settings.volume,r+(t-1)/1e3),n.gain.linearRampToValueAtTime(0,r+t/1e3),s.start(r),s.stop(r+t/1e3)}catch(s){console.error("音声エラー:",s)}}startContinuousTone(){if(this.ensureAudioContext(),!!this.audioContext)try{this.stopContinuousTone();const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.value=this.settings.frequency,e.type="sine";const s=this.audioContext.currentTime;t.gain.setValueAtTime(0,s),t.gain.linearRampToValueAtTime(this.settings.volume,s+.001),e.start(s),this.currentOscillator=e,this.currentGain=t}catch(e){console.error("連続音開始エラー:",e)}}stopContinuousTone(){if(this.audioContext)try{if(this.currentOscillator&&this.currentGain){const e=this.audioContext.currentTime;this.currentGain.gain.cancelScheduledValues(e),this.currentGain.gain.setValueAtTime(this.currentGain.gain.value,e),this.currentGain.gain.linearRampToValueAtTime(0,e+.001),this.currentOscillator.stop(e+.002),this.currentOscillator=null,this.currentGain=null}}catch(e){console.error("連続音停止エラー:",e)}}async playMorseString(e){if(this.isPlaying||!e||(this.ensureAudioContext(),!this.audioContext))return!1;this.isPlaying=!0;const s=1200/(this.settings.wpm||20),n=s,i=3*s,r=s,l=3*s,d=7*s;let a=this.audioContext.currentTime+.02;for(let u=0;u<e.length&&this.isPlaying;u++){const v=e[u];v==="."?(this.scheduleTone(a,n),a+=(n+r)/1e3):v==="-"?(this.scheduleTone(a,i),a+=(i+r)/1e3):v===" "?a+=(l-r)/1e3:v==="/"&&(a+=(d-r)/1e3)}const h=(a-this.audioContext.currentTime)*1e3;await new Promise(u=>setTimeout(u,h));const c=this.isPlaying;return this.isPlaying=!1,c}stopPlaying(){this.isPlaying=!1}getAudioContext(){return this.audioContext}getVolume(){return this.settings.volume}setVolume(e){this.settings.volume=Math.max(0,Math.min(1,e))}getFrequency(){return this.settings.frequency}setFrequency(e){this.settings.frequency=Math.max(400,Math.min(1200,e))}getWPM(){return this.settings.wpm||20}setWPM(e){this.settings.wpm=Math.max(5,Math.min(40,e))}saveSettings(){try{localStorage.setItem("v4.audio.settings",JSON.stringify(this.settings))}catch(e){console.error("設定保存エラー:",e)}}loadSettings(){try{const e=localStorage.getItem("v4.audio.settings");e&&(this.settings={...this.settings,...JSON.parse(e)})}catch(e){console.error("設定読み込みエラー:",e)}}}const g={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."," ":"/",".":".-.-.-",",":"--..--",":":"---...","?":"..--..",_:"..--.-","+":".-.-.","-":"-....-","×":"-..-","^":"......","/":"-..-.","@":".--.-.","(":"-.--.",")":"-.--.-",'"':".-..-.","'":".----.","=":"-...-"},b=Object.fromEntries(Object.entries(g).map(([p,e])=>[e,p]));class I{static textToMorse(e){const t=e.toUpperCase(),s=/\[([A-Z]+)\]/g,n=[];let i=0,r;for(;(r=s.exec(t))!==null;){if(r.index>i){const a=t.substring(i,r.index),h=Array.from(a).map(c=>g[c]||c);n.push(h.join(" "))}const d=Array.from(r[1]).map(a=>g[a]||a);n.push(d.join("")),i=s.lastIndex}if(i<t.length){const l=t.substring(i),d=Array.from(l).map(a=>g[a]||a);n.push(d.join(" "))}return n.filter(l=>l).join(" ")}static morseSequencesToText(e){let t="";for(const s of e)s==="/"?t+=" ":s&&s!==""&&(t+=b[s]||"?");return t}static getMorseMap(){return g}static charToMorse(e){return g[e.toUpperCase()]}}const y="K M U R E S N A P T L W I . J Z = F O Y , V G 5 / Q 9 2 H 3 8 B ? 4 7 C 1 D 6 0 X".split(" ");function f(p){return y.slice(0,p+1)}function x(p,e=5,t=60){const s=[],n=Math.floor(t*20/(e*5));for(let i=0;i<n;i++){let r="";for(let l=0;l<e;l++){const d=p[Math.floor(Math.random()*p.length)];r+=d}s.push(r)}return s}const m=class m{static get(e){return this.settings[e]}static set(e,t){this.settings[e]=t,this.save()}static load(){try{const e=localStorage.getItem("v4.koch.settings");e&&(this.settings={...this.defaultSettings,...JSON.parse(e)})}catch(e){console.error("Failed to load Koch settings:",e)}}static save(){try{localStorage.setItem("v4.koch.settings",JSON.stringify(this.settings))}catch(e){console.error("Failed to save Koch settings:",e)}}static getAll(){return{...this.settings}}static reset(){this.settings={...this.defaultSettings},this.save()}};m.defaultSettings={characterSpeed:20,effectiveSpeed:20,frequency:750,volume:.7,groupSize:5,displayMode:"fixed",practiceDuration:60,showInput:!0},m.settings={...m.defaultSettings};let o=m;class C{constructor(){this.state={currentLesson:1,isPlaying:!1,userInput:"",correctAnswer:"",groups:[],currentGroupIndex:0},o.load();const e=o.getAll();this.audioSystem=new S({frequency:e.frequency,volume:e.volume,wpm:e.characterSpeed}),this.loadProgress(),this.render()}loadProgress(){try{const e=localStorage.getItem("v4.koch.currentLesson");e&&(this.state.currentLesson=parseInt(e))}catch(e){console.error("Failed to load progress:",e)}}saveProgress(){try{localStorage.setItem("v4.koch.currentLesson",this.state.currentLesson.toString())}catch(e){console.error("Failed to save progress:",e)}}async startLesson(){const e=o.getAll(),t=f(this.state.currentLesson);this.state.groups=x(t,5,e.practiceDuration),this.state.currentGroupIndex=0,this.state.userInput="",this.state.correctAnswer=this.state.groups.join(" "),this.state.isPlaying=!0,this.audioSystem.updateSettings({frequency:e.frequency,volume:e.volume,wpm:e.characterSpeed}),this.renderPractice();for(let s=0;s<this.state.groups.length&&this.state.isPlaying;s++){const n=this.state.groups[s],i=I.textToMorse(n);await this.audioSystem.playMorseString(i+" /"),this.state.currentGroupIndex=s+1,this.updateProgress()}this.state.isPlaying=!1,this.showResult()}stopLesson(){this.state.isPlaying=!1,this.audioSystem.stopPlaying(),this.render()}showResult(){const e=this.calculateAccuracy(),t=e>=90,s=document.getElementById("resultContainer");s&&(s.innerHTML=`
      <div class="result ${t?"passed":"failed"}">
        <h2>${t?"合格！":"不合格"}</h2>
        <div class="accuracy">正答率: ${e.toFixed(1)}%</div>
        <div class="comparison">
          <div>送信: ${this.state.correctAnswer}</div>
          <div>入力: ${this.state.userInput||"（未入力）"}</div>
        </div>
        <div class="actions">
          ${t?'<button class="btn primary" onclick="window.location.reload()">次のレッスンへ</button>':""}
          <button class="btn" onclick="window.location.reload()">もう一度</button>
        </div>
      </div>
    `,t&&this.state.currentLesson<40&&(this.state.currentLesson++,this.saveProgress()))}calculateAccuracy(){if(!this.state.userInput)return 0;const e=this.state.correctAnswer.replace(/\s/g,""),t=this.state.userInput.replace(/\s/g,""),s=Math.max(e.length,t.length);let n=0;for(let i=0;i<s;i++)e[i]===t[i]&&n++;return n/s*100}updateProgress(){const e=document.getElementById("lessonProgress");if(e){const t=this.state.currentGroupIndex/this.state.groups.length*100;e.textContent=`進行: ${this.state.currentGroupIndex}/${this.state.groups.length} (${t.toFixed(0)}%)`}}showSettings(){const e={...o.getAll()},t=o.getAll(),s=document.createElement("div");s.className="modal",s.innerHTML=`
      <div class="modal-content">
        <div class="modal-header">
          <h2>設定</h2>
          <button id="closeSettings" class="close-btn">×</button>
        </div>
        <div class="modal-body">
          <div class="setting-item">
            <label>文字速度 (Character Speed): <span id="charSpeedValue">${t.characterSpeed}</span> WPM</label>
            <input type="range" id="characterSpeed" min="5" max="40" step="1" value="${t.characterSpeed}">
          </div>

          <div class="setting-item">
            <label>実効速度 (Effective Speed): <span id="effSpeedValue">${t.effectiveSpeed}</span> WPM</label>
            <input type="range" id="effectiveSpeed" min="5" max="40" step="1" value="${t.effectiveSpeed}">
            <small>※現在は文字速度のみ実装。実効速度は将来実装予定</small>
          </div>

          <div class="setting-item">
            <label>周波数: <span id="frequencyValue">${t.frequency}</span> Hz</label>
            <input type="range" id="frequency" min="400" max="1000" step="10" value="${t.frequency}">
          </div>

          <div class="setting-item">
            <label>音量: <span id="volumeValue">${Math.round(t.volume*100)}</span>%</label>
            <input type="range" id="volume" min="0" max="100" step="5" value="${t.volume*100}">
          </div>

          <div class="setting-item">
            <label>練習時間: <span id="durationValue">${t.practiceDuration}</span> 秒</label>
            <input type="range" id="practiceDuration" min="30" max="300" step="30" value="${t.practiceDuration}">
          </div>

          <div class="setting-item">
            <label>グループサイズ: <span id="groupSizeValue">${t.groupSize}</span> 文字</label>
            <input type="range" id="groupSize" min="3" max="10" step="1" value="${t.groupSize}">
            <small>※キーボードUI実装時に有効化</small>
          </div>

          <div class="setting-item">
            <label>
              <input type="checkbox" id="showInput" ${t.showInput?"checked":""}>
              入力を表示
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelSettings" class="btn">キャンセル</button>
          <button id="saveSettings" class="btn primary">OK</button>
        </div>
      </div>
    `,document.body.appendChild(s);const n=document.getElementById("characterSpeed"),i=document.getElementById("effectiveSpeed"),r=document.getElementById("frequency"),l=document.getElementById("volume"),d=document.getElementById("practiceDuration"),a=document.getElementById("groupSize");n?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("charSpeedValue").textContent=u}),i?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("effSpeedValue").textContent=u}),r?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("frequencyValue").textContent=u}),l?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("volumeValue").textContent=u}),d?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("durationValue").textContent=u}),a?.addEventListener("input",c=>{const u=c.target.value;document.getElementById("groupSizeValue").textContent=u});const h=()=>{o.set("characterSpeed",e.characterSpeed),o.set("effectiveSpeed",e.effectiveSpeed),o.set("frequency",e.frequency),o.set("volume",e.volume),o.set("practiceDuration",e.practiceDuration),o.set("groupSize",e.groupSize),o.set("showInput",e.showInput),this.audioSystem.updateSettings({frequency:e.frequency,volume:e.volume,wpm:e.characterSpeed})};document.getElementById("saveSettings")?.addEventListener("click",()=>{o.set("characterSpeed",parseInt(n.value)),o.set("effectiveSpeed",parseInt(i.value)),o.set("frequency",parseInt(r.value)),o.set("volume",parseInt(l.value)/100),o.set("practiceDuration",parseInt(d.value)),o.set("groupSize",parseInt(a.value)),o.set("showInput",document.getElementById("showInput").checked),this.audioSystem.updateSettings({frequency:o.get("frequency"),volume:o.get("volume"),wpm:o.get("characterSpeed")}),s.remove()}),document.getElementById("cancelSettings")?.addEventListener("click",()=>{h(),s.remove()}),document.getElementById("closeSettings")?.addEventListener("click",()=>{h(),s.remove()}),s.addEventListener("click",c=>{c.target===s&&(h(),s.remove())})}render(){const e=document.getElementById("app");if(!e)return;const t=f(this.state.currentLesson),s=y.slice(0,40).map((n,i)=>{const r=i+1,l=f(r),d=r===this.state.currentLesson,a=r<this.state.currentLesson;return`
        <div class="lesson-item ${d?"current":""} ${a?"passed":""}" data-lesson="${r}">
          <div class="lesson-num">L${r}</div>
          <div class="lesson-chars">${l.join(" ")}</div>
        </div>
      `}).join("");e.innerHTML=`
      <div class="settings-icon" id="settingsIcon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
      </div>

      <div class="container">
        <header class="header">
          <button id="backBtn" class="back-btn">← 戻る</button>
          <h1>コッホ法トレーニング</h1>
        </header>

        <div class="lesson-info">
          <h2>レッスン ${this.state.currentLesson} / 40</h2>
          <div class="chars">学習文字: ${t.join(" ")}</div>
          <button id="startBtn" class="btn primary">練習開始</button>
        </div>

        <div id="practiceContainer"></div>
        <div id="resultContainer"></div>

        <div class="instructions">
          <h3>使い方</h3>
          <ul>
            <li>「練習開始」をクリックしてモールス信号を聞く</li>
            <li>聞こえた文字を入力</li>
            <li>90%以上の正答率で次のレッスンへ</li>
          </ul>
        </div>

        <div class="lesson-list-section">
          <h3>レッスン一覧</h3>
          <div class="lesson-list">
            ${s}
          </div>
        </div>
      </div>
    `,document.getElementById("backBtn")?.addEventListener("click",()=>{window.location.href="./index.html"}),document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.showSettings()}),document.getElementById("startBtn")?.addEventListener("click",()=>{this.startLesson()}),document.querySelectorAll(".lesson-item").forEach(n=>{n.addEventListener("click",()=>{const i=parseInt(n.getAttribute("data-lesson")||"1");this.state.currentLesson=i,this.saveProgress(),this.render(),window.scrollTo({top:0,behavior:"smooth"})})})}renderPractice(){const e=document.getElementById("practiceContainer");if(!e)return;const t=o.getAll(),s=f(this.state.currentLesson);e.innerHTML=`
      <div class="practice-area">
        <div id="lessonProgress" class="progress">準備中...</div>
        <textarea id="userInput" class="input-area" placeholder="聞こえた文字を入力..." ${t.showInput?"":'style="opacity: 0.3; pointer-events: none;"'}></textarea>
        ${this.renderKeyboard(s)}
        <button id="stopBtn" class="btn">停止</button>
      </div>
    `;const n=document.getElementById("userInput");n&&n.addEventListener("input",i=>{this.state.userInput=i.target.value.toUpperCase()}),document.getElementById("stopBtn")?.addEventListener("click",()=>{this.stopLesson()}),this.setupKeyboardEvents(s)}renderKeyboard(e){const t=o.get("groupSize"),s=[];for(let n=0;n<y.length;n+=t)s.push(y.slice(n,n+t));return`
      <div class="keyboard">
        <div class="keyboard-header">
          <small>グループベースキーボード（学習済み文字のみ有効）</small>
        </div>
        <div class="keyboard-groups">
          ${s.map((n,i)=>`
            <div class="keyboard-group">
              <div class="group-label">G${i+1}</div>
              <div class="group-keys">
                ${n.map(r=>{const l=e.includes(r);return`
                    <button class="key-btn ${l?"":"disabled"}"
                            data-char="${r}"
                            ${l?"":"disabled"}>
                      ${r}
                    </button>
                  `}).join("")}
              </div>
            </div>
          `).join("")}
        </div>
        <div class="keyboard-controls">
          <button id="spaceBtn" class="key-btn special">スペース</button>
          <button id="backspaceBtn" class="key-btn special">←削除</button>
        </div>
      </div>
    `}setupKeyboardEvents(e){const t=document.getElementById("userInput");t&&(document.querySelectorAll(".key-btn:not(.special)").forEach(s=>{s.addEventListener("click",n=>{const i=n.target.getAttribute("data-char");i&&e.includes(i)&&(t.value+=i,this.state.userInput=t.value.toUpperCase(),t.focus())})}),document.getElementById("spaceBtn")?.addEventListener("click",()=>{t.value+=" ",this.state.userInput=t.value.toUpperCase(),t.focus()}),document.getElementById("backspaceBtn")?.addEventListener("click",()=>{t.value=t.value.slice(0,-1),this.state.userInput=t.value.toUpperCase(),t.focus()}),t.addEventListener("keydown",s=>{s.key===" "&&(s.preventDefault(),t.value+=" ",this.state.userInput=t.value.toUpperCase())}))}}document.addEventListener("DOMContentLoaded",()=>{new C});</script>
  <style rel="stylesheet" crossorigin>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}.container{max-width:800px;margin:0 auto}.header{display:flex;align-items:center;gap:20px;margin-bottom:30px;color:#fff}.back-btn{background:#fff3;border:none;color:#fff;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:1rem;transition:background .3s}.back-btn:hover{background:#ffffff4d}.header h1{font-size:2rem}.lesson-info{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;text-align:center}.lesson-info h2{color:#667eea;margin-bottom:10px}.chars{font-family:Courier New,monospace;font-size:1.2rem;color:#333;margin-bottom:20px}.controls{display:flex;justify-content:center;margin-bottom:30px}.btn{background:#fff;border:none;color:#667eea;padding:12px 30px;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .3s}.btn:hover{background:#f0f0f0}.btn.primary{background:#667eea;color:#fff}.btn.primary:hover{background:#5568d3}.practice-area{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.progress{font-size:1.1rem;color:#667eea;margin-bottom:15px;text-align:center}.input-area{width:100%;min-height:120px;padding:15px;border:2px solid #ddd;border-radius:8px;font-family:Courier New,monospace;font-size:1.1rem;margin-bottom:15px;resize:vertical}.input-area:focus{outline:none;border-color:#667eea}.result{background:#fff;border-radius:12px;padding:30px;text-align:center}.result h2{font-size:2rem;margin-bottom:20px}.result.passed h2{color:#4caf50}.result.failed h2{color:#f44336}.accuracy{font-size:1.5rem;color:#667eea;margin-bottom:20px}.comparison{background:#f9f9f9;border-radius:8px;padding:15px;margin-bottom:20px;text-align:left}.comparison div{font-family:Courier New,monospace;margin-bottom:10px}.actions{display:flex;gap:10px;justify-content:center}.instructions{background:#fff;border-radius:12px;padding:20px;color:#333}.instructions h3{margin-bottom:15px;color:#667eea}.instructions ul{list-style:none}.instructions li{margin-bottom:10px;padding-left:20px;position:relative}.instructions li:before{content:"•";position:absolute;left:0}.lesson-list-section{background:#fff;border-radius:12px;padding:20px;color:#333;margin-top:20px}.lesson-list-section h3{margin-bottom:15px;color:#667eea}.lesson-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.lesson-item{background:#f9f9f9;border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:5px;transition:all .3s;border:2px solid transparent;cursor:pointer}.lesson-item:hover{background:#f0f0f0;transform:translateY(-2px)}.lesson-item.current{background:#e8ebff;border-color:#667eea;box-shadow:0 0 10px #667eea4d}.lesson-item.passed{opacity:.6}.lesson-num{font-weight:600;font-size:.9rem;color:#667eea}.lesson-chars{font-family:Courier New,monospace;font-size:.85rem;color:#333;word-wrap:break-word}.settings-icon{position:fixed;top:20px;right:20px;width:48px;height:48px;background:#fff3;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;z-index:100}.settings-icon:hover{background:#ffffff4d;transform:rotate(45deg)}.settings-icon svg{width:24px;height:24px;fill:#fff}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content{background:#fff;border-radius:12px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #ddd}.modal-header h2{color:#667eea;margin:0}.close-btn{background:none;border:none;font-size:2rem;color:#999;cursor:pointer;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;transition:color .3s}.close-btn:hover{color:#333}.modal-body{padding:20px}.modal-footer{padding:20px;border-top:1px solid #ddd;display:flex;gap:10px;justify-content:flex-end}.setting-item{margin-bottom:20px}.setting-item label{display:block;margin-bottom:8px;color:#333;font-weight:500}.setting-item input[type=range]{width:100%;height:6px;border-radius:3px;background:#ddd;outline:none;-webkit-appearance:none}.setting-item input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#667eea;cursor:pointer}.setting-item input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#667eea;cursor:pointer;border:none}.setting-item small{display:block;margin-top:5px;color:#999;font-size:.85rem}.setting-item input[type=checkbox]{margin-right:8px}.keyboard{margin:20px 0;background:#f9f9f9;border-radius:8px;padding:15px}.keyboard-header{text-align:center;margin-bottom:15px;color:#666}.keyboard-groups{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-bottom:15px}.keyboard-group{background:#fff;border-radius:8px;padding:10px}.group-label{text-align:center;font-size:.85rem;color:#667eea;font-weight:600;margin-bottom:8px}.group-keys{display:flex;flex-direction:column;gap:5px}.key-btn{background:#667eea;color:#fff;border:none;border-radius:6px;padding:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:Courier New,monospace}.key-btn:hover:not(:disabled){background:#5568d3;transform:translateY(-2px)}.key-btn:active:not(:disabled){transform:translateY(0)}.key-btn.disabled{background:#ddd;color:#999;cursor:not-allowed;opacity:.5}.key-btn.special{background:#764ba2}.key-btn.special:hover{background:#663d8f}.keyboard-controls{display:flex;gap:10px;justify-content:center}.keyboard-controls .key-btn{padding:12px 30px}@media (max-width: 768px){.header h1{font-size:1.5rem}.keyboard-groups{grid-template-columns:repeat(auto-fit,minmax(100px,1fr))}.keyboard-controls{flex-direction:column}.keyboard-controls .key-btn{width:100%}}</style>
</head>
<body>
  <div id="app"></div>
</body>
</html>
