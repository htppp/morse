<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CW略語・Q符号学習 - モールス練習アプリ v4</title>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class p{constructor(t={frequency:750,volume:.7,wpm:20}){this.audioContext=null,this.currentOscillator=null,this.currentGain=null,this.isPlaying=!1,this.settings=t,this.loadSettings(),this.init()}ensureAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.ensureAudioContext(),this.playDummyTone()},{once:!0}):(this.ensureAudioContext(),this.playDummyTone())}playDummyTone(){if(this.audioContext)try{const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.value=this.settings.frequency,t.type="sine";const s=this.audioContext.currentTime;e.gain.setValueAtTime(this.settings.volume*.1,s),t.start(s),t.stop(s+.1)}catch(t){console.error("ダミートーンエラー:",t)}}updateSettings(t){this.settings={...this.settings,...t}}scheduleTone(t,e){if(this.ensureAudioContext(),!!this.audioContext)try{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.audioContext.destination),s.frequency.value=this.settings.frequency,s.type="sine";const i=this.audioContext.currentTime,r=Math.max(i,t);n.gain.setValueAtTime(0,r),n.gain.linearRampToValueAtTime(this.settings.volume,r+.001),n.gain.setValueAtTime(this.settings.volume,r+(e-1)/1e3),n.gain.linearRampToValueAtTime(0,r+e/1e3),s.start(r),s.stop(r+e/1e3)}catch(s){console.error("音声エラー:",s)}}startContinuousTone(){if(this.ensureAudioContext(),!!this.audioContext)try{this.stopContinuousTone();const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.value=this.settings.frequency,t.type="sine";const s=this.audioContext.currentTime;e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(this.settings.volume,s+.001),t.start(s),this.currentOscillator=t,this.currentGain=e}catch(t){console.error("連続音開始エラー:",t)}}stopContinuousTone(){if(this.audioContext)try{if(this.currentOscillator&&this.currentGain){const t=this.audioContext.currentTime;this.currentGain.gain.cancelScheduledValues(t),this.currentGain.gain.setValueAtTime(this.currentGain.gain.value,t),this.currentGain.gain.linearRampToValueAtTime(0,t+.001),this.currentOscillator.stop(t+.002),this.currentOscillator=null,this.currentGain=null}}catch(t){console.error("連続音停止エラー:",t)}}async playMorseString(t){if(this.isPlaying||!t||(this.ensureAudioContext(),!this.audioContext))return!1;this.isPlaying=!0;const s=1200/(this.settings.wpm||20),n=s,i=3*s,r=s,o=3*s,l=7*s;let a=this.audioContext.currentTime+.02;for(let h=0;h<t.length&&this.isPlaying;h++){const g=t[h];g==="."?(this.scheduleTone(a,n),a+=(n+r)/1e3):g==="-"?(this.scheduleTone(a,i),a+=(i+r)/1e3):g===" "?a+=(o-r)/1e3:g==="/"&&(a+=(l-r)/1e3)}const c=(a-this.audioContext.currentTime)*1e3;await new Promise(h=>setTimeout(h,c));const u=this.isPlaying;return this.isPlaying=!1,u}stopPlaying(){this.isPlaying=!1}getAudioContext(){return this.audioContext}getVolume(){return this.settings.volume}setVolume(t){this.settings.volume=Math.max(0,Math.min(1,t))}getFrequency(){return this.settings.frequency}setFrequency(t){this.settings.frequency=Math.max(400,Math.min(1200,t))}getWPM(){return this.settings.wpm||20}setWPM(t){this.settings.wpm=Math.max(5,Math.min(40,t))}saveSettings(){try{localStorage.setItem("v4.audio.settings",JSON.stringify(this.settings))}catch(t){console.error("設定保存エラー:",t)}}loadSettings(){try{const t=localStorage.getItem("v4.audio.settings");t&&(this.settings={...this.settings,...JSON.parse(t)})}catch(t){console.error("設定読み込みエラー:",t)}}}const b={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."," ":"/",".":".-.-.-",",":"--..--",":":"---...","?":"..--..",_:"..--.-","+":".-.-.","-":"-....-","×":"-..-","^":"......","/":"-..-.","@":".--.-.","(":"-.--.",")":"-.--.-",'"':".-..-.","'":".----.","=":"-...-"},f=Object.fromEntries(Object.entries(b).map(([m,t])=>[t,m]));class v{static textToMorse(t){const e=t.toUpperCase(),s=/\[([A-Z]+)\]/g,n=[];let i=0,r;for(;(r=s.exec(e))!==null;){if(r.index>i){const a=e.substring(i,r.index),c=Array.from(a).map(u=>b[u]||u);n.push(c.join(" "))}const l=Array.from(r[1]).map(a=>b[a]||a);n.push(l.join("")),i=s.lastIndex}if(i<e.length){const o=e.substring(i),l=Array.from(o).map(a=>b[a]||a);n.push(l.join(" "))}return n.filter(o=>o).join(" ")}static morseSequencesToText(t){let e="";for(const s of t)s==="/"?e+=" ":s&&s!==""&&(e+=f[s]||"?");return e}static getMorseMap(){return b}static charToMorse(t){return b[t.toUpperCase()]}}class y{constructor(){this.entries=[],this.filteredEntries=[],this.selectedTags=new Set,this.selectedFrequencies=new Set([5]),this.displayMode="card",this.viewMode="browse",this.sortColumn="abbreviation",this.sortDirection="asc",this.searchQuery="",this.currentCards=[],this.currentIndex=0,this.isFlipped=!1,this.progress={known:new Set,unknown:new Set},this.reviewMode=!1,this.hideAbbreviation=!1,this.isLearning=!1,this.currentlyPlaying=null,this.examQuestions=[],this.currentQuestionIndex=0,this.examResults=[],this.questionCount=10,this.questionType="abbr-to-meaning",this.settingsModalOpen=!1,this.tempSettings=null,this.isTestPlaying=!1,this.audioSystem=new p,this.loadProgress(),this.loadFilters(),this.loadData()}async loadData(){try{const t=await fetch("./flashcard.tsv");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.text();this.entries=e.trim().split(`
`).slice(1).map(s=>{const[n,i,r,o,l,a,c]=s.split("	");return{tags:n,frequency:parseInt(i),abbreviation:r,english:o,japanese:l,description:a||"",example:c||""}}),this.applyFilters(),this.render()}catch(t){console.error("データ読み込みエラー:",t),this.renderError()}}getAllTags(){const t=new Set;return this.entries.forEach(e=>{e.tags.split(",").forEach(s=>t.add(s.trim()))}),Array.from(t).sort()}applyFilters(){let t=this.entries;if(this.selectedTags.size>0&&(t=t.filter(e=>{const s=e.tags.split(",").map(n=>n.trim());return Array.from(this.selectedTags).some(n=>s.includes(n))})),this.selectedFrequencies.size>0&&(t=t.filter(e=>this.selectedFrequencies.has(e.frequency))),this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();t=t.filter(s=>s.abbreviation.toLowerCase().includes(e)||s.english.toLowerCase().includes(e)||s.japanese.includes(this.searchQuery)||s.tags.toLowerCase().includes(e))}this.filteredEntries=this.sortEntries(t)}sortEntries(t){const e=[...t];return e.sort((s,n)=>{let i=0;switch(this.sortColumn){case"abbreviation":i=s.abbreviation.localeCompare(n.abbreviation);break;case"english":i=s.english.localeCompare(n.english);break;case"japanese":i=s.japanese.localeCompare(n.japanese);break;case"frequency":i=s.frequency-n.frequency;break;case"tags":i=s.tags.localeCompare(n.tags);break}return this.sortDirection==="asc"?i:-i}),e}toggleSort(t){this.sortColumn===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.applyFilters(),this.render()}toggleTag(t){this.selectedTags.has(t)?this.selectedTags.delete(t):this.selectedTags.add(t),this.applyFilters(),this.saveFilters(),this.render()}toggleFrequency(t){this.selectedFrequencies.has(t)?this.selectedFrequencies.delete(t):this.selectedFrequencies.add(t),this.applyFilters(),this.saveFilters(),this.render()}toggleAllFrequencies(){const t=[1,2,3,4,5];t.every(e=>this.selectedFrequencies.has(e))?this.selectedFrequencies.clear():t.forEach(e=>this.selectedFrequencies.add(e)),this.applyFilters(),this.saveFilters(),this.render()}toggleDisplayMode(){this.displayMode=this.displayMode==="card"?"list":"card",this.render()}getFrequencyStars(t){return"★".repeat(t)+"☆".repeat(5-t)}formatAbbreviation(t){const e=t.match(/^\[([A-Z]+)\]$/);return e?`<span class="prosign">${e[1]}</span>`:t}getCardCountText(){const t=this.filteredEntries.length,e=this.filteredEntries.filter(n=>this.progress.unknown.has(n.abbreviation)).length,s=this.filteredEntries.filter(n=>this.progress.known.has(n.abbreviation)).length;return`全${t}件 / わかる:${s}件 / わからない:${e}件`}shuffleCards(t){const e=[...t];for(let s=e.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[e[s],e[n]]=[e[n],e[s]]}return e}startLearning(){this.reviewMode?this.currentCards=this.filteredEntries.filter(t=>this.progress.unknown.has(t.abbreviation)):this.currentCards=this.shuffleCards(this.filteredEntries),this.currentIndex=0,this.isFlipped=!1,this.isLearning=!0,this.render()}flipCard(){this.isFlipped=!this.isFlipped,this.render()}nextCard(){this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1,this.render())}previousCard(){this.currentIndex>0&&(this.currentIndex--,this.isFlipped=!1,this.render())}markAsKnown(){const t=this.currentCards[this.currentIndex];this.progress.known.add(t.abbreviation),this.progress.unknown.delete(t.abbreviation),this.saveProgress(),this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1),this.render()}markAsUnknown(){const t=this.currentCards[this.currentIndex];this.progress.unknown.add(t.abbreviation),this.progress.known.delete(t.abbreviation),this.saveProgress(),this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1),this.render()}backToLearnSetup(){this.isLearning=!1,this.currentCards=[],this.currentIndex=0,this.isFlipped=!1,this.render()}async playMorse(t){try{if(this.currentlyPlaying===t){this.audioSystem.stopPlaying(),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render();return}this.currentlyPlaying&&this.audioSystem.stopPlaying(),this.currentlyPlaying=t,this.viewMode!=="exam"&&this.render();const e=v.textToMorse(t);e&&await this.audioSystem.playMorseString(e),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render()}catch(e){console.error("モールス再生エラー:",e),this.currentlyPlaying=null,this.viewMode!=="exam"&&this.render()}}render(){this.viewMode==="browse"?this.renderBrowseMode():this.viewMode==="learn"?this.renderLearnMode():this.viewMode==="exam"&&this.renderExamMode(),this.settingsModalOpen&&this.renderSettingsModal()}renderBrowseMode(){const t=document.getElementById("app");if(!t)return;const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button active" data-tab="browse">一覧</button>
					<button class="tab-button" data-tab="learn">学習モード</button>
					<button class="tab-button" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<div class="filter-group">
						<h2>タグでフィルター</h2>
						<div class="tags-list">
							${e.map(r=>`
								<button class="tag-btn ${this.selectedTags.has(r)?"active":""}" data-tag="${r}">
									${r}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>使用頻度 <button id="toggle-freq-btn" class="toggle-freq-btn" title="チェックを反転">⇆</button></h2>
						<div class="frequency-list">
							${[5,4,3,2,1].map(r=>`
								<button class="freq-btn ${this.selectedFrequencies.has(r)?"active":""}" data-freq="${r}">
									${this.getFrequencyStars(r)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>検索</h2>
						<input type="text" id="search-input" class="search-input" placeholder="略語、英文、和訳、タグで検索..." value="${this.searchQuery}">
					</div>

					<div class="result-count">
						全 ${this.filteredEntries.length} 件
					</div>
				</div>

				<div class="entries-container" id="entriesContainer"></div>
			</div>
		`;const s=document.getElementById("backBtn");s&&s.addEventListener("click",()=>{window.location.href="./index.html"});const n=document.getElementById("settingsBtn");n&&n.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(r=>{r.addEventListener("click",()=>{const o=r.getAttribute("data-tab");o==="learn"?(this.viewMode="learn",this.render()):o==="exam"&&(this.viewMode="exam",this.render())})}),this.renderEntries(),this.attachBrowseModeListeners()}renderEntries(){const t=document.getElementById("entriesContainer");if(!t)return;this.displayMode==="card"?this.renderCardView(t):this.renderListView(t);const e=document.getElementById("toggleModeBtn");e&&e.addEventListener("click",()=>this.toggleDisplayMode())}updateResultCount(){const t=document.querySelector(".result-count");t&&(t.textContent=`全 ${this.filteredEntries.length} 件`)}renderCardView(t){t.innerHTML=`
			<div class="entries-header">
				<h2>略語一覧 (${this.filteredEntries.length}件 / ${this.entries.length}件中)</h2>
				<button id="toggleModeBtn" class="toggle-mode-btn" title="表示モード切り替え">
					📋 リスト表示
				</button>
			</div>
			<div class="entries-list">
				${this.filteredEntries.map(e=>`
					<div class="entry-card ${this.currentlyPlaying===e.abbreviation?"playing":""}" data-abbr="${e.abbreviation}">
						<div class="entry-header">
							<div class="entry-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
							<div class="entry-frequency" title="使用頻度: ${e.frequency}/5">${this.getFrequencyStars(e.frequency)}</div>
						</div>
						<div class="entry-english">${e.english}</div>
						<div class="entry-japanese">${e.japanese}</div>
						${e.description?`<div class="entry-description">${e.description}</div>`:""}
						${e.example?`<div class="entry-example">例: ${e.example}</div>`:""}
						<div class="entry-tags">${e.tags}</div>
					</div>
				`).join("")}
			</div>
		`,t.querySelectorAll(".entry-card").forEach(e=>{e.addEventListener("click",()=>{const s=e.getAttribute("data-abbr");s&&this.playMorse(s)})})}getSortIndicator(t){return this.sortColumn!==t?"":this.sortDirection==="asc"?" ▲":" ▼"}renderListView(t){t.innerHTML=`
			<div class="entries-header">
				<h2>略語一覧 (${this.filteredEntries.length}件 / ${this.entries.length}件中)</h2>
				<button id="toggleModeBtn" class="toggle-mode-btn" title="表示モード切り替え">
					🃏 カード表示
				</button>
			</div>
			<div class="list-table-container">
				<table class="list-table">
					<thead>
						<tr>
							<th class="sortable" data-column="abbreviation">略語${this.getSortIndicator("abbreviation")}</th>
							<th class="sortable" data-column="english">英文${this.getSortIndicator("english")}</th>
							<th class="sortable" data-column="japanese">和訳${this.getSortIndicator("japanese")}</th>
							<th class="sortable" data-column="frequency">頻度${this.getSortIndicator("frequency")}</th>
							<th class="sortable" data-column="tags">タグ${this.getSortIndicator("tags")}</th>
							<th>説明</th>
							<th>具体例</th>
						</tr>
					</thead>
					<tbody>
						${this.filteredEntries.map(n=>`
							<tr>
								<td class="list-abbr">
									<button class="abbr-play-btn ${this.currentlyPlaying===n.abbreviation?"playing":""}" data-abbr="${n.abbreviation}">
										${this.formatAbbreviation(n.abbreviation)}
									</button>
								</td>
								<td class="list-english">${n.english}</td>
								<td class="list-japanese">${n.japanese}</td>
								<td class="list-frequency" title="使用頻度: ${n.frequency}/5">${this.getFrequencyStars(n.frequency)}</td>
								<td class="list-tags">${n.tags}</td>
								<td class="list-description">${n.description}</td>
								<td class="list-example">${n.example}</td>
							</tr>
						`).join("")}
					</tbody>
				</table>
			</div>
		`,t.querySelectorAll("th.sortable").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-column");i&&this.toggleSort(i)})}),t.querySelectorAll(".abbr-play-btn").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-abbr");i&&this.playMorse(i)})})}renderLearnMode(){const t=document.getElementById("app");if(!t)return;if(!this.isLearning){this.renderLearnSetupView(t);return}if(this.currentCards.length===0){t.innerHTML=`
				<div class="container">
					<div class="no-cards">
						${this.reviewMode?"復習するカードがありません":"学習するカードがありません"}
					</div>
					<button id="back-to-setup-btn" class="secondary-button">設定に戻る</button>
				</div>
			`;const i=document.getElementById("back-to-setup-btn");i&&i.addEventListener("click",()=>this.backToLearnSetup());return}const e=this.currentCards[this.currentIndex],s=this.currentIndex+1,n=this.currentCards.length;t.innerHTML=`
			<div class="container learning-view">
				<div class="learning-header">
					<button id="back-to-setup-btn" class="back-btn">← 設定に戻る</button>
					<div class="progress-indicator">${s} / ${n}</div>
				</div>

				<div class="card-container">
					<div class="flashcard ${this.isFlipped?"flipped":""}" id="flashcard">
						<div class="card-front">
							${this.hideAbbreviation?"":`
								<div class="card-label">略語</div>
								<div class="card-content">${this.formatAbbreviation(e.abbreviation)}</div>
							`}
							<button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">🔊 モールス再生</button>
						</div>
						<div class="card-back">
							<div class="card-label">意味</div>
							<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>
							<div class="card-content-text">${e.english}</div>
							<div class="card-content-text">${e.japanese}</div>
							${e.description?`<div class="card-description">${e.description}</div>`:""}
							${e.example?`<div class="card-example">例: ${e.example}</div>`:""}
							<div class="card-tags">${e.tags} / ${this.getFrequencyStars(e.frequency)}</div>
						</div>
					</div>
				</div>

				<div class="card-controls">
					<button id="flip-card-btn" class="control-button">
						${this.isFlipped?"問題に戻る":"正解を確認する"} (Space)
					</button>
				</div>

				${this.isFlipped?this.renderJudgmentButtons(e):""}

				<div class="navigation-controls">
					<button id="prev-card-btn" class="nav-button" ${this.currentIndex===0?"disabled":""}>
						← 前のカード
					</button>
					<button id="next-card-btn" class="nav-button" ${this.currentIndex>=this.currentCards.length-1?"disabled":""}>
						次のカード →
					</button>
				</div>
			</div>
		`,this.attachLearnModeListeners()}renderLearnSetupView(t){const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button" data-tab="browse">一覧</button>
					<button class="tab-button active" data-tab="learn">学習モード</button>
					<button class="tab-button" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<div class="filter-group">
						<h2>タグでフィルター</h2>
						<div class="tags-list">
							${e.map(r=>`
								<button class="tag-btn ${this.selectedTags.has(r)?"active":""}" data-tag="${r}">
									${r}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>使用頻度 <button id="toggle-freq-btn" class="toggle-freq-btn" title="チェックを反転">⇆</button></h2>
						<div class="frequency-list">
							${[5,4,3,2,1].map(r=>`
								<button class="freq-btn ${this.selectedFrequencies.has(r)?"active":""}" data-freq="${r}">
									${this.getFrequencyStars(r)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h2>モード</h2>
						<label class="mode-checkbox">
							<input type="checkbox" id="review-mode-checkbox" ${this.reviewMode?"checked":""}>
							<span>復習モード（わからないカードのみ）</span>
						</label>
						<label class="mode-checkbox">
							<input type="checkbox" id="hide-abbreviation-checkbox" ${this.hideAbbreviation?"checked":""}>
							<span>略語を非表示（モールス再生のみ）</span>
						</label>
					</div>

					<div class="result-count">
						${this.getCardCountText()}
					</div>

					<div class="action-buttons">
						<button id="start-learning-btn" class="primary-button">学習開始</button>
						<button id="clear-progress-btn" class="secondary-button">進捗をリセット</button>
					</div>
				</div>
			</div>
		`;const s=document.getElementById("backBtn");s&&s.addEventListener("click",()=>{window.location.href="./index.html"});const n=document.getElementById("settingsBtn");n&&n.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(r=>{r.addEventListener("click",()=>{const o=r.getAttribute("data-tab");o==="browse"?(this.viewMode="browse",this.render()):o==="exam"&&(this.viewMode="exam",this.render())})}),this.attachLearnSetupListeners()}renderJudgmentButtons(t){const e=this.progress.known.has(t.abbreviation);return`
			<div class="judgment-controls">
				<button id="mark-unknown-btn" class="judgment-button unknown ${this.progress.unknown.has(t.abbreviation)?"active":""}">
					× わからない
				</button>
				<button id="mark-known-btn" class="judgment-button known ${e?"active":""}">
					○ わかる
				</button>
			</div>
		`}attachBrowseModeListeners(){document.querySelectorAll(".tag-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.getAttribute("data-tag");r&&this.toggleTag(r)})}),document.querySelectorAll(".freq-btn").forEach(i=>{i.addEventListener("click",()=>{const r=parseInt(i.getAttribute("data-freq")||"0",10);this.toggleFrequency(r)})});const s=document.getElementById("toggle-freq-btn");s&&s.addEventListener("click",()=>this.toggleAllFrequencies());const n=document.getElementById("search-input");n&&n.addEventListener("input",()=>{this.searchQuery=n.value,this.applyFilters(),this.renderEntries(),this.updateResultCount()})}attachLearnSetupListeners(){document.querySelectorAll(".tag-btn").forEach(l=>{l.addEventListener("click",()=>{const a=l.getAttribute("data-tag");a&&this.toggleTag(a)})}),document.querySelectorAll(".freq-btn").forEach(l=>{l.addEventListener("click",()=>{const a=parseInt(l.getAttribute("data-freq")||"0",10);this.toggleFrequency(a)})});const s=document.getElementById("toggle-freq-btn");s&&s.addEventListener("click",()=>this.toggleAllFrequencies());const n=document.getElementById("review-mode-checkbox");n&&n.addEventListener("change",()=>{this.reviewMode=n.checked});const i=document.getElementById("hide-abbreviation-checkbox");i&&i.addEventListener("change",()=>{this.hideAbbreviation=i.checked});const r=document.getElementById("start-learning-btn");r&&r.addEventListener("click",()=>this.startLearning());const o=document.getElementById("clear-progress-btn");o&&o.addEventListener("click",()=>{confirm("学習進捗をすべてリセットしますか？")&&(this.progress={known:new Set,unknown:new Set},this.saveProgress(),this.render())})}attachLearnModeListeners(){const t=document.getElementById("back-to-setup-btn");t&&t.addEventListener("click",()=>this.backToLearnSetup());const e=document.getElementById("flip-card-btn");e&&e.addEventListener("click",()=>this.flipCard());const s=document.getElementById("play-morse-btn");s&&s.addEventListener("click",()=>{const r=this.currentCards[this.currentIndex];this.playMorse(r.abbreviation)});const n=document.getElementById("prev-card-btn"),i=document.getElementById("next-card-btn");if(n&&n.addEventListener("click",()=>this.previousCard()),i&&i.addEventListener("click",()=>this.nextCard()),this.isFlipped){const r=document.getElementById("mark-known-btn"),o=document.getElementById("mark-unknown-btn");r&&r.addEventListener("click",()=>this.markAsKnown()),o&&o.addEventListener("click",()=>this.markAsUnknown())}this.attachKeyboardListeners()}attachKeyboardListeners(){const t=e=>{this.viewMode==="learn"&&(e.key===" "||e.key==="Spacebar"?(e.preventDefault(),this.flipCard()):e.key==="ArrowRight"?(e.preventDefault(),this.nextCard()):e.key==="ArrowLeft"&&(e.preventDefault(),this.previousCard()))};document.removeEventListener("keydown",t),document.addEventListener("keydown",t)}saveFilters(){try{const t={tags:Array.from(this.selectedTags),frequencies:Array.from(this.selectedFrequencies)};localStorage.setItem("v4.flashcard.filters",JSON.stringify(t))}catch(t){console.error("フィルタ保存エラー:",t)}}loadFilters(){try{const t=localStorage.getItem("v4.flashcard.filters");if(t){const e=JSON.parse(t);this.selectedTags=new Set(Array.isArray(e.tags)?e.tags:[]),this.selectedFrequencies=new Set(Array.isArray(e.frequencies)?e.frequencies:[5])}}catch(t){console.error("フィルタ読み込みエラー:",t)}}saveProgress(){try{const t={known:Array.from(this.progress.known),unknown:Array.from(this.progress.unknown)};localStorage.setItem("v4.flashcard.progress",JSON.stringify(t))}catch(t){console.error("進捗保存エラー:",t)}}loadProgress(){try{const t=localStorage.getItem("v4.flashcard.progress");if(t){const e=JSON.parse(t);this.progress={known:new Set(e.known||[]),unknown:new Set(e.unknown||[])}}}catch(t){console.error("進捗読み込みエラー:",t)}}renderError(){const t=document.getElementById("app");t&&(t.innerHTML=`
			<div class="container">
				<header class="header">
					<button onclick="window.location.href='./index.html'" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
				</header>
				<div class="error">
					データの読み込みに失敗しました。flashcard.tsvを確認してください。
				</div>
			</div>
		`)}openSettingsModal(){this.settingsModalOpen=!0,this.tempSettings={volume:this.audioSystem.getVolume(),frequency:this.audioSystem.getFrequency(),wpm:this.audioSystem.getWPM()},this.renderSettingsModal()}closeSettingsModal(t){this.isTestPlaying&&(this.audioSystem.stopPlaying(),this.isTestPlaying=!1),!t&&this.tempSettings?(this.audioSystem.setVolume(this.tempSettings.volume),this.audioSystem.setFrequency(this.tempSettings.frequency),this.audioSystem.setWPM(this.tempSettings.wpm)):t&&this.audioSystem.saveSettings(),this.settingsModalOpen=!1,this.tempSettings=null;const e=document.getElementById("settings-modal");e&&e.remove()}renderSettingsModal(){const t=document.getElementById("settings-modal");t&&t.remove();const e=this.audioSystem.getVolume(),s=this.audioSystem.getFrequency(),n=this.audioSystem.getWPM(),i=`
			<div class="settings-modal" id="settings-modal">
				<div class="settings-content">
					<h2>設定</h2>
					<div class="settings-grid">
						<div class="setting-item">
							<label>音量</label>
							<input type="range" id="volumeRange" min="0" max="100" value="${e*100}">
							<input type="number" id="volumeInput" min="0" max="100" value="${Math.round(e*100)}">
							<span>%</span>
						</div>
						<div class="setting-item">
							<label>周波数 (Hz)</label>
							<input type="number" id="frequencyInput" min="400" max="1200" value="${s}" step="50">
						</div>
						<div class="setting-item">
							<label>WPM (速度: 5-40)</label>
							<input type="number" id="wpmInput" min="5" max="40" value="${n}">
						</div>
						<div class="setting-item">
							<label>テスト再生</label>
							<button id="testMorseBtn" class="test-button">再生</button>
						</div>
					</div>
					<div class="settings-buttons">
						<button id="cancelBtn" class="secondary-button">キャンセル</button>
						<button id="okBtn" class="primary-button">OK</button>
					</div>
				</div>
			</div>
		`;document.body.insertAdjacentHTML("beforeend",i);const r=document.getElementById("settings-modal");if(!r)return;r.addEventListener("click",d=>{d.target===r&&this.closeSettingsModal(!1)});const o=document.getElementById("volumeRange"),l=document.getElementById("volumeInput");o&&l&&(o.addEventListener("input",()=>{const d=parseInt(o.value)/100;this.audioSystem.setVolume(d),l.value=o.value}),l.addEventListener("input",()=>{const d=parseInt(l.value)/100;this.audioSystem.setVolume(d),o.value=l.value}));const a=document.getElementById("frequencyInput");a&&a.addEventListener("input",()=>{const d=parseInt(a.value);this.audioSystem.setFrequency(d)});const c=document.getElementById("wpmInput");c&&c.addEventListener("input",()=>{const d=parseInt(c.value);this.audioSystem.setWPM(d)});const u=document.getElementById("testMorseBtn");u&&u.addEventListener("click",async()=>{if(this.isTestPlaying)this.audioSystem.stopPlaying(),this.isTestPlaying=!1,u.textContent="再生";else{this.isTestPlaying=!0,u.textContent="停止";const d=v.textToMorse("CQ");d&&await this.audioSystem.playMorseString(d),this.isTestPlaying=!1,u.textContent="再生"}});const h=document.getElementById("cancelBtn");h&&h.addEventListener("click",()=>{this.closeSettingsModal(!1)});const g=document.getElementById("okBtn");g&&g.addEventListener("click",()=>{this.closeSettingsModal(!0)})}renderExamMode(){const t=document.getElementById("app");t&&(this.examQuestions.length===0?this.renderExamSetup(t):this.currentQuestionIndex<this.examQuestions.length?this.renderExamQuestion(t):this.renderExamResult(t))}renderExamSetup(t){const e=this.getAllTags();t.innerHTML=`
			<div class="container">
				<header class="header">
					<button id="backBtn" class="back-btn">← 戻る</button>
					<h1>CW略語・Q符号</h1>
					<div class="settings-icon" id="settingsBtn">
						<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
						</svg>
					</div>
				</header>

				<div class="tabs">
					<button class="tab-button" data-tab="browse">一覧</button>
					<button class="tab-button" data-tab="learn">学習モード</button>
					<button class="tab-button active" data-tab="exam">試験モード</button>
				</div>

				<div class="filter-section">
					<h2>試験モード設定</h2>

					<div class="filter-group">
						<h3>タグでフィルター</h3>
						<div class="tags-list">
							${e.map(s=>`
								<button class="tag-btn ${this.selectedTags.has(s)?"active":""}" data-tag="${s}">
									${s}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h3>使用頻度</h3>
						<div class="frequency-list">
							${[5,4,3,2,1].map(s=>`
								<button class="freq-btn ${this.selectedFrequencies.has(s)?"active":""}" data-freq="${s}">
									${this.getFrequencyStars(s)}
								</button>
							`).join("")}
						</div>
					</div>

					<div class="filter-group">
						<h3>出題形式</h3>
						<div class="question-type-buttons">
							<button class="question-type-btn ${this.questionType==="abbr-to-meaning"?"selected":""}" data-type="abbr-to-meaning">略語→意味（基礎）</button>
							<button class="question-type-btn ${this.questionType==="meaning-to-abbr"?"selected":""}" data-type="meaning-to-abbr">意味→略語（応用）</button>
							<button class="question-type-btn ${this.questionType==="morse-to-abbr"?"selected":""}" data-type="morse-to-abbr">モールス音→略語（実践）</button>
							<button class="question-type-btn ${this.questionType==="morse-to-meaning"?"selected":""}" data-type="morse-to-meaning">モールス音→意味（実践）</button>
						</div>
					</div>

					<div class="filter-group">
						<h3>問題数</h3>
						<div class="question-count-buttons">
							<button class="question-count-btn ${this.questionCount===5?"selected":""}" data-count="5">5問</button>
							<button class="question-count-btn ${this.questionCount===10?"selected":""}" data-count="10">10問</button>
							<button class="question-count-btn ${this.questionCount===20?"selected":""}" data-count="20">20問</button>
							<button class="question-count-btn ${this.questionCount===50?"selected":""}" data-count="50">50問</button>
						</div>
					</div>

					<div class="result-count">
						出題可能: ${this.filteredEntries.length}件
					</div>

					<div class="action-buttons">
						<button id="start-exam-btn" class="primary-button">試験開始</button>
					</div>
				</div>
			</div>
		`,this.attachExamSetupListeners()}attachExamSetupListeners(){const t=document.getElementById("backBtn");t&&t.addEventListener("click",()=>{window.location.href="./index.html"});const e=document.getElementById("settingsBtn");e&&e.addEventListener("click",()=>{this.openSettingsModal()}),document.querySelectorAll(".tab-button").forEach(a=>{a.addEventListener("click",()=>{const c=a.getAttribute("data-tab");c==="browse"?(this.viewMode="browse",this.render()):c==="learn"&&(this.viewMode="learn",this.currentCards=[],this.render())})}),document.querySelectorAll(".tag-btn").forEach(a=>{a.addEventListener("click",()=>{const c=a.getAttribute("data-tag");c&&(this.selectedTags.has(c)?this.selectedTags.delete(c):this.selectedTags.add(c),this.applyFilters(),this.saveFilters(),this.render())})}),document.querySelectorAll(".freq-btn").forEach(a=>{a.addEventListener("click",()=>{const c=parseInt(a.getAttribute("data-freq")||"0",10);this.toggleFrequency(c)})}),document.querySelectorAll(".question-type-btn").forEach(a=>{a.addEventListener("click",()=>{const c=a.getAttribute("data-type");c&&(this.questionType=c,this.render())})}),document.querySelectorAll(".question-count-btn").forEach(a=>{a.addEventListener("click",()=>{const c=parseInt(a.getAttribute("data-count")||"10",10);this.questionCount=c,this.render()})});const l=document.getElementById("start-exam-btn");l&&l.addEventListener("click",()=>{this.startExam()})}startExam(){this.examQuestions=this.generateExamQuestions(),this.currentQuestionIndex=0,this.examResults=[],this.render()}generateExamQuestions(){const t=Math.min(this.questionCount,this.filteredEntries.length);return[...this.filteredEntries].sort(()=>Math.random()-.5).slice(0,t).map(n=>this.createExamQuestion(n))}createExamQuestion(t){const e=this.filteredEntries.filter(i=>i.abbreviation!==t.abbreviation).sort(()=>Math.random()-.5).slice(0,3);let s,n;switch(this.questionType){case"abbr-to-meaning":s=`${t.english} / ${t.japanese}`,n=[s,...e.map(i=>`${i.english} / ${i.japanese}`)];break;case"meaning-to-abbr":s=t.abbreviation,n=[s,...e.map(i=>i.abbreviation)];break;case"morse-to-abbr":s=t.abbreviation,n=[s,...e.map(i=>i.abbreviation)];break;case"morse-to-meaning":s=`${t.english} / ${t.japanese}`,n=[s,...e.map(i=>`${i.english} / ${i.japanese}`)];break}return n=n.sort(()=>Math.random()-.5),{type:this.questionType,entry:t,choices:n,correctAnswer:s}}renderExamQuestion(t){const e=this.examQuestions[this.currentQuestionIndex],s=`問題 ${this.currentQuestionIndex+1} / ${this.examQuestions.length}`;t.innerHTML=`
			<div class="container exam-view">
				<div class="exam-header">
					<button id="quit-exam-btn" class="secondary-button">試験を中止</button>
					<div class="progress-indicator">${s}</div>
				</div>

				<div class="question-container">
					${this.renderQuestion(e)}
				</div>

				<div class="choices-container">
					${this.renderChoices(e)}
				</div>

				<div id="feedback-area" class="feedback-area"></div>
			</div>
		`,this.attachExamQuestionListeners(),(e.type==="morse-to-abbr"||e.type==="morse-to-meaning")&&setTimeout(()=>this.playMorse(e.entry.abbreviation),500)}renderQuestion(t){switch(t.type){case"abbr-to-meaning":return`
					<div class="question-text">
						<p>次の略語の意味を選んでください:</p>
						<p class="question-abbr">${this.formatAbbreviation(t.entry.abbreviation)}</p>
					</div>
				`;case"meaning-to-abbr":return`
					<div class="question-text">
						<p>次の意味に対応する略語を選んでください:</p>
						<p class="question-meaning">${t.entry.english}</p>
						<p class="question-meaning">${t.entry.japanese}</p>
					</div>
				`;case"morse-to-abbr":return`
					<div class="question-text">
						<p>モールス音を聞いて、対応する略語を選んでください:</p>
						<button id="replay-morse-btn" class="control-button">🔊 もう一度再生</button>
					</div>
				`;case"morse-to-meaning":return`
					<div class="question-text">
						<p>モールス音を聞いて、対応する意味を選んでください:</p>
						<button id="replay-morse-btn" class="control-button">🔊 もう一度再生</button>
					</div>
				`}}renderChoices(t){return t.choices.map((e,s)=>`
			<button class="choice-button" data-choice="${e}">
				${String.fromCharCode(65+s)}. ${e}
			</button>
		`).join("")}attachExamQuestionListeners(){const t=document.getElementById("quit-exam-btn");t&&t.addEventListener("click",()=>{confirm("試験を中止しますか？")&&(this.examQuestions=[],this.examResults=[],this.currentQuestionIndex=0,this.render())});const e=document.getElementById("replay-morse-btn");e&&e.addEventListener("click",()=>{const n=this.examQuestions[this.currentQuestionIndex];this.playMorse(n.entry.abbreviation)}),document.querySelectorAll(".choice-button").forEach(n=>{n.addEventListener("click",()=>{const i=n.getAttribute("data-choice");i&&this.submitExamAnswer(i)})})}submitExamAnswer(t){const e=this.examQuestions[this.currentQuestionIndex],s=t===e.correctAnswer;this.examResults.push({question:e,userAnswer:t,isCorrect:s}),this.showExamFeedback(s,e.correctAnswer),setTimeout(()=>{this.currentQuestionIndex++,this.render()},1500)}showExamFeedback(t,e){const s=document.getElementById("feedback-area");if(!s)return;s.className=`feedback-area ${t?"correct":"incorrect"}`,s.innerHTML=t?'<div class="feedback-text">✓ 正解！</div>':`<div class="feedback-text">✗ 不正解<br>正解: ${e}</div>`,document.querySelectorAll(".choice-button").forEach(i=>{i.disabled=!0})}renderExamResult(t){const e=this.examResults.filter(r=>r.isCorrect).length,s=this.examResults.length,n=Math.round(e/s*100),i=this.examResults.filter(r=>!r.isCorrect);t.innerHTML=`
			<div class="container exam-result-view">
				<div class="result-header">
					<h2>試験結果</h2>
				</div>

				<div class="score-display">
					<div class="score-large">${e} / ${s}</div>
					<div class="score-percentage">${n}%</div>
				</div>

				<div class="result-details">
					${i.length>0?`
						<h3>間違えた問題 (${i.length}問)</h3>
						<div class="wrong-questions">
							${i.map(r=>this.renderWrongAnswer(r)).join("")}
						</div>
					`:`
						<p class="perfect-score">全問正解です！おめでとうございます！</p>
					`}
				</div>

				<div class="action-buttons">
					<button id="back-to-setup-btn" class="primary-button">設定に戻る</button>
					${i.length>0?`
						<button id="retry-wrong-btn" class="secondary-button">間違えた問題を復習</button>
					`:""}
				</div>
			</div>
		`,this.attachExamResultListeners()}renderWrongAnswer(t){const{question:e,userAnswer:s}=t;return`
			<div class="wrong-question-item">
				<div class="wrong-q-abbr">${this.formatAbbreviation(e.entry.abbreviation)}</div>
				<div class="wrong-q-correct">正解: ${e.correctAnswer}</div>
				<div class="wrong-q-user">あなたの回答: ${s}</div>
				<div class="wrong-q-meaning">${e.entry.english} / ${e.entry.japanese}</div>
			</div>
		`}attachExamResultListeners(){const t=document.getElementById("back-to-setup-btn");t&&t.addEventListener("click",()=>{this.examQuestions=[],this.examResults=[],this.currentQuestionIndex=0,this.render()});const e=document.getElementById("retry-wrong-btn");e&&e.addEventListener("click",()=>{const s=this.examResults.filter(n=>!n.isCorrect).map(n=>n.question.entry);this.filteredEntries=s,this.questionCount=s.length,this.startExam()})}}document.addEventListener("DOMContentLoaded",()=>{new y});</script>
  <style rel="stylesheet" crossorigin>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}.prosign{text-decoration:overline}.container{max-width:1200px;margin:0 auto}.header{display:flex;align-items:center;gap:20px;margin-bottom:30px;color:#fff}.back-btn{background:#fff3;border:none;color:#fff;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:1rem;transition:background .3s}.back-btn:hover{background:#ffffff4d}.header h1{font-size:2rem;flex:1}.mode-toggle{margin-left:auto}.toggle-mode-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:.9rem;transition:transform .2s,box-shadow .2s;white-space:nowrap}.toggle-mode-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.tags-container{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.tags-container h2{font-size:1.2rem;color:#667eea;margin-bottom:15px}.tags-list{display:flex;flex-wrap:wrap;gap:10px}.tag-btn{background:#f0f0f0;border:2px solid transparent;color:#667eea;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:.9rem;transition:all .3s}.tag-btn:hover{background:#e0e0e0}.tag-btn.active{background:#667eea;color:#fff;border-color:#667eea}.entries-container{background:#fff;border-radius:12px;padding:20px}.entries-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.entries-header h2{font-size:1.2rem;color:#667eea;margin:0}.entries-container h2{font-size:1.2rem;color:#667eea;margin-bottom:15px}.entries-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}.entry-card{background:#f9f9f9;border-radius:8px;padding:15px;transition:transform .2s,box-shadow .2s;cursor:pointer}.entry-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.entry-card.playing{background:linear-gradient(135deg,#ffe0e0,#ffd0d0);box-shadow:0 4px 12px #f443364d;animation:cardPulse 1s infinite}@keyframes cardPulse{0%,to{opacity:1}50%{opacity:.85}}.entry-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.entry-abbr{font-size:1.3rem;font-weight:700;color:#667eea}.entry-frequency{font-size:1rem;color:orange;-webkit-user-select:none;user-select:none}.entry-english{font-size:.95rem;color:#666;margin-bottom:5px}.entry-japanese{font-size:1rem;color:#333;margin-bottom:10px}.entry-description{font-size:.9rem;color:#666;margin-bottom:8px;line-height:1.5}.entry-example{font-size:.85rem;color:#888;margin-bottom:10px;font-style:italic;padding-left:10px;border-left:3px solid #ddd}.entry-tags{font-size:.85rem;color:#999;font-style:italic}.error{background:#fff;border-radius:12px;padding:40px;text-align:center;color:#d32f2f;font-size:1.1rem}.list-table-container{overflow-x:auto}.list-table{width:100%;border-collapse:collapse;background:#fff}.list-table thead{background:#667eea;color:#fff}.list-table th{padding:12px;text-align:left;font-weight:600;white-space:nowrap}.list-table th.sortable{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .2s}.list-table th.sortable:hover{background:#5568d3}.list-table tbody tr{border-bottom:1px solid #e0e0e0;transition:background .2s}.list-table tbody tr:hover{background:#f5f5f5}.list-table td{padding:10px 12px}.list-frequency{color:orange;font-size:.9rem;white-space:nowrap;text-align:center;-webkit-user-select:none;user-select:none}.list-abbr{white-space:nowrap}.abbr-play-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;font-weight:700;transition:transform .2s,box-shadow .2s;white-space:nowrap}.abbr-play-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px #667eea4d}.abbr-play-btn.playing{background:linear-gradient(135deg,#f44336,#e91e63);animation:pulse 1s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.7}}.abbr-play-btn .prosign{text-decoration:overline}.list-english{color:#666;min-width:150px}.list-japanese{color:#333;min-width:150px}.list-tags{color:#999;font-size:.85rem;font-style:italic}.list-description{color:#555;font-size:.9rem;line-height:1.4;min-width:200px}.list-example{color:#777;font-size:.85rem;font-style:italic;line-height:1.4;min-width:200px}.filter-section{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px}.filter-group{margin-bottom:20px}.filter-group h2{font-size:1.1rem;color:#667eea;margin-bottom:10px;display:flex;align-items:center;gap:10px}.toggle-freq-btn{background:#667eea1a;border:1px solid #667eea;color:#667eea;padding:4px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .2s}.toggle-freq-btn:hover{background:#667eea;color:#fff}.search-input{width:100%;max-width:500px;padding:10px 15px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:border-color .3s}.search-input:focus{outline:none;border-color:#667eea}.frequency-list{display:flex;flex-wrap:wrap;gap:10px}.freq-btn{background:#f0f0f0;border:2px solid transparent;color:#667eea;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:1rem;transition:all .3s;-webkit-user-select:none;user-select:none}.freq-btn:hover{background:#e0e0e0}.freq-btn.active{background:#667eea;color:#fff;border-color:#667eea}.mode-checkbox{display:flex;align-items:center;gap:8px;cursor:pointer}.mode-checkbox input{cursor:pointer}.result-count{font-size:1rem;color:#667eea;margin:15px 0;font-weight:600}.action-buttons{display:flex;gap:10px;margin-top:15px}.primary-button{background:#667eea;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.primary-button:hover{background:#5568d3}.secondary-button{background:#f0f0f0;color:#333;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.secondary-button:hover{background:#e0e0e0}.learning-view{max-width:800px}.learning-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.progress-indicator{font-size:1.2rem;color:#fff;font-weight:600}.no-cards{background:#fff;border-radius:12px;padding:60px;text-align:center;font-size:1.2rem;color:#666;margin-bottom:20px}.card-container{perspective:1000px;margin-bottom:30px}.flashcard{position:relative;width:100%;min-height:400px;transition:transform .6s;transform-style:preserve-3d}.flashcard.flipped{transform:rotateY(180deg)}.card-front,.card-back{position:absolute;width:100%;min-height:400px;backface-visibility:hidden;background:#fff;border-radius:12px;padding:40px;display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 4px 20px #0000001a}.card-back{transform:rotateY(180deg)}.card-label{font-size:1rem;color:#999;margin-bottom:20px;text-transform:uppercase;letter-spacing:1px}.card-content{font-size:3rem;font-weight:700;color:#667eea;margin-bottom:30px;text-align:center}.card-content-abbr{font-size:2rem;font-weight:700;color:#667eea;margin-bottom:15px}.card-content-text{font-size:1.3rem;color:#333;margin-bottom:10px;text-align:center}.card-description{font-size:1rem;color:#666;margin-top:15px;margin-bottom:10px;text-align:center;line-height:1.6;max-width:90%}.card-example{font-size:.95rem;color:#888;margin-top:10px;margin-bottom:10px;text-align:center;font-style:italic;padding:10px;background:#f9f9f9;border-radius:6px;max-width:90%}.card-tags{font-size:.9rem;color:#999;margin-top:20px}.play-morse-btn{background:#764ba2;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.play-morse-btn:hover{background:#5f3d84}.card-controls{text-align:center;margin-bottom:20px}.control-button{background:#667eea;color:#fff;border:none;padding:15px 40px;border-radius:8px;font-size:1.1rem;cursor:pointer;transition:background .3s}.control-button:hover{background:#5568d3}.judgment-controls{display:flex;justify-content:center;gap:20px;margin-bottom:20px}.judgment-button{border:2px solid transparent;padding:15px 40px;border-radius:8px;font-size:1.1rem;cursor:pointer;transition:all .3s}.judgment-button.known{background:#f0f0f0;color:#4caf50}.judgment-button.known:hover{background:#e8f5e9}.judgment-button.known.active{background:#4caf50;color:#fff;border-color:#4caf50}.judgment-button.unknown{background:#f0f0f0;color:#f44336}.judgment-button.unknown:hover{background:#ffebee}.judgment-button.unknown.active{background:#f44336;color:#fff;border-color:#f44336}.navigation-controls{display:flex;justify-content:space-between;gap:20px}.nav-button{background:#fff3;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:background .3s}.nav-button:hover:not(:disabled){background:#ffffff4d}.nav-button:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.header h1{font-size:1.5rem}.entries-list{grid-template-columns:1fr}.toggle-mode-btn{font-size:.9rem;padding:8px 12px}.list-table{font-size:.9rem}.list-table th,.list-table td{padding:8px}.card-content{font-size:2rem}.card-content-abbr{font-size:1.5rem}.card-content-text{font-size:1.1rem}.judgment-controls,.navigation-controls{flex-direction:column}}.settings-icon{width:40px;height:40px;background:#fff3;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.settings-icon:hover{background:#ffffff4d;transform:rotate(90deg) scale(1.1)}.settings-icon svg{width:24px;height:24px;fill:#fff}.tabs{display:flex;gap:8px;margin-bottom:20px;border-bottom:2px solid rgba(255,255,255,.3)}.tab-button{background:#ffffff1a;border:none;color:#fff;padding:12px 24px;border-radius:8px 8px 0 0;cursor:pointer;font-size:1rem;font-weight:500;transition:all .3s;border-bottom:3px solid transparent}.tab-button:hover{background:#fff3}.tab-button.active{background:#fff;color:#667eea;border-bottom-color:#667eea}.settings-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.settings-content{background:#fff;border-radius:12px;padding:30px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.settings-content h2{margin-bottom:20px;color:#333}.settings-grid{display:flex;flex-direction:column;gap:20px;margin-bottom:30px}.setting-item{display:grid;grid-template-columns:150px 1fr auto auto;gap:15px;align-items:center}.setting-item label{font-weight:600;color:#555}.setting-item input[type=range]{width:100%}.setting-item input[type=number]{width:80px;padding:8px;border:2px solid #e0e0e0;border-radius:8px;text-align:center}.test-button{padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s}.test-button:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.settings-buttons{display:flex;justify-content:center;gap:15px}.question-type-buttons,.question-count-buttons{display:flex;flex-wrap:wrap;gap:10px}.question-type-btn,.question-count-btn{padding:12px 20px;background:#ffffffe6;color:#333;border:2px solid transparent;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .3s;flex:1;min-width:120px}.question-type-btn:hover,.question-count-btn:hover{background:#fff;transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.question-type-btn.selected,.question-count-btn.selected{background:#667eea;color:#fff;border-color:#667eea}.exam-view,.exam-result-view{background:#fff;border-radius:12px;padding:30px}.exam-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.question-container{background:#f9f9f9;padding:40px;border-radius:8px;margin-bottom:30px}.question-text{font-size:1.25rem;color:#333;text-align:center}.question-text p{margin-bottom:12px}.question-abbr{font-size:3rem;font-weight:700;font-family:Courier New,monospace;color:#667eea;margin:20px 0}.question-meaning{font-size:1.125rem;font-weight:500;color:#555;margin:12px 0}.choices-container{display:grid;grid-template-columns:1fr;gap:12px;max-width:800px;margin:0 auto 30px}.choice-button{padding:16px 24px;background:#fff;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;text-align:left;cursor:pointer;transition:all .3s}.choice-button:hover:not(:disabled){border-color:#667eea;background:#f0f8ff}.choice-button:disabled{cursor:not-allowed;opacity:.6}.feedback-area{min-height:60px;display:flex;align-items:center;justify-content:center;margin-top:20px}.feedback-text{font-size:1.5rem;font-weight:600;padding:20px 40px;border-radius:8px}.feedback-area.correct .feedback-text{background:#e8f5e9;color:#2e7d32;border:2px solid #4caf50}.feedback-area.incorrect .feedback-text{background:#ffebee;color:#c62828;border:2px solid #ef5350}.result-header h2{font-size:2rem;color:#333;text-align:center;margin-bottom:30px}.score-display{text-align:center;padding:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;color:#fff;margin-bottom:40px}.score-large{font-size:4rem;font-weight:700;margin-bottom:12px}.score-percentage{font-size:2.25rem;font-weight:500}.result-details{max-width:800px;margin:0 auto 30px}.result-details h3{font-size:1.5rem;color:#333;margin-bottom:20px}.wrong-questions{display:flex;flex-direction:column;gap:16px}.wrong-question-item{background:#fff3e0;border:2px solid #ffa726;border-radius:8px;padding:20px}.wrong-q-abbr{font-size:1.5rem;font-weight:700;font-family:Courier New,monospace;color:#667eea;margin-bottom:12px}.wrong-q-correct{font-size:1rem;font-weight:600;color:#2e7d32;margin-bottom:8px}.wrong-q-user{font-size:1rem;color:#c62828;margin-bottom:12px}.wrong-q-meaning{font-size:.875rem;color:#666;font-style:italic}.perfect-score{text-align:center;font-size:1.5rem;font-weight:600;color:#2e7d32;padding:40px;background:#e8f5e9;border-radius:8px}</style>
</head>
<body>
  <div id="app"></div>
</body>
</html>
