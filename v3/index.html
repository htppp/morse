<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>モールス CW略語・Q符号 学習アプリ</title>
  <meta name="description" content="CW通信で使用される略語とQ符号を効率的に学習するための教材アプリケーション">
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();async function T(){try{const o=await fetch("data/flashcard.tsv");if(!o.ok)throw new Error(`Failed to load flashcard data: ${o.statusText}`);const t=await o.text();return C(t)}catch(o){throw console.error("Error loading flashcard data:",o),o}}function C(o){const e=o.trim().split(`
`).slice(1),i=[];for(const s of e){if(!s.trim())continue;const n=s.split("	");if(n.length<5){console.warn("Invalid line (insufficient fields):",s);continue}const[r,c,a,h,u]=n,y=r.split(",").map(p=>p.trim()).filter(p=>p.length>0),g=parseInt(c,10);if(isNaN(g)){console.warn("Invalid frequency value:",c);continue}i.push({tags:y,frequency:g,abbreviation:a.trim(),english:h.trim(),japanese:u.trim()})}return i}function w(o,t){return t.length===0?o:o.filter(e=>t.every(i=>e.tags.includes(i)))}function q(o,t){return t<=1?o:o.filter(e=>e.frequency>=t)}function E(o,t){if(!t.trim())return o;const e=t.toLowerCase();return o.filter(i=>i.abbreviation.toLowerCase().includes(e)||i.english.toLowerCase().includes(e)||i.japanese.includes(t)||i.tags.some(s=>s.includes(t)))}function k(o,t,e="asc"){const i=[...o];return i.sort((s,n)=>{let r=0;switch(t){case"abbreviation":r=s.abbreviation.localeCompare(n.abbreviation);break;case"frequency":r=s.frequency-n.frequency;break;case"tags":const c=s.tags[0]||"",a=n.tags[0]||"";r=c.localeCompare(a);break}return e==="asc"?r:-r}),i}function x(o){const t=new Set;for(const e of o)for(const i of e.tags)t.add(i);return Array.from(t).sort()}class S{constructor(t){this.container=t,this.currentTab="list",this.tabChangeCallbacks=new Map}initialize(){this.renderTabs(),this.attachEventListeners()}renderTabs(){const t=`
      <div class="tabs">
        <button class="tab-button ${this.currentTab==="list"?"active":""}" data-tab="list">
          一覧表示
        </button>
        <button class="tab-button ${this.currentTab==="flashcard"?"active":""}" data-tab="flashcard">
          フラッシュカード
        </button>
        <button class="tab-button ${this.currentTab==="exam"?"active":""}" data-tab="exam">
          試験モード
        </button>
      </div>
      <div id="tab-content" class="tab-content"></div>
    `;this.container.innerHTML=t}attachEventListeners(){this.container.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{const i=e.getAttribute("data-tab");i&&!e.hasAttribute("disabled")&&this.switchTab(i)})})}switchTab(t){if(this.currentTab===t)return;this.currentTab=t,this.container.querySelectorAll(".tab-button").forEach(s=>{s.getAttribute("data-tab")===t?s.classList.add("active"):s.classList.remove("active")});const i=this.tabChangeCallbacks.get(t);i&&i()}onTabChange(t,e){this.tabChangeCallbacks.set(t,e)}getContentContainer(){return this.container.querySelector("#tab-content")}getCurrentTab(){return this.currentTab}}const v=class v{static get(t){return this.settings[t]}static set(t,e){this.settings[t]=e,this.notifyListeners()}static getAll(){return{...this.settings}}static load(){try{const t=localStorage.getItem("morseSettings");t?this.settings={...this.defaultSettings,...JSON.parse(t)}:this.settings={...this.defaultSettings},this.notifyListeners()}catch(t){console.error("Failed to load settings:",t),this.settings={...this.defaultSettings}}}static save(){try{localStorage.setItem("morseSettings",JSON.stringify(this.settings))}catch(t){console.error("Failed to save settings:",t)}}static reset(){this.settings={...this.defaultSettings},this.save(),this.notifyListeners()}static addListener(t){this.listeners.add(t)}static removeListener(t){this.listeners.delete(t)}static notifyListeners(){this.listeners.forEach(t=>t())}};v.defaultSettings={volume:.3,frequency:800,wpm:20},v.settings={...v.defaultSettings},v.listeners=new Set;let l=v;l.load();//! 音声システムモジュール。
//! 音声システムクラス。
const f=class f{static ensureAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext.state==="suspended"&&this.audioContext.resume()}static ensureSidetone(){if(this.ensureAudioContext(),!this.sidOsc&&this.audioContext){this.sidOsc=this.audioContext.createOscillator(),this.sidGain=this.audioContext.createGain(),this.sidFilter=this.audioContext.createBiquadFilter();const t=this.audioContext.createDynamicsCompressor();this.sidOsc.type="sine",this.sidOsc.frequency.value=l.get("frequency"),this.sidGain.gain.value=0,this.sidFilter.type="bandpass",this.sidFilter.frequency.value=l.get("frequency"),this.sidFilter.Q.value=10,t.threshold.value=-18,t.ratio.value=2,t.attack.value=.001,t.release.value=.08,this.sidOsc.connect(this.sidGain),this.sidGain.connect(this.sidFilter),this.sidFilter.connect(t),t.connect(this.audioContext.destination),this.sidOsc.start()}}static scheduleTone(t,e){if(this.ensureAudioContext(),!!this.audioContext){this.audioContext.state==="suspended"&&this.audioContext.resume();try{const i=this.audioContext.createOscillator(),s=this.audioContext.createGain();i.connect(s),s.connect(this.audioContext.destination);const n=l.get("frequency"),r=l.get("volume");i.frequency.value=n,i.type="sine";const c=this.audioContext.currentTime,a=Math.max(c,t);s.gain.setValueAtTime(0,a),s.gain.linearRampToValueAtTime(r,a+.001),s.gain.setValueAtTime(r,a+(e-1)/1e3),s.gain.linearRampToValueAtTime(0,a+e/1e3),i.start(a),i.stop(a+e/1e3);const h={osc:i,gain:s};this.scheduledNodes.push(h),i.onended=()=>{const u=this.scheduledNodes.indexOf(h);u>-1&&this.scheduledNodes.splice(u,1)}}catch(i){console.error("音声エラー:",i)}}}static startContinuousTone(){if(this.ensureAudioContext(),!!this.audioContext){this.audioContext.state==="suspended"&&this.audioContext.resume();try{if(window.currentStraightOsc)try{window.currentStraightOsc.stop()}catch{}const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination);const i=l.get("frequency"),s=l.get("volume");t.frequency.value=i,t.type="sine";const n=this.audioContext.currentTime;e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(s,n+.001),t.start(n),window.currentStraightOsc=t,window.currentStraightGain=e}catch(t){console.error("連続音開始エラー:",t)}}}static stopContinuousTone(){if(this.audioContext)try{if(window.currentStraightOsc&&window.currentStraightGain){const t=this.audioContext.currentTime;window.currentStraightGain.gain.cancelScheduledValues(t),window.currentStraightGain.gain.setValueAtTime(window.currentStraightGain.gain.value,t),window.currentStraightGain.gain.linearRampToValueAtTime(0,t+.001),window.currentStraightOsc.stop(t+.002),window.currentStraightOsc=null,window.currentStraightGain=null}}catch(t){console.error("連続音停止エラー:",t)}}static async playMorseString(t){if(this.isPlaying||!t||t==="モールス信号が表示されます"||(this.ensureAudioContext(),this.ensureSidetone(),!this.audioContext))return!1;this.isPlaying=!0;const e=l.get("frequency");this.sidOsc&&this.sidFilter&&(this.sidOsc.frequency.setValueAtTime(e,this.audioContext.currentTime),this.sidFilter.frequency.setValueAtTime(e,this.audioContext.currentTime));const s=1200/l.get("wpm"),n=s,r=3*s,c=s,a=3*s,h=7*s;let u=this.audioContext.currentTime+.02;for(let p=0;p<t.length&&this.isPlaying;p++){const b=t[p];b==="."?(this.scheduleTone(u,n),u+=(n+c)/1e3):b==="-"?(this.scheduleTone(u,r),u+=(r+c)/1e3):b===" "?u+=(a-c)/1e3:b==="/"&&(u+=(h-c)/1e3)}const y=(u-this.audioContext.currentTime)*1e3;await new Promise(p=>setTimeout(p,y));const g=this.isPlaying;return this.isPlaying=!1,g}static stopPlaying(){if(this.isPlaying=!1,this.sidGain&&this.audioContext){const t=this.audioContext.currentTime;this.sidGain.gain.cancelScheduledValues(t),this.sidGain.gain.setValueAtTime(0,t)}}static stopAllScheduledTones(){if(!this.audioContext)return;const t=this.audioContext.currentTime;this.scheduledNodes.forEach(({osc:e,gain:i})=>{try{i.gain.cancelScheduledValues(t),i.gain.setValueAtTime(i.gain.value,t),i.gain.linearRampToValueAtTime(0,t+.01),e.stop(t+.01)}catch{}}),this.scheduledNodes=[]}static init(){document.addEventListener("click",()=>{this.ensureAudioContext()},{once:!0}),document.addEventListener("keydown",()=>{this.ensureAudioContext()},{once:!0})}};f.audioContext=null,f.sidOsc=null,f.sidGain=null,f.sidFilter=null,f.isPlaying=!1,f.scheduledNodes=[];let d=f;//! モールス符号マッピングと変換機能。
//! モールス符号のマッピング型定義。
//! 欧文モールス符号マップ。
const L={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."," ":"/",".":".-.-.-",",":"--..--",":":"---...","?":"..--..",_:"..--.-","+":".-.-.","-":"-....-","×":"-..-","^":"......","/":"-..-.","@":".--.-.","(":"-.--.",")":"-.--.-",'"':".-..-.","'":".----.",HH:"........","=":"-...-",VA:"...-.-",AS:".-...",VE:"...-."};//! 和文モールス符号マップ。
const M={ア:"--.--",イ:".-",ウ:"..-",エ:"-.---",オ:".-...",カ:".-..",キ:"-.-..",ク:"...-",ケ:"-.--",コ:"----",サ:"-.-.-",シ:"--.-.",ス:"---.-",セ:".---.",ソ:"---.",タ:"-.",チ:"..-.",ツ:".--.",テ:".-.--",ト:"..-..",ナ:".-.",ニ:"-.-.",ヌ:"....",ネ:"--.-",ノ:"..--",ハ:"-...",ヒ:"--..-",フ:"--..",ヘ:".",ホ:"-..",マ:"-..-",ミ:"..-.-",ム:"-",メ:"-...-",モ:"-..-.",ヤ:".--",ユ:"-..--",ヨ:"--",ラ:"...",リ:"--.",ル:"-.--.",レ:"---",ロ:".-.-",ワ:"-.-",ヲ:".---",ン:".-.-.",ヱ:".--..",ヰ:".-..-.","゛":"..","゜":"..--.",ー:".--.-","、":".-.-.-.-","」":".-.-..","（":"-.--.-","）":".-..-.-",ホレ:"-..----",ラタ:"...-.-","(":"-.--.",")":"-.--.-"," ":"/",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."};//! モールス符号モジュール。
class m{static getCurrentMorseMap(){return document.getElementById("japaneseMode")?.checked?M:L}static getCurrentMorseToCharMap(){const t=this.getCurrentMorseMap();return Object.fromEntries(Object.entries(t).map(([e,i])=>[i,e]))}static textToMorse(t){const e=this.getCurrentMorseMap(),i=t.toUpperCase();return Array.from(i).map(s=>e[s]||s).join(" ")}static morseSequencesToText(t){const e=this.getCurrentMorseToCharMap();let i="";for(const s of t)s==="/"?i+=" ":s&&s!==""&&(i+=e[s]||"?");return i}static combineDakutenHandakuten(t){return t}}class ${constructor(t){this.container=t,this.allEntries=[],this.filteredEntries=[],this.selectedTags=[],this.minFrequency=1,this.searchQuery="",this.sortKey="abbreviation",this.sortOrder="asc",this.playingAbbreviation=null}setData(t){this.allEntries=t,this.applyFilters(),this.render()}applyFilters(){let t=this.allEntries;t=w(t,this.selectedTags),t=q(t,this.minFrequency),t=E(t,this.searchQuery),t=k(t,this.sortKey,this.sortOrder),this.filteredEntries=t}render(){this.container.innerHTML=`
      <div class="list-mode">
        <div class="filter-section">
          <h2>一覧表示モード</h2>

          <div class="filter-controls">
            <div class="filter-group">
              <label for="tag-filter">タグフィルタ:</label>
              <select id="tag-filter" multiple size="5">
                <option value="">すべて</option>
                ${this.renderTagOptions()}
              </select>
            </div>

            <div class="filter-group">
              <label for="frequency-filter">使用頻度:</label>
              <select id="frequency-filter">
                <option value="1">すべて</option>
                <option value="2">頻度2以上</option>
                <option value="3">頻度3以上</option>
                <option value="4">頻度4以上</option>
                <option value="5">頻度5のみ</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="search-input">検索:</label>
              <input type="text" id="search-input" placeholder="略語、英文、和訳、タグで検索...">
            </div>

            <div class="filter-group">
              <label for="sort-key">並び順:</label>
              <select id="sort-key">
                <option value="abbreviation">略語順</option>
                <option value="frequency">使用頻度順</option>
                <option value="tags">タグ順</option>
              </select>
              <select id="sort-order">
                <option value="asc">昇順</option>
                <option value="desc">降順</option>
              </select>
            </div>
          </div>

          <div class="result-count">
            ${this.filteredEntries.length}件 / ${this.allEntries.length}件
          </div>
        </div>

        <div class="table-container">
          ${this.renderTable()}
        </div>
      </div>
    `,this.attachEventListeners()}renderTagOptions(){return x(this.allEntries).map(e=>{const i=this.selectedTags.includes(e)?"selected":"";return`<option value="${e}" ${i}>${e}</option>`}).join("")}renderTable(){return this.filteredEntries.length===0?'<p class="no-results">該当する項目がありません</p>':`
      <table class="flashcard-table">
        <thead>
          <tr>
            <th>略語</th>
            <th>英文</th>
            <th>和訳</th>
            <th>使用頻度</th>
            <th>タグ</th>
          </tr>
        </thead>
        <tbody>
          ${this.filteredEntries.map(e=>`
      <tr>
        <td class="abbreviation-cell">
          <button class="${this.playingAbbreviation===e.abbreviation?"abbreviation-button playing":"abbreviation-button"}" data-abbreviation="${e.abbreviation}" title="クリックでモールス符号を再生">${e.abbreviation}</button>
        </td>
        <td>${e.english}</td>
        <td>${e.japanese}</td>
        <td class="frequency-cell">${this.renderFrequency(e.frequency)}</td>
        <td class="tags-cell">${e.tags.join(", ")}</td>
      </tr>
    `).join("")}
        </tbody>
      </table>
    `}renderFrequency(t){return"⭐".repeat(t)}attachEventListeners(){const t=this.container.querySelector("#tag-filter");t&&t.addEventListener("change",()=>{const c=Array.from(t.selectedOptions).map(a=>a.value).filter(a=>a);this.selectedTags=c,this.applyFilters(),this.render()});const e=this.container.querySelector("#frequency-filter");e&&(e.value=this.minFrequency.toString(),e.addEventListener("change",()=>{this.minFrequency=parseInt(e.value,10),this.applyFilters(),this.render()}));const i=this.container.querySelector("#search-input");i&&(i.value=this.searchQuery,i.addEventListener("input",()=>{this.searchQuery=i.value,this.applyFilters(),this.render()}));const s=this.container.querySelector("#sort-key"),n=this.container.querySelector("#sort-order");s&&n&&(s.value=this.sortKey,n.value=this.sortOrder,s.addEventListener("change",()=>{this.sortKey=s.value,this.applyFilters(),this.render()}),n.addEventListener("change",()=>{this.sortOrder=n.value,this.applyFilters(),this.render()})),this.container.querySelectorAll(".abbreviation-button").forEach(c=>{c.addEventListener("click",a=>{a.preventDefault();const h=a.target.getAttribute("data-abbreviation");h&&this.playMorse(h)})})}async playMorse(t){if(this.playingAbbreviation===t){d.stopAllScheduledTones(),this.playingAbbreviation=null,this.render();return}this.playingAbbreviation!==null&&d.stopAllScheduledTones();try{this.playingAbbreviation=t,this.render(),d.ensureAudioContext();const e=m.textToMorse(t);e&&await this.playMorseSequence(e),this.playingAbbreviation=null,this.render()}catch(e){console.error("Error playing morse:",e),this.playingAbbreviation=null,this.render()}}async playMorseSequence(t){const e=d.audioContext;if(!e)return;const s=1200/l.get("wpm");let n=e.currentTime;for(const r of t)r==="."?(d.scheduleTone(n,s),n+=(s+s)/1e3):r==="-"?(d.scheduleTone(n,s*3),n+=(s*3+s)/1e3):r===" "?n+=s*3/1e3:r==="/"&&(n+=s*7/1e3)}}class A{constructor(t){this.container=t,this.allEntries=[],this.filteredEntries=[],this.selectedTags=[],this.minFrequency=1,this.currentCards=[],this.currentIndex=0,this.isFlipped=!1,this.progress={known:new Set,unknown:new Set},this.reviewMode=!1,this.loadProgress()}setData(t){this.allEntries=t,this.applyFilters(),this.render()}applyFilters(){let t=this.allEntries;t=w(t,this.selectedTags),t=q(t,this.minFrequency),this.filteredEntries=t}shuffleCards(t){const e=[...t];for(let i=e.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[e[i],e[s]]=[e[s],e[i]]}return e}startLearning(){this.reviewMode?this.currentCards=this.filteredEntries.filter(t=>this.progress.unknown.has(t.abbreviation)):this.currentCards=this.shuffleCards(this.filteredEntries),this.currentIndex=0,this.isFlipped=!1,this.renderLearningView()}render(){this.container.innerHTML=`
      <div class="flashcard-mode">
        <div class="filter-section">
          <h2>フラッシュカードモード</h2>

          <div class="filter-controls">
            <div class="filter-group">
              <label for="fc-tag-filter">タグフィルタ:</label>
              <select id="fc-tag-filter" multiple size="5">
                <option value="">すべて</option>
                ${this.renderTagOptions()}
              </select>
            </div>

            <div class="filter-group">
              <label for="fc-frequency-filter">使用頻度:</label>
              <select id="fc-frequency-filter">
                <option value="1">すべて</option>
                <option value="2">頻度2以上</option>
                <option value="3">頻度3以上</option>
                <option value="4">頻度4以上</option>
                <option value="5">頻度5のみ</option>
              </select>
            </div>

            <div class="filter-group">
              <label>
                <input type="checkbox" id="review-mode-checkbox">
                復習モード（わからないカードのみ）
              </label>
            </div>
          </div>

          <div class="result-count">
            ${this.getCardCountText()}
          </div>

          <div class="action-buttons">
            <button id="start-learning-btn" class="primary-button">学習開始</button>
            <button id="clear-progress-btn" class="secondary-button">進捗をリセット</button>
          </div>
        </div>
      </div>
    `,this.attachEventListeners()}getCardCountText(){const t=this.filteredEntries.length,e=this.filteredEntries.filter(s=>this.progress.unknown.has(s.abbreviation)).length,i=this.filteredEntries.filter(s=>this.progress.known.has(s.abbreviation)).length;return`全${t}件 / わかる:${i}件 / わからない:${e}件`}renderTagOptions(){return x(this.allEntries).map(e=>{const i=this.selectedTags.includes(e)?"selected":"";return`<option value="${e}" ${i}>${e}</option>`}).join("")}renderLearningView(){if(this.currentCards.length===0){this.container.innerHTML=`
        <div class="flashcard-mode">
          <div class="no-cards">
            ${this.reviewMode?"復習するカードがありません":"学習するカードがありません"}
          </div>
          <button id="back-to-setup-btn" class="secondary-button">設定に戻る</button>
        </div>
      `,this.attachBackButton();return}const t=this.currentCards[this.currentIndex],e=`${this.currentIndex+1} / ${this.currentCards.length}`;this.container.innerHTML=`
      <div class="flashcard-mode learning-view">
        <div class="learning-header">
          <button id="back-to-setup-btn" class="secondary-button">← 設定に戻る</button>
          <div class="progress-indicator">${e}</div>
        </div>

        <div class="card-container">
          <div class="flashcard ${this.isFlipped?"flipped":""}" id="flashcard">
            <div class="card-front">
              <div class="card-label">略語</div>
              <div class="card-content">${t.abbreviation}</div>
              <button class="play-morse-btn" id="play-morse-btn" title="モールス符号を再生">♪ モールス再生</button>
            </div>
            <div class="card-back">
              <div class="card-label">意味</div>
              <div class="card-content-small">${t.english}</div>
              <div class="card-content-small">${t.japanese}</div>
              <div class="card-tags">${t.tags.join(", ")} / 頻度:${"⭐".repeat(t.frequency)}</div>
            </div>
          </div>
        </div>

        <div class="card-controls">
          <button id="flip-card-btn" class="control-button">
            ${this.isFlipped?"表に戻す":"カードをめくる"} (Space)
          </button>
        </div>

        ${this.isFlipped?this.renderJudgmentButtons():""}

        <div class="navigation-controls">
          <button id="prev-card-btn" class="nav-button" ${this.currentIndex===0?"disabled":""}>
            ← 前のカード
          </button>
          <button id="next-card-btn" class="nav-button" ${this.currentIndex>=this.currentCards.length-1?"disabled":""}>
            次のカード →
          </button>
        </div>
      </div>
    `,this.attachLearningEventListeners()}renderJudgmentButtons(){const t=this.currentCards[this.currentIndex],e=this.progress.known.has(t.abbreviation);return`
      <div class="judgment-controls">
        <button id="mark-unknown-btn" class="judgment-button unknown ${this.progress.unknown.has(t.abbreviation)?"active":""}">
          × わからない
        </button>
        <button id="mark-known-btn" class="judgment-button known ${e?"active":""}">
          ○ わかる
        </button>
      </div>
    `}attachEventListeners(){const t=this.container.querySelector("#fc-tag-filter");t&&t.addEventListener("change",()=>{const r=Array.from(t.selectedOptions).map(c=>c.value).filter(c=>c);this.selectedTags=r,this.applyFilters(),this.render()});const e=this.container.querySelector("#fc-frequency-filter");e&&(e.value=this.minFrequency.toString(),e.addEventListener("change",()=>{this.minFrequency=parseInt(e.value,10),this.applyFilters(),this.render()}));const i=this.container.querySelector("#review-mode-checkbox");i&&(i.checked=this.reviewMode,i.addEventListener("change",()=>{this.reviewMode=i.checked,this.render()}));const s=this.container.querySelector("#start-learning-btn");s&&s.addEventListener("click",()=>this.startLearning());const n=this.container.querySelector("#clear-progress-btn");n&&n.addEventListener("click",()=>{confirm("学習進捗をすべてリセットしますか？")&&(this.progress={known:new Set,unknown:new Set},this.saveProgress(),this.render())})}attachLearningEventListeners(){this.attachBackButton();const t=this.container.querySelector("#flip-card-btn");t&&t.addEventListener("click",()=>this.flipCard());const e=this.container.querySelector("#play-morse-btn");e&&e.addEventListener("click",()=>{const n=this.currentCards[this.currentIndex];this.playMorse(n.abbreviation)});const i=this.container.querySelector("#prev-card-btn"),s=this.container.querySelector("#next-card-btn");if(i&&i.addEventListener("click",()=>this.previousCard()),s&&s.addEventListener("click",()=>this.nextCard()),this.isFlipped){const n=this.container.querySelector("#mark-known-btn"),r=this.container.querySelector("#mark-unknown-btn");n&&n.addEventListener("click",()=>this.markAsKnown()),r&&r.addEventListener("click",()=>this.markAsUnknown())}this.attachKeyboardListeners()}attachBackButton(){const t=this.container.querySelector("#back-to-setup-btn");t&&t.addEventListener("click",()=>this.render())}attachKeyboardListeners(){const t=e=>{e.key===" "||e.key==="Spacebar"?(e.preventDefault(),this.flipCard()):e.key==="ArrowRight"?(e.preventDefault(),this.nextCard()):e.key==="ArrowLeft"&&(e.preventDefault(),this.previousCard())};document.removeEventListener("keydown",t),document.addEventListener("keydown",t)}flipCard(){this.isFlipped=!this.isFlipped,this.renderLearningView()}nextCard(){this.currentIndex<this.currentCards.length-1&&(this.currentIndex++,this.isFlipped=!1,this.renderLearningView())}previousCard(){this.currentIndex>0&&(this.currentIndex--,this.isFlipped=!1,this.renderLearningView())}markAsKnown(){const t=this.currentCards[this.currentIndex];this.progress.known.add(t.abbreviation),this.progress.unknown.delete(t.abbreviation),this.saveProgress(),this.renderLearningView()}markAsUnknown(){const t=this.currentCards[this.currentIndex];this.progress.unknown.add(t.abbreviation),this.progress.known.delete(t.abbreviation),this.saveProgress(),this.renderLearningView()}async playMorse(t){try{d.ensureAudioContext();const e=m.textToMorse(t);e&&await this.playMorseSequence(e)}catch(e){console.error("Error playing morse:",e)}}async playMorseSequence(t){const e=d.audioContext;if(!e)return;const s=1200/l.get("wpm");let n=e.currentTime;for(const r of t)r==="."?(d.scheduleTone(n,s),n+=(s+s)/1e3):r==="-"?(d.scheduleTone(n,s*3),n+=(s*3+s)/1e3):r===" "?n+=s*3/1e3:r==="/"&&(n+=s*7/1e3)}saveProgress(){const t={known:Array.from(this.progress.known),unknown:Array.from(this.progress.unknown)};localStorage.setItem("flashcard-progress",JSON.stringify(t))}loadProgress(){try{const t=localStorage.getItem("flashcard-progress");if(t){const e=JSON.parse(t);this.progress={known:new Set(e.known||[]),unknown:new Set(e.unknown||[])}}}catch(t){console.error("Failed to load progress:",t)}}}class F{constructor(t){this.container=t,this.allEntries=[],this.filteredEntries=[],this.selectedTags=[],this.minFrequency=1,this.questions=[],this.currentQuestionIndex=0,this.results=[],this.questionCount=10,this.questionType="abbr-to-meaning"}setData(t){this.allEntries=t,this.applyFilters(),this.render()}applyFilters(){let t=this.allEntries;t=w(t,this.selectedTags),t=q(t,this.minFrequency),this.filteredEntries=t}render(){this.container.innerHTML=`
      <div class="exam-mode">
        <div class="filter-section">
          <h2>試験モード</h2>

          <div class="filter-controls">
            <div class="filter-group">
              <label for="exam-tag-filter">タグフィルタ:</label>
              <select id="exam-tag-filter" multiple size="5">
                <option value="">すべて</option>
                ${this.renderTagOptions()}
              </select>
            </div>

            <div class="filter-group">
              <label for="exam-frequency-filter">使用頻度:</label>
              <select id="exam-frequency-filter">
                <option value="1">すべて</option>
                <option value="2">頻度2以上</option>
                <option value="3">頻度3以上</option>
                <option value="4">頻度4以上</option>
                <option value="5">頻度5のみ</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="question-type">出題形式:</label>
              <select id="question-type">
                <option value="abbr-to-meaning">略語→意味（基礎）</option>
                <option value="meaning-to-abbr">意味→略語（応用）</option>
                <option value="morse-to-abbr">モールス音→略語（実践）</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="question-count">問題数:</label>
              <select id="question-count">
                <option value="5">5問</option>
                <option value="10" selected>10問</option>
                <option value="20">20問</option>
                <option value="50">50問</option>
              </select>
            </div>
          </div>

          <div class="result-count">
            出題可能: ${this.filteredEntries.length}件
          </div>

          <div class="action-buttons">
            <button id="start-exam-btn" class="primary-button">試験開始</button>
          </div>
        </div>
      </div>
    `,this.attachEventListeners()}renderTagOptions(){return x(this.allEntries).map(e=>{const i=this.selectedTags.includes(e)?"selected":"";return`<option value="${e}" ${i}>${e}</option>`}).join("")}startExam(){if(this.filteredEntries.length<4){alert("試験を開始するには4件以上のデータが必要です");return}this.questions=this.generateQuestions(),this.currentQuestionIndex=0,this.results=[],this.renderQuestionView()}generateQuestions(){const t=Math.min(this.questionCount,this.filteredEntries.length);return[...this.filteredEntries].sort(()=>Math.random()-.5).slice(0,t).map(s=>this.createQuestion(s))}createQuestion(t){const i=this.filteredEntries.filter(r=>r.abbreviation!==t.abbreviation).sort(()=>Math.random()-.5).slice(0,3);let s,n;switch(this.questionType){case"abbr-to-meaning":s=`${t.english} / ${t.japanese}`,n=[s,...i.map(r=>`${r.english} / ${r.japanese}`)];break;case"meaning-to-abbr":s=t.abbreviation,n=[s,...i.map(r=>r.abbreviation)];break;case"morse-to-abbr":s=t.abbreviation,n=[s,...i.map(r=>r.abbreviation)];break}return n=n.sort(()=>Math.random()-.5),{type:this.questionType,entry:t,choices:n,correctAnswer:s}}renderQuestionView(){if(this.currentQuestionIndex>=this.questions.length){this.renderResultView();return}const t=this.questions[this.currentQuestionIndex],e=`問題 ${this.currentQuestionIndex+1} / ${this.questions.length}`;this.container.innerHTML=`
      <div class="exam-mode question-view">
        <div class="exam-header">
          <button id="quit-exam-btn" class="secondary-button">試験を中止</button>
          <div class="progress-indicator">${e}</div>
        </div>

        <div class="question-container">
          ${this.renderQuestion(t)}
        </div>

        <div class="choices-container">
          ${this.renderChoices(t)}
        </div>

        <div id="feedback-area" class="feedback-area"></div>
      </div>
    `,this.attachQuestionEventListeners(),t.type==="morse-to-abbr"&&setTimeout(()=>this.playMorse(t.entry.abbreviation),500)}renderQuestion(t){switch(t.type){case"abbr-to-meaning":return`
          <div class="question-text">
            <p>次の略語の意味を選んでください:</p>
            <p class="question-abbr">${t.entry.abbreviation}</p>
          </div>
        `;case"meaning-to-abbr":return`
          <div class="question-text">
            <p>次の意味に対応する略語を選んでください:</p>
            <p class="question-meaning">${t.entry.english}</p>
            <p class="question-meaning">${t.entry.japanese}</p>
          </div>
        `;case"morse-to-abbr":return`
          <div class="question-text">
            <p>モールス音を聞いて、対応する略語を選んでください:</p>
            <button id="replay-morse-btn" class="control-button">♪ もう一度再生</button>
          </div>
        `}}renderChoices(t){return t.choices.map((e,i)=>`
      <button class="choice-button" data-choice="${e}">
        ${String.fromCharCode(65+i)}. ${e}
      </button>
    `).join("")}renderResultView(){const t=this.results.filter(n=>n.isCorrect).length,e=this.results.length,i=Math.round(t/e*100),s=this.results.filter(n=>!n.isCorrect);this.container.innerHTML=`
      <div class="exam-mode result-view">
        <div class="result-header">
          <h2>試験結果</h2>
        </div>

        <div class="score-display">
          <div class="score-large">${t} / ${e}</div>
          <div class="score-percentage">${i}%</div>
        </div>

        <div class="result-details">
          ${s.length>0?`
            <h3>間違えた問題 (${s.length}問)</h3>
            <div class="wrong-questions">
              ${s.map(n=>this.renderWrongQuestion(n)).join("")}
            </div>
          `:`
            <p class="perfect-score">全問正解です！おめでとうございます！</p>
          `}
        </div>

        <div class="action-buttons">
          <button id="back-to-setup-btn" class="primary-button">設定に戻る</button>
          ${s.length>0?`
            <button id="retry-wrong-btn" class="secondary-button">間違えた問題を復習</button>
          `:""}
        </div>
      </div>
    `,this.attachResultEventListeners()}renderWrongQuestion(t){const{question:e,userAnswer:i}=t;return`
      <div class="wrong-question-item">
        <div class="wrong-q-abbr">${e.entry.abbreviation}</div>
        <div class="wrong-q-correct">正解: ${e.correctAnswer}</div>
        <div class="wrong-q-user">あなたの回答: ${i}</div>
        <div class="wrong-q-meaning">${e.entry.english} / ${e.entry.japanese}</div>
      </div>
    `}attachEventListeners(){const t=this.container.querySelector("#exam-tag-filter");t&&t.addEventListener("change",()=>{const r=Array.from(t.selectedOptions).map(c=>c.value).filter(c=>c);this.selectedTags=r,this.applyFilters(),this.render()});const e=this.container.querySelector("#exam-frequency-filter");e&&(e.value=this.minFrequency.toString(),e.addEventListener("change",()=>{this.minFrequency=parseInt(e.value,10),this.applyFilters(),this.render()}));const i=this.container.querySelector("#question-type");i&&(i.value=this.questionType,i.addEventListener("change",()=>{this.questionType=i.value}));const s=this.container.querySelector("#question-count");s&&(s.value=this.questionCount.toString(),s.addEventListener("change",()=>{this.questionCount=parseInt(s.value,10)}));const n=this.container.querySelector("#start-exam-btn");n&&n.addEventListener("click",()=>this.startExam())}attachQuestionEventListeners(){const t=this.container.querySelector("#quit-exam-btn");t&&t.addEventListener("click",()=>{confirm("試験を中止しますか？")&&this.render()});const e=this.container.querySelector("#replay-morse-btn");e&&e.addEventListener("click",()=>{const s=this.questions[this.currentQuestionIndex];this.playMorse(s.entry.abbreviation)}),this.container.querySelectorAll(".choice-button").forEach(s=>{s.addEventListener("click",()=>{const n=s.getAttribute("data-choice");n&&this.submitAnswer(n)})})}attachResultEventListeners(){const t=this.container.querySelector("#back-to-setup-btn");t&&t.addEventListener("click",()=>this.render());const e=this.container.querySelector("#retry-wrong-btn");e&&e.addEventListener("click",()=>{const i=this.results.filter(s=>!s.isCorrect).map(s=>s.question.entry);this.filteredEntries=i,this.questionCount=i.length,this.startExam()})}submitAnswer(t){const e=this.questions[this.currentQuestionIndex],i=t===e.correctAnswer;this.results.push({question:e,userAnswer:t,isCorrect:i}),this.showFeedback(i,e.correctAnswer),setTimeout(()=>{this.currentQuestionIndex++,this.renderQuestionView()},1500)}showFeedback(t,e){const i=this.container.querySelector("#feedback-area");i&&(i.className=`feedback-area ${t?"correct":"incorrect"}`,i.innerHTML=t?'<div class="feedback-text">✓ 正解！</div>':`<div class="feedback-text">✗ 不正解<br>正解: ${e}</div>`),this.container.querySelectorAll(".choice-button").forEach(n=>{n.disabled=!0})}async playMorse(t){try{d.ensureAudioContext();const e=m.textToMorse(t);e&&await this.playMorseSequence(e)}catch(e){console.error("Error playing morse:",e)}}async playMorseSequence(t){const e=d.audioContext;if(!e)return;const s=1200/l.get("wpm");let n=e.currentTime;for(const r of t)r==="."?(d.scheduleTone(n,s),n+=(s+s)/1e3):r==="-"?(d.scheduleTone(n,s*3),n+=(s*3+s)/1e3):r===" "?n+=s*3/1e3:r==="/"&&(n+=s*7/1e3)}}class I{constructor(){this.modal=null,this.isOpen=!1,this.isPlaying=!1,this.playbackTimeoutId=null,this.savedSettings=null,this.createModal(),this.attachEventListeners(),l.addListener(()=>this.updateUI())}createModal(){const t=document.createElement("div");t.className="settings-modal",t.id="settingsModal";const e=l.getAll();t.innerHTML=`
      <div class="settings-content">
        <div class="settings-grid">
          <div class="setting-item">
            <div class="setting-row">
              <label>音量</label>
              <span class="spacer"></span>
              <input type="range" id="volumeRange" min="0" max="100" value="${e.volume*100}" style="width: 50%;">
              <input type="number" id="volumeInput" min="0" max="100" value="${Math.round(e.volume*100)}">
              <span class="input-suffix">%</span>
            </div>
          </div>
          <div class="setting-item">
            <div class="setting-row">
              <label>周波数 (Hz)</label>
              <span class="spacer"></span>
              <span class="spacer"></span>
              <input type="number" id="globalFrequency" min="400" max="1200" value="${e.frequency}" step="50">
              <span class="input-suffix"></span>
            </div>
          </div>
          <div class="setting-item">
            <div class="setting-row">
              <label>WPM (速度: 5-40)</label>
              <span class="spacer"></span>
              <span class="spacer"></span>
              <input type="number" id="globalWPM" min="5" max="40" value="${e.wpm}">
              <span class="input-suffix"></span>
            </div>
          </div>
          <div class="setting-item">
            <div class="setting-row">
              <label>テスト再生</label>
              <span class="spacer"></span>
              <span class="spacer"></span>
              <button id="testMorseBtn" style="min-width: 100px;">再生</button>
              <span class="input-suffix"></span>
            </div>
          </div>
        </div>
        <div style="display: flex; justify-content: center; gap: 15px; margin-top: 25px;">
          <button id="settingsReset" style="min-width: 120px; padding: 10px 20px; background: linear-gradient(135deg, #888 0%, #666 100%); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all .3s ease;">Cancel</button>
          <button id="settingsOK" style="min-width: 120px; padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all .3s ease;">OK</button>
        </div>
      </div>
    `,document.body.appendChild(t),this.modal=t}open(){if(this.modal){const t=l.getAll();this.savedSettings={volume:t.volume,frequency:t.frequency,wpm:t.wpm},this.modal.classList.add("active"),this.isOpen=!0,this.updateUI()}}close(t=!1){this.modal&&(this.modal.classList.remove("active"),this.isOpen=!1,t?l.save():this.savedSettings&&(l.set("volume",this.savedSettings.volume),l.set("frequency",this.savedSettings.frequency),l.set("wpm",this.savedSettings.wpm)),this.savedSettings=null,this.isPlaying&&(d.stopAllScheduledTones(),this.playbackTimeoutId!==null&&(clearTimeout(this.playbackTimeoutId),this.playbackTimeoutId=null),this.isPlaying=!1,this.updateTestButton()))}updateUI(){if(!this.modal||!this.isOpen)return;const t=l.getAll(),e=this.modal.querySelector("#volumeRange"),i=this.modal.querySelector("#volumeInput");e&&i&&(e.value=String(t.volume*100),i.value=String(Math.round(t.volume*100)));const s=this.modal.querySelector("#globalFrequency");s&&(s.value=String(t.frequency));const n=this.modal.querySelector("#globalWPM");n&&(n.value=String(t.wpm))}attachEventListeners(){if(!this.modal)return;this.modal.addEventListener("click",a=>{a.target===this.modal&&this.close()});const t=this.modal.querySelector("#volumeRange"),e=this.modal.querySelector("#volumeInput");t&&t.addEventListener("input",()=>{const a=parseInt(t.value,10)/100;l.set("volume",a),e&&(e.value=t.value)}),e&&e.addEventListener("input",()=>{const a=parseInt(e.value,10)/100;l.set("volume",Math.max(0,Math.min(1,a))),t&&(t.value=e.value)});const i=this.modal.querySelector("#globalFrequency");i&&i.addEventListener("input",()=>{const a=parseInt(i.value,10);l.set("frequency",Math.max(400,Math.min(1200,a)))});const s=this.modal.querySelector("#globalWPM");s&&s.addEventListener("input",()=>{const a=parseInt(s.value,10);l.set("wpm",Math.max(5,Math.min(40,a)))});const n=this.modal.querySelector("#testMorseBtn");n&&n.addEventListener("click",()=>{this.playTestMorse()});const r=this.modal.querySelector("#settingsReset");r&&r.addEventListener("click",()=>{this.close()});const c=this.modal.querySelector("#settingsOK");c&&c.addEventListener("click",()=>{this.close(!0)})}async playTestMorse(){if(this.isPlaying){d.stopAllScheduledTones(),this.playbackTimeoutId!==null&&(clearTimeout(this.playbackTimeoutId),this.playbackTimeoutId=null),this.isPlaying=!1,this.updateTestButton();return}try{this.isPlaying=!0,this.updateTestButton(),d.ensureAudioContext();const t=m.textToMorse("CQ");t&&await this.playMorseSequence(t),this.isPlaying&&(this.isPlaying=!1,this.updateTestButton())}catch(t){console.error("Error playing test morse:",t),this.isPlaying=!1,this.updateTestButton()}}updateTestButton(){const t=this.modal?.querySelector("#testMorseBtn");t&&(t.textContent=this.isPlaying?"停止":"再生")}async playMorseSequence(t){const e=d.audioContext;if(!e)return;const s=1200/l.get("wpm");let n=e.currentTime;const r=n;for(const a of t)a==="."?(d.scheduleTone(n,s),n+=(s+s)/1e3):a==="-"?(d.scheduleTone(n,s*3),n+=(s*3+s)/1e3):a===" "?n+=s*3/1e3:a==="/"&&(n+=s*7/1e3);const c=(n-r)*1e3;await new Promise(a=>{this.playbackTimeoutId=window.setTimeout(()=>{this.playbackTimeoutId=null,a()},c)})}}class O{constructor(){this.uiControls=null,this.listMode=null,this.flashcardMode=null,this.examMode=null,this.settingsModal=null}async initialize(){try{this.showLoading();const t=await T();console.log(`Loaded ${t.length} flashcard entries`);const e=document.getElementById("app");if(!e)throw new Error("App container not found");this.uiControls=new S(e),this.uiControls.initialize();const i=this.uiControls.getContentContainer();if(!i)throw new Error("Content container not found");this.listMode=new $(i),this.listMode.setData(t),this.flashcardMode=new A(i),this.examMode=new F(i),this.settingsModal=new I;const s=document.getElementById("settingsIcon");s&&this.settingsModal&&s.addEventListener("click",()=>{this.settingsModal?.open()}),this.uiControls.onTabChange("list",()=>{i&&this.listMode&&this.listMode.setData(t)}),this.uiControls.onTabChange("flashcard",()=>{i&&this.flashcardMode&&this.flashcardMode.setData(t)}),this.uiControls.onTabChange("exam",()=>{i&&this.examMode&&this.examMode.setData(t)}),this.hideLoading()}catch(t){console.error("Failed to initialize app:",t),this.showError("アプリケーションの初期化に失敗しました。データファイルを確認してください。")}}showLoading(){const t=document.getElementById("app");t&&(t.innerHTML='<div class="loading">読み込み中...</div>')}hideLoading(){const t=document.querySelector(".loading");t&&t.remove()}showError(t){const e=document.getElementById("app");e&&(e.innerHTML=`<div class="error">${t}</div>`)}}document.addEventListener("DOMContentLoaded",()=>{new O().initialize()});</script>
  <style rel="stylesheet" crossorigin>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,sans-serif;font-size:16px;line-height:1.6;color:#333;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}.settings-icon{position:fixed;top:20px;right:20px;width:50px;height:50px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 15px #0003;z-index:100;transition:all .3s ease}.settings-icon:hover{transform:rotate(90deg) scale(1.1)}.settings-icon svg{width:28px;height:28px;fill:#667eea}.settings-modal{display:none;position:fixed;inset:0;background:#00000080;z-index:200;align-items:center;justify-content:center;padding:20px}.settings-modal.active{display:flex}.settings-content{background:#fff;border-radius:20px;padding:30px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px #0000004d;scrollbar-width:none;-ms-overflow-style:none}.settings-content::-webkit-scrollbar{display:none}.settings-grid{display:grid;grid-template-columns:1fr;gap:20px}.setting-item{display:flex;flex-direction:column;gap:8px}.setting-item label{font-weight:600;color:#555;font-size:15px}.setting-row{display:grid;grid-template-columns:auto 1fr auto auto auto;gap:10px;align-items:center}.spacer{width:100%}.setting-row input[type=number]{width:80px;text-align:center;padding:8px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px}.setting-row input[type=range]{max-width:300px}.input-suffix{display:inline-block;width:20px;text-align:left;justify-self:start}.setting-row button{padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;transition:all .3s ease}.setting-row button:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}#app{max-width:1400px;margin:0 auto;background-color:#fff;border-radius:8px;box-shadow:0 2px 8px #0000001a;padding:20px}.loading,.error{text-align:center;padding:40px;font-size:18px}.error{color:#d32f2f;background-color:#ffebee;border-radius:4px}.tabs{display:flex;gap:8px;border-bottom:2px solid #e0e0e0;margin-bottom:20px}.tab-button{padding:12px 24px;background:none;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:16px;font-weight:500;color:#666;transition:all .2s}.tab-button:hover:not(:disabled){color:#333;background-color:#f5f5f5}.tab-button.active{color:#1976d2;border-bottom-color:#1976d2}.tab-button:disabled{color:#bbb;cursor:not-allowed}.tab-content{min-height:400px}.list-mode{display:flex;flex-direction:column;gap:20px}.filter-section{background-color:#f9f9f9;padding:20px;border-radius:8px;border:1px solid #e0e0e0}.filter-section h2{font-size:24px;margin-bottom:16px;color:#333}.filter-controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:12px}.filter-group{display:flex;flex-direction:column;gap:8px}.filter-group label{font-weight:500;font-size:14px;color:#555}.filter-group select,.filter-group input{padding:8px 12px;border:1px solid #ccc;border-radius:4px;font-size:14px;background-color:#fff}.filter-group select:focus,.filter-group input:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 2px #1976d21a}#tag-filter{min-height:100px}.result-count{text-align:right;font-size:14px;color:#666;margin-top:8px}.table-container{overflow-x:auto;border:1px solid #e0e0e0;border-radius:8px}.flashcard-table{width:100%;border-collapse:collapse;background-color:#fff}.flashcard-table thead{background-color:#f5f5f5;border-bottom:2px solid #e0e0e0}.flashcard-table th{padding:12px 16px;text-align:left;font-weight:600;font-size:14px;color:#555}.flashcard-table td{padding:12px 16px;border-top:1px solid #e0e0e0;font-size:14px}.flashcard-table tbody tr:hover{background-color:#f9f9f9}.abbreviation-cell{text-align:center}.abbreviation-button{padding:10px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-family:Courier New,monospace;font-size:15px;transition:all .3s ease}.abbreviation-button:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.frequency-cell{font-size:18px;color:#ffa726}.tags-cell{font-size:13px;color:#666}.no-results{text-align:center;padding:40px;color:#999;font-size:16px}@media (max-width: 768px){body{padding:10px}#app{padding:15px}.filter-controls{grid-template-columns:1fr}.flashcard-table{font-size:13px}.flashcard-table th,.flashcard-table td{padding:8px 12px}.tab-button{padding:10px 16px;font-size:14px}}:focus{outline:2px solid #1976d2;outline-offset:2px}button:focus,select:focus,input:focus{outline:2px solid #1976d2;outline-offset:2px}.action-buttons{display:flex;gap:12px;margin-top:16px}.primary-button,.secondary-button,.control-button{padding:12px 24px;border-radius:4px;font-size:16px;font-weight:500;cursor:pointer;transition:all .2s;border:none}.primary-button{background-color:#1976d2;color:#fff}.primary-button:hover{background-color:#1565c0}.secondary-button{background-color:#e0e0e0;color:#333}.secondary-button:hover{background-color:#d0d0d0}.control-button{background-color:#4caf50;color:#fff}.control-button:hover{background-color:#45a049}.flashcard-mode{display:flex;flex-direction:column;gap:20px}.learning-view{min-height:600px}.learning-header,.exam-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.progress-indicator{font-size:18px;font-weight:600;color:#666}.card-container{display:flex;justify-content:center;align-items:center;min-height:400px;perspective:1000px}.flashcard{width:100%;max-width:600px;height:400px;position:relative;transform-style:preserve-3d;transition:transform .6s}.flashcard.flipped{transform:rotateY(180deg)}.card-front,.card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border:2px solid #1976d2;border-radius:12px;padding:40px;display:flex;flex-direction:column;justify-content:center;align-items:center;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);box-shadow:0 4px 12px #00000026}.card-back{transform:rotateY(180deg);background:linear-gradient(135deg,#e0f7fa,#80deea)}.card-label{font-size:14px;font-weight:500;color:#666;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}.card-content{font-size:72px;font-weight:700;font-family:Courier New,monospace;color:#1976d2;text-align:center;margin-bottom:20px}.card-content-small{font-size:24px;font-weight:500;color:#333;text-align:center;margin-bottom:12px}.card-tags{font-size:14px;color:#666;margin-top:20px;text-align:center}.play-morse-btn{margin-top:auto;padding:10px 20px;background-color:#1976d2;color:#fff;border:none;border-radius:4px;font-size:14px;cursor:pointer;transition:all .2s}.play-morse-btn:hover{background-color:#1565c0}.card-controls{display:flex;justify-content:center;margin:20px 0}.judgment-controls{display:flex;justify-content:center;gap:20px;margin:20px 0}.judgment-button{padding:16px 32px;border-radius:8px;font-size:18px;font-weight:600;cursor:pointer;border:2px solid;transition:all .2s}.judgment-button.known{background-color:#e8f5e9;color:#2e7d32;border-color:#4caf50}.judgment-button.known:hover,.judgment-button.known.active{background-color:#4caf50;color:#fff}.judgment-button.unknown{background-color:#ffebee;color:#c62828;border-color:#ef5350}.judgment-button.unknown:hover,.judgment-button.unknown.active{background-color:#ef5350;color:#fff}.navigation-controls{display:flex;justify-content:center;gap:20px;margin-top:20px}.nav-button{padding:12px 24px;background-color:#e0e0e0;color:#333;border:none;border-radius:4px;font-size:16px;cursor:pointer;transition:all .2s}.nav-button:hover:not(:disabled){background-color:#d0d0d0}.nav-button:disabled{opacity:.5;cursor:not-allowed}.no-cards{text-align:center;padding:60px 20px;font-size:20px;color:#666}.exam-mode{display:flex;flex-direction:column;gap:20px}.question-view{min-height:600px}.question-container{background-color:#f9f9f9;padding:40px;border-radius:8px;border:1px solid #e0e0e0;margin-bottom:30px}.question-text{font-size:20px;color:#333;margin-bottom:20px}.question-text p{margin-bottom:12px}.question-abbr{font-size:48px;font-weight:700;font-family:Courier New,monospace;color:#1976d2;text-align:center;margin:20px 0}.question-meaning{font-size:18px;font-weight:500;color:#555;text-align:center;margin:12px 0}.choices-container{display:grid;grid-template-columns:1fr;gap:12px;max-width:800px;margin:0 auto}.choice-button{padding:16px 24px;background-color:#fff;border:2px solid #e0e0e0;border-radius:8px;font-size:16px;text-align:left;cursor:pointer;transition:all .2s}.choice-button:hover:not(:disabled){border-color:#1976d2;background-color:#f0f8ff}.choice-button:disabled{cursor:not-allowed;opacity:.6}.feedback-area{margin-top:30px;text-align:center;min-height:60px;display:flex;align-items:center;justify-content:center}.feedback-text{font-size:24px;font-weight:600;padding:20px 40px;border-radius:8px}.feedback-area.correct .feedback-text{background-color:#e8f5e9;color:#2e7d32;border:2px solid #4caf50}.feedback-area.incorrect .feedback-text{background-color:#ffebee;color:#c62828;border:2px solid #ef5350}.result-view{min-height:600px}.result-header h2{font-size:32px;color:#333;text-align:center;margin-bottom:30px}.score-display{text-align:center;padding:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;color:#fff;margin-bottom:40px}.score-large{font-size:64px;font-weight:700;margin-bottom:12px}.score-percentage{font-size:36px;font-weight:500}.result-details{max-width:800px;margin:0 auto}.result-details h3{font-size:24px;color:#333;margin-bottom:20px}.wrong-questions{display:flex;flex-direction:column;gap:16px}.wrong-question-item{background-color:#fff3e0;border:2px solid #ffa726;border-radius:8px;padding:20px}.wrong-q-abbr{font-size:24px;font-weight:700;font-family:Courier New,monospace;color:#1976d2;margin-bottom:12px}.wrong-q-correct{font-size:16px;font-weight:600;color:#2e7d32;margin-bottom:8px}.wrong-q-user{font-size:16px;color:#c62828;margin-bottom:12px}.wrong-q-meaning{font-size:14px;color:#666;font-style:italic}.perfect-score{text-align:center;font-size:24px;font-weight:600;color:#2e7d32;padding:40px;background-color:#e8f5e9;border-radius:8px}@media (max-width: 768px){.card-content{font-size:48px}.card-content-small{font-size:18px}.flashcard{height:300px}.judgment-button{font-size:16px;padding:12px 24px}.score-large{font-size:48px}.score-percentage{font-size:28px}}.settings-panel{max-width:800px;margin:0 auto}.settings-panel h2{font-size:28px;color:#333;margin-bottom:24px}.settings-section{background-color:#f9f9f9;padding:24px;border-radius:8px;border:1px solid #e0e0e0;margin-bottom:20px}.settings-section h3{font-size:20px;color:#555;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid #e0e0e0}.setting-item{margin-bottom:24px}.setting-item:last-child{margin-bottom:0}.setting-item label{display:block;font-weight:600;font-size:15px;color:#333;margin-bottom:12px}.setting-control{display:flex;align-items:center;gap:16px}.setting-range{flex:1;height:8px;border-radius:4px;background:#e0e0e0;outline:none;-webkit-appearance:none;appearance:none}.setting-range::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#1976d2;cursor:pointer;transition:all .2s}.setting-range::-webkit-slider-thumb:hover{background:#1565c0;transform:scale(1.1)}.setting-range::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#1976d2;cursor:pointer;border:none;transition:all .2s}.setting-range::-moz-range-thumb:hover{background:#1565c0;transform:scale(1.1)}.setting-number{width:80px;padding:8px 12px;border:1px solid #ccc;border-radius:4px;font-size:14px;text-align:center}.setting-number:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 2px #1976d21a}.setting-unit{font-size:14px;font-weight:500;color:#666;min-width:40px}.test-section{text-align:center;padding:20px}.test-description{margin-top:12px;font-size:14px;color:#666}.settings-actions{display:flex;justify-content:center;gap:16px;margin:24px 0}.settings-actions button.saved{background-color:#4caf50}.settings-info{background-color:#e3f2fd;border:1px solid #90caf9;border-radius:8px;padding:20px;margin-top:24px}.settings-info h3{font-size:18px;color:#1565c0;margin-bottom:12px}.settings-info ul{list-style:none;padding:0;margin:0 0 16px}.settings-info li{margin-bottom:8px;padding-left:20px;position:relative}.settings-info li:before{content:"•";position:absolute;left:0;color:#1976d2;font-weight:700}.settings-note{font-size:13px;color:#666;font-style:italic;margin-top:12px}@media (max-width: 768px){.settings-panel{padding:0}.setting-control{flex-direction:column;align-items:stretch}.setting-number{width:100%}}</style>
</head>
<body>
  <div class="settings-icon" id="settingsIcon">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
    </svg>
  </div>

  <div id="app"></div>
</body>
</html>
