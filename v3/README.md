# モールス CW略語・Q符号 学習アプリ

CW通信で使用される略語とQ符号を効率的に学習するための教材アプリケーション

## 🎯 特徴

- **包括的な学習データ**: 120以上のCW略語・Q符号・信号レポートを収録
- **タグベース学習**: 柔軟なタグシステムで体系的に学習可能
- **使用頻度対応**: 5段階の使用頻度でよく使う略語を優先学習
- **複数の学習モード**: 一覧表示、フラッシュカード、試験モード
- **モールス再生機能**: 各略語をモールス信号で再生して実践的に学習
- **外部データ読み込み**: TSVファイルから柔軟にデータを管理

## 📋 収録内容

### タグ一覧

各略語には複数のタグ（カンマ区切り）が付与されており、柔軟なフィルタリングが可能です：

- **送受, 制御**: 送受信の制御や動作指示に関する略語
- **確認, 返答**: 確認や返答に使用する略語
- **交信, 状態, Q符号**: 通信状態や信号品質を確認するQ符号
- **出力, 速度, Q符号**: 送信出力や速度調整のQ符号
- **周波数, 通信, Q符号**: 周波数や通信方法に関するQ符号
- **通信, Q符号**: 通信内容や情報伝達のQ符号
- **挨拶, 定型表現**: 挨拶や定型的な表現
- **設備, 用語**: 設備や一般的な用語の略語
- **RST**: RST信号レポート
- **RST, 詳細**: 信号レポートの詳細評価項目（R/S/T個別評価）

**特殊タグ:**
- **疑問**: Q符号の質問形（`?`付き）に付与（全24エントリー）
  - 例: `QSL?`, `QRZ?`, `QRP?`, `QTH?`
  - 質問と回答を区別して学習可能
  - 実際の交信で相手に質問する際の表現を集中学習

**タグシステムの利点:**
- 複数タグによる多角的な分類（例: `交信,状態,Q符号,疑問`）
- タグ組み合わせによる柔軟な検索（例: 「Q符号」だけで絞り込み、「疑問」で質問形のみ抽出）
- 将来的なタグ追加が容易

### 使用頻度分類

- **頻度5**: 最も頻繁に使用される略語
- **頻度4**: よく使用される略語
- **頻度3**: 一般的に使用される略語
- **頻度2**: ときどき使用される略語
- **頻度1**: まれに使用される略語

具体的な略語の一覧は `flashcard.tsv` を参照してください。

## 🚀 使用方法

### モード一覧

アプリケーションは以下の3つのモードで構成されます:

#### 1. 一覧表示モード

全ての略語を表で閲覧できるモード

**機能:**
- タグ別フィルタリング
  - 単一タグ絞り込み（例: 「Q符号」のみ）
  - 複数タグ組み合わせ（例: 「送受」+「制御」）
- 使用頻度別フィルタリング (頻度5のみ、頻度4以上、など)
- タグと頻度の組み合わせフィルタ
- 略語クリックでモールス符号を再生
- ソート機能 (タグ順、使用頻度順、アルファベット順)
- 検索機能
  - 部分一致検索（リアルタイム絞り込み）
  - 検索対象: 略語/英文/和訳/タグ
  - 例: "QSL", "thank", "周波数", "Q符号" など

**表示内容:**
| 略語 | 英文 | 和訳 | 使用頻度 | タグ |
|------|------|------|----------|------|
| K | Go ahead | どうぞ | ⭐⭐⭐⭐⭐ | 送受,制御 |

**操作:**
- フィルタ選択: ドロップダウンメニューで選択
- 略語クリック: モールス符号を音声再生
- 再生速度: 設定でWPMを調整可能

#### 2. フラッシュカードモード

反復学習のための単語カードモード

**機能:**
- タグ・使用頻度でフィルタして学習範囲を選択
- 表面に略語、裏面に意味を表示
- カードめくりアニメーション
- シャッフル機能
- 学習進捗の記録
- 「わかる/わからない」で仕分け
- わからないカードだけを復習
- モールス聴取練習モード
  - 音を聞いて略語を当てる
  - 速度調整 (10-30 WPM)
  - リピート再生機能

**操作:**
- **カードめくり**: クリックまたはスペースキー
- **次のカード**: 右矢印キー または 「次へ」ボタン
- **前のカード**: 左矢印キー または 「前へ」ボタン
- **モールス再生**: 「♪」ボタンで略語を再生
- **わかる**: ○ボタン (緑) - 次回学習時にスキップ
- **わからない**: ×ボタン (赤) - 復習対象として記録

**学習フロー:**
1. タグ・頻度を選択して学習範囲を設定
2. 略語(表面)を見て意味を思い出す
3. カードをめくって答えを確認
4. 「わかる/わからない」を選択
5. 全カード終了後、わからないカードだけを復習

#### 3. 試験モード

理解度を確認するための試験モード

**機能:**
- タグ・使用頻度で出題範囲を選択
- 選択式問題 (4択)
- 記述式問題 (入力式)
- ランダム出題
- 即座に正誤判定
- スコア表示
- 間違えた問題の復習

**出題形式:**
- **パターン1**: 略語を見て意味を選択 (基礎)
- **パターン2**: 意味を見て略語を選択 (応用)
- **パターン3**: モールス音を聞いて略語を選択 (実践)
  - 実際のCW通信で最も重要なスキル
  - 速度調整可能 (10-30 WPM)

**操作:**
- 選択肢クリックで解答
- Enter キーで次の問題
- 試験終了後にスコアと間違えた問題を表示
- 間違えた問題のみ復習可能

## 📖 CW略語・Q符号について

### Q符号とは

Q符号は国際的に標準化された3文字の略語で、アマチュア無線のCW(モールス符号)通信において頻繁に使用されます。限られた符号で効率的に情報を伝達するための重要なツールです。

### Prosign (プロサイン)

Prosign (procedural signal) は、通信プロトコルを簡素化するための特殊な信号です。通常の文字とは異なり、**文字間スペースなしで連続送信**され、句読点や制御文字のような役割を果たします。

- 言語の壁を超えて普遍的に認識される
- 本アプリでは角括弧で表記 (例: `[AR]`, `[SK]`, `[BK]`)
- 送信時は文字間スペースを入れずに一つの符号として送る
- 文の終わり `[AR]`、交信終了 `[SK]`、送受交代 `[BK]` など

参考: [Prosigns for Morse code - Wikipedia](https://en.wikipedia.org/wiki/Prosigns_for_Morse_code)

### その他の略語

CW通信では効率化のため、Q符号以外にも様々な略語が使用されます。挨拶、定型表現、設備・状況を表す用語などが含まれます。

### RST信号レポート

CW通信では相手の信号品質を**RST**の3つの要素で報告します:

- **R (Readability / 了解度)**: 1-5の5段階評価
- **S (Signal Strength / 信号強度)**: 1-9の9段階評価
- **T (Tone / 音質)**: 1-9の9段階評価 (CWのみ)

詳細な略語の意味や使用例は `flashcard.tsv` または一覧表示モードで確認できます。

## 📚 推奨学習パス

効率的に学習するための推奨順序:

### 1. 超頻出20語 (頻度5のみ)
最も頻繁に使用される必須の略語から始める
- K, QSL, 73, CQ, DE, R, TU, C, DX, PSE, TNX, UR, WX, NW など
- 目標: 1-2日で完全マスター

### 2. 送受信制御 (タグ別)
交信の基本フローを理解
- タグ: `送受,制御`
- [BK], [AR], [SK], [VA], [BT] など
- 目標: 実際の交信の流れを把握

### 3. Q符号基礎 (頻度4-5)
よく使うQ符号を習得
- タグ: `Q符号`（全Q符号を横断検索）
- 質問形の学習: タグ `疑問` で質問形のみ抽出可能
- QRP, QRO, QRS, QTH, QSO, QRZ など
- 目標: 基本的な交信が可能に

### 4. 全タグ (頻度3以上)
一般的に使用される略語を網羅
- 目標: 実践的な交信に対応可能

### 5. 完全マスター (全120語)
全ての略語を習得し、応用力を養う
- 目標: あらゆる状況に対応

**実装予定:** プリセットフィルタ機能により、上記の学習パスをワンクリックで選択可能

## 🛠️ 開発予定

### Phase 1: 基本機能実装
- [x] CW略語・Q符号データの準備 (flashcard.tsv, 120+項目)
- [ ] TSVファイル読み込み機能
- [ ] データパース・フィルタリング機能
  - [ ] タグのカンマ区切りパース
  - [ ] 複数タグによる絞り込みロジック
- [ ] 一覧表示モード
  - [ ] タグ/使用頻度フィルタ
  - [ ] 検索機能（タグも検索対象に含む）
  - [ ] ソート機能

### Phase 2: 学習機能実装
- [ ] フラッシュカードモード
  - [ ] カード表示UI
  - [ ] カードめくりアニメーション
  - [ ] 「わかる/わからない」判定
  - [ ] 学習進捗の保存 (LocalStorage)
  - [ ] モールス聴取練習モード
- [ ] 試験モード
  - [ ] 4択問題生成
  - [ ] 正誤判定
  - [ ] スコア表示
  - [ ] 間違い問題の復習
- [ ] 間隔反復学習 (SRS: Spaced Repetition System)
  - [ ] SM-2アルゴリズムの実装
  - [ ] 復習タイミング自動計算
  - [ ] 習熟度の5段階評価 (Again, Hard, Good, Easy, Perfect)
  - [ ] 次回復習日の表示
- [ ] 学習パスのプリセット機能
  - [ ] 「超頻出20語」（頻度5）のワンクリック選択
  - [ ] 「送受信制御」（タグ: `送受,制御`）のワンクリック選択
  - [ ] 「全Q符号」（タグ: `Q符号`）のワンクリック選択
  - [ ] 「Q符号質問形」（タグ: `疑問`）のワンクリック選択

### Phase 3: モールス機能統合
- [ ] v2の音声システム統合
  - [ ] AudioSystem クラスの統合
  - [ ] MorseCode 変換ロジックの統合
- [ ] 一覧モードでのモールス再生
- [ ] フラッシュカードモードでのモールス再生
- [ ] 試験モードでのモールス聴取問題

### Phase 4: 応用機能
- [ ] 学習統計・グラフ表示
  - [ ] 学習時間の記録
  - [ ] タグ別習熟度グラフ
  - [ ] 学習履歴カレンダー
- [ ] モールス入力練習モード
  - [ ] キーボード入力でモールス信号を送信
  - [ ] 自動デコードと正誤判定
- [ ] QSO会話シミュレーション
  - [ ] 典型的な交信の流れを学習
    1. CQ呼び出し: "CQ CQ DE JA1ABC K"
    2. 応答: "JA1ABC DE JH2XYZ PSE K"
    3. RST交換: "UR RST 599 QTH TOKYO TU K"
    4. 雑談: "WX HR FN OP NAME IS TARO"
    5. 終了: "73 GL [SK]"
  - [ ] 各ステップで適切な略語を選択
  - [ ] モールス音声で再生
  - [ ] 間違いを指摘・解説
  - [ ] コンテストQSO、DXペディションなど複数のシナリオ
- [ ] カスタムデータセット対応
  - [ ] ユーザー独自のTSVファイルをインポート
  - [ ] 特定のコンテスト用略語セットなど

## 📁 ファイル構成

```
v3/
├── README.md              # このファイル
├── index.html             # 本番用ファイル (ビルド済み)
└── src/                   # 開発環境
    ├── src/                   # TypeScriptソースコード
    │   ├── main.ts                # エントリーポイント
    │   ├── flashcard-data.ts      # TSVデータ読み込み・パース（タグのカンマ分割含む）
    │   ├── list-mode.ts           # 一覧表示モード
    │   ├── flashcard-mode.ts      # フラッシュカードモード
    │   ├── exam-mode.ts           # 試験モード
    │   ├── audio-system.ts        # モールス音声生成 (v2から)
    │   ├── morse-code.ts          # モールス符号変換 (v2から)
    │   ├── settings.ts            # 設定管理
    │   └── ui-controls.ts         # UI制御とタブ管理
    ├── data/
    │   └── flashcard.tsv          # 学習データ (TSV形式)
    ├── index.html             # 開発用HTMLテンプレート
    ├── style.css              # スタイルシート
    ├── package.json           # 依存関係定義
    ├── tsconfig.json          # TypeScript設定
    └── vite.config.ts         # Viteビルド設定
```

## 📊 データフォーマット (flashcard.tsv)

TSV (タブ区切り) 形式で以下の5カラムから構成:

| カラム名 | 説明 | 例 |
|---------|------|-----|
| タグ | 略語の分類（カンマ区切りで複数指定可能） | 送受,制御 |
| 使用頻度 | 1-5の数値 (5が最頻出) | 5 |
| 略語 | CW略語・Q符号 | K |
| 英文 | 英語の意味 | Go ahead, invite reply |
| 和訳 | 日本語の意味 | どうぞ(送信をどうぞ) |

**データ例:**
```tsv
タグ	使用頻度	略語	英文	和訳
送受,制御	5	K	Go ahead, invite reply	どうぞ(送信をどうぞ)
確認,返答	5	QSL	I acknowledge receipt	了解しました(QSLカードの意)
確認,返答,疑問	4	QSL?	Can you acknowledge receipt?	受信確認できますか？
交信,状態,Q符号,疑問	5	QRZ?	Who is calling me?	誰が私を呼んでいますか？
出力,速度,Q符号,疑問	5	QRP?	Shall I decrease power?	出力を下げましょうか？
出力,速度,Q符号	5	QRP	Decrease power	出力を下げてください
RST	5	RST 599	Perfectly readable, extremely strong, pure tone	完全に了解でき、非常に強く、純粋な音
```

**タグシステムの特徴:**
- 1行目はヘッダー行
- 各フィールドはタブ(`\t`)で区切られる
- **タグはカンマ区切りで複数指定可能**（例: `交信,状態,Q符号,疑問`）
- 欧文2文字略語（Prosign）は `[AR]`, `[SK]` のように角括弧で表記
- Q符号の質問形（`?`付き）には「疑問」タグを付与
- Q符号の質問形と回答形は別エントリーとして記録

**タグベースシステムの利点:**
- 柔軟な分類: 1つの略語に複数の観点からタグ付け可能
- 横断検索: 「Q符号」タグで全Q符号を一括検索、「疑問」タグで質問形のみ抽出
- 学習モード別対応: 「疑問」タグで質問と回答を区別して学習可能
- 拡張性: 新しいタグを自由に追加可能（例: `初心者向け`, `コンテスト`, `DX`など）

**将来の拡張案:**
- タイプ列の追加（prosign/qcode/abbreviation）でデータ種別を明示
- モールス符号列の追加で変換処理を効率化
- Q符号の質問形/回答形を1エントリーに統合する可能性

## 🚀 開発・ビルド

### セットアップ

v2の開発環境をベースに構築します:

```bash
cd v3/src
npm install
```

### 開発サーバー

```bash
npm run dev
```

開発サーバーが起動し、ホットリロード機能が有効になります。
→ http://localhost:3000

### ビルド

```bash
npm run build
```

`src/dist/index.html`に最適化された単一HTMLファイルが生成されます。

```bash
# 本番用ファイルとして配置
cp dist/index.html ../index.html
```

### プレビュー

```bash
npm run preview
```

ビルド後のファイルをローカルサーバーでプレビューします。

## 📋 技術スタック

| 技術 | バージョン | 用途 |
|------|-----------|------|
| TypeScript | 5.9.3 | 型安全な開発 |
| Vite | 7.1.8 | ビルドツール |
| vite-plugin-singlefile | - | 単一HTMLファイル化 |
| Web Audio API | - | モールス信号音声生成 |
| LocalStorage API | - | 学習進捗の永続化 |

## 📚 v2との違い

| 項目 | v2 (モールス練習) | v3 (学習アプリ) |
|------|------------------|-----------------|
| 主目的 | モールス信号の送受信練習 | CW略語・Q符号の学習 |
| 入力方式 | 電鍵シミュレーション | データ読み込み・選択式 |
| データ | モールス符号表 (固定) | TSVファイル (外部・拡張可能) |
| 学習機能 | なし | フラッシュカード・試験モード・SRS |
| フィルタ | なし | タグ・使用頻度別（複数タグ対応） |
| 進捗管理 | なし | LocalStorageで保存 |
| 音声再生 | 入力に応じて再生 | 略語選択で再生 |

## 🌐 ブラウザ互換性

- Chrome/Edge: ✅ 完全対応
- Firefox: ✅ 完全対応
- Safari: ✅ 対応 (一部制限あり)

## 📚 データソース

収録データは以下の資料を参考に作成:

- **ARRL公式資料**: [Q Signals](http://www.arrl.org/q-signals)
- **ITU勧告**: 国際電気通信連合の標準Q符号
- **JARL推奨**: 日本アマチュア無線連盟の推奨略語
- **実運用データ**: アマチュア無線家の実際の使用頻度を反映

使用頻度の評価基準:
- コンテスト、ラグチュー、DXペディション等の実際の交信ログを分析
- 初心者向けCW教本での出現頻度
- JARLおよびARRLの推奨度

## ♿ アクセシビリティ

本アプリケーションは以下のアクセシビリティ対応を予定:

### Phase 1での対応
- **キーボードナビゲーション**: Tab/矢印キーでの完全操作
- **カラーコントラスト**: WCAG 2.1 AA準拠 (4.5:1以上)
- **フォーカスインジケータ**: 明確なフォーカス表示

### Phase 2での対応
- **ARIA属性**: スクリーンリーダー対応
  - `role`, `aria-label`, `aria-live`の適切な使用
- **ショートカットキー**: 全機能にキーボードショートカット提供
  - 一覧: `/` (検索), `f` (フィルタ), `s` (ソート)
  - カード: Space (めくる), ← → (前後), `r` (音声再生)
  - 試験: 1-4 (選択肢), Enter (次へ)

### Phase 3での対応
- **音声読み上げ**: モールス音声とスクリーンリーダーの両立
- **字幕/テキスト**: 音声のテキスト代替提供
