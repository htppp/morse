import{w as t,k as e,$ as n,x as s,P as i,W as a,Y as r,K as o,B as d,G as c,I as l,M as u,N as h,F as p}from"./morse-engine-a8OruELh.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class v{menuItems=[{id:"vertical",title:"ç¸¦æŒ¯ã‚Šé›»éµç·´ç¿’",description:"ä¸Šä¸‹ã«å‹•ã‹ã™é›»éµï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã‚­ãƒ¼ï¼‰ã®ç·´ç¿’",route:"vertical"},{id:"horizontal",title:"æ¨ªæŒ¯ã‚Šé›»éµç·´ç¿’",description:"å·¦å³ã«å‹•ã‹ã™é›»éµï¼ˆãƒ‘ãƒ‰ãƒ«ï¼‰ã®ç·´ç¿’ï¼ˆIambic A/Bå¯¾å¿œï¼‰",route:"horizontal"},{id:"flashcard",title:"CWç•¥èªãƒ»Qç¬¦å·",description:"CWé€šä¿¡ã§ä½¿ç”¨ã•ã‚Œã‚‹ç•¥èªã¨Qç¬¦å·ã‚’å­¦ç¿’",route:"flashcard"},{id:"koch",title:"ã‚³ãƒƒãƒ›æ³•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",description:"æ®µéšçš„ã«æ–‡å­—ã‚’å¢—ã‚„ã—ã¦å­¦ç¿’ã™ã‚‹æ–¹å¼",route:"koch"},{id:"listening",title:"ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·èãå–ã‚Šç·´ç¿’",description:"ãƒ©ãƒ³ãƒ€ãƒ QSOã‚„è‹±æ–‡ã‚’èã„ã¦ç·´ç¿’",route:"listening"}];render(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="container">\n\t\t\t\t<header class="menu-header">\n\t\t\t\t\t<h1>ãƒ¢ãƒ¼ãƒ«ã‚¹ç·´ç¿’ã‚¢ãƒ—ãƒª</h1>\n\t\t\t\t\t<p class="version">v10 - Engine/GUIåˆ†é›¢ç‰ˆ</p>\n\t\t\t\t</header>\n\n\t\t\t\t<main class="menu-main">\n\t\t\t\t\t<div class="menu-grid">\n\t\t\t\t\t\t${this.menuItems.map(t=>this.renderMenuItem(t)).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</main>\n\n\t\t\t\t<footer class="menu-footer">\n\t\t\t\t\t<p>&copy; 2025 ãƒ¢ãƒ¼ãƒ«ã‚¹ç·´ç¿’ã‚¢ãƒ—ãƒª</p>\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`,
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã€‚
this.attachEventListeners())}renderMenuItem(t){return`\n\t\t\t<div class="menu-item" data-route="${t.route}">\n\t\t\t\t<h2 class="menu-item-title">${t.title}</h2>\n\t\t\t\t<p class="menu-item-description">${t.description}</p>\n\t\t\t</div>\n\t\t`}attachEventListeners(){document.querySelectorAll(".menu-item").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-route");e&&(window.location.hash=`#${e}`)})})}destroy(){
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯æ–°ã—ã„HTMLã§ä¸Šæ›¸ãã•ã‚Œã‚‹ãŸã‚ã€ç‰¹ã«å‡¦ç†ä¸è¦ã€‚
}}class m{trainer;buffer;timer;audio;isKeyPressed=!1;keyPressHandler=null;keyReleaseHandler=null;updateIntervalId=null;currentWPM=20;keyCode="Space";latestEvaluation=null;overallStats=null;dotStats=null;dashStats=null;constructor(){
//! è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€‚
const a=localStorage.getItem("verticalKeyWPM");a&&(this.currentWPM=parseInt(a,10));const r=localStorage.getItem("verticalKeyCode");r&&(this.keyCode=r),
//! ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆæœŸåŒ–ã€‚
this.buffer=new t,this.timer=new e,this.audio=new n({frequency:700,volume:.5,wpm:this.currentWPM});
//! ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨ˆç®—ã€‚
const o=s.calculate(this.currentWPM);
//! ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’åˆæœŸåŒ–ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§éŸ³å£°åˆ¶å¾¡ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°è©•ä¾¡ï¼‰ã€‚
this.trainer=new i(this.buffer,this.timer,o,{onKeyPress:()=>{
//! ã‚­ãƒ¼æŠ¼ä¸‹æ™‚ã«éŸ³ã‚’é³´ã‚‰ã™ã€‚
this.audio.startContinuousTone()},onKeyRelease:()=>{
//! ã‚­ãƒ¼è§£æ”¾æ™‚ã«éŸ³ã‚’æ­¢ã‚ã‚‹ã€‚
this.audio.stopContinuousTone()},onTimingEvaluated:t=>{
//! ã‚¿ã‚¤ãƒŸãƒ³ã‚°è©•ä¾¡çµæœã‚’ä¿å­˜ã€‚
this.latestEvaluation=t,this.updateTimingStatistics()}})}render(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>ç¸¦æŒ¯ã‚Šé›»éµç·´ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="key-button-container">\n\t\t\t\t\t<button class="key-button" id="morse-key">\n\t\t\t\t\t\tKEY\n\t\t\t\t\t\t<span class="key-label">(ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—ã§é€ä¿¡)</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="practice-container">\n\t\t\t\t\t<div class="display-area">\n\t\t\t\t\t\t<div class="display-section">\n\t\t\t\t\t\t\t<h3>ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·</h3>\n\t\t\t\t\t\t\t<div class="display-output morse-buffer" id="morse-buffer">ï¼ˆã“ã“ã«ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="display-section">\n\t\t\t\t\t\t\t<h3>ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ</h3>\n\t\t\t\t\t\t\t<div class="display-output" id="decoded-text">ï¼ˆã“ã“ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="action-area">\n\t\t\t\t\t\t<button class="btn btn-large btn-danger" id="clear-btn">ã‚¯ãƒªã‚¢</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="status-area">\n\t\t\t\t\t\t<div class="status-item">\n\t\t\t\t\t\t\t<span class="label">ç¾åœ¨ã®é€Ÿåº¦</span>\n\t\t\t\t\t\t\t<span class="value" id="current-wpm">${this.currentWPM}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="status-item" id="key-status">\n\t\t\t\t\t\t\t<span class="label">ã‚­ãƒ¼çŠ¶æ…‹</span>\n\t\t\t\t\t\t\t<span class="value">è§£æ”¾</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="status-item">\n\t\t\t\t\t\t\t<span class="label">å…¥åŠ›æ–‡å­—æ•°</span>\n\t\t\t\t\t\t\t<span class="value" id="char-count">0</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="timing-evaluation-area">\n\t\t\t\t\t\t<h3>ã‚¿ã‚¤ãƒŸãƒ³ã‚°è©•ä¾¡</h3>\n\t\t\t\t\t\t<div class="evaluation-panel">\n\t\t\t\t\t\t\t<div class="latest-evaluation">\n\t\t\t\t\t\t\t\t<h4>æœ€æ–°ã®å…¥åŠ›</h4>\n\t\t\t\t\t\t\t\t<div id="latest-evaluation-content" class="evaluation-content">\n\t\t\t\t\t\t\t\t\tï¼ˆå…¥åŠ›å¾…ã¡ï¼‰\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="statistics-panel">\n\t\t\t\t\t\t\t\t<h4>å…¨ä½“çµ±è¨ˆ</h4>\n\t\t\t\t\t\t\t\t<div id="overall-stats-content" class="stats-content">\n\t\t\t\t\t\t\t\t\tï¼ˆçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="element-stats-panel">\n\t\t\t\t\t\t\t\t<div class="dot-stats">\n\t\t\t\t\t\t\t\t\t<h4>çŸ­ç‚¹ (ãƒ») çµ±è¨ˆ</h4>\n\t\t\t\t\t\t\t\t\t<div id="dot-stats-content" class="stats-content">\n\t\t\t\t\t\t\t\t\t\tï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="dash-stats">\n\t\t\t\t\t\t\t\t\t<h4>é•·ç‚¹ (ãƒ¼) çµ±è¨ˆ</h4>\n\t\t\t\t\t\t\t\t\t<div id="dash-stats-content" class="stats-content">\n\t\t\t\t\t\t\t\t\t\tï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¾ãŸã¯ç”»é¢ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã„ã‚‹é–“ã€ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ãŒé€ä¿¡ã•ã‚Œã¾ã™</li>\n\t\t\t\t\t\t\t<li>çŸ­ãæŠ¼ã™ã¨ã€Œãƒ»ã€(dit)ã€é•·ãæŠ¼ã™ã¨ã€Œãƒ¼ã€(dah)ã«ãªã‚Šã¾ã™</li>\n\t\t\t\t\t\t\t<li>æ–‡å­—é–“ã¯è‡ªå‹•çš„ã«åˆ¤å®šã•ã‚Œã¾ã™</li>\n\t\t\t\t\t\t\t<li>WPMï¼ˆWords Per Minuteï¼‰ã§é€Ÿåº¦ã‚’èª¿æ•´ã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>ç”»é¢å³ä¸Šã®âš™ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰éŸ³é‡ãƒ»å‘¨æ³¢æ•°ãƒ»é€Ÿåº¦ã‚’èª¿æ•´ã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>éŸ³å£°ãŒé³´ã‚‰ãªã„å ´åˆã¯ã€ä¸€åº¦ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒãƒªã‚·ãƒ¼ï¼‰</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã€‚
this.attachEventListeners(),
//! å®šæœŸæ›´æ–°ã‚’é–‹å§‹ã€‚
this.startUpdate())}attachEventListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const t=document.querySelector(".back-btn");t?.addEventListener("click",()=>{window.location.hash="#menu"}),
//! è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã€‚
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.openSettingsModal()});
//! ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("clear-btn");e?.addEventListener("click",()=>{this.trainer.clear(),this.updateDisplay()}),
//! ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆè¨­å®šã•ã‚ŒãŸã‚­ãƒ¼ï¼‰ã€‚
this.keyPressHandler=t=>{t.code!==this.keyCode||t.repeat||(t.preventDefault(),this.isKeyPressed||this.handleKeyDown())},this.keyReleaseHandler=t=>{t.code===this.keyCode&&(t.preventDefault(),this.isKeyPressed&&this.handleKeyUp())},window.addEventListener("keydown",this.keyPressHandler),window.addEventListener("keyup",this.keyReleaseHandler);
//! ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒï¼‰ã€‚
const n=document.getElementById("morse-key");n&&(
//! ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã€‚
n.addEventListener("mousedown",t=>{t.preventDefault(),this.isKeyPressed||this.handleKeyDown()}),n.addEventListener("mouseup",t=>{t.preventDefault(),this.isKeyPressed&&this.handleKeyUp()}),n.addEventListener("mouseleave",()=>{this.isKeyPressed&&this.handleKeyUp()}),
//! ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã€‚
n.addEventListener("touchstart",t=>{t.preventDefault(),this.isKeyPressed||this.handleKeyDown()}),n.addEventListener("touchend",t=>{t.preventDefault(),this.isKeyPressed&&this.handleKeyUp()}),n.addEventListener("touchcancel",()=>{this.isKeyPressed&&this.handleKeyUp()}))}handleKeyDown(){this.isKeyPressed=!0,this.trainer.keyPress(),this.updateKeyStatus(!0);
//! ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°ã€‚
const t=document.getElementById("morse-key");t&&t.classList.add("pressed")}handleKeyUp(){this.isKeyPressed=!1,this.trainer.keyRelease(),this.updateKeyStatus(!1);
//! ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°ã€‚
const t=document.getElementById("morse-key");t&&t.classList.remove("pressed")}startUpdate(){
//! 100msã”ã¨ã«ç”»é¢ã‚’æ›´æ–°ã€‚
this.updateIntervalId=window.setInterval(()=>{this.updateDisplay()},100)}updateDisplay(){const t=document.getElementById("morse-buffer"),e=document.getElementById("decoded-text"),n=document.getElementById("char-count");if(t){const e=this.trainer.getBuffer(),n=this.trainer.getSequence(),s=n?`${e} ${n}`:e;t.textContent=s||"ï¼ˆã“ã“ã«ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}if(e){const t=this.trainer.getDecoded();e.textContent=t||"ï¼ˆã“ã“ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}if(n){const t=this.trainer.getDecoded();n.textContent=t.length.toString()}
//! ã‚¿ã‚¤ãƒŸãƒ³ã‚°è©•ä¾¡è¡¨ç¤ºã‚’æ›´æ–°ã€‚
this.updateTimingDisplay()}updateTimingStatistics(){this.overallStats=this.trainer.getTimingStatistics();const t=this.trainer.getStatisticsByElement();this.dotStats=t.dot,this.dashStats=t.dash}updateTimingDisplay(){
//! æœ€æ–°è©•ä¾¡ã‚’è¡¨ç¤ºã€‚
const t=document.getElementById("latest-evaluation-content");if(t&&this.latestEvaluation){const e=this.latestEvaluation,n="."===e.record.element?"çŸ­ç‚¹ (ãƒ»)":"é•·ç‚¹ (ãƒ¼)",i=e.accuracy.toFixed(1),a=this.getAccuracyClass(e.accuracy),r=s.calculate(this.currentWPM).dot,o=8*r,d=e.record.expectedDuration,c=e.record.actualDuration,l=d/o*100,u=c/o*100,h=c-d,p=h>0?"longer":h<0?"shorter":"perfect",v=h>0?`+${h}ms (é•·ã„)`:h<0?`${h}ms (çŸ­ã„)`:"å®Œç’§";t.innerHTML=`\n\t\t\t\t<div class="eval-item">\n\t\t\t\t\t<span class="eval-label">è¦ç´ :</span>\n\t\t\t\t\t<span class="eval-value">${n}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="timing-chart">\n\t\t\t\t\t<div class="chart-row">\n\t\t\t\t\t\t<div class="chart-label">ç†è«–å€¤:</div>\n\t\t\t\t\t\t<div class="chart-bar-container">\n\t\t\t\t\t\t\t<div class="chart-bar expected" style="width: ${l}%">\n\t\t\t\t\t\t\t\t<span class="chart-value">${d}ms</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chart-row">\n\t\t\t\t\t\t<div class="chart-label">å®Ÿæ¸¬å€¤:</div>\n\t\t\t\t\t\t<div class="chart-bar-container">\n\t\t\t\t\t\t\t<div class="chart-bar actual ${a}" style="width: ${u}%">\n\t\t\t\t\t\t\t\t<span class="chart-value">${c}ms</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chart-scale">\n\t\t\t\t\t\t<span>0ms</span>\n\t\t\t\t\t\t<span>${Math.round(4*r)}ms</span>\n\t\t\t\t\t\t<span>${Math.round(o)}ms</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="eval-item">\n\t\t\t\t\t<span class="eval-label">ç²¾åº¦:</span>\n\t\t\t\t\t<span class="eval-value accuracy-${a}">${i}%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="eval-item">\n\t\t\t\t\t<span class="eval-label">èª¤å·®:</span>\n\t\t\t\t\t<span class="eval-value timing-diff-${p}">${v}</span>\n\t\t\t\t</div>\n\t\t\t`}
//! å…¨ä½“çµ±è¨ˆã‚’è¡¨ç¤ºã€‚
const e=document.getElementById("overall-stats-content");if(e&&this.overallStats&&this.overallStats.count>0){const t=this.overallStats,n=this.getAccuracyClass(t.averageAccuracy);e.innerHTML=`\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å…¥åŠ›æ•°:</span>\n\t\t\t\t\t<span class="stat-value">${t.count}å›</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å¹³å‡ç²¾åº¦:</span>\n\t\t\t\t\t<span class="stat-value accuracy-${n}">${t.averageAccuracy.toFixed(1)} Â± ${t.standardDeviation.toFixed(1)}%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">æœ€é«˜ç²¾åº¦:</span>\n\t\t\t\t\t<span class="stat-value">${t.maxAccuracy.toFixed(1)}%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">æœ€ä½ç²¾åº¦:</span>\n\t\t\t\t\t<span class="stat-value">${t.minAccuracy.toFixed(1)}%</span>\n\t\t\t\t</div>\n\t\t\t`}
//! çŸ­ç‚¹çµ±è¨ˆã‚’è¡¨ç¤ºã€‚
const n=document.getElementById("dot-stats-content");if(n&&this.dotStats&&this.dotStats.count>0){const t=this.dotStats,e=this.getAccuracyClass(t.averageAccuracy);n.innerHTML=`\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å…¥åŠ›æ•°:</span>\n\t\t\t\t\t<span class="stat-value">${t.count}å›</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å¹³å‡ç²¾åº¦:</span>\n\t\t\t\t\t<span class="stat-value accuracy-${e}">${t.averageAccuracy.toFixed(1)} Â± ${t.standardDeviation.toFixed(1)}%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å¹³å‡èª¤å·®:</span>\n\t\t\t\t\t<span class="stat-value">${t.averageAbsoluteError.toFixed(1)}ms</span>\n\t\t\t\t</div>\n\t\t\t`}
//! é•·ç‚¹çµ±è¨ˆã‚’è¡¨ç¤ºã€‚
const i=document.getElementById("dash-stats-content");if(i&&this.dashStats&&this.dashStats.count>0){const t=this.dashStats,e=this.getAccuracyClass(t.averageAccuracy);i.innerHTML=`\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å…¥åŠ›æ•°:</span>\n\t\t\t\t\t<span class="stat-value">${t.count}å›</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å¹³å‡ç²¾åº¦:</span>\n\t\t\t\t\t<span class="stat-value accuracy-${e}">${t.averageAccuracy.toFixed(1)} Â± ${t.standardDeviation.toFixed(1)}%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="stat-item">\n\t\t\t\t\t<span class="stat-label">å¹³å‡èª¤å·®:</span>\n\t\t\t\t\t<span class="stat-value">${t.averageAbsoluteError.toFixed(1)}ms</span>\n\t\t\t\t</div>\n\t\t\t`}}getAccuracyClass(t){return t>=90?"excellent":t>=70?"good":t>=50?"fair":"poor"}updateKeyStatus(t){const e=document.getElementById("key-status");if(e){const n=e.querySelector(".value");n&&(n.textContent=t?"æŠ¼ä¸‹ä¸­":"è§£æ”¾"),t?e.classList.add("active"):e.classList.remove("active")}}openSettingsModal(){
//! ç¾åœ¨ã®è¨­å®šå€¤ã‚’å–å¾—ã€‚
const t={volume:Math.round(100*this.audio.getVolume()),frequency:this.audio.getFrequency(),wpm:this.currentWPM,keyCode:this.keyCode},e={volume:this.audio.getVolume(),frequency:this.audio.getFrequency(),wpm:this.currentWPM,keyCode:this.keyCode};
//! è¨­å®šå¤‰æ›´å‰ã®å€¤ã‚’ä¿å­˜ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å¾©å…ƒç”¨ï¼‰ã€‚
//! ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã€‚
new a("vertical-key-settings-modal",r,t,{onSave:t=>{
//! è¨­å®šã‚’ä¿å­˜ã€‚
this.audio.setVolume(t.volume/100),this.audio.setFrequency(t.frequency),this.audio.setWPM(t.wpm),this.currentWPM=t.wpm,this.keyCode=t.keyCode,
//! localStorageã«ä¿å­˜ã€‚
localStorage.setItem("verticalKeyWPM",this.currentWPM.toString()),localStorage.setItem("verticalKeyCode",this.keyCode);
//! ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å†è¨ˆç®—ã—ã¦ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’å†åˆæœŸåŒ–ã€‚
const e=s.calculate(this.currentWPM);this.trainer=new i(this.buffer,this.timer,e,{onKeyPress:()=>{this.audio.startContinuousTone()},onKeyRelease:()=>{this.audio.stopContinuousTone()},onTimingEvaluated:t=>{this.latestEvaluation=t,this.updateTimingStatistics()}});
//! ç¾åœ¨ã®WPMè¡¨ç¤ºã‚’æ›´æ–°ã€‚
const n=document.getElementById("current-wpm");n&&(n.textContent=this.currentWPM.toString())},onCancel:()=>{
//! è¨­å®šã‚’å…ƒã«æˆ»ã™ã€‚
this.audio.setVolume(e.volume),this.audio.setFrequency(e.frequency),this.audio.setWPM(e.wpm),this.currentWPM=e.wpm,this.keyCode=e.keyCode}}).show("vertical-key")}destroy(){
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã€‚
this.keyPressHandler&&(window.removeEventListener("keydown",this.keyPressHandler),this.keyPressHandler=null),this.keyReleaseHandler&&(window.removeEventListener("keyup",this.keyReleaseHandler),this.keyReleaseHandler=null),
//! å®šæœŸæ›´æ–°ã‚’åœæ­¢ã€‚
null!==this.updateIntervalId&&(clearInterval(this.updateIntervalId),this.updateIntervalId=null),
//! éŸ³å£°ã‚’åœæ­¢ã€‚
this.audio.stopContinuousTone(),
//! ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢ã€‚
this.trainer.clear()}}class g{trainer;buffer;timer;audio;timings;leftPressed=!1;rightPressed=!1;updateIntervalId=null;currentWPM=20;iambicMode="B";paddleLayout="normal";leftKeyCode="KeyJ";rightKeyCode="KeyK";keyPressHandler=null;keyReleaseHandler=null;constructor(){
//! è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€‚
const s=localStorage.getItem("horizontalKeyWPM");s&&(this.currentWPM=parseInt(s,10));const i=localStorage.getItem("horizontalKeyIambicMode");"A"!==i&&"B"!==i||(this.iambicMode=i);const a=localStorage.getItem("horizontalKeyPaddleLayout");"normal"!==a&&"reversed"!==a||(this.paddleLayout=a);const r=localStorage.getItem("horizontalKeyLeftCode");r&&(this.leftKeyCode=r);const o=localStorage.getItem("horizontalKeyRightCode");o&&(this.rightKeyCode=o),
//! ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆæœŸåŒ–ã€‚
this.buffer=new t,this.timer=new e,this.audio=new n({frequency:700,volume:.5,wpm:this.currentWPM}),
//! ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’åˆæœŸåŒ–ã€‚
this.initializeTrainer()}initializeTrainer(){this.timings=s.calculate(this.currentWPM),this.trainer=new o(this.buffer,this.timer,this.timings,{onElementStart:(t,e)=>{
//! è¦ç´ é€ä¿¡é–‹å§‹æ™‚ã«æŒ‡å®šæ™‚é–“ã ã‘éŸ³ã‚’é³´ã‚‰ã™ã€‚
this.audio.scheduleTone(0,e)},onSpacingEvaluated:()=>{
//! ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°è©•ä¾¡ãŒå®Œäº†ã—ãŸã‚‰ç”»é¢ã‚’æ›´æ–°ã€‚
this.updateDisplay()}},{iambicMode:this.iambicMode,paddleLayout:this.paddleLayout})}render(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>æ¨ªæŒ¯ã‚Šé›»éµç·´ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="paddle-container">\n\t\t\t\t\t<button class="paddle-button dit" id="left-paddle">\n\t\t\t\t\t\tDIT\n\t\t\t\t\t\t<span class="paddle-label">(çŸ­ç‚¹)</span>\n\t\t\t\t\t\t<span class="paddle-key">J ã‚­ãƒ¼</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="paddle-button dah" id="right-paddle">\n\t\t\t\t\t\tDAH\n\t\t\t\t\t\t<span class="paddle-label">(é•·ç‚¹)</span>\n\t\t\t\t\t\t<span class="paddle-key">K ã‚­ãƒ¼</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="practice-container">\n\t\t\t\t\t<div class="display-area">\n\t\t\t\t\t\t<div class="display-section">\n\t\t\t\t\t\t\t<h3>ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·</h3>\n\t\t\t\t\t\t\t<div class="display-output morse-buffer" id="morse-buffer">ï¼ˆã“ã“ã«ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="display-section">\n\t\t\t\t\t\t\t<h3>ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ</h3>\n\t\t\t\t\t\t\t<div class="display-output" id="decoded-text">ï¼ˆã“ã“ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="action-area">\n\t\t\t\t\t\t<button class="btn btn-large btn-danger" id="clear-btn">ã‚¯ãƒªã‚¢</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="status-area">\n\t\t\t\t\t\t<div class="status-item">\n\t\t\t\t\t\t\t<span class="label">ç¾åœ¨ã®é€Ÿåº¦</span>\n\t\t\t\t\t\t\t<span class="value" id="current-wpm">${this.currentWPM}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="status-item">\n\t\t\t\t\t\t\t<span class="label">Iambicãƒ¢ãƒ¼ãƒ‰</span>\n\t\t\t\t\t\t\t<span class="value" id="current-iambic-mode">${this.iambicMode}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="status-item">\n\t\t\t\t\t\t\t<span class="label">å…¥åŠ›æ–‡å­—æ•°</span>\n\t\t\t\t\t\t\t<span class="value" id="char-count">0</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="timing-evaluation-section">\n\t\t\t\t\t\t<h3>ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°è©•ä¾¡</h3>\n\t\t\t\t\t\t<div class="timing-stats-grid">\n\t\t\t\t\t\t\t<div class="timing-stat-card">\n\t\t\t\t\t\t\t\t<div class="timing-stat-label">å¹³å‡ç²¾åº¦</div>\n\t\t\t\t\t\t\t\t<div class="timing-stat-value" id="timing-avg-accuracy">--%</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="timing-stat-card">\n\t\t\t\t\t\t\t\t<div class="timing-stat-label">å¹³å‡èª¤å·®</div>\n\t\t\t\t\t\t\t\t<div class="timing-stat-value" id="timing-avg-error">--ms</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="timing-stat-card">\n\t\t\t\t\t\t\t\t<div class="timing-stat-label">è©•ä¾¡æ•°</div>\n\t\t\t\t\t\t\t\t<div class="timing-stat-value" id="timing-count">0</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="timing-element-stats">\n\t\t\t\t\t\t\t<div class="timing-element-stat">\n\t\t\t\t\t\t\t\t<h4>æ–‡å­—é–“</h4>\n\t\t\t\t\t\t\t\t<div class="timing-element-detail">\n\t\t\t\t\t\t\t\t\t<span>æœŸå¾…å€¤: <span id="timing-char-expected">--ms</span></span>\n\t\t\t\t\t\t\t\t\t<span>ç²¾åº¦: <span id="timing-char-accuracy">--%</span></span>\n\t\t\t\t\t\t\t\t\t<span>èª¤å·®: <span id="timing-char-error">--ms</span></span>\n\t\t\t\t\t\t\t\t\t<span>å›æ•°: <span id="timing-char-count">0</span></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="timing-element-stat">\n\t\t\t\t\t\t\t\t<h4>å˜èªé–“</h4>\n\t\t\t\t\t\t\t\t<div class="timing-element-detail">\n\t\t\t\t\t\t\t\t\t<span>æœŸå¾…å€¤: <span id="timing-word-expected">--ms</span></span>\n\t\t\t\t\t\t\t\t\t<span>ç²¾åº¦: <span id="timing-word-accuracy">--%</span></span>\n\t\t\t\t\t\t\t\t\t<span>èª¤å·®: <span id="timing-word-error">--ms</span></span>\n\t\t\t\t\t\t\t\t\t<span>å›æ•°: <span id="timing-word-count">0</span></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>å·¦ãƒ‘ãƒ‰ãƒ«ï¼ˆJï¼‰: çŸ­ç‚¹ï¼ˆãƒ»ï¼‰/ å³ãƒ‘ãƒ‰ãƒ«ï¼ˆKï¼‰: é•·ç‚¹ï¼ˆãƒ¼ï¼‰</li>\n\t\t\t\t\t\t\t<li>ä¸¡æ–¹åŒæ™‚æŠ¼ã—ã§è‡ªå‹•äº¤äº’é€ä¿¡ï¼ˆIambicï¼‰</li>\n\t\t\t\t\t\t\t<li>Iambic Bãƒ¢ãƒ¼ãƒ‰: ã‚¹ã‚¯ã‚¤ãƒ¼ã‚ºå¾Œ1è¦ç´ è¿½åŠ é€ä¿¡</li>\n\t\t\t\t\t\t\t<li>ç”»é¢å³ä¸Šã®âš™ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰è¨­å®šï¼ˆWPMã€Iambicãƒ¢ãƒ¼ãƒ‰ã€ãƒ‘ãƒ‰ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€éŸ³é‡ãƒ»å‘¨æ³¢æ•°ï¼‰ã‚’å¤‰æ›´ã§ãã¾ã™</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã€‚
this.attachEventListeners(),
//! å®šæœŸæ›´æ–°ã‚’é–‹å§‹ã€‚
this.startUpdate())}attachEventListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const t=document.querySelector(".back-btn");t?.addEventListener("click",()=>{window.location.hash="#menu"}),
//! è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã€‚
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.openSettingsModal()});
//! ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("clear-btn");e?.addEventListener("click",()=>{this.trainer.clear(),this.updateDisplay()}),
//! ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆè¨­å®šã•ã‚ŒãŸã‚­ãƒ¼ï¼‰ã€‚
this.keyPressHandler=t=>{t.repeat||(t.code===this.leftKeyCode?(t.preventDefault(),this.handleLeftPaddlePress()):t.code===this.rightKeyCode&&(t.preventDefault(),this.handleRightPaddlePress()))},this.keyReleaseHandler=t=>{t.code===this.leftKeyCode?(t.preventDefault(),this.handleLeftPaddleRelease()):t.code===this.rightKeyCode&&(t.preventDefault(),this.handleRightPaddleRelease())},window.addEventListener("keydown",this.keyPressHandler),window.addEventListener("keyup",this.keyReleaseHandler);
//! ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå·¦ãƒ‘ãƒ‰ãƒ«ï¼‰ã€‚
const n=document.getElementById("left-paddle");n&&(n.addEventListener("mousedown",t=>{t.preventDefault(),this.handleLeftPaddlePress()}),n.addEventListener("mouseup",t=>{t.preventDefault(),this.handleLeftPaddleRelease()}),n.addEventListener("mouseleave",()=>{this.leftPressed&&this.handleLeftPaddleRelease()}),n.addEventListener("touchstart",t=>{t.preventDefault(),this.handleLeftPaddlePress()}),n.addEventListener("touchend",t=>{t.preventDefault(),this.handleLeftPaddleRelease()}),n.addEventListener("touchcancel",()=>{this.leftPressed&&this.handleLeftPaddleRelease()}));
//! ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå³ãƒ‘ãƒ‰ãƒ«ï¼‰ã€‚
const s=document.getElementById("right-paddle");s&&(s.addEventListener("mousedown",t=>{t.preventDefault(),this.handleRightPaddlePress()}),s.addEventListener("mouseup",t=>{t.preventDefault(),this.handleRightPaddleRelease()}),s.addEventListener("mouseleave",()=>{this.rightPressed&&this.handleRightPaddleRelease()}),s.addEventListener("touchstart",t=>{t.preventDefault(),this.handleRightPaddlePress()}),s.addEventListener("touchend",t=>{t.preventDefault(),this.handleRightPaddleRelease()}),s.addEventListener("touchcancel",()=>{this.rightPressed&&this.handleRightPaddleRelease()}))}handleLeftPaddlePress(){if(this.leftPressed)return;this.leftPressed=!0,this.trainer.leftPaddlePress();const t=document.getElementById("left-paddle");t&&t.classList.add("pressed")}handleLeftPaddleRelease(){if(!this.leftPressed)return;this.leftPressed=!1,this.trainer.leftPaddleRelease();const t=document.getElementById("left-paddle");t&&t.classList.remove("pressed")}handleRightPaddlePress(){if(this.rightPressed)return;this.rightPressed=!0,this.trainer.rightPaddlePress();const t=document.getElementById("right-paddle");t&&t.classList.add("pressed")}handleRightPaddleRelease(){if(!this.rightPressed)return;this.rightPressed=!1,this.trainer.rightPaddleRelease();const t=document.getElementById("right-paddle");t&&t.classList.remove("pressed")}updatePaddleLabels(){const t=document.getElementById("left-paddle"),e=document.getElementById("right-paddle");"normal"===this.paddleLayout?(t&&(t.className="paddle-button dit",t.innerHTML='\n\t\t\t\t\tDIT\n\t\t\t\t\t<span class="paddle-label">(çŸ­ç‚¹)</span>\n\t\t\t\t\t<span class="paddle-key">J ã‚­ãƒ¼</span>\n\t\t\t\t'),e&&(e.className="paddle-button dah",e.innerHTML='\n\t\t\t\t\tDAH\n\t\t\t\t\t<span class="paddle-label">(é•·ç‚¹)</span>\n\t\t\t\t\t<span class="paddle-key">K ã‚­ãƒ¼</span>\n\t\t\t\t')):(t&&(t.className="paddle-button dah",t.innerHTML='\n\t\t\t\t\tDAH\n\t\t\t\t\t<span class="paddle-label">(é•·ç‚¹)</span>\n\t\t\t\t\t<span class="paddle-key">J ã‚­ãƒ¼</span>\n\t\t\t\t'),e&&(e.className="paddle-button dit",e.innerHTML='\n\t\t\t\t\tDIT\n\t\t\t\t\t<span class="paddle-label">(çŸ­ç‚¹)</span>\n\t\t\t\t\t<span class="paddle-key">K ã‚­ãƒ¼</span>\n\t\t\t\t')),
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®šã€‚
this.attachEventListeners()}startUpdate(){
//! 100msã”ã¨ã«ç”»é¢ã‚’æ›´æ–°ã€‚
this.updateIntervalId=window.setInterval(()=>{this.updateDisplay()},100)}updateDisplay(){const t=document.getElementById("morse-buffer"),e=document.getElementById("decoded-text"),n=document.getElementById("char-count");if(t){const e=this.trainer.getBuffer(),n=this.trainer.getSequence(),s=n?`${e} ${n}`:e;t.textContent=s||"ï¼ˆã“ã“ã«ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}if(e){const t=this.trainer.getDecoded();e.textContent=t||"ï¼ˆã“ã“ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰"}if(n){const t=this.trainer.getDecoded();n.textContent=t.length.toString()}
//! ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°è©•ä¾¡çµ±è¨ˆã‚’æ›´æ–°ã€‚
const s=this.trainer.getSpacingStatistics(),i=this.trainer.getStatisticsBySpacingType(),a=document.getElementById("timing-avg-accuracy"),r=document.getElementById("timing-avg-error"),o=document.getElementById("timing-count");a&&(a.textContent=s.count>0?`${s.averageAccuracy.toFixed(1)} Â± ${s.standardDeviation.toFixed(1)}%`:"--%"),r&&(r.textContent=s.count>0?`${Math.round(s.averageAbsoluteError)}ms`:"--ms"),o&&(o.textContent=s.count.toString());
//! æ–‡å­—é–“ã‚¹ãƒšãƒ¼ã‚¹çµ±è¨ˆã€‚
const d=document.getElementById("timing-char-expected"),c=document.getElementById("timing-char-accuracy"),l=document.getElementById("timing-char-error"),u=document.getElementById("timing-char-count");d&&(d.textContent=`${Math.round(this.timings.charGap)}ms`),c&&(c.textContent=i.character.count>0?`${i.character.averageAccuracy.toFixed(1)} Â± ${i.character.standardDeviation.toFixed(1)}%`:"--%"),l&&(l.textContent=i.character.count>0?`${Math.round(i.character.averageAbsoluteError)}ms`:"--ms"),u&&(u.textContent=i.character.count.toString());
//! å˜èªé–“ã‚¹ãƒšãƒ¼ã‚¹çµ±è¨ˆã€‚
const h=document.getElementById("timing-word-expected"),p=document.getElementById("timing-word-accuracy"),v=document.getElementById("timing-word-error"),m=document.getElementById("timing-word-count");h&&(h.textContent=`${Math.round(this.timings.wordGap)}ms`),p&&(p.textContent=i.word.count>0?`${i.word.averageAccuracy.toFixed(1)} Â± ${i.word.standardDeviation.toFixed(1)}%`:"--%"),v&&(v.textContent=i.word.count>0?`${Math.round(i.word.averageAbsoluteError)}ms`:"--ms"),m&&(m.textContent=i.word.count.toString())}openSettingsModal(){
//! ç¾åœ¨ã®è¨­å®šå€¤ã‚’å–å¾—ã€‚
const t={volume:Math.round(100*this.audio.getVolume()),frequency:this.audio.getFrequency(),wpm:this.currentWPM,iambicMode:this.iambicMode,paddleLayout:this.paddleLayout,leftKeyCode:this.leftKeyCode,rightKeyCode:this.rightKeyCode},e={volume:this.audio.getVolume(),frequency:this.audio.getFrequency(),wpm:this.currentWPM,iambicMode:this.iambicMode,paddleLayout:this.paddleLayout,leftKeyCode:this.leftKeyCode,rightKeyCode:this.rightKeyCode};
//! è¨­å®šå¤‰æ›´å‰ã®å€¤ã‚’ä¿å­˜ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å¾©å…ƒç”¨ï¼‰ã€‚
//! ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã€‚
new a("horizontal-key-settings-modal",r,t,{onSave:t=>{
//! è¨­å®šã‚’ä¿å­˜ã€‚
this.audio.setVolume(t.volume/100),this.audio.setFrequency(t.frequency),this.audio.setWPM(t.wpm),this.currentWPM=t.wpm,this.iambicMode=t.iambicMode,this.paddleLayout=t.paddleLayout,this.leftKeyCode=t.leftKeyCode,this.rightKeyCode=t.rightKeyCode,
//! localStorageã«ä¿å­˜ã€‚
localStorage.setItem("horizontalKeyWPM",this.currentWPM.toString()),localStorage.setItem("horizontalKeyIambicMode",this.iambicMode),localStorage.setItem("horizontalKeyPaddleLayout",this.paddleLayout),localStorage.setItem("horizontalKeyLeftCode",this.leftKeyCode),localStorage.setItem("horizontalKeyRightCode",this.rightKeyCode);
//! ç¾åœ¨ã®WPMè¡¨ç¤ºã‚’æ›´æ–°ã€‚
const e=document.getElementById("current-wpm");e&&(e.textContent=this.currentWPM.toString());
//! ç¾åœ¨ã®Iambicãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°ã€‚
const n=document.getElementById("current-iambic-mode");n&&(n.textContent=this.iambicMode),
//! ãƒ‘ãƒ‰ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å¿œã˜ã¦ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°ã€‚
this.updatePaddleLabels(),
//! ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’å†åˆæœŸåŒ–ã€‚
this.initializeTrainer()},onCancel:()=>{
//! è¨­å®šã‚’å…ƒã«æˆ»ã™ã€‚
this.audio.setVolume(e.volume),this.audio.setFrequency(e.frequency),this.audio.setWPM(e.wpm),this.currentWPM=e.wpm,this.iambicMode=e.iambicMode,this.paddleLayout=e.paddleLayout,this.leftKeyCode=e.leftKeyCode,this.rightKeyCode=e.rightKeyCode}}).show("horizontal-key")}destroy(){
//! ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã€‚
this.keyPressHandler&&(window.removeEventListener("keydown",this.keyPressHandler),this.keyPressHandler=null),this.keyReleaseHandler&&(window.removeEventListener("keyup",this.keyReleaseHandler),this.keyReleaseHandler=null),
//! å®šæœŸæ›´æ–°ã‚’åœæ­¢ã€‚
null!==this.updateIntervalId&&(clearInterval(this.updateIntervalId),this.updateIntervalId=null),
//! ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢ã€‚
this.trainer.clear()}}async function b(t){
//! TSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã€‚
const e=await fetch(t);if(!e.ok)throw new Error(`Failed to load flashcard data: ${e.statusText}`);return function(t){
//! è¡Œã«åˆ†å‰²ã€‚
const e=t.split("\n").filter(t=>t.trim());if(0===e.length)return[];
//! å…ˆé ­è¡Œã¯ãƒ˜ãƒƒãƒ€ãƒ¼ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—ã€‚
return e.slice(1).map((t,e)=>{
//! ã‚¿ãƒ–ã§åˆ†å‰²ã€‚
const n=t.split("\t");
//! æœ€ä½é™6åˆ—ï¼ˆã‚¿ã‚°ã€é »åº¦ã€ç•¥èªã€è‹±æ–‡ã€å’Œè¨³ã€èª¬æ˜ï¼‰å¿…è¦ã€‚
if(n.length<6)return null;return{tags:n[0].trim(),frequency:parseInt(n[1].trim(),10)||1,abbreviation:n[2].trim(),english:n[3].trim(),japanese:n[4].trim(),description:n[5]?.trim(),example:n[6]?.trim()}}).filter(t=>null!==t)}(await e.text())}class y{allEntries=[];filteredEntries=[];currentState="loading";selectedTags=new Set;selectedFrequencies=new Set([5]);searchQuery="";displayMode="card";sortColumn="abbreviation";sortDirection="asc";learnQuestionType="abbr-to-meaning";learnCards=[];currentLearnIndex=0;isFlipped=!1;reviewMode=!1;progress={known:new Set,unknown:new Set};questionType="abbr-to-meaning";questionCount=10;questions=[];currentQuestionIndex=0;results=[];audio;currentlyPlaying=null;constructor(){this.audio=new n({frequency:700,volume:.5,wpm:20}),
//! ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã‚€ã€‚
this.progress=d.loadProgress();const t=d.loadFilters();this.selectedTags=t.selectedTags,this.selectedFrequencies=t.selectedFrequencies,this.searchQuery=t.searchQuery;const e=d.loadViewState();this.displayMode=e.displayMode,this.sortColumn=e.sortColumn,this.sortDirection=e.sortDirection,this.learnQuestionType=e.learnQuestionType,this.questionType=e.examQuestionType}saveProgress(){d.saveProgress(this.progress)}clearProgress(){this.progress={known:new Set,unknown:new Set},d.clearProgress()}saveFilters(){d.saveFilters({selectedTags:this.selectedTags,selectedFrequencies:this.selectedFrequencies,searchQuery:this.searchQuery})}async render(){const t=document.getElementById("app");if(t)if("loading"===this.currentState){
//! ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºã€‚
t.innerHTML='\n\t\t\t\t<div class="container">\n\t\t\t\t\t<header class="header">\n\t\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’</h1>\n\t\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t</header>\n\t\t\t\t\t<div class="loading-container">\n\t\t\t\t\t\t<p>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t';const n=document.querySelector(".back-btn");n?.addEventListener("click",()=>{window.location.hash="#menu"});
//! ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã€‚
try{this.allEntries=await b("/flashcard.tsv"),this.updateFilteredEntries();
//! ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã€ä¿å­˜ã•ã‚Œã¦ã„ãŸviewModeã‚’å¾©å…ƒã€‚
const t=d.loadViewState();this.currentState=t.viewMode,this.render()}catch(e){t.innerHTML=`\n\t\t\t\t\t<div class="container">\n\t\t\t\t\t\t<header class="header">\n\t\t\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’</h1>\n\t\t\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t\t</header>\n\t\t\t\t\t\t<div class="error-container">\n\t\t\t\t\t\t\t<p>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>\n\t\t\t\t\t\t\t<p>ã‚¨ãƒ©ãƒ¼: ${e}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}}else"browse"===this.currentState?this.renderBrowseMode():"learn"===this.currentState?this.renderLearnMode():"exam"===this.currentState?this.renderExamMode():"exam-result"===this.currentState&&this.renderExamResultMode()}renderFilterSection(){return`\n\t\t\t<div class="filter-section">\n\t\t\t\t<h3>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š</h3>\n\n\t\t\t\t<div class="filter-group">\n\t\t\t\t\t<label>ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿</label>\n\t\t\t\t\t<div class="tag-filter" id="tag-filter">\n\t\t\t\t\t\t${c.getAllTags(this.allEntries).map(t=>`\n\t\t\t\t\t\t\t<label class="tag-checkbox">\n\t\t\t\t\t\t\t\t<input type="checkbox" value="${t}" ${this.selectedTags.has(t)?"checked":""}>\n\t\t\t\t\t\t\t\t<span>${t}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="filter-group">\n\t\t\t\t\t<label>ä½¿ç”¨é »åº¦ã§çµã‚Šè¾¼ã¿ï¼ˆ1=ä½é »åº¦ã€5=é«˜é »åº¦ï¼‰</label>\n\t\t\t\t\t<div class="frequency-filter" id="frequency-filter">\n\t\t\t\t\t\t${[5,4,3,2,1].map(t=>`\n\t\t\t\t\t\t\t<label class="frequency-checkbox">\n\t\t\t\t\t\t\t\t<input type="checkbox" value="${t}" ${this.selectedFrequencies.has(t)?"checked":""}>\n\t\t\t\t\t\t\t\t<span>â˜…${t}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="filter-group">\n\t\t\t\t\t<label for="search-input">æ¤œç´¢ï¼ˆç•¥èªãƒ»æ„å‘³ãƒ»ã‚¿ã‚°ï¼‰</label>\n\t\t\t\t\t<input type="text" id="search-input" class="search-input" placeholder="ä¾‹: QTH, location, Qç¬¦å·" value="${this.searchQuery}">\n\t\t\t\t</div>\n\n\t\t\t\t<div class="filter-stats">\n\t\t\t\t\t<span>è©²å½“: <strong id="filtered-count">${this.filteredEntries.length}</strong> ä»¶</span>\n\t\t\t\t\t<span>å…¨ä½“: <strong>${this.allEntries.length}</strong> ä»¶</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}renderBrowseMode(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="tabs">\n\t\t\t\t\t<button class="tab-button active" data-tab="browse">ä¸€è¦§</button>\n\t\t\t\t\t<button class="tab-button" data-tab="learn">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t\t<button class="tab-button" data-tab="exam">è©¦é¨“ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="flashcard-container">\n\t\t\t\t\t${this.renderFilterSection()}\n\n\t\t\t\t\t<div class="entries-section" id="entries-section">\n\t\t\t\t\t\t\x3c!-- ã“ã“ã«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ --\x3e\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>ã‚¿ã‚°ã€ä½¿ç”¨é »åº¦ã€æ¤œç´¢ã§ç•¥èªã‚’çµã‚Šè¾¼ã‚ã¾ã™</li>\n\t\t\t\t\t\t\t<li>ç•¥èªã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã‚’å†ç”Ÿã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã¨ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™</li>\n\t\t\t\t\t\t\t<li>ã€Œå­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã€ã‚¿ãƒ–ã§ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å­¦ç¿’ãŒã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>ã€Œè©¦é¨“ãƒ¢ãƒ¼ãƒ‰ã€ã‚¿ãƒ–ã§ç†è§£åº¦ãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>ç”»é¢å³ä¸Šã®âš™ã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰éŸ³é‡ãƒ»å‘¨æ³¢æ•°ãƒ»é€Ÿåº¦ã‚’èª¿æ•´ã§ãã¾ã™</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.renderEntries(),this.attachBrowseModeListeners())}renderEntries(){const t=document.getElementById("entries-section");t&&("card"===this.displayMode?this.renderCardView(t):this.renderListView(t))}renderCardView(t){t.innerHTML=`\n\t\t\t<div class="entries-header">\n\t\t\t\t<h3>ç•¥èªä¸€è¦§ (${this.filteredEntries.length}ä»¶)</h3>\n\t\t\t\t<button id="toggle-display-btn" class="toggle-display-btn">ğŸ“‹ ãƒªã‚¹ãƒˆè¡¨ç¤º</button>\n\t\t\t</div>\n\t\t\t<div class="entries-grid">\n\t\t\t\t${this.filteredEntries.map(t=>`\n\t\t\t\t\t<div class="entry-card ${this.currentlyPlaying===t.abbreviation?"playing":""}" data-abbr="${t.abbreviation}">\n\t\t\t\t\t\t<div class="entry-header">\n\t\t\t\t\t\t\t<div class="entry-abbr">${this.formatAbbreviation(t.abbreviation)}</div>\n\t\t\t\t\t\t\t<div class="entry-frequency" title="ä½¿ç”¨é »åº¦: ${t.frequency}/5">${"â˜…".repeat(t.frequency)}${"â˜†".repeat(5-t.frequency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="entry-english">${t.english}</div>\n\t\t\t\t\t\t<div class="entry-japanese">${t.japanese}</div>\n\t\t\t\t\t\t${t.description?`<div class="entry-description">${t.description}</div>`:""}\n\t\t\t\t\t\t${t.example?`<div class="entry-example">ä¾‹: ${t.example}</div>`:""}\n\t\t\t\t\t\t<div class="entry-tags">${t.tags}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`).join("")}\n\t\t\t</div>\n\t\t`,
//! ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ«ã‚¹å†ç”Ÿã€‚
t.querySelectorAll(".entry-card").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-abbr");e&&this.playMorse(e)})});
//! è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("toggle-display-btn");e&&e.addEventListener("click",()=>{this.displayMode="list",d.saveDisplayMode(this.displayMode),this.renderEntries()})}renderListView(t){t.innerHTML=`\n\t\t\t<div class="entries-header">\n\t\t\t\t<h3>ç•¥èªä¸€è¦§ (${this.filteredEntries.length}ä»¶)</h3>\n\t\t\t\t<button id="toggle-display-btn" class="toggle-display-btn">ğŸƒ ã‚«ãƒ¼ãƒ‰è¡¨ç¤º</button>\n\t\t\t</div>\n\t\t\t<div class="list-table-container">\n\t\t\t\t<table class="list-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th class="sortable" data-column="abbreviation">ç•¥èª${this.getSortIndicator("abbreviation")}</th>\n\t\t\t\t\t\t\t<th class="sortable" data-column="english">è‹±æ–‡${this.getSortIndicator("english")}</th>\n\t\t\t\t\t\t\t<th class="sortable" data-column="japanese">å’Œè¨³${this.getSortIndicator("japanese")}</th>\n\t\t\t\t\t\t\t<th class="sortable" data-column="frequency">é »åº¦${this.getSortIndicator("frequency")}</th>\n\t\t\t\t\t\t\t<th class="sortable" data-column="tags">ã‚¿ã‚°${this.getSortIndicator("tags")}</th>\n\t\t\t\t\t\t\t<th>èª¬æ˜</th>\n\t\t\t\t\t\t\t<th>å…·ä½“ä¾‹</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t${this.filteredEntries.map(t=>`\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td class="list-abbr">\n\t\t\t\t\t\t\t\t\t<button class="abbr-play-btn ${this.currentlyPlaying===t.abbreviation?"playing":""}" data-abbr="${t.abbreviation}">\n\t\t\t\t\t\t\t\t\t\t${this.formatAbbreviation(t.abbreviation)}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>${t.english}</td>\n\t\t\t\t\t\t\t\t<td>${t.japanese}</td>\n\t\t\t\t\t\t\t\t<td title="ä½¿ç”¨é »åº¦: ${t.frequency}/5">${"â˜…".repeat(t.frequency)}${"â˜†".repeat(5-t.frequency)}</td>\n\t\t\t\t\t\t\t\t<td>${t.tags}</td>\n\t\t\t\t\t\t\t\t<td>${t.description||""}</td>\n\t\t\t\t\t\t\t\t<td>${t.example||""}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;t.querySelectorAll("th.sortable").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-column");e&&this.toggleSort(e)})});t.querySelectorAll(".abbr-play-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-abbr");e&&this.playMorse(e)})});
//! è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("toggle-display-btn");e&&e.addEventListener("click",()=>{this.displayMode="card",d.saveDisplayMode(this.displayMode),this.renderEntries()})}renderLearnMode(){0===this.learnCards.length?
//! ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ã‚’è¡¨ç¤ºã€‚
this.renderLearnSetup():
//! å­¦ç¿’ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã€‚
this.renderLearnCard()}renderLearnSetup(){const t=document.getElementById("app");if(!t)return;
//! ã‚«ãƒ¼ãƒ‰æšæ•°ã‚’è¨ˆç®—ã€‚
let e=this.filteredEntries.length;this.reviewMode&&(e=this.filteredEntries.filter(t=>this.progress.unknown.has(t.abbreviation)).length),t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="tabs">\n\t\t\t\t\t<button class="tab-button" data-tab="browse">ä¸€è¦§</button>\n\t\t\t\t\t<button class="tab-button active" data-tab="learn">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t\t<button class="tab-button" data-tab="exam">è©¦é¨“ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="flashcard-container">\n\t\t\t\t\t${this.renderFilterSection()}\n\n\t\t\t\t\t<div class="learn-setup-section">\n\t\t\t\t\t\t<h3>å­¦ç¿’è¨­å®š</h3>\n\n\t\t\t\t\t\t<div class="filter-group">\n\t\t\t\t\t\t\t<label>ãƒ¢ãƒ¼ãƒ‰</label>\n\t\t\t\t\t\t\t<div class="mode-buttons">\n\t\t\t\t\t\t\t\t<button class="mode-btn ${this.reviewMode?"active":""}" id="review-mode-btn">\n\t\t\t\t\t\t\t\t\tå¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚ã‹ã‚‰ãªã„ã‚«ãƒ¼ãƒ‰ã®ã¿: ${this.progress.unknown.size}ä»¶ï¼‰\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="filter-group">\n\t\t\t\t\t\t\t<label>å‡ºé¡Œå½¢å¼</label>\n\t\t\t\t\t\t\t<div class="question-type-buttons">\n\t\t\t\t\t\t\t\t<button class="question-type-btn ${"abbr-to-meaning"===this.learnQuestionType?"active":""}" data-type="abbr-to-meaning">ç•¥èªâ†’æ„å‘³ï¼ˆåŸºæœ¬ï¼‰</button>\n\t\t\t\t\t\t\t\t<button class="question-type-btn ${"meaning-to-abbr"===this.learnQuestionType?"active":""}" data-type="meaning-to-abbr">æ„å‘³â†’ç•¥èªï¼ˆå¿œç”¨ï¼‰</button>\n\t\t\t\t\t\t\t\t<button class="question-type-btn ${"morse-to-abbr"===this.learnQuestionType?"active":""}" data-type="morse-to-abbr">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³â†’ç•¥èªï¼ˆå®Ÿè·µï¼‰</button>\n\t\t\t\t\t\t\t\t<button class="question-type-btn ${"morse-to-meaning"===this.learnQuestionType?"active":""}" data-type="morse-to-meaning">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³â†’æ„å‘³ï¼ˆå®Ÿè·µï¼‰</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="filter-stats">\n\t\t\t\t\t\t\t<span>å­¦ç¿’å¯èƒ½: <strong>${e}</strong> æš</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="action-area">\n\t\t\t\t\t\t\t<button class="btn btn-large btn-primary" id="start-learn-btn" ${0===e?"disabled":""}>å­¦ç¿’é–‹å§‹</button>\n\t\t\t\t\t\t\t<button class="btn btn-large btn-secondary" id="clear-progress-btn">é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆ</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§å­¦ç¿’ã™ã‚‹ç•¥èªã‚’çµã‚Šè¾¼ã¿ã¾ã™</li>\n\t\t\t\t\t\t\t<li>å‡ºé¡Œå½¢å¼ã‚’é¸æŠã—ã¾ã™ï¼ˆç•¥èªâ†’æ„å‘³ã€æ„å‘³â†’ç•¥èªã€ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‹ã‚‰ã®è§£èª­ï¼‰</li>\n\t\t\t\t\t\t\t<li>ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã§è£è¿”ã—ã€ã€Œã‚ã‹ã‚‹ã€ã€Œã‚ã‹ã‚‰ãªã„ã€ã§é€²æ—ã‚’è¨˜éŒ²</li>\n\t\t\t\t\t\t\t<li>å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã§ã€Œã‚ã‹ã‚‰ãªã„ã€ã‚«ãƒ¼ãƒ‰ã®ã¿ã‚’å­¦ç¿’ã§ãã¾ã™</li>\n\t\t\t\t\t\t\t<li>å­¦ç¿’é€²æ—ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachCommonListeners(),this.attachLearnSetupListeners()}attachLearnSetupListeners(){
//! ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const t=document.getElementById("tag-filter");t?.addEventListener("change",t=>{const e=t.target;"checkbox"===e.type&&(e.checked?this.selectedTags.add(e.value):this.selectedTags.delete(e.value),this.updateFilteredEntries(),this.renderLearnSetup())});
//! ä½¿ç”¨é »åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const e=document.getElementById("frequency-filter");e?.addEventListener("change",t=>{const e=t.target;if("checkbox"===e.type){const t=parseInt(e.value,10);e.checked?this.selectedFrequencies.add(t):this.selectedFrequencies.delete(t),this.updateFilteredEntries(),this.renderLearnSetup()}});
//! æ¤œç´¢ã€‚
const n=document.getElementById("learn-search-input");n?.addEventListener("input",()=>{this.searchQuery=n.value,this.updateFilteredEntries(),this.renderLearnSetup()});
//! å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã€‚
const s=document.getElementById("review-mode-btn");s?.addEventListener("click",()=>{this.reviewMode=!this.reviewMode,this.renderLearnSetup()});document.querySelectorAll(".question-type-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-type");e&&(this.learnQuestionType=e,d.saveLearnQuestionType(this.learnQuestionType),this.renderLearnSetup())})});
//! å­¦ç¿’é–‹å§‹ãƒœã‚¿ãƒ³ã€‚
const i=document.getElementById("start-learn-btn");i?.addEventListener("click",()=>{this.startLearn()});
//! é€²æ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã€‚
const a=document.getElementById("clear-progress-btn");a?.addEventListener("click",()=>{confirm("å­¦ç¿’é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")&&(this.clearProgress(),this.renderLearnSetup())})}startLearn(){
//! ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‹ã‚‰å­¦ç¿’ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆã€‚
let t=[...this.filteredEntries];this.reviewMode&&(
//! å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰: ã‚ã‹ã‚‰ãªã„ã‚«ãƒ¼ãƒ‰ã®ã¿ã€‚
t=t.filter(t=>this.progress.unknown.has(t.abbreviation))),0!==t.length?(
//! ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€‚
t=t.sort(()=>Math.random()-.5),this.learnCards=t,this.currentLearnIndex=0,this.isFlipped=!1,this.renderLearnCard()):alert("å­¦ç¿’å¯èƒ½ãªã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")}renderLearnCard(){const t=document.getElementById("app");if(!t)return;const e=this.learnCards[this.currentLearnIndex],n=this.currentLearnIndex+1,s=this.learnCards.length;
//! å•é¡Œã¨æ­£è§£ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã€‚
let i="",a="";switch(this.learnQuestionType){case"abbr-to-meaning":i=`\n\t\t\t\t\t<div class="card-label">ç•¥èª</div>\n\t\t\t\t\t<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>\n\t\t\t\t`,a=`\n\t\t\t\t\t<div class="card-label">æ„å‘³</div>\n\t\t\t\t\t<div class="card-content-text">${e.english}</div>\n\t\t\t\t\t<div class="card-content-text">${e.japanese}</div>\n\t\t\t\t`;break;case"meaning-to-abbr":i=`\n\t\t\t\t\t<div class="card-label">æ„å‘³</div>\n\t\t\t\t\t<div class="card-content-text">${e.english}</div>\n\t\t\t\t\t<div class="card-content-text">${e.japanese}</div>\n\t\t\t\t`,a=`\n\t\t\t\t\t<div class="card-label">ç•¥èª</div>\n\t\t\t\t\t<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>\n\t\t\t\t`;break;case"morse-to-abbr":i='\n\t\t\t\t\t<div class="card-label">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‚’èã„ã¦ç•¥èªã‚’ç­”ãˆã¦ãã ã•ã„</div>\n\t\t\t\t\t<button class="play-morse-btn" id="play-morse-btn">ğŸ”Š ãƒ¢ãƒ¼ãƒ«ã‚¹å†ç”Ÿ</button>\n\t\t\t\t',a=`\n\t\t\t\t\t<div class="card-label">ç•¥èª</div>\n\t\t\t\t\t<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>\n\t\t\t\t`;break;case"morse-to-meaning":i='\n\t\t\t\t\t<div class="card-label">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‚’èã„ã¦æ„å‘³ã‚’ç­”ãˆã¦ãã ã•ã„</div>\n\t\t\t\t\t<button class="play-morse-btn" id="play-morse-btn">ğŸ”Š ãƒ¢ãƒ¼ãƒ«ã‚¹å†ç”Ÿ</button>\n\t\t\t\t',a=`\n\t\t\t\t\t<div class="card-label">æ„å‘³</div>\n\t\t\t\t\t<div class="card-content-abbr">${this.formatAbbreviation(e.abbreviation)}</div>\n\t\t\t\t\t<div class="card-content-text">${e.english}</div>\n\t\t\t\t\t<div class="card-content-text">${e.japanese}</div>\n\t\t\t\t`}
//! åˆ¤å®šãƒœã‚¿ãƒ³ã®HTMLã€‚
const r=this.progress.known.has(e.abbreviation),o=`\n\t\t\t<div class="judgment-controls">\n\t\t\t\t<button id="mark-unknown-btn" class="judgment-button unknown ${this.progress.unknown.has(e.abbreviation)?"active":""}">\n\t\t\t\t\tÃ— ã‚ã‹ã‚‰ãªã„\n\t\t\t\t</button>\n\t\t\t\t<button id="mark-known-btn" class="judgment-button known ${r?"active":""}">\n\t\t\t\t\tâ—‹ ã‚ã‹ã‚‹\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;t.innerHTML=`\n\t\t\t<div class="container learning-view">\n\t\t\t\t<div class="learning-header">\n\t\t\t\t\t<button id="back-to-setup-btn" class="back-btn">â† è¨­å®šã«æˆ»ã‚‹</button>\n\t\t\t\t\t<div class="progress-indicator">${n} / ${s}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="card-container">\n\t\t\t\t\t<div class="flashcard ${this.isFlipped?"flipped":""}" id="flashcard">\n\t\t\t\t\t\t<div class="card-front">\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="card-back">\n\t\t\t\t\t\t\t${a}\n\t\t\t\t\t\t\t${e.description?`<div class="card-description">${e.description}</div>`:""}\n\t\t\t\t\t\t\t${e.example?`<div class="card-example">ä¾‹: ${e.example}</div>`:""}\n\t\t\t\t\t\t\t<div class="card-tags">${e.tags} / ${"â˜…".repeat(e.frequency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="card-controls">\n\t\t\t\t\t<button id="flip-card-btn" class="control-button">\n\t\t\t\t\t\t${this.isFlipped?"å•é¡Œã«æˆ»ã‚‹":"æ­£è§£ã‚’ç¢ºèªã™ã‚‹"} (Space)\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t${this.isFlipped?o:""}\n\n\t\t\t\t<div class="navigation-controls">\n\t\t\t\t\t<button id="prev-card-btn" class="nav-button" ${0===this.currentLearnIndex?"disabled":""}>\n\t\t\t\t\t\tâ† å‰ã®ã‚«ãƒ¼ãƒ‰\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="next-card-btn" class="nav-button" ${this.currentLearnIndex>=this.learnCards.length-1?"disabled":""}>\n\t\t\t\t\t\tæ¬¡ã®ã‚«ãƒ¼ãƒ‰ â†’\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachLearnCardListeners()}attachLearnCardListeners(){
//! è¨­å®šã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const t=document.getElementById("back-to-setup-btn");t?.addEventListener("click",()=>{this.learnCards=[],this.currentLearnIndex=0,this.isFlipped=!1,this.renderLearnSetup()});
//! ãƒ•ãƒªãƒƒãƒ—ãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("flip-card-btn");e?.addEventListener("click",()=>{this.isFlipped=!this.isFlipped,this.renderLearnCard()});document.addEventListener("keydown",t=>{"Space"===t.code&&t.target===document.body&&(t.preventDefault(),this.isFlipped=!this.isFlipped,this.renderLearnCard())});
//! ãƒ¢ãƒ¼ãƒ«ã‚¹å†ç”Ÿãƒœã‚¿ãƒ³ã€‚
const n=document.getElementById("play-morse-btn");n&&n.addEventListener("click",()=>{const t=this.learnCards[this.currentLearnIndex];this.playMorse(t.abbreviation)});
//! åˆ¤å®šãƒœã‚¿ãƒ³ï¼ˆã‚ã‹ã‚‰ãªã„ï¼‰ã€‚
const s=document.getElementById("mark-unknown-btn");s?.addEventListener("click",()=>{const t=this.learnCards[this.currentLearnIndex];this.progress.unknown.add(t.abbreviation),this.progress.known.delete(t.abbreviation),this.saveProgress(),this.moveToNextCard()});
//! åˆ¤å®šãƒœã‚¿ãƒ³ï¼ˆã‚ã‹ã‚‹ï¼‰ã€‚
const i=document.getElementById("mark-known-btn");i?.addEventListener("click",()=>{const t=this.learnCards[this.currentLearnIndex];this.progress.known.add(t.abbreviation),this.progress.unknown.delete(t.abbreviation),this.saveProgress(),this.moveToNextCard()});
//! å‰ã®ã‚«ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã€‚
const a=document.getElementById("prev-card-btn");a?.addEventListener("click",()=>{this.currentLearnIndex>0&&(this.currentLearnIndex--,this.isFlipped=!1,this.renderLearnCard())});
//! æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã€‚
const r=document.getElementById("next-card-btn");r?.addEventListener("click",()=>{this.currentLearnIndex<this.learnCards.length-1&&(this.currentLearnIndex++,this.isFlipped=!1,this.renderLearnCard())})}moveToNextCard(){this.currentLearnIndex<this.learnCards.length-1?(
//! æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Œã°ç§»å‹•ã€‚
this.currentLearnIndex++,this.isFlipped=!1,this.renderLearnCard()):(
//! æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã®å ´åˆã¯å­¦ç¿’å®Œäº†ã€‚
alert("å­¦ç¿’å®Œäº†ã—ã¾ã—ãŸï¼"),this.learnCards=[],this.currentLearnIndex=0,this.isFlipped=!1,this.renderLearnSetup())}renderExamMode(){document.getElementById("app")&&(0===this.questions.length?this.renderExamSetup():this.renderExamQuestion())}renderExamSetup(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="tabs">\n\t\t\t\t\t<button class="tab-button" data-tab="browse">ä¸€è¦§</button>\n\t\t\t\t\t<button class="tab-button" data-tab="learn">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t\t<button class="tab-button active" data-tab="exam">è©¦é¨“ãƒ¢ãƒ¼ãƒ‰</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="flashcard-container">\n\t\t\t\t\t${this.renderFilterSection()}\n\n\t\t\t\t\t<div class="exam-setup-section">\n\t\t\t\t\t\t<h3>å‡ºé¡Œå½¢å¼</h3>\n\t\t\t\t\t\t<div class="question-type-buttons">\n\t\t\t\t\t\t\t<button class="question-type-btn ${"abbr-to-meaning"===this.questionType?"active":""}" data-type="abbr-to-meaning">ç•¥èªâ†’æ„å‘³ï¼ˆåŸºç¤ï¼‰</button>\n\t\t\t\t\t\t\t<button class="question-type-btn ${"meaning-to-abbr"===this.questionType?"active":""}" data-type="meaning-to-abbr">æ„å‘³â†’ç•¥èªï¼ˆå¿œç”¨ï¼‰</button>\n\t\t\t\t\t\t\t<button class="question-type-btn ${"morse-to-abbr"===this.questionType?"active":""}" data-type="morse-to-abbr">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³â†’ç•¥èªï¼ˆå®Ÿè·µï¼‰</button>\n\t\t\t\t\t\t\t<button class="question-type-btn ${"morse-to-meaning"===this.questionType?"active":""}" data-type="morse-to-meaning">ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³â†’æ„å‘³ï¼ˆå®Ÿè·µï¼‰</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<h3>å•é¡Œæ•°</h3>\n\t\t\t\t\t\t<div class="question-count-buttons">\n\t\t\t\t\t\t\t<button class="question-count-btn ${5===this.questionCount?"active":""}" data-count="5">5å•</button>\n\t\t\t\t\t\t\t<button class="question-count-btn ${10===this.questionCount?"active":""}" data-count="10">10å•</button>\n\t\t\t\t\t\t\t<button class="question-count-btn ${20===this.questionCount?"active":""}" data-count="20">20å•</button>\n\t\t\t\t\t\t\t<button class="question-count-btn ${50===this.questionCount?"active":""}" data-count="50">50å•</button>\n\t\t\t\t\t\t\t<button class="question-count-btn ${"all"===this.questionCount?"active":""}" data-count="all">å…¨å•</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="action-area">\n\t\t\t\t\t\t\t<button class="btn btn-large btn-primary" id="start-exam-btn">è©¦é¨“é–‹å§‹</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§å‡ºé¡Œç¯„å›²ã‚’çµã‚Šè¾¼ã¿ã¾ã™</li>\n\t\t\t\t\t\t\t<li>å‡ºé¡Œå½¢å¼ã‚’é¸æŠã—ã¾ã™ï¼ˆç•¥èªâ†’æ„å‘³ã€æ„å‘³â†’ç•¥èªã€ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‹ã‚‰ï¼‰</li>\n\t\t\t\t\t\t\t<li>å•é¡Œæ•°ã‚’é¸æŠã—ã¾ã™ï¼ˆ5å•ã€œå…¨å•ï¼‰</li>\n\t\t\t\t\t\t\t<li>4ã¤ã®é¸æŠè‚¢ã‹ã‚‰æ­£è§£ã‚’é¸ã³ã¾ã™</li>\n\t\t\t\t\t\t\t<li>80%ä»¥ä¸Šã§åˆæ ¼ã§ã™</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachExamSetupListeners())}renderExamQuestion(){const t=document.getElementById("app");if(!t)return;const e=this.questions[this.currentQuestionIndex],n=this.currentQuestionIndex+1,s=this.questions.length;let i="";switch(e.type){case"abbr-to-meaning":i=`æ¬¡ã®ç•¥èªã®æ„å‘³ã¯ï¼Ÿ<br><strong class="question-text">${e.entry.abbreviation}</strong>`;break;case"meaning-to-abbr":i=`æ¬¡ã®æ„å‘³ã‚’è¡¨ã™ç•¥èªã¯ï¼Ÿ<br><strong class="question-text">${e.entry.english} / ${e.entry.japanese}</strong>`;break;case"morse-to-abbr":i='ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‚’èã„ã¦ã€å¯¾å¿œã™ã‚‹ç•¥èªã¯ï¼Ÿ<br><button id="replay-morse-btn" class="btn btn-secondary">ğŸ”Š ã‚‚ã†ä¸€åº¦å†ç”Ÿ</button>';break;case"morse-to-meaning":i='ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ã‚’èã„ã¦ã€å¯¾å¿œã™ã‚‹æ„å‘³ã¯ï¼Ÿ<br><button id="replay-morse-btn" class="btn btn-secondary">ğŸ”Š ã‚‚ã†ä¸€åº¦å†ç”Ÿ</button>'}t.innerHTML=`\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’ - è©¦é¨“ä¸­</h1>\n\t\t\t\t\t<button class="back-btn">ä¸­æ–­</button>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="exam-container">\n\t\t\t\t\t<div class="exam-progress">\n\t\t\t\t\t\t<span>å•é¡Œ <strong>${n}</strong> / ${s}</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="question-area">\n\t\t\t\t\t\t<p class="question">${i}</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="choices-area">\n\t\t\t\t\t\t${e.choices.map((t,e)=>`\n\t\t\t\t\t\t\t<button class="choice-btn" data-choice="${t}">\n\t\t\t\t\t\t\t\t${e+1}. ${t}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachExamQuestionListeners(),
//! ãƒ¢ãƒ¼ãƒ«ã‚¹éŸ³ãŒå¿…è¦ãªå ´åˆã¯è‡ªå‹•å†ç”Ÿã€‚
"morse-to-abbr"!==e.type&&"morse-to-meaning"!==e.type||setTimeout(()=>this.playMorse(e.entry.abbreviation),500)}renderExamResultMode(){const t=document.getElementById("app");if(!t)return;const e=c.calculateScore(this.results),n=c.isPassed(e.percentage),s=c.getWrongAnswers(this.results);t.innerHTML=`\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<h1>CWç•¥èªãƒ»Qç¬¦å·å­¦ç¿’ - çµæœ</h1>\n\t\t\t\t\t<button class="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="result-container">\n\t\t\t\t\t<div class="score-area ${n?"passed":"failed"}">\n\t\t\t\t\t\t<h2>${n?"åˆæ ¼ï¼":"ä¸åˆæ ¼"}</h2>\n\t\t\t\t\t\t<div class="score-display">\n\t\t\t\t\t\t\t<span class="score-percentage">${e.percentage}%</span>\n\t\t\t\t\t\t\t<span class="score-detail">${e.correct} / ${e.total} å•æ­£è§£</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t${s.length>0?`\n\t\t\t\t\t\t<div class="wrong-answers-section">\n\t\t\t\t\t\t\t<h3>é–“é•ãˆãŸå•é¡Œï¼ˆ${s.length}ä»¶ï¼‰</h3>\n\t\t\t\t\t\t\t<div class="wrong-answers-list">\n\t\t\t\t\t\t\t\t${this.results.filter(t=>!t.isCorrect).map(t=>`\n\t\t\t\t\t\t\t\t\t<div class="wrong-answer-item">\n\t\t\t\t\t\t\t\t\t\t<div class="wrong-answer-question">\n\t\t\t\t\t\t\t\t\t\t\t<strong>${t.question.entry.abbreviation}</strong>\n\t\t\t\t\t\t\t\t\t\t\t<span>${t.question.entry.english} / ${t.question.entry.japanese}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="wrong-answer-detail">\n\t\t\t\t\t\t\t\t\t\t\t<span class="wrong-label">ã‚ãªãŸã®å›ç­”:</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="wrong-user-answer">${t.userAnswer}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="correct-label">æ­£è§£:</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="correct-answer">${t.question.correctAnswer}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t${t.question.entry.description?`\n\t\t\t\t\t\t\t\t\t\t\t<div class="wrong-answer-description">\n\t\t\t\t\t\t\t\t\t\t\t\t${t.question.entry.description}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t`:""}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`:'\n\t\t\t\t\t\t<div class="perfect-score">\n\t\t\t\t\t\t\t<p>ã™ã¹ã¦æ­£è§£ã—ã¾ã—ãŸï¼</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'}\n\n\t\t\t\t\t<div class="action-area">\n\t\t\t\t\t\t<button class="btn btn-primary btn-large" id="retry-btn">ã‚‚ã†ä¸€åº¦</button>\n\t\t\t\t\t\t<button class="btn btn-secondary btn-large" id="back-to-setup-btn">è¨­å®šã«æˆ»ã‚‹</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachResultListeners()}attachBrowseModeListeners(){this.attachCommonListeners();
//! ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const t=document.getElementById("tag-filter");t?.addEventListener("change",t=>{const e=t.target;"checkbox"===e.type&&(e.checked?this.selectedTags.add(e.value):this.selectedTags.delete(e.value),this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount(),this.renderEntries())});
//! ä½¿ç”¨é »åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const e=document.getElementById("frequency-filter");e?.addEventListener("change",t=>{const e=t.target;if("checkbox"===e.type){const t=parseInt(e.value,10);e.checked?this.selectedFrequencies.add(t):this.selectedFrequencies.delete(t),this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount(),this.renderEntries()}});
//! æ¤œç´¢ã€‚
const n=document.getElementById("search-input");n?.addEventListener("input",()=>{this.searchQuery=n.value,this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount(),this.renderEntries()})}attachExamSetupListeners(){this.attachCommonListeners();
//! ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const t=document.getElementById("tag-filter");t?.addEventListener("change",t=>{const e=t.target;"checkbox"===e.type&&(e.checked?this.selectedTags.add(e.value):this.selectedTags.delete(e.value),this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount())});
//! ä½¿ç”¨é »åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€‚
const e=document.getElementById("frequency-filter");e?.addEventListener("change",t=>{const e=t.target;if("checkbox"===e.type){const t=parseInt(e.value,10);e.checked?this.selectedFrequencies.add(t):this.selectedFrequencies.delete(t),this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount()}});
//! æ¤œç´¢ã€‚
const n=document.getElementById("search-input");n?.addEventListener("input",()=>{this.searchQuery=n.value,this.saveFilters(),this.updateFilteredEntries(),this.updateFilteredCount()});document.querySelectorAll(".question-type-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-type");e&&(this.questionType=e,d.saveExamQuestionType(this.questionType),this.renderExamSetup())})});document.querySelectorAll(".question-count-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-count");e&&(this.questionCount="all"===e?"all":parseInt(e,10),this.renderExamSetup())})});
//! è©¦é¨“é–‹å§‹ãƒœã‚¿ãƒ³ã€‚
const s=document.getElementById("start-exam-btn");s?.addEventListener("click",()=>{this.startExam()})}attachExamQuestionListeners(){
//! ä¸­æ–­ãƒœã‚¿ãƒ³ã€‚
const t=document.querySelector(".back-btn");t?.addEventListener("click",()=>{confirm("è©¦é¨“ã‚’ä¸­æ–­ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")&&(window.location.hash="#menu")});
//! ãƒ¢ãƒ¼ãƒ«ã‚¹å†ç”Ÿãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("replay-morse-btn");if(e){const t=this.questions[this.currentQuestionIndex];e.addEventListener("click",()=>{this.playMorse(t.entry.abbreviation)})}
//! é¸æŠè‚¢ãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".choice-btn").forEach(t=>{t.addEventListener("click",t=>{const e=t.currentTarget.dataset.choice||"";this.handleAnswer(e)})})}attachResultListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const t=document.querySelector(".back-btn");t?.addEventListener("click",()=>{window.location.hash="#menu"});
//! ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ã€‚
const e=document.getElementById("retry-btn");e?.addEventListener("click",()=>{this.questions=[],this.results=[],this.currentQuestionIndex=0,this.currentState="exam",this.render()});
//! è¨­å®šã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const n=document.getElementById("back-to-setup-btn");n?.addEventListener("click",()=>{this.questions=[],this.results=[],this.currentQuestionIndex=0,this.currentState="exam",this.render()})}attachCommonListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
const t=document.querySelector(".back-btn");t?.addEventListener("click",()=>{window.location.hash="#menu"}),
//! è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã€‚
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.openSettingsModal()});document.querySelectorAll(".tab-button").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-tab");"browse"===e?(this.currentState="browse",d.saveViewMode("browse"),this.render()):"learn"===e?(this.currentState="learn",d.saveViewMode("learn"),this.render()):"exam"===e&&(this.questions=[],this.results=[],this.currentQuestionIndex=0,this.currentState="exam",d.saveViewMode("exam"),this.render())})})}updateFilteredCount(){const t=document.getElementById("filtered-count");t&&(t.textContent=this.filteredEntries.length.toString());
//! å•é¡Œæ•°ã®æœ€å¤§å€¤ã‚‚æ›´æ–°ï¼ˆè©¦é¨“ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆï¼‰ã€‚
const e=document.getElementById("question-count");e&&(e.max=this.filteredEntries.length.toString(),parseInt(e.value,10)>this.filteredEntries.length&&(e.value=this.filteredEntries.length.toString(),this.questionCount=this.filteredEntries.length))}updateFilteredEntries(){let t=this.allEntries;
//! ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚
t=c.filterByTags(t,this.selectedTags),
//! ä½¿ç”¨é »åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚
t=c.filterByFrequencies(t,this.selectedFrequencies),
//! æ¤œç´¢ã‚¯ã‚¨ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚
t=c.filterByQuery(t,this.searchQuery),
//! ã‚½ãƒ¼ãƒˆé©ç”¨ã€‚
this.filteredEntries=this.sortEntries(t)}sortEntries(t){const e="asc"===this.sortDirection;switch(this.sortColumn){case"abbreviation":return c.sortByAbbreviation(t,e);case"english":return c.sortByEnglish(t,e);case"japanese":return c.sortByJapanese(t,e);case"frequency":return c.sortByFrequency(t,e);case"tags":return c.sortByTags(t,e);default:return t}}toggleSort(t){this.sortColumn===t?
//! åŒã˜åˆ—ãªã‚‰æ–¹å‘ã‚’åè»¢ã€‚
this.sortDirection="asc"===this.sortDirection?"desc":"asc":(
//! ç•°ãªã‚‹åˆ—ãªã‚‰æ˜‡é †ã§é–‹å§‹ã€‚
this.sortColumn=t,this.sortDirection="asc"),
//! ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ä¿å­˜ã€‚
d.saveSortState(this.sortColumn,this.sortDirection),this.updateFilteredEntries(),this.renderEntries()}getSortIndicator(t){return this.sortColumn!==t?"":"asc"===this.sortDirection?" â–²":" â–¼"}formatAbbreviation(t){const e=t.match(/^\[([A-Z]+)\]$/);return e?`<span class="prosign">${e[1]}</span>`:t}async playMorse(t){try{
//! æ—¢ã«å†ç”Ÿä¸­ã®å ´åˆã¯åœæ­¢ã€‚
if(this.currentlyPlaying===t)return this.audio.stopContinuousTone(),this.currentlyPlaying=null,void this.renderEntries();
//! åˆ¥ã®ã‚‚ã®ãŒå†ç”Ÿä¸­ãªã‚‰åœæ­¢ã€‚
this.currentlyPlaying&&this.audio.stopContinuousTone(),this.currentlyPlaying=t,this.renderEntries();
//! ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ã«å¤‰æ›ã€‚
const e=l.textToMorse(t);if(e)
//! ã‚·ãƒ³ãƒ—ãƒ«ãªå†ç”Ÿå®Ÿè£…ï¼ˆscheduleToneã‚’ä½¿ç”¨ï¼‰ã€‚
for(const t of e)"."===t?(this.audio.scheduleTone(0,60),await new Promise(t=>setTimeout(t,120))):"-"===t?(this.audio.scheduleTone(0,180),await new Promise(t=>setTimeout(t,240))):" "===t&&await new Promise(t=>setTimeout(t,60));this.currentlyPlaying=null,this.renderEntries()}catch(e){this.currentlyPlaying=null,this.renderEntries()}}startExam(){if(0===this.filteredEntries.length)return void alert("è©²å½“ã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚");const t="all"===this.questionCount?this.filteredEntries.length:this.questionCount,e=Math.min(t,this.filteredEntries.length);0!==e?(
//! å•é¡Œã‚’ç”Ÿæˆã€‚
this.questions=c.generateExamQuestions(this.filteredEntries,this.questionType,e),this.currentQuestionIndex=0,this.results=[],this.render()):alert("å•é¡Œæ•°ã‚’1ä»¥ä¸Šã«è¨­å®šã—ã¦ãã ã•ã„ã€‚")}handleAnswer(t){const e=this.questions[this.currentQuestionIndex],n=c.checkAnswer(e,t);
//! çµæœã‚’è¨˜éŒ²ã€‚
this.results.push({question:e,userAnswer:t,isCorrect:n}),
//! æ¬¡ã®å•é¡Œã«é€²ã‚€ã‹çµæœè¡¨ç¤ºã€‚
this.currentQuestionIndex++,this.currentQuestionIndex<this.questions.length||(this.currentState="exam-result"),this.render()}openSettingsModal(){
//! ç¾åœ¨ã®è¨­å®šå€¤ã‚’å–å¾—ï¼ˆ0-100ã®ç¯„å›²ã«å¤‰æ›ï¼‰ã€‚
const t={volume:Math.round(100*this.audio.getVolume()),frequency:this.audio.getFrequency(),wpm:this.audio.getWPM()},e={volume:this.audio.getVolume(),frequency:this.audio.getFrequency(),wpm:this.audio.getWPM()};
//! è¨­å®šå¤‰æ›´å‰ã®å€¤ã‚’ä¿å­˜ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å¾©å…ƒç”¨ï¼‰ã€‚
//! ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã€‚
new a("flashcard-settings-modal",r,t,{onSave:t=>{
//! è¨­å®šã‚’ä¿å­˜ã€‚
this.audio.setVolume(t.volume/100),this.audio.setFrequency(t.frequency),this.audio.setWPM(t.wpm)},onCancel:()=>{
//! è¨­å®šã‚’å…ƒã«æˆ»ã™ã€‚
this.audio.setVolume(e.volume),this.audio.setFrequency(e.frequency),this.audio.setWPM(e.wpm)},onTestPlay:async()=>{
//! ãƒ†ã‚¹ãƒˆå†ç”Ÿã€‚
await this.playMorse("CQ")}}).show("flashcard")}destroy(){
//! éŸ³å£°ã‚’åœæ­¢ã€‚
this.currentlyPlaying&&this.audio.stopContinuousTone()}}const f={characterSpeed:20,effectiveSpeed:15,frequency:700,volume:.7,practiceDuration:60,groupSize:5,showInput:!0};class w{audio;viewMode="learning";settings={...f};state={currentLesson:1,isPlaying:!1,userInput:"",correctAnswer:"",groups:[],currentGroupIndex:0};customState={selectedChars:new Set,isCustomRunning:!1,customUserInput:"",customCorrectAnswer:"",customGroups:[],customCurrentGroupIndex:0,customIsPlaying:!1};constructor(){
//! è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€‚
this.loadSettings(),this.loadProgress(),this.loadViewMode(),this.loadSelectedChars(),
//! AudioGeneratorã‚’åˆæœŸåŒ–ã€‚
this.audio=new n({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed})}
//! ========== è¨­å®šç®¡ç† ==========
loadSettings(){try{const t=localStorage.getItem("v10.koch.settings");t&&(this.settings={...f,...JSON.parse(t)})}catch(t){}}saveSettings(){try{localStorage.setItem("v10.koch.settings",JSON.stringify(this.settings))}catch(t){}}loadProgress(){try{const t=localStorage.getItem("v10.koch.currentLesson");t&&(this.state.currentLesson=parseInt(t,10))}catch(t){}}saveProgress(){try{localStorage.setItem("v10.koch.currentLesson",this.state.currentLesson.toString())}catch(t){}}loadViewMode(){try{const t=localStorage.getItem("v10.koch.viewMode");t&&["learning","custom"].includes(t)&&(this.viewMode=t)}catch(t){}}saveViewMode(){try{localStorage.setItem("v10.koch.viewMode",this.viewMode)}catch(t){}}loadSelectedChars(){try{const t=localStorage.getItem("v10.koch.selectedChars");if(t){const e=JSON.parse(t);this.customState.selectedChars=new Set(e)}}catch(t){}}saveSelectedChars(){try{const t=Array.from(this.customState.selectedChars);localStorage.setItem("v10.koch.selectedChars",JSON.stringify(t))}catch(t){}}
//! ========== ãƒ¬ãƒƒã‚¹ãƒ³ç®¡ç† ==========
async startLesson(){const t=u.getCharsForLesson(this.state.currentLesson),e={groupSize:this.settings.groupSize,duration:this.settings.practiceDuration,wpm:this.settings.characterSpeed};this.state.groups=u.generateRandomGroups(t,e),this.state.currentGroupIndex=0,this.state.userInput="",this.state.correctAnswer=this.state.groups.join(""),this.state.isPlaying=!1,
//! AudioGeneratorã®è¨­å®šã‚’æ›´æ–°ã€‚
this.audio.updateSettings({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed}),this.renderPractice()}async playMorse(){if(!this.state.isPlaying){this.state.isPlaying=!0,this.state.currentGroupIndex=0,this.updateProgress(),this.updatePlaybackButtons();
//! ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã‚’å†ç”Ÿã€‚
for(let t=0;t<this.state.groups.length&&this.state.isPlaying;t++){const e=this.state.groups[t],n=l.textToMorse(e);await this.audio.playMorseString(n+" /"),this.state.currentGroupIndex=t+1,this.updateProgress()}this.state.isPlaying=!1,this.updatePlaybackButtons(),this.state.currentGroupIndex>=this.state.groups.length&&this.showResult()}}pauseMorse(){this.state.isPlaying=!1,this.audio.stopPlaying(),this.updatePlaybackButtons()}stopLesson(){this.state.isPlaying=!1,this.audio.stopPlaying(),this.render()}showResult(){const t=u.calculateAccuracy(this.state.correctAnswer,this.state.userInput),e=t>=90,n=document.getElementById("resultContainer");n&&(n.innerHTML=`\n\t\t\t<div class="result ${e?"passed":"failed"}">\n\t\t\t\t<h2>${e?"åˆæ ¼ï¼":"ä¸åˆæ ¼"}</h2>\n\t\t\t\t<div class="accuracy">æ­£ç­”ç‡: ${t.toFixed(1)}%</div>\n\t\t\t\t<div class="comparison">\n\t\t\t\t\t<div>é€ä¿¡: ${this.state.correctAnswer}</div>\n\t\t\t\t\t<div>å…¥åŠ›: ${this.state.userInput||"ï¼ˆæœªå…¥åŠ›ï¼‰"}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="actions">\n\t\t\t\t\t${e?'<button class="btn primary" id="nextLessonBtn">æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¸</button>':""}\n\t\t\t\t\t<button class="btn" id="retryBtn">ã‚‚ã†ä¸€åº¦</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,e&&this.state.currentLesson<40&&(this.state.currentLesson++,this.saveProgress(),document.getElementById("nextLessonBtn")?.addEventListener("click",()=>{this.render()})),document.getElementById("retryBtn")?.addEventListener("click",()=>{this.render()}))}updateProgress(){const t=document.getElementById("lessonProgress"),e=document.getElementById("progressBar");if(t&&e){const n=this.state.currentGroupIndex/this.state.groups.length*100;t.textContent=`é€²è¡Œ: ${this.state.currentGroupIndex}/${this.state.groups.length} (${n.toFixed(0)}%)`,e.style.width=`${n}%`}this.updatePlaybackButtons()}updatePlaybackButtons(){const t=document.getElementById("playBtn"),e=document.getElementById("pauseBtn");t&&e&&(this.state.isPlaying?(t.disabled=!0,e.disabled=!1):(t.disabled=!1,e.disabled=!0))}
//! ========== ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ç®¡ç† ==========
async startCustom(){const t=Array.from(this.customState.selectedChars),e={groupSize:this.settings.groupSize,duration:this.settings.practiceDuration,wpm:this.settings.characterSpeed};this.customState.customGroups=u.generateRandomGroups(t,e),this.customState.customCurrentGroupIndex=0,this.customState.customUserInput="",this.customState.customCorrectAnswer=this.customState.customGroups.join(""),this.customState.customIsPlaying=!1,this.customState.isCustomRunning=!0,
//! AudioGeneratorã®è¨­å®šã‚’æ›´æ–°ã€‚
this.audio.updateSettings({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed}),this.render(),this.renderCustomPractice()}async playCustomMorse(){if(!this.customState.customIsPlaying){this.customState.customIsPlaying=!0,this.customState.customCurrentGroupIndex=0,this.updateCustomProgress(),this.updateCustomPlaybackButtons();
//! ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã‚’å†ç”Ÿã€‚
for(let t=0;t<this.customState.customGroups.length&&this.customState.customIsPlaying;t++){const e=this.customState.customGroups[t],n=l.textToMorse(e);await this.audio.playMorseString(n+" /"),this.customState.customCurrentGroupIndex=t+1,this.updateCustomProgress()}this.customState.customIsPlaying=!1,this.updateCustomPlaybackButtons()}}pauseCustomMorse(){this.customState.customIsPlaying=!1,this.audio.stopPlaying(),this.updateCustomPlaybackButtons()}stopCustom(){this.customState.customIsPlaying=!1,this.audio.stopPlaying(),this.customState.isCustomRunning=!1,this.render()}updateCustomProgress(){const t=document.getElementById("customProgress"),e=document.getElementById("customProgressBar");if(t&&e){const n=this.customState.customCurrentGroupIndex/this.customState.customGroups.length*100;t.textContent=`é€²è¡Œ: ${this.customState.customCurrentGroupIndex}/${this.customState.customGroups.length} (${n.toFixed(0)}%)`,e.style.width=`${n}%`}this.updateCustomPlaybackButtons()}updateCustomPlaybackButtons(){const t=document.getElementById("customPlayBtn"),e=document.getElementById("customPauseBtn");t&&e&&(this.customState.customIsPlaying?(t.disabled=!0,e.disabled=!1):(t.disabled=!1,e.disabled=!0))}showCustomResult(){const t=document.getElementById("customResultContainer");if(!t)return;
//! libå´ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦æ­£ç­”ç‡ã‚’è¨ˆç®—ã€‚
const e=u.calculateAccuracy(this.customState.customCorrectAnswer,this.customState.customUserInput),n=this.customState.customUserInput.replace(/\s+/g,""),s=this.customState.customCorrectAnswer.replace(/\s+/g,"");t.innerHTML=`\n\t\t\t<div class="result">\n\t\t\t\t<h2>ç·´ç¿’çµæœ</h2>\n\t\t\t\t<div class="accuracy">æ­£ç­”ç‡: ${e}%</div>\n\t\t\t\t<div class="comparison">\n\t\t\t\t\t<div>é€ä¿¡: ${s}</div>\n\t\t\t\t\t<div>ã‚ãªãŸã®å…¥åŠ›: ${n}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="actions">\n\t\t\t\t\t<button id="retryCustomBtn" class="btn">ã‚‚ã†ä¸€åº¦</button>\n\t\t\t\t\t<button id="backToCustomMenuBtn" class="btn primary">æˆ»ã‚‹</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,document.getElementById("retryCustomBtn")?.addEventListener("click",()=>{this.customState.isCustomRunning=!1,this.render(),this.startCustom()}),document.getElementById("backToCustomMenuBtn")?.addEventListener("click",()=>{this.customState.isCustomRunning=!1,this.render()})}
//! ========== è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« ==========
showSettings(){
//! ç¾åœ¨ã®è¨­å®šå€¤ã‚’å–å¾—ï¼ˆvolumeã‚’0-100ã®ç¯„å›²ã«å¤‰æ›ï¼‰ã€‚
const t={volume:Math.round(100*this.settings.volume),frequency:this.settings.frequency,wpm:this.settings.characterSpeed,characterSpeed:this.settings.characterSpeed,effectiveSpeed:this.settings.effectiveSpeed,practiceDuration:this.settings.practiceDuration,groupSize:this.settings.groupSize,showInput:this.settings.showInput},e={...this.settings};
//! è¨­å®šå¤‰æ›´å‰ã®å€¤ã‚’ä¿å­˜ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å¾©å…ƒç”¨ï¼‰ã€‚
//! ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã€‚
new a("koch-settings-modal",r,t,{onSave:t=>{
//! å®ŸåŠ¹é€Ÿåº¦ã¯æ–‡å­—é€Ÿåº¦ã‚’ä¸Šé™ã¨ã™ã‚‹ã€‚
let e=t.effectiveSpeed;const n=t.characterSpeed;e>n&&(e=n),
//! è¨­å®šã‚’ä¿å­˜ã€‚
this.settings.characterSpeed=n,this.settings.effectiveSpeed=e,this.settings.frequency=t.frequency,this.settings.volume=t.volume/100,this.settings.practiceDuration=t.practiceDuration,this.settings.groupSize=t.groupSize,this.settings.showInput=t.showInput,this.saveSettings(),
//! AudioGeneratorã‚’æ›´æ–°ã€‚
this.audio.updateSettings({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed}),
//! ç·´ç¿’ä¸­ã®å ´åˆã€è¡¨ç¤ºã‚’æ›´æ–°ã€‚
this.state.groups.length>0&&this.renderPractice()},onCancel:()=>{
//! è¨­å®šã‚’å…ƒã«æˆ»ã™ã€‚
this.settings={...e},this.audio.updateSettings({frequency:e.frequency,volume:e.volume,wpm:e.characterSpeed,effectiveWpm:e.effectiveSpeed})}}).show("koch")}
//! ========== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ==========
render(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button class="back-btn" id="back-btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>ã‚³ãƒƒãƒ›æ³•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="tabs">\n\t\t\t\t\t<button class="tab-button ${"learning"===this.viewMode?"active":""}" data-tab="learning">åŸºæœ¬å­¦ç¿’</button>\n\t\t\t\t\t<button class="tab-button ${"custom"===this.viewMode?"active":""}" data-tab="custom">ä»»æ„æ–‡å­—åˆ—ç·´ç¿’</button>\n\t\t\t\t</div>\n\n\t\t\t\t${this.renderModeContent()}\n\t\t\t</div>\n\t\t`,this.attachEventListeners())}renderModeContent(){switch(this.viewMode){case"learning":default:return this.renderLearningMode();case"custom":return this.renderCustomMode()}}renderLearningMode(){const t=u.getCharsForLesson(this.state.currentLesson),e=h.slice(0,40).map((t,e)=>{const n=e+1,s=u.getCharsForLesson(n);return`\n\t\t\t\t<div class="lesson-item ${n===this.state.currentLesson?"current":""} ${n<this.state.currentLesson?"passed":""}" data-lesson="${n}">\n\t\t\t\t\t<div class="lesson-num">L${n}</div>\n\t\t\t\t\t<div class="lesson-chars">${s.join("")}</div>\n\t\t\t\t</div>\n\t\t\t`}).join("");return`\n\t\t\t<div class="flashcard-container">\n\t\t\t\t<div class="lesson-info">\n\t\t\t\t\t<h2>ãƒ¬ãƒƒã‚¹ãƒ³ ${this.state.currentLesson} / 40</h2>\n\t\t\t\t\t<div class="chars">å­¦ç¿’æ–‡å­—: ${t.join("")}</div>\n\t\t\t\t\t<button id="startBtn" class="btn btn-primary">ç·´ç¿’é–‹å§‹</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div id="practiceContainer"></div>\n\t\t\t\t<div id="resultContainer"></div>\n\n\t\t\t\t<div class="instructions">\n\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li>ã€Œç·´ç¿’é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã‚’èã</li>\n\t\t\t\t\t\t<li>èã“ãˆãŸæ–‡å­—ã‚’å…¥åŠ›</li>\n\t\t\t\t\t\t<li>90%ä»¥ä¸Šã®æ­£ç­”ç‡ã§æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¸</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="lesson-list-section">\n\t\t\t\t\t<h3>ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§</h3>\n\t\t\t\t\t<div class="lesson-list">\n\t\t\t\t\t\t${e}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}renderCustomMode(){if(this.customState.isCustomRunning)
//! ç·´ç¿’å®Ÿè¡Œç”»é¢ã€‚
return'\n\t\t\t\t<div class="flashcard-container">\n\t\t\t\t\t<div id="customPracticeContainer"></div>\n\t\t\t\t\t<div id="customResultContainer"></div>\n\t\t\t\t</div>\n\t\t\t';return`\n\t\t\t\t<div class="flashcard-container">\n\t\t\t\t\t<div class="lesson-info">\n\t\t\t\t\t\t<h2>ä»»æ„æ–‡å­—åˆ—ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰</h2>\n\t\t\t\t\t\t<p>ç·´ç¿’ã—ãŸã„æ–‡å­—ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€ä½2æ–‡å­—ï¼‰</p>\n\t\t\t\t\t\t<div class="char-selection">\n\t\t\t\t\t\t\t${h.map(t=>`\n\t\t\t\t<button class="char-select-btn ${this.customState.selectedChars.has(t)?"selected":""}" data-char="${t}">\n\t\t\t\t\t${t}\n\t\t\t\t</button>\n\t\t\t`).join("")}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button id="startCustomBtn" class="btn btn-primary" ${this.customState.selectedChars.size<2?"disabled":""}>ç·´ç¿’é–‹å§‹</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="instructions">\n\t\t\t\t\t\t<h3>ä½¿ã„æ–¹</h3>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li>ç·´ç¿’ã—ãŸã„æ–‡å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</li>\n\t\t\t\t\t\t\t<li>2æ–‡å­—ä»¥ä¸Šé¸æŠã™ã‚‹ã¨ç·´ç¿’é–‹å§‹å¯èƒ½</li>\n\t\t\t\t\t\t\t<li>é¸æŠã—ãŸæ–‡å­—ã®ã¿ã§ãƒ©ãƒ³ãƒ€ãƒ ãªç·´ç¿’å•é¡ŒãŒç”Ÿæˆã•ã‚Œã¾ã™</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`}renderPractice(){const t=document.getElementById("practiceContainer");if(!t)return;const e=u.getCharsForLesson(this.state.currentLesson);t.innerHTML=`\n\t\t\t<div class="practice-area">\n\t\t\t\t<div class="progress-section">\n\t\t\t\t\t<div class="progress-bar-container">\n\t\t\t\t\t\t<div id="progressBar" class="progress-bar" style="width: 0%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="lessonProgress" class="progress-text">æº–å‚™å®Œäº† - å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="playback-controls">\n\t\t\t\t\t<button id="playBtn" class="control-btn" title="å†ç”Ÿ">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M8 5v14l11-7z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="pauseBtn" class="control-btn" title="ä¸€æ™‚åœæ­¢" disabled>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="stopBtn" class="control-btn" title="åœæ­¢">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<rect x="6" y="6" width="12" height="12"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<textarea id="userInput" class="input-area" placeholder="èã“ãˆãŸæ–‡å­—ã‚’å…¥åŠ›..." ${this.settings.showInput?"":'style="opacity: 0.3; pointer-events: none;"'}></textarea>\n\t\t\t\t${this.renderKeyboard(e)}\n\t\t\t</div>\n\t\t`;const n=document.getElementById("userInput");n&&n.addEventListener("input",t=>{this.state.userInput=t.target.value.toUpperCase()}),document.getElementById("playBtn")?.addEventListener("click",()=>{this.playMorse()}),document.getElementById("pauseBtn")?.addEventListener("click",()=>{this.pauseMorse()}),document.getElementById("stopBtn")?.addEventListener("click",()=>{this.stopLesson()}),
//! ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã€‚
this.setupKeyboardEvents(e),this.updatePlaybackButtons()}renderCustomPractice(){const t=document.getElementById("customPracticeContainer");t&&(t.innerHTML=`\n\t\t\t<div class="practice-area">\n\t\t\t\t<div class="progress-section">\n\t\t\t\t\t<div class="progress-bar-container">\n\t\t\t\t\t\t<div id="customProgressBar" class="progress-bar" style="width: 0%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="customProgress" class="progress-text">æº–å‚™å®Œäº† - å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="playback-controls">\n\t\t\t\t\t<button id="customPlayBtn" class="control-btn" title="å†ç”Ÿ">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M8 5v14l11-7z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="customPauseBtn" class="control-btn" title="ä¸€æ™‚åœæ­¢" disabled>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="customStopBtn" class="control-btn" title="åœæ­¢">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<rect x="6" y="6" width="12" height="12"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t${this.settings.showInput?'\n\t\t\t\t\t<textarea id="customInputArea" class="input-area" placeholder="èã“ãˆãŸæ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>\n\t\t\t\t':""}\n\n\t\t\t\t<button id="customEndBtn" class="btn btn-primary">çµæœã‚’è¦‹ã‚‹</button>\n\t\t\t</div>\n\t\t`,this.setupCustomControls())}renderKeyboard(t){const e=[];
//! KOCH_SEQUENCEã‚’groupSizeã”ã¨ã«åˆ†å‰²ã€‚
for(let n=0;n<h.length;n+=this.settings.groupSize)e.push(h.slice(n,n+this.settings.groupSize));return`\n\t\t\t<div class="keyboard">\n\t\t\t\t<div class="keyboard-header">\n\t\t\t\t\t<small>ã‚°ãƒ«ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼ˆå­¦ç¿’æ¸ˆã¿æ–‡å­—ã®ã¿æœ‰åŠ¹ï¼‰</small>\n\t\t\t\t</div>\n\t\t\t\t<div class="keyboard-controls">\n\t\t\t\t\t<button id="spaceBtn" class="key-btn special">ã‚¹ãƒšãƒ¼ã‚¹</button>\n\t\t\t\t\t<button id="backspaceBtn" class="key-btn special">1å­—å‰Šé™¤</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="keyboard-groups-wrapper">\n\t\t\t\t\t<div class="keyboard-groups">\n\t\t\t\t\t\t${e.map((e,n)=>`\n\t\t\t\t\t\t\t<div class="keyboard-group">\n\t\t\t\t\t\t\t\t<div class="group-label">G${n+1}</div>\n\t\t\t\t\t\t\t\t<div class="group-keys">\n\t\t\t\t\t\t\t\t\t${e.map(e=>{const n=t.includes(e);return`\n\t\t\t\t\t\t\t\t\t\t\t<button class="key-btn ${n?"":"disabled"}"\n\t\t\t\t\t\t\t\t\t\t\t        data-char="${e}"\n\t\t\t\t\t\t\t\t\t\t\t        ${n?"":"disabled"}>\n\t\t\t\t\t\t\t\t\t\t\t\t${e}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t`}).join("")}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}setupKeyboardEvents(t){const e=document.getElementById("userInput");e&&(
//! æ–‡å­—ã‚­ãƒ¼ã€‚
document.querySelectorAll(".key-btn:not(.special)").forEach(n=>{n.addEventListener("click",n=>{n.preventDefault();const s=n.target.getAttribute("data-char");s&&t.includes(s)&&(e.value+=s,this.state.userInput=e.value.toUpperCase())})}),
//! ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã€‚
document.getElementById("spaceBtn")?.addEventListener("click",t=>{t.preventDefault(),e.value+=" ",this.state.userInput=e.value.toUpperCase()}),
//! ãƒãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã€‚
document.getElementById("backspaceBtn")?.addEventListener("click",t=>{t.preventDefault(),e.value=e.value.slice(0,-1),this.state.userInput=e.value.toUpperCase()}))}setupCustomControls(){
//! å…¥åŠ›æ¬„ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã€‚
const t=document.getElementById("customInputArea");t&&t.addEventListener("input",t=>{this.customState.customUserInput=t.target.value.toUpperCase()}),document.getElementById("customPlayBtn")?.addEventListener("click",()=>{this.playCustomMorse()}),document.getElementById("customPauseBtn")?.addEventListener("click",()=>{this.pauseCustomMorse()}),document.getElementById("customStopBtn")?.addEventListener("click",()=>{this.stopCustom()}),document.getElementById("customEndBtn")?.addEventListener("click",()=>{this.showCustomResult()}),this.updateCustomPlaybackButtons()}attachEventListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
document.getElementById("back-btn")?.addEventListener("click",()=>{window.location.hash="#menu"}),
//! è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã€‚
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.showSettings()}),
//! ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".tab-button").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-tab");e&&(this.viewMode=e,this.saveViewMode(),this.render())})}),
//! ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã€‚
this.setupModeEventListeners()}setupModeEventListeners(){"learning"===this.viewMode?(document.getElementById("startBtn")?.addEventListener("click",()=>{this.startLesson()}),
//! ãƒ¬ãƒƒã‚¹ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã€‚
document.querySelectorAll(".lesson-item").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-lesson")||"1",10);this.state.currentLesson=e,this.saveProgress(),this.render(),window.scrollTo({top:0,behavior:"smooth"})})})):"custom"===this.viewMode&&(this.customState.isCustomRunning||(document.getElementById("startCustomBtn")?.addEventListener("click",()=>{this.startCustom()}),
//! æ–‡å­—é¸æŠãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".char-select-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-char");e&&(this.customState.selectedChars.has(e)?this.customState.selectedChars.delete(e):this.customState.selectedChars.add(e),this.saveSelectedChars(),this.render())})})))}destroy(){
//! éŸ³å£°ã‚’åœæ­¢ã€‚
this.audio.stopPlaying()}}const E={characterSpeed:20,effectiveSpeed:15,frequency:700,bFrequency:600,volume:.7};class L{audio;audioB;settings={...E};state={currentCategory:"qso",selectedTemplate:null,isPlaying:!1,userInput:"",showResult:!1,showAnswer:!1,showDialogFormat:!1};customTemplates=[];constructor(){
//! è¨­å®šã‚’èª­ã¿è¾¼ã‚€ã€‚
this.loadSettings(),this.loadCategory(),this.loadCustomTemplates(),
//! Aå´ã®AudioGeneratorã‚’åˆæœŸåŒ–ã€‚
this.audio=new n({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed}),
//! Bå´ã®AudioGeneratorã‚’åˆæœŸåŒ–ã€‚
this.audioB=new n({frequency:this.settings.bFrequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed})}
//! ========== è¨­å®šç®¡ç† ==========
loadSettings(){try{const t=localStorage.getItem("v10.listening.settings");t&&(this.settings={...E,...JSON.parse(t)})}catch(t){}}saveSettings(){try{localStorage.setItem("v10.listening.settings",JSON.stringify(this.settings))}catch(t){}}loadCategory(){try{const t=localStorage.getItem("v10.listening.category");t&&["qso","text100","text200","text300","custom"].includes(t)&&(this.state.currentCategory=t)}catch(t){}}saveCategory(){try{localStorage.setItem("v10.listening.category",this.state.currentCategory)}catch(t){}}loadCustomTemplates(){try{const t=localStorage.getItem("v10.listening.customTemplates");t&&(this.customTemplates=JSON.parse(t))}catch(t){}}saveCustomTemplates(){try{localStorage.setItem("v10.listening.customTemplates",JSON.stringify(this.customTemplates))}catch(t){}}
//! ========== ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† ==========
getTemplates(){if("custom"===this.state.currentCategory){return[{id:"qso-random-generate",category:"qso",title:"ãƒ©ãƒ³ãƒ€ãƒ QSOç”Ÿæˆ",content:""},...this.customTemplates]}{const t=p.getBuiltinTemplates(this.state.currentCategory);
//! QSOã‚«ãƒ†ã‚´ãƒªãƒ¼ã«ã¯ãƒ©ãƒ³ãƒ€ãƒ QSOç”Ÿæˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã€‚
if("qso"===this.state.currentCategory){return[{id:"qso-random-generate",category:"qso",title:"ãƒ©ãƒ³ãƒ€ãƒ QSOç”Ÿæˆ",content:""},...t]}return t}}
//! ========== å†ç”Ÿåˆ¶å¾¡ ==========
async playMorse(){if(this.state.selectedTemplate&&!this.state.isPlaying){
//! ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¿œã˜ã¦å†ç”Ÿï¼ˆdialogãŒã‚ã‚Œã°A/Bäº¤äº’ã€ãªã‘ã‚Œã°contentã‚’å†ç”Ÿï¼‰ã€‚
if(this.state.isPlaying=!0,this.updatePlaybackButtons(),this.state.showDialogFormat&&this.state.selectedTemplate.dialog)
//! å¯¾è©±å½¢å¼ã§å†ç”Ÿï¼ˆAå´ã¨Bå´ã‚’äº¤äº’ã«å†ç”Ÿï¼‰ã€‚
await this.playDialogQSO(this.state.selectedTemplate);else if(this.state.selectedTemplate.content){
//! é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§å†ç”Ÿï¼ˆå…¨ä½“ã‚’Aå´ã§å†ç”Ÿï¼‰ã€‚
const t=l.textToMorse(this.state.selectedTemplate.content);await this.audio.playMorseString(t)}this.state.isPlaying=!1,this.updatePlaybackButtons()}}getTemplateText(t){return t.dialog&&t.dialog.length>0?t.dialog.map(t=>t.text).join(" BT "):t.content||""}async playDialogQSO(t){
//! dialogãŒãªã„å ´åˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªï¼‰ã¯contentã‚’å†ç”Ÿã€‚
if(t.dialog&&0!==t.dialog.length)
//! å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’äº¤äº’ã«Aå´ã¨Bå´ã§å†ç”Ÿã€‚
for(let e=0;e<t.dialog.length;e++){const n=t.dialog[e],s=l.textToMorse(n.text),i="A"===n.side?this.audio:this.audioB;await i.playMorseString(s),
//! ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–“ã«çŸ­ã„é–“éš”ã‚’å…¥ã‚Œã‚‹ã€‚
e<t.dialog.length-1&&await new Promise(t=>setTimeout(t,500))}else if(t.content){const e=l.textToMorse(t.content);await this.audio.playMorseString(e)}}pauseMorse(){this.audio.stopPlaying(),this.state.isPlaying=!1,this.updatePlaybackButtons()}stopMorse(){this.audio.stopPlaying(),this.state.isPlaying=!1,this.state.userInput="",this.state.showResult=!1,this.state.showAnswer=!1,this.renderPracticeArea()}updatePlaybackButtons(){const t=document.getElementById("playBtn"),e=document.getElementById("pauseBtn");t&&(t.disabled=this.state.isPlaying),e&&(e.disabled=!this.state.isPlaying)}
//! ========== æ¡ç‚¹ã¨çµæœè¡¨ç¤º ==========
checkAnswer(){this.state.selectedTemplate&&(this.state.showResult=!0,this.state.showAnswer=!0,this.renderPracticeArea())}toggleAnswer(){this.state.showAnswer=!this.state.showAnswer,this.renderPracticeArea()}toggleDialogFormat(){this.state.showDialogFormat=!this.state.showDialogFormat,this.renderAnswer()}
//! ========== ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† ==========
showCustomTemplateDialog(t){const e=!!t,n=e?t.title:"",s=e?t.content:"",i=document.createElement("div");i.className="modal-overlay",i.innerHTML=`\n\t\t\t<div class="modal">\n\t\t\t\t<h2>${e?"ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†":"ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–°è¦ä½œæˆ"}</h2>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label for="templateTitle">ã‚¿ã‚¤ãƒˆãƒ«:</label>\n\t\t\t\t\t<input type="text" id="templateTitle" value="${n}" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label for="templateContent">å†…å®¹:</label>\n\t\t\t\t\t<textarea id="templateContent" placeholder="ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ã«å¤‰æ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›">${s}</textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-actions">\n\t\t\t\t\t<button id="saveTemplateBtn" class="btn btn-primary">ä¿å­˜</button>\n\t\t\t\t\t<button id="cancelTemplateBtn" class="btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,document.body.appendChild(i),
//! ä¿å­˜ãƒœã‚¿ãƒ³ã€‚
document.getElementById("saveTemplateBtn")?.addEventListener("click",()=>{const n=document.getElementById("templateTitle"),s=document.getElementById("templateContent");if(n.value.trim()&&s.value.trim()){if(e&&t)
//! æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã€‚
t.title=n.value.trim(),t.content=s.value.trim().toUpperCase();else{
//! æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¿½åŠ ã€‚
const t={id:`custom-${Date.now()}`,category:"qso",title:n.value.trim(),content:s.value.trim().toUpperCase()};this.customTemplates.push(t)}this.saveCustomTemplates(),i.remove(),this.render()}else alert("ã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}),
//! ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã€‚
document.getElementById("cancelTemplateBtn")?.addEventListener("click",()=>{i.remove()}),
//! ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ã€‚
i.addEventListener("click",t=>{t.target===i&&i.remove()})}deleteCustomTemplate(t){confirm("ã“ã®å®šå‹æ–‡ã‚’å‰Šé™¤ã—ã¾ã™ã‹?")&&(this.customTemplates=this.customTemplates.filter(e=>e.id!==t),this.saveCustomTemplates(),this.render())}
//! ========== è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« ==========
showSettings(){
//! ç¾åœ¨ã®è¨­å®šå€¤ã‚’å–å¾—ï¼ˆvolumeã‚’0-100ã®ç¯„å›²ã«å¤‰æ›ï¼‰ã€‚
const t={characterSpeed:this.settings.characterSpeed,effectiveSpeed:this.settings.effectiveSpeed,frequency:this.settings.frequency,bFrequency:this.settings.bFrequency,volume:Math.round(100*this.settings.volume)},e={...this.settings};
//! è¨­å®šå¤‰æ›´å‰ã®å€¤ã‚’ä¿å­˜ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®å¾©å…ƒç”¨ï¼‰ã€‚
//! ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã€‚
new a("listening-settings-modal",r,t,{onSave:t=>{
//! å®ŸåŠ¹é€Ÿåº¦ã¯æ–‡å­—é€Ÿåº¦ã‚’ä¸Šé™ã¨ã™ã‚‹ã€‚
let e=t.effectiveSpeed;const n=t.characterSpeed;e>n&&(e=n),
//! è¨­å®šã‚’ä¿å­˜ã€‚
this.settings.characterSpeed=n,this.settings.effectiveSpeed=e,this.settings.frequency=t.frequency,this.settings.bFrequency=t.bFrequency,this.settings.volume=t.volume/100,this.saveSettings(),
//! Aå´ã®AudioGeneratorã‚’æ›´æ–°ã€‚
this.audio.updateSettings({frequency:this.settings.frequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed}),
//! Bå´ã®AudioGeneratorã‚’æ›´æ–°ã€‚
this.audioB.updateSettings({frequency:this.settings.bFrequency,volume:this.settings.volume,wpm:this.settings.characterSpeed,effectiveWpm:this.settings.effectiveSpeed})},onCancel:()=>{
//! è¨­å®šã‚’å…ƒã«æˆ»ã™ã€‚
this.settings={...e},this.audio.updateSettings({frequency:e.frequency,volume:e.volume,wpm:e.characterSpeed,effectiveWpm:e.effectiveSpeed}),this.audioB.updateSettings({frequency:e.bFrequency,volume:e.volume,wpm:e.characterSpeed,effectiveWpm:e.effectiveSpeed})},onTestPlay:async()=>{
//! ãƒ†ã‚¹ãƒˆå†ç”Ÿ: Aå´ã¨Bå´ã®å‘¨æ³¢æ•°ã§é †ç•ªã«å†ç”Ÿã€‚
const t=l.textToMorse("CQ");await this.audio.playMorseString(t),await new Promise(t=>setTimeout(t,500)),await this.audioB.playMorseString(t)}}).show("listening")}
//! ========== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ==========
render(){const t=document.getElementById("app");t&&(t.innerHTML=`\n\t\t\t<div class="settings-icon" id="settingsIcon">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="container">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>\n\t\t\t\t\t<h1>ãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·èãå–ã‚Šç·´ç¿’</h1>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="tabs">\n\t\t\t\t\t${this.renderCategoryTabs()}\n\t\t\t\t</div>\n\n\t\t\t\t<div class="content-area">\n\t\t\t\t\t${this.state.selectedTemplate?this.renderPracticeContent():this.renderTemplateList()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.attachEventListeners())}renderCategoryTabs(){return[{id:"qso",label:"ãƒ©ãƒãƒ¼ã‚¹ã‚¿ãƒ³ãƒ—QSO"},{id:"text100",label:"è‹±æ–‡100å­—"},{id:"text200",label:"è‹±æ–‡200å­—"},{id:"text300",label:"è‹±æ–‡300å­—"},{id:"custom",label:"ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©"}].map(t=>`\n\t\t\t<button class="tab-button ${this.state.currentCategory===t.id?"active":""}" data-category="${t.id}">\n\t\t\t\t${t.label}\n\t\t\t</button>\n\t\t`).join("")}renderTemplateList(){const t=this.getTemplates();return 0===t.length||1===t.length&&"qso-random-generate"===t[0].id?`\n\t\t\t\t<div class="empty-state">\n\t\t\t\t\t<p>å®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</p>\n\t\t\t\t\t${"custom"===this.state.currentCategory?'<button id="addCustomBtn" class="btn btn-primary">æ–°è¦ä½œæˆ</button>':""}\n\t\t\t\t</div>\n\t\t\t`:`\n\t\t\t<div class="template-list">\n\t\t\t\t${"custom"===this.state.currentCategory?'<button id="addCustomBtn" class="btn btn-primary">æ–°è¦ä½œæˆ</button>':""}\n\t\t\t\t${t.map(t=>{const e=this.getTemplateText(t),n="qso-random-generate"===t.id?"ã‚³ãƒ¼ãƒ«ã‚µã‚¤ãƒ³ã€åœ°åã€åå‰ã€RSãƒ¬ãƒãƒ¼ãƒˆã€ãƒªã‚°ãªã©ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸå®Œå…¨ãªQSOãŒä½œæˆã•ã‚Œã¾ã™ã€‚æ¯å›ç•°ãªã‚‹å†…å®¹ã§ç·´ç¿’ã§ãã¾ã™ã€‚":`${e.substring(0,100)}${e.length>100?"...":""}`;return`\n\t\t\t\t\t<div class="template-card" data-template-id="${t.id}">\n\t\t\t\t\t\t<h3>${t.title}</h3>\n\t\t\t\t\t\t<p class="template-preview">${n}</p>\n\t\t\t\t\t\t<div class="template-actions">\n\t\t\t\t\t\t\t<button class="btn select-btn" data-template-id="${t.id}">é¸æŠ</button>\n\t\t\t\t\t\t\t${"custom"===this.state.currentCategory&&"qso-random-generate"!==t.id?`\n\t\t\t\t\t\t\t\t<button class="btn edit-btn" data-template-id="${t.id}">ç·¨é›†</button>\n\t\t\t\t\t\t\t\t<button class="btn delete-btn" data-template-id="${t.id}">å‰Šé™¤</button>\n\t\t\t\t\t\t\t`:""}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}).join("")}\n\t\t\t</div>\n\t\t`}renderPracticeContent(){return this.state.selectedTemplate?`\n\t\t\t<div class="practice-area">\n\t\t\t\t<div class="practice-header">\n\t\t\t\t\t<h2>${this.state.selectedTemplate.title}</h2>\n\t\t\t\t\t<button id="backToListBtn" class="btn">ä¸€è¦§ã«æˆ»ã‚‹</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="playback-controls">\n\t\t\t\t\t<button id="playBtn" class="control-btn" title="å†ç”Ÿ" ${this.state.isPlaying?"disabled":""}>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M8 5v14l11-7z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="pauseBtn" class="control-btn" title="ä¸€æ™‚åœæ­¢" ${this.state.isPlaying?"":"disabled"}>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="stopBtn" class="control-btn" title="åœæ­¢">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<rect x="6" y="6" width="12" height="12"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button id="downloadBtn" class="control-btn" title="WAVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div id="practiceInputArea"></div>\n\t\t\t</div>\n\t\t`:""}renderPracticeArea(){const t=document.getElementById("practiceInputArea");if(!t)return;t.innerHTML=`\n\t\t\t<div class="input-section">\n\t\t\t\t<label for="userInput">èãå–ã£ãŸå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</label>\n\t\t\t\t<textarea id="userInput" class="input-area" placeholder="èãå–ã£ãŸæ–‡å­—ã‚’å…¥åŠ›...">${this.state.userInput}</textarea>\n\t\t\t</div>\n\n\t\t\t<div class="action-buttons">\n\t\t\t\t<button id="checkBtn" class="btn btn-primary">æ¡ç‚¹</button>\n\t\t\t\t<button id="showAnswerBtn" class="btn">${this.state.showAnswer?"æ­£è§£ã‚’éè¡¨ç¤º":"æ­£è§£ã‚’è¡¨ç¤º"}</button>\n\t\t\t</div>\n\n\t\t\t${this.state.showAnswer?'<div id="answerArea"></div>':""}\n\t\t\t${this.state.showResult?'<div id="resultArea"></div>':""}\n\t\t`;
//! ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ç›£è¦–ã€‚
const e=document.getElementById("userInput");e?.addEventListener("input",()=>{this.state.userInput=e.value}),
//! æ¡ç‚¹ãƒœã‚¿ãƒ³ã€‚
document.getElementById("checkBtn")?.addEventListener("click",()=>{this.checkAnswer()}),
//! æ­£è§£è¡¨ç¤ºãƒœã‚¿ãƒ³ã€‚
document.getElementById("showAnswerBtn")?.addEventListener("click",()=>{this.toggleAnswer()}),
//! æ­£è§£ã¨çµæœã‚’æç”»ã€‚
this.state.showAnswer&&this.renderAnswer(),this.state.showResult&&this.renderResult()}renderAnswer(){const t=document.getElementById("answerArea");if(!t||!this.state.selectedTemplate)return;const e="qso"===this.state.selectedTemplate.category,n=this.getTemplateText(this.state.selectedTemplate),s=e?`<button id="toggleDialogBtn" class="btn" style="margin-left: 10px;">${this.state.showDialogFormat?"é€šå¸¸è¡¨ç¤º":"å¯¾è©±å½¢å¼ã§è¡¨ç¤º"}</button>`:"";
//! å¯¾è©±å½¢å¼è¡¨ç¤ºã®ç”Ÿæˆã€‚
let i="";if(e&&this.state.showDialogFormat){i=`\n\t\t\t\t<table class="dialog-table">\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t${n.split(/\s+BT\s+/).map((t,e)=>`\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="speaker-cell">${e%2==0?"A":"B"}</td>\n\t\t\t\t\t\t\t\t\t<td class="content-cell">${t.trim()}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t`}else i=`<div class="answer-text">${n}</div>`;t.innerHTML=`\n\t\t\t<div class="answer-area">\n\t\t\t\t<h3 style="display: inline-block;">æ­£è§£</h3>\n\t\t\t\t${s}\n\t\t\t\t${i}\n\t\t\t</div>\n\t\t`,
//! å¯¾è©±å½¢å¼ãƒœã‚¿ãƒ³ã€‚
document.getElementById("toggleDialogBtn")?.addEventListener("click",()=>{this.toggleDialogFormat()})}renderResult(){const t=document.getElementById("resultArea");if(!t||!this.state.selectedTemplate)return;const e=this.getTemplateText(this.state.selectedTemplate),n=p.calculateAccuracy(e,this.state.userInput);t.innerHTML=`\n\t\t\t<div class="result-area">\n\t\t\t\t<h3>çµæœ</h3>\n\t\t\t\t<div class="accuracy">æ­£ç­”ç‡: ${n}%</div>\n\t\t\t\t<div class="comparison">\n\t\t\t\t\t<div class="comparison-row">\n\t\t\t\t\t\t<strong>æ­£è§£:</strong>\n\t\t\t\t\t\t<div class="comparison-text">${e}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="comparison-row">\n\t\t\t\t\t\t<strong>å…¥åŠ›:</strong>\n\t\t\t\t\t\t<div class="comparison-text">${this.state.userInput||"ï¼ˆæœªå…¥åŠ›ï¼‰"}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}
//! ========== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ==========
attachEventListeners(){
//! æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
document.getElementById("backBtn")?.addEventListener("click",()=>{window.location.hash="#menu"}),
//! è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ã€‚
document.getElementById("settingsIcon")?.addEventListener("click",()=>{this.showSettings()}),
//! ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–ã€‚
document.querySelectorAll(".tab-button").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-category");e&&(this.state.currentCategory=e,this.state.selectedTemplate=null,this.state.showResult=!1,this.state.showAnswer=!1,this.state.showDialogFormat=!1,this.state.userInput="",this.saveCategory(),this.render())})}),
//! å®šå‹æ–‡é¸æŠãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".select-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-template-id");if(e)
//! ãƒ©ãƒ³ãƒ€ãƒ QSOç”Ÿæˆãƒœã‚¿ãƒ³ã®å ´åˆã€‚
if("qso-random-generate"===e)this.state.selectedTemplate=p.generateRandomQSO(),this.state.showResult=!1,this.state.showAnswer=!1,this.state.showDialogFormat=!1,this.state.userInput="",this.render(),this.renderPracticeArea();else{
//! é€šå¸¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã€‚
const t=[...p.getBuiltinTemplates(),...this.customTemplates].find(t=>t.id===e);t&&(this.state.selectedTemplate=t,this.state.showResult=!1,this.state.showAnswer=!1,this.state.showDialogFormat=!1,this.state.userInput="",this.render(),this.renderPracticeArea())}})}),
//! ä¸€è¦§ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€‚
document.getElementById("backToListBtn")?.addEventListener("click",()=>{this.state.selectedTemplate=null,this.state.showResult=!1,this.state.showAnswer=!1,this.state.showDialogFormat=!1,this.state.userInput="",this.audio.stopPlaying(),this.render()}),
//! ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å®šå‹æ–‡ã®æ–°è¦ä½œæˆãƒœã‚¿ãƒ³ã€‚
document.getElementById("addCustomBtn")?.addEventListener("click",()=>{this.showCustomTemplateDialog()}),
//! ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å®šå‹æ–‡ã®ç·¨é›†ãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".edit-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-template-id");if(e){const t=this.customTemplates.find(t=>t.id===e);t&&this.showCustomTemplateDialog(t)}})}),
//! ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©å®šå‹æ–‡ã®å‰Šé™¤ãƒœã‚¿ãƒ³ã€‚
document.querySelectorAll(".delete-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-template-id");e&&this.deleteCustomTemplate(e)})}),
//! å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆç·´ç¿’ç”»é¢ã®ã¿ï¼‰ã€‚
this.state.selectedTemplate&&(document.getElementById("playBtn")?.addEventListener("click",()=>{this.playMorse()}),document.getElementById("pauseBtn")?.addEventListener("click",()=>{this.pauseMorse()}),document.getElementById("stopBtn")?.addEventListener("click",()=>{this.stopMorse()}),document.getElementById("downloadBtn")?.addEventListener("click",()=>{this.downloadWav()}),this.renderPracticeArea())}async downloadWav(){if(this.state.selectedTemplate)try{
//! ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ã«å¤‰æ›ã€‚
const t=this.getTemplateText(this.state.selectedTemplate),e=l.textToMorse(t),n=await this.audio.generateWav(e);!function(t,e){const n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}(n,`${function(t){return t.replace(/[^a-zA-Z0-9_-]/g,"_")}(this.state.selectedTemplate.title)}.wav`)}catch(t){alert("WAVãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}destroy(){
//! AudioGeneratorã‚’åœæ­¢ã€‚
this.audio.stopPlaying()}}class S{currentView=null;routes=[];constructor(){
//! ãƒ«ãƒ¼ãƒˆå®šç¾©ã€‚
this.routes=[{path:"",view:v},{path:"menu",view:v},{path:"vertical",view:m},{path:"horizontal",view:g},{path:"flashcard",view:y},{path:"koch",view:w},{path:"listening",view:L}]}init(){
//! ãƒãƒƒã‚·ãƒ¥å¤‰æ›´æ™‚ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã€‚
window.addEventListener("hashchange",()=>this.handleRoute()),
//! åˆå›ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€‚
this.handleRoute()}handleRoute(){
//! ç¾åœ¨ã®ãƒ“ãƒ¥ãƒ¼ã‚’ç ´æ£„ã€‚
this.currentView&&(this.currentView.destroy(),this.currentView=null);
//! ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ‘ã‚¹ã‚’å–å¾—ï¼ˆ#ã‚’é™¤å»ï¼‰ã€‚
const t=window.location.hash.slice(1),e=this.routes.find(e=>e.path===t);e?(
//! ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€‚
this.currentView=new e.view,this.currentView.render()):
//! è©²å½“ã™ã‚‹ãƒ«ãƒ¼ãƒˆãŒãªã„å ´åˆã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«é·ç§»ã€‚
window.location.hash="#menu"}navigate(t){window.location.hash=`#${t}`}}
//! ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã®å‡¦ç†ã€‚
function I(){(new S).init()}
//! DOMContentLoadedå¾Œã«åˆæœŸåŒ–ã€‚
"loading"===document.readyState?document.addEventListener("DOMContentLoaded",I):I();
//# sourceMappingURL=index-BpmTl6A5.js.map
