# モールス体験 v2

TypeScriptで実装したモダンなモールス信号練習・検証用Webアプリケーション

## 🎯 特徴

- **型安全性**: TypeScriptによる静的型チェックで堅牢性を確保
- **軽量**: 47KB (gzip: 11KB) - v1より約23%削減
- **サーバー不要**: 単一HTMLファイルで動作、`file://`プロトコルでも利用可能
- **モダンな開発環境**: Vite + TypeScript + ホットリロード
- **モジュール設計**: ES6モジュールとクラスベースの構造化実装

## 📁 ディレクトリ構成

```
v2/
├── index.html          # 本番用ファイル (ビルド済み、47KB)
└── src/                # 開発環境
    ├── src/                # TypeScriptソースコード
    │   ├── main.ts             # エントリーポイント
    │   ├── audio-system.ts     # Web Audio APIによる音声生成
    │   ├── morse-code.ts       # モールス符号定義と変換ロジック
    │   ├── settings.ts         # 設定管理とLocalStorage連携
    │   ├── straight-key.ts     # 縦振り電鍵シミュレーション
    │   ├── paddle-key.ts       # 横振り電鍵 (Iambic A/B対応)
    │   └── ui-controls.ts      # UI制御とタブ管理
    ├── index.html          # 開発用HTMLテンプレート
    ├── style.css           # スタイルシート
    ├── package.json        # 依存関係定義
    ├── tsconfig.json       # TypeScript設定 (strict mode)
    └── vite.config.ts      # Viteビルド設定
```

## 🚀 使用方法

### 本番ファイル

`index.html`をブラウザで開くだけで動作します。

```bash
# ローカルで開く
open index.html         # macOS
xdg-open index.html     # Linux
start index.html        # Windows

# WSLから開く
file://wsl.localhost/Ubuntu/path/to/v2/index.html
```

## 🛠️ 開発

### セットアップ

```bash
cd src
npm install
```

### 開発サーバー

```bash
npm run dev
```

開発サーバーが起動し、ホットリロード機能が有効になります。
→ http://localhost:3000

### ビルド

```bash
npm run build
```

`src/dist/index.html`に最適化された単一HTMLファイルが生成されます。

```bash
# 本番用ファイルとして配置
cp dist/index.html ../index.html
```

### プレビュー

```bash
npm run preview
```

ビルド後のファイルをローカルサーバーでプレビューします。

## 📋 技術スタック

| 技術 | バージョン | 用途 |
|------|-----------|------|
| TypeScript | 5.9.3 | 型安全な開発 |
| Vite | 7.1.8 | ビルドツール |
| vite-plugin-singlefile | - | 単一HTMLファイル化 |
| Web Audio API | - | サイドトーン生成 |
| LocalStorage API | - | 設定永続化 |

## 📊 v1との比較

| 項目 | v1 (JavaScript) | v2 (TypeScript) |
|------|-----------------|-----------------|
| ファイルサイズ | 61KB | 47KB (gzip: 11KB) |
| 型安全性 | なし | あり (strict mode) |
| ビルドシステム | なし | Vite |
| 開発体験 | 手動リロード | ホットリロード |
| モジュール化 | グローバル変数 | ES6モジュール |
| 保守性 | 低 | 高 (型定義・クラス設計) |

## 🌐 ブラウザ互換性

- Chrome/Edge: ✅ 完全対応
- Firefox: ✅ 完全対応
- Safari: ✅ 対応 (一部制限あり)

---

## 📖 アプリケーション詳細仕様

### 画面構成

アプリケーションは単一ページで、以下の3つのモードをタブで切り替えます:

1. **縦振り電鍵**
2. **横振り電鍵**
3. **文字列変換**

### 共通UI要素

#### ヘッダー部

- **タブ切り替え**: 3つのモード間を切り替え
- **設定ボタン**: 各種パラメータを調整するモーダルを表示

#### 出力表示エリア

- **モールス符号表示**: 入力されたモールス信号を`. -`で表示
- **デコード結果表示**: モールス信号を文字に変換して表示
- **受理ログ**: デコードされた文字列の履歴を表示
  - お気に入り機能: ログをブックマークして保存
  - クリア機能: ログを全削除

### 1. 縦振り電鍵モード

#### 機能

- キーボード入力またはマウスクリックでモールス信号を送信
- 押下時間に応じて自動的にdit(・)とdash(ー)を判定
- リアルタイムでサイドトーンを再生

#### 操作方法

- **キー入力**: 設定で指定したキー(デフォルト: スペースキー)を押下
- **マウス入力**: 画面上のボタンをクリック/タッチ
- **判定基準**: 押下時間が閾値未満でdit、以上でdash

#### 時間パラメータ

- WPM (Words Per Minute)に基づいて1単位時間を算出: `1u = 1200 / WPM [ms]`
- dit = 1u
- dash = 3u
- 要素間ギャップ = 1u
- 文字間ギャップ = 3u
- 単語間ギャップ = 7u

### 2. 横振り電鍵モード

#### 機能

- エレキーパドルのシミュレーション
- Iambic A/Bモード対応
- スクウィーズ(左右同時押し)による高速入力
- 自動交互送信(dit-dash-dit-dash...)

#### 操作方法

- **左パドル**: dit(・)を送信(デフォルト: Aキー)
- **右パドル**: dash(ー)を送信(デフォルト: Lキー)
- **スクウィーズ**: 左右同時押しでdit/dashを交互に自動送信

#### Iambicモード

- **Iambic A**: 基本的な交互送信
- **Iambic B**: 最後の要素完了時に反対側が押されていれば追加送信

#### パドル設定

- **レイアウト反転**: 左右のdit/dash割り当てを入れ替え可能
- **キー割り当て**: 任意のキーボードキーに変更可能

### 3. 文字列変換モード

#### 機能

- テキスト入力欄に文字列を入力
- 入力文字列を自動的にモールス信号に変換
- 変換結果を音声とビジュアルで再生

#### 操作方法

- **テキスト入力**: 入力欄に変換したい文字列を入力
- **再生ボタン**: モールス信号として再生
- **停止ボタン**: 再生中の信号を中断

#### 対応文字

- **欧文モールス**: A-Z, 0-9, 基本記号
- **和文モールス**: ひらがな、カタカナ、一部の漢字

### 設定モーダル

#### 音声設定

- **音量**: 0-100%で調整
- **周波数**: サイドトーンの周波数(Hz)を設定
- **WPM**: 送信速度(Words Per Minute)を設定

#### 表示設定

- **モールス符号形式**: 欧文/和文の切り替え
- **日本語モード**: 和文モールス符号を使用

#### キー設定

- **縦振りキー**: 縦振りモードで使用するキーを設定
- **横振り左パドル**: 横振りモードの左パドルキーを設定
- **横振り右パドル**: 横振りモードの右パドルキーを設定

#### 横振り詳細設定

- **Iambicモード**: Iambic A/Bを選択
- **パドルレイアウト**: 左右のdit/dash割り当てを選択
- **スクウィーズインジケータ**: 同時押し状態を視覚的に表示

### データ永続化

- 全ての設定はLocalStorageに自動保存
- ページリロード後も設定を維持
- お気に入りログも永続化

### 音声システム

#### Web Audio API構成

- **Oscillator**: サイン波による純音生成
- **Gain Node**: エンベロープ制御
- **BiquadFilter**: バンドパスフィルタでクリック音抑制
- **DynamicsCompressor**: 音量の平滑化

#### エンベロープ

- 立ち上がり/立ち下がりに短いフェードを適用
- クリックノイズを抑制しながら明瞭な信号音を実現
