# モールス練習アプリ v8 - PWAアプリ版

v7の機能を維持しつつ、PWA（Progressive Web App）化に対応したバージョンです。
オフライン動作、ホーム画面へのインストール、アプリライクな体験を提供します。

## 🎯 v8の新機能（計画）

### PWA対応

v8ではPWA（Progressive Web App）化を実施し、以下の機能を提供します。

#### 1. オフライン対応

- **完全オフライン動作**: インターネット接続なしでアプリが動作
- **Service Worker**: アプリケーションファイルとデータファイルを自動キャッシュ
- **音声の安定性**: オフラインでもモールス音声生成が確実に動作

**技術実装**:
- vite-plugin-pwa を使用したService Workerの自動生成
- Workboxによる効率的なキャッシュ戦略
- flashcard.tsvなどのデータファイルもキャッシュ対象

#### 2. インストール可能

- **ホーム画面に追加**: スマートフォンやPCのホーム画面にアプリアイコンを追加
- **アプリライクな起動**: ブラウザのUIなしで専用アプリとして起動
- **スプラッシュスクリーン**: アプリ起動時の美しいスプラッシュ画面

**必要なファイル**:
- manifest.json: アプリメタデータ（名前、アイコン、テーマカラーなど）
- アイコン画像: 192x192px, 512x512px など各サイズ
- apple-touch-icon: iOS対応アイコン

#### 3. アプリ体験の向上

- **高速起動**: キャッシュから即座にロード、起動時間が大幅に短縮
- **バックグラウンド同期**: オフライン時の学習データを接続復帰時に同期（将来拡張）
- **プッシュ通知**: 学習リマインダーなどの通知機能（将来拡張）

#### 4. パフォーマンス最適化

- **リソースの効率的なキャッシュ**: 初回ロード後は高速アクセス
- **段階的な機能強化**: 基本機能は全ブラウザで動作、PWA機能は対応ブラウザのみ
- **オフラインファースト設計**: ネットワーク状態に依存しない安定動作

## 📋 PWA実装計画

### Phase 1: 基本PWA対応（予定）

1. **vite-plugin-pwaの導入**
   ```bash
   npm install -D vite-plugin-pwa
   ```

2. **manifest.jsonの作成**
   - アプリ名: "モールス練習アプリ"
   - 短縮名: "モールス練習"
   - テーマカラー: #1a1a2e（濃紺）
   - 背景色: #0f0f1e
   - 表示モード: standalone
   - 開始URL: ./

3. **アイコンの準備**
   - 192x192px（最小要件）
   - 512x512px（推奨）
   - apple-touch-icon.png（iOS用）
   - maskable icon（Android用）

4. **Service Workerの設定**
   - Workbox設定でキャッシュ戦略を定義
   - アプリシェル（HTML, CSS, JS）を事前キャッシュ
   - flashcard.tsvをランタイムキャッシュ
   - ネットワーク優先 → キャッシュフォールバック戦略

### Phase 2: 機能拡張（将来）

1. **オフライン学習データの同期**
   - IndexedDBで学習履歴を保存
   - オンライン復帰時にサーバーと同期

2. **学習リマインダー通知**
   - Web Push APIで学習時刻に通知
   - 学習習慣の形成を支援

3. **アップデート管理**
   - 新バージョンリリース時の自動更新
   - ユーザーへの更新通知

## 📁 ディレクトリ構造

```
v8/src/
├── index.html          # 単一エントリーポイント
├── main.ts             # アプリケーション起動ファイル
├── manifest.json       # PWA マニフェスト（追加予定）
├── sw.js               # Service Worker（自動生成）
├── icons/              # PWAアイコン（追加予定）
│   ├── icon-192.png
│   ├── icon-512.png
│   └── apple-touch-icon.png
├── core/               # 共有モジュール
│   ├── router.ts       # ルーティングシステム
│   ├── audio-system.ts # 音声システム
│   ├── morse-code.ts   # モールス符号変換
│   └── settings.ts     # 設定管理
├── modes/              # 各モード
│   ├── menu/           # メニュー画面
│   ├── vertical/       # 縦振り電鍵練習
│   ├── horizontal/     # 横振り電鍵練習
│   ├── flashcard/      # CW略語・Q符号学習
│   ├── koch/           # コッホ法トレーニング
│   └── listening/      # モールス信号聞き取り練習
├── components/         # 再利用可能なコンポーネント
└── styles/             # グローバルスタイル
    └── global.css
```

## 🚀 開発とビルド

### 開発サーバーの起動
```bash
cd v8/src
npm install
npm run dev
```

ブラウザで http://localhost:3000 を開きます。

### プロダクションビルド
```bash
cd v8/src
npm run build
```

ビルドされたファイルは `v8/dist/index.html` に出力されます。

### プレビュー
```bash
cd v8/src
npm run preview
```

## 🎓 5つの練習モード

### 1. 縦振り電鍵練習 (#vertical)
縦振り電鍵（ストレートキー）の操作を練習します。

### 2. 横振り電鍵練習 (#horizontal)
横振り電鍵（パドル）の操作を練習します。
- Iambic A/Bモード対応
- パドルレイアウト切り替え可能

### 3. CW略語・Q符号学習 (#flashcard)
無線通信で使用する略語とQ符号を学習します。
- フラッシュカードモード
- 試験モード
- 全295語収録

### 4. コッホ法トレーニング (#koch)
系統的にモールス符号を学習します。
- **基本学習モード**: 40文字を段階的に習得
- **試験モード**: 学習済み文字のテスト
- **任意文字列練習モード**: カスタマイズ可能な練習

### 5. モールス信号聞き取り練習 (#listening)
実践的な文章のモールス信号を聞き取る練習をします。
- **ラバースタンプQSO**: アマチュア無線の定型交信
- **ランダムQSO生成**: 毎回異なる交信内容を自動生成
- **英文練習**: 100字/200字/300字の英文
- **ユーザー定義**: 自分で作成した練習文

## 🔄 v7からの主な変更点

### 計画中の新規機能
- **PWA対応**: オフライン動作、インストール可能
- **Service Worker**: 効率的なキャッシュ管理
- **manifest.json**: アプリメタデータ
- **アプリアイコン**: 各サイズのアイコンセット
- **高速起動**: キャッシュによる即座のロード

### LocalStorageキーの変更
- v7からv8へのマイグレーション対応
- `v7.listening.*` → `v8.listening.*`

## 📝 技術スタック

- **TypeScript**: 型安全性とコード品質の向上
- **Vite**: 高速なビルドツール
- **vite-plugin-singlefile**: 単一HTMLファイル生成
- **vite-plugin-pwa**: PWA対応（追加予定）
- **Workbox**: Service Workerライブラリ（追加予定）
- **Web Audio API**: 音声生成
- **LocalStorage API**: 設定とユーザーデータの永続化

## 🔧 設定可能な項目

- 音量（0-100%）
- 周波数（100-2000Hz）
- 文字速度（Character Speed WPM）
- 実効速度（Effective Speed WPM）
- 練習時間（秒）
- グループサイズ（文字）
- Iambic A/Bモード（横振り電鍵）
- パドルレイアウト（normal/reversed）

## 📱 対応環境

### ブラウザ要件
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- Web Audio API対応必須
- LocalStorage対応必須

### PWA要件（追加）
- Service Worker対応ブラウザ
- HTTPS接続（開発環境ではlocalhostも可）
- manifest.json対応

### プラットフォーム
- デスクトップ（Windows, macOS, Linux）
- モバイル（Android, iOS）
- タブレット

## 🌟 PWAのメリット

### ユーザー体験
- **オフライン学習**: インターネット接続不要で練習可能
- **高速起動**: キャッシュから即座にロード
- **アプリライク**: ホーム画面から直接起動
- **安定動作**: ネットワーク状態に依存しない

### 技術的メリット
- **リソース効率**: 初回以降はネットワーク通信を最小化
- **段階的強化**: 基本機能は全ブラウザで動作
- **将来拡張性**: プッシュ通知、バックグラウンド同期など

## 🐛 既知の問題

- 一部のブラウザでは初回音声再生時にユーザージェスチャーが必要
- iOS Safariでは音声の自動再生に制限あり
- PWA機能は対応ブラウザでのみ利用可能

## 📄 ライセンス

ISC

## 👤 Author

モールス練習アプリ v8 - PWAアプリ版
