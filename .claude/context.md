# モールス練習アプリ - プロジェクトコンテキスト

このドキュメントは、Claude Codeがプロジェクトを理解するための情報を記録します。
次回以降のセッションでトークン消費を抑えるため、重要な情報を集約しています。

## プロジェクト概要

モールス符号の学習・練習を支援するWebアプリケーションです。
複数のバージョン(v2, v3, v4)が並行して開発されています。

## ディレクトリ構造

```
morse/
├── v2/                    # 旧バージョン
├── v3/                    # 旧バージョン
├── v4/                    # 最新バージョン（開発中）
│   ├── src/              # TypeScriptソースコード
│   │   ├── menu/         # メニューページ
│   │   ├── vertical/     # 縦振り電鍵練習
│   │   ├── horizontal/   # 横振り電鍵練習
│   │   ├── flashcard/    # CW略語・Q符号学習
│   │   ├── koch/         # コッホ法訓練
│   │   └── shared/       # 共通モジュール
│   ├── *.html            # ビルド済みHTMLファイル（単一ファイル）
│   ├── flashcard.tsv     # CW略語データ
│   └── TODO.md           # 実装予定・課題リスト
├── flashcard.tsv         # 元データ（v4にコピーされる）
└── .claude/
    └── context.md        # このファイル
```

## v4アーキテクチャ

### ビルドシステム
- **技術スタック**: TypeScript + Vite
- **出力形式**: 単一HTMLファイル（vite-plugin-singlefile使用）
- **ビルドコマンド**: `npm run build` (v4/src/ で実行)
- **ビルドスクリプト**:
  - TypeScriptコンパイル → 各ページをViteでビルド → dist/を親ディレクトリにコピー
  - postbuild.cjs が最終的なファイルコピーを実行

### 共通モジュール (v4/src/shared/)
- **audio-system.ts**: Web Audio APIを使った音声再生システム
  - モールス音の生成（連続音/パターン音）
  - 周波数・音量・WPM設定に対応
- **settings.ts**: LocalStorageベースの設定管理
- **morse-converter.ts**: モールス符号変換（未確認）

### 各ページの概要

#### 1. メニューページ (menu/)
- v4のトップページ
- 各機能へのリンク集
- カードレイアウトで表示

#### 2. 縦振り電鍵練習 (vertical/)
- 縦振り電鍵のシミュレーター
- スペースキーまたはタップで操作
- リアルタイムでモールス音を再生

#### 3. 横振り電鍵練習 (horizontal/)
- 横振り電鍵のシミュレーター
- 左右のキー（A/L）またはタップで操作
- **既知の問題**: v2との動作乖離あり（TODO.md参照）

#### 4. CW略語・Q符号学習 (flashcard/)
**現在実装されている機能**:
- flashcard.tsvからデータ読み込み
- タグベースフィルタリング
- 使用頻度の星表示（★☆で1-5段階）
- 表示モード切り替え:
  - カード表示: グリッドレイアウトで見やすく表示
  - リスト表示: v3互換のテーブル形式

**未実装の機能** (TODO.md参照):
- フラッシュカード学習モード（カードめくり）
- 試験モード（ランダム出題）
- 正答率記録・統計表示
- LocalStorage統合

**データ構造** (flashcard.tsv):
```
tags	frequency	abbreviation	english	japanese
Q符号	5	QTH	Location	こちらの位置は
...
```

#### 5. コッホ法訓練 (koch/)
- コッホ法によるモールス符号学習
- レッスンベースで段階的に文字を学習
- **現在の実装**:
  - レッスン1: K, M の2文字
  - レッスン2以降: 段階的に文字追加
  - 設定UI（音響設定、速度設定など）
  - グループベースキーボードUI

## 最近の変更履歴

### 2025-10-06
1. **トップページデザイン刷新**
   - v4風のカードレイアウトに変更
   - グリッドレイアウトでレスポンシブ対応

2. **コッホ法訓練の改善**
   - レッスン1をKのみからKとMの2文字に変更
   - 設定ボタンをアイコンのみに変更
   - レッスン一覧を40レッスンに制限
   - レッスンアイテムのクリック機能追加

3. **CW略語・Q符号学習の機能追加**
   - 使用頻度の星表示（★☆）を実装
   - カード/リスト表示切り替え機能を実装
   - リスト表示はv3互換のテーブル形式

## 開発ガイドライン

### コーディング規約
- インデント: タブ使用
- コメント: 日本語で記述、必ず句点(。)をつける
- TypeScript: 関数ごとに分割、型定義を明確に

### Git運用
- コミットメッセージ: Angular Conventional Commit形式、日本語
- ブランチ: 基本的にmasterで開発（現状）
- コミット粒度: 適度な粒度で機能単位

### ビルド・デプロイ
- 開発時: `npm run dev` (v4/src/)
- ビルド: `npm run build` (v4/src/)
- 出力先: v4/*.html（単一HTMLファイル）

## 重要な設計判断

1. **単一HTMLファイル形式**
   - デプロイが簡単（ファイルをコピーするだけ）
   - オフライン動作が容易
   - CDN不要

2. **LocalStorage活用**
   - 設定の永続化
   - 学習進捗の保存（今後実装予定）

3. **Web Audio API使用**
   - モールス音の生成
   - 精密なタイミング制御が可能

## TODO: 優先度が高いタスク

詳細はv4/TODO.mdを参照。主要なものは:

1. 横振り電鍵のv2互換性確保
2. フラッシュカード学習モードの実装
3. コッホ法の設定UI拡張
4. 統計・可視化機能

## トラブルシューティング

### ビルドエラー
- **現象**: npm run buildが失敗
- **原因**: v4/src/でコマンドを実行していない
- **解決**: `cd v4/src && npm run build`

### 音が出ない
- **原因**: AudioContextの初期化タイミング
- **解決**: ユーザーインタラクション後に初期化（実装済み）

## 参考リンク

- Web Audio API: https://developer.mozilla.org/ja/docs/Web/API/Web_Audio_API
- Vite: https://vitejs.dev/
- コッホ法: モールス符号学習の段階的手法

---

**更新日**: 2025-10-06
**最終更新者**: Claude Code
